--------------------------- MODULE conntrackVuln ---------------------------

EXTENDS Naturals, TLC, Sequences, FiniteSets
\* Modification History
\* Last modified Fri Dec 29 16:48:33 GMT-07:00 2023 by tarun
\* Last modified Tue Feb 07 18:01:31 MST 2023 by conntrack
\* Last modified Mon Feb 06 23:33:18 UTC 2023 by ben
\* Created Tue Oct 11 10:53:30 MDT 2022 by conntrack
(* --algorithm conntrackVuln {

variables
A = "A",
B = "B",
C = "C",
D = "D",
N = "N",
E = "E",
NN = "NN",
Aa="a", 
Bb="b",
Cc="c",
Dd="d",
Ee="e",
Ff="f",
Gg="g",
Hh="h",
Ii="i",
Jj="j",
Kk="k",
Ll="l",
Mm="m",
Nn="n", 
Oo="o",
Pp="p",
Qq="q", 
Rr="r", 
Ss="s", 
Tt="t",
Uu="u",
Vv="v",
Ww="w", 
Xx="x",
Yy="y",
Zz="z",
H1 = 1,
H2 = 2,

MaxPorts=1,
EP1 = "N1",
PortMap1 = <<>>,
EP2 = "N2",
PortMap2 = <<>>,
TableFull=FALSE,
EvictionReroute=FALSE,
PortScanInv=FALSE,
MaxTableSize=2,
hosts = <<H1, H2, C>>;
FreeHosts = <<H1, H2>>,

UsedHosts = <<>>,
Ports = <<A, B, C, NN>>,
ExtraPorts = <<D>>;
ExtraExtraPorts = <<Aa, Bb, Cc, Dd,Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz>>;
T = <<>>,
FreeIPs = <<A, B>>,
UsedIPs = <<>>,
Connections = <<>>,
SendQueue = <<>>,
RcvQueue = <<>>,
MAX = 3,
Marker1 = H1,
Marker2 = H2;
CmdConnect = "Connect";
CmdDisconnect = "Disconnect";
PortSpaceFull = FALSE; 

(* BEGIN: vulnerable versions *)

procedure ConnectVuln(depth)
  variables host, hidx, host_idx, pidx, port_idx
{
  connectVEvtSeqV: call EventSequenceVuln(depth);
  connectVStart:
  if ( Len(FreeHosts) > 0 ) {
      print <<"ConnectVuln:", FreeHosts, FreeHosts>>;
      host_idx := DOMAIN FreeHosts;
      hidx := CHOOSE h \in host_idx : TRUE;
      host := FreeHosts[hidx];
      (*
      FreeIPs := SelectSeq(FreeIPs, LAMBDA e: ~(e=ip));
      UsedIPs := Append(UsedIPs, ip);
      *)
      FreeHosts := SelectSeq(FreeHosts, LAMBDA a: a /= host);
      UsedHosts := Append(UsedHosts, host);
      ip_idx := DOMAIN FreeIPs;
      ipidx := CHOOSE ipp \in ip_idx : TRUE;
      ip := FreeIPs[ipidx];
      FreeIPs := SelectSeq(FreeIPs, LAMBDA d: d /= ip);
      UsedIPs := Append(UsedIPs, ip);
      Connections := Append(Connections, <<ip, host>>);
      (* SendQueue := Append(SendQueue, pkt); *)
  };
  connectVRet: return;
}

procedure DisconnectVuln(depth)
variables ip, host, connDomain, cidx, conn
{
  disconnectVEvtSV: call EventSequenceVuln(depth);
  disconnectVStart: 
  if ( Len(Connections) > 0) {
    connDomain := DOMAIN Connections;
    cidx := CHOOSE c \in connDomain : TRUE;
    conn := Connections[cidx];
    ip := conn[1];
    host := conn[2];

    print << "Disconnect- Before:", host, ip, Connections>>;
    Connections := SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip);
    UsedIPs := SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip);
    FreeIPs := Append(FreeIPs, ip);
    
    FreeHosts := Append(FreeHosts, host);
    UsedHosts := SelectSeq(UsedHosts, LAMBDA m: m /= host);
    
    print << "Disconnect- After: ", host, ip, Connections>>;
  };
  disconnectRet: return ;
}

(*Manually connect instead of randomly selecting one of the IPs.*)
procedure ConnectMan(host, ip)
  variables hidx, host_idx, pidx, port_idx
{
  connectManStart:
  if ( Len(FreeHosts) > 0 ) {
      print << "ConnectMan - BEFORE ", FreeHosts, FreeIPs, Connections>>;

      (* *)FreeIPs := SelectSeq(FreeIPs, LAMBDA e: ~(e=ip));
      UsedIPs := Append(UsedIPs, ip); 
      FreeHosts := SelectSeq(FreeHosts, LAMBDA a: a /= host);
      UsedHosts := Append(UsedHosts, host);
      (*  *)  Connections := Append(Connections,  <<ip, host>>);
      print << "ConnectMan - AFTER ", FreeHosts, FreeIPs, Connections>>;
      port_idx := DOMAIN Ports;
      pidx := CHOOSE p \in port_idx : TRUE;
  };
  connectManRet: return;
}

procedure DisconnectMan(host, ip)
variables connDomain, cidx, conn
{
  disconnectManStart: 

  if ( Len(Connections) > 0) {
    print << "DisconnectMan - Before:", host, ip, Connections>>;
    Connections := SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip);
    UsedIPs := SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip);
    FreeIPs := Append(FreeIPs, ip);
    FreeHosts := Append(FreeHosts, host);
    UsedHosts := SelectSeq(UsedHosts, LAMBDA m: m /= host);
    print << "DisconnectMan - After: ", host, ip, Connections>>;
    (* Remove translations for host that disconnected. *)
    disconnectVulnPurgeOrphans1: T := SelectSeq(T, LAMBDA e: e.orig.saddr /= ip);
    disconnectVulnPurgeOrphans2: T := SelectSeq(T, LAMBDA e: e.orig.saddr /= host);    
    if (host=H1) {
        PortMap1 := <<>>;
    } else {
        PortMap2 := <<>>;
    };

    
  };
  disconnectManRet: return ;
}

procedure DisconnectVulnMan(host, ip)
variables connDomain, cidx, conn
{
  disconnectVulnManStart: 

  if ( Len(Connections) > 0) {

    print << "DisconnectVulnMan- Before:", host, ip, Connections>>;     
    Connections := SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip);
    UsedIPs := SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip);
    FreeIPs := Append(FreeIPs, ip);
    FreeHosts := Append(FreeHosts, host);
    UsedHosts := SelectSeq(UsedHosts, LAMBDA m: m /= host);
    print << "DisconnectVulnMan - After: ", host, ip, Connections>>;
    (* Remove translations for host that disconnected. *)    
  };
  disconnectVulnManRet: return ;
}


procedure Evict() {
  evictStart:
  print "Evict";
  if (Len(T) > 0) {
    T := Tail(T);
  };
  evictRet: return;
}

procedure PubToPrivVuln(depth)
variables pkt, ipkt, entry, conn, hostMarker, ip_idx, ipidx, ip, host
{
  pubtoprivVEvt3: call EventSequenceVuln(depth);
  pubtoprivVStart:
  if (Len(SendQueue) > 0) {
    pkt := Head(SendQueue);
    print <<"PubToPrivMan - Len(SendQueue) > 0:", pkt, Connections, T>>;
    SendQueue := Tail(SendQueue);
    if (Len(T) > 0) {
      print <<"PubToPrivMan - Len(T) > 0:">>;
      entry := SelectSeq(T, LAMBDA e: e.reply.saddr=pkt.saddr /\ 
                                      e.reply.sport=pkt.sport /\
                                      e.reply.daddr=pkt.daddr /\
                                      e.reply.dport=pkt.dport);
      if (entry=defaultInitValue) {
        pubtirprivVDE: return ;
      };
      pubtoprivEEmpty:
      if (Len(entry) <= 0) {
         print <<"PubToPrivVuln - Empty Entry">>
         (* assert(FALSE); We can just let this slide since it's OK in real networks.*)
      } else {
        print <<"PubToPrivMan - Len(entry) > -0:", entry, pkt>>;
        (* There is a matching translation/routing rule. *)
        pubtoPrivElse: entry := Head(entry);
        if (entry.reply.dport=N) {
          print <<"PubToPrivMan - PortShadow: ", entry, pkt>>;
        };
        if ( entry.host_marker/=pkt.host_marker ) {
          print <<"PubToPrivMan - entry.host_marker/=pkt.host_marker:", entry, pkt>>;
          (* 
          EvictionReroute and Request Diversion:
 
          The case when the host creates a private host creates an entry and a different host sends a packet
          to the intermediary is not always error in at least two cases, when the host expects 
          a response and its entry is evicted and replaced by anothe private host and when the port
          is a listening port. Otherwise, this looks like NAT traverseral or P2P traffic.
          
          Error because of a bad eviction. The host who generated the packet
          is different from the host receiving the packet. *)
          if (pkt.host_marker = H1) {
            Marker1 := entry.host_marker;
          } else {
            Marker2 := entry.host_marker;
          };
          print <<"PubToPrivMan-Eviction Error: pkt", pkt, " entry", entry, "Connections:", Connections, "T: ", T>>;              
          (* assert(entry.host_marker= pkt.host_marker); *)
        };
        conn := SelectSeq(Connections, LAMBDA e: entry.orig.saddr = Head(e));
        if (Len(conn) > 0) {
          pubtoprivVConngt1: conn := Head(conn);
          pubtoprivVConngt2: hostMarker := conn[2];
          (* PortScanning: Error because of a switched private host host.
          print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
          print <<"Marker1", Marker1, "Marker2", Marker2>>;*)
          if ( hostMarker = H1 ) {
            if (entry.host_marker = H2) {
              PortScanInv := TRUE;
            };
            Marker1 := entry.host_marker;
          } else {
            if (entry.host_marker = H1) {
              PortScanInv := TRUE;
            };       
            Marker2 := entry.host_marker;
          };
          (* print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
          print <<"Marker1", Marker1, "Marker2", Marker2>>;
          HostMarkers[hostMarker] := entry.host_marker;              
          assert( hostMarker = entry.host_marker);*)
        };        
      };
    };
  };
  pubtopriVvRet: return ;
}

procedure PubToPrivMan()
variables pkt, ipkt, entry, conn, hostMarker, ip_idx, ipidx, ip, host
{
  pubtoprivManStart:
  if (Len(SendQueue) > 0) {
    pkt := Head(SendQueue);
    print <<"PubToPrivMan - Len(SendQueue) > 0:", pkt, Connections, T>>;
    SendQueue := Tail(SendQueue);
    if (Len(T) > 0) {
      print <<"PubToPrivMan - Len(T) > 0:">>;
      entry := SelectSeq(T, LAMBDA e: e.reply.saddr=pkt.saddr /\ 
                                      e.reply.sport=pkt.sport /\
                                      e.reply.daddr=pkt.daddr /\
                                      e.reply.dport=pkt.dport);
      if (Len(entry) <= 0) {
        assert(FALSE); (*We can just let this slide since it's OK in real networks.*)
      } else {
        print <<"PubToPrivMan - Len(entry) > -0:", entry, pkt>>;
        (* There is a matching translation/routing rule. *)
        pubtoPrivElse: entry := Head(entry);
        if (entry.reply.dport=N) {
          print <<"PubToPrivMan - PortShadow: ", entry, pkt>>;
        };
        if ( entry.host_marker/=pkt.host_marker ) {
          print <<"PubToPrivMan - entry.host_marker/=pkt.host_marker:", entry, pkt>>;
          (* EvictionReroute:
          Error because of a bad eviction. The host who generated the packet
          is different from the host receiving the packet. *)
          if (pkt.host_marker = H1) {
             Marker1 := entry.host_marker;
             if (entry.host_marker = H2) {
               EvictionReroute := TRUE;
             };
          } else {
             Marker2 := entry.host_marker;
             if (entry.host_marker = H1) {
               EvictionReroute := TRUE;
             };
          };
          print <<"PubToPrivMan - Eviction Error: pkt", pkt, " entry", entry, "Connections:", Connections, "T: ", T>>;
          (* assert(entry.host_marker= pkt.host_marker); *)
        };
        conn := SelectSeq(Connections, LAMBDA e: entry.orig.saddr = Head(e));
        if (Len(conn) > 0) {
          pubtoprivConngt1: conn := Head(conn);
          pubtoprivConngt2: hostMarker := conn[2];
          (*Error because of a switched host.
          print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
          print <<"Marker1", Marker1, "Marker2", Marker2>>;*)
          if ( hostMarker = H1 ) {
            if (entry.host_marker = H2) {
              PortScanInv := TRUE;
            };
            Marker1 := entry.host_marker;
          } else {
            if (entry.host_marker = H1) {
              PortScanInv := TRUE;
            };       
            Marker2 := entry.host_marker;
          };
          (* print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
          print <<"Marker1", Marker1, "Marker2", Marker2>>;
          HostMarkers[hostMarker] := entry.host_marker;              
          assert( hostMarker = entry.host_marker);*)
        };        
      };
    };
  } else {
    print <<"PubToPrivMan - Else Len(SendQueue) <= 0">>;
  };
  pubtoprivRet: return ;
}

procedure PrivToPubMan2(conn, sport, dstAddr, dport) 
 variables pkt, hostMarker, daddr, hostidx, hidx,
 otherEntry, i, indicies, portDomain, sourcePort, destPort, new_sport
{
  privtopubManStart:
  if (Len (Connections) > 0) {
    sourcePort := sport; (* Ports[sourcePort]; *)
    privtopubMan2Dport: destPort := dport; (* Ports[destPort]; *)
    daddr := dstAddr; (*hosts[hidx]; *)
    (* *)print <<"PrivToPub - Conn: ", conn>>; 
    hostMarker := Head(Tail(conn));
    pkt := [saddr |-> Head(conn), sport |-> sourcePort, (*XXX: Might need to change this to make sure the old attacks work*)
            daddr |-> daddr, dport |-> destPort,
            host_marker |-> hostMarker
           ];
    print <<"PrivToPubMan - pkt: ", conn, pkt>>;
           
    entry := [host_marker |-> hostMarker,
              orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                        daddr |-> pkt.daddr, dport |-> pkt.dport],
              reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                         daddr |-> N,  dport |-> pkt.sport ]]; (*Doesn't account for selecting a new packet*)

    otherEntry := SelectSeq(T, LAMBDA k: k.reply.saddr=pkt.daddr /\ k.reply.sport=pkt.dport /\
                                         k.reply.daddr=N /\ k.reply.dport=pkt.sport);
    (* *)print <<"PrivToPub - T", T, otherEntry, pkt>>; 
    if ( Len(otherEntry) > 0) {
          T := SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt.daddr /\ e.reply.sport=pkt.dport /\
                                        e.reply.daddr=N /\ e.reply.dport=pkt.sport) );
    };
    privtoPubMan2AddT: T := Append(T, entry);
    privtopubPkt: pkt := [saddr |->pkt.daddr, sport |-> pkt.dport,
                          daddr |-> N, dport |-> pkt.sport,
                          host_marker |-> hostMarker];
    SendQueue := Append(SendQueue, pkt);
  };
  privtopubMan2Ret: return;
}

procedure PrivToPubVuln(depth)
 variables pkt, conn, hostMarker, daddr, hostidx, hidx,
 otherEntry, i, indicies, portDomain, sourcePort, destPort, new_sport
{
  privtopubV3: call EventSequenceVuln(depth);
  privtopubManStart:
  if (Len (Connections) > 0) {
    indicies := DOMAIN Connections;
    portDomain := DOMAIN Ports;
    sourcePort := CHOOSE pr \in portDomain : TRUE;
    i := CHOOSE f \in indicies : TRUE;
    (* *)print <<"PrivToPub - conn", indecies, conn, Connections>>; 
    privtopubConn: conn := Connections[i];
    sourcePort := Ports[sourcePort];
    portDomain := DOMAIN Ports;
    destPort := CHOOSE h \in portDomain : TRUE;
    privtopubDport: destPort := Ports[destPort];
    hostidx := DOMAIN hosts;
    hidx := CHOOSE hid \in hostidx : TRUE;
    daddr := hosts[hidx];
    (* *) print <<"PrivToPubVuln - Conn: ", conn>>; 
    hostMarker := Head(Tail(conn));

    pkt := [saddr |-> Head(conn), sport |-> sourcePort, (*XXX: Might need to change this to make sure the old attacks work*)
            daddr |-> daddr, dport |-> destPort,
            host_marker |-> hostMarker
           ];
    print <<"PrivToPubMan - pkt: ", conn, pkt>>;
           
    entry := [host_marker |-> hostMarker,
              orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                        daddr |-> pkt.daddr, dport |-> pkt.dport],
              reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                         daddr |-> N,  dport |-> pkt.sport ]]; (*Doesn't account for selecting a new packet*)

    otherEntry := SelectSeq(T, LAMBDA k: k.reply.saddr=pkt.daddr /\ k.reply.sport=pkt.dport /\
                                         k.reply.daddr=N /\ k.reply.dport=pkt.sport /\ k.host_marker /= hostMarker);
    (* *)print <<"PrivToPub - T", T, otherEntry, pkt>>; 
    if ( Len(otherEntry) > 0) {
          T := SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt.daddr /\ e.reply.sport=pkt.dport /\
                                        e.reply.daddr=N /\ e.reply.dport=pkt.sport) );
    };
    privtoPubManAddT: T := Append(T, entry);
      if ( Len(T) > MaxTableSize ) {
          TableFull := TRUE;
      };
    
    privtopubPkt: pkt := [saddr |->pkt.daddr, sport |-> pkt.dport,
                          daddr |-> N, dport |-> pkt.sport,
                          host_marker |-> hostMarker];
    SendQueue := Append(SendQueue, pkt);
  };
  privtopubRet: return;
}


procedure PrivToPubMan() 
 variables pkt, conn, hostMarker, daddr, hostidx, hidx,
 otherEntry, i, indicies, portDomain, sourcePort, destPort, new_sport
{
  privtopubManStart:
  if (Len (Connections) > 0) {
    indicies := DOMAIN Connections;
    portDomain := DOMAIN Ports;
    sourcePort := CHOOSE pr \in portDomain : TRUE;
    i := CHOOSE f \in indicies : TRUE;
    privtopubManConn: conn := Connections[i];
    sourcePort := B; (* Ports[sourcePort]; *)
    portDomain := DOMAIN Ports;
    (* *) destPort := CHOOSE h \in portDomain : TRUE; 
    privtopubManDport: destPort := C; (* Ports[destPort]; *)
    hostidx := DOMAIN hosts;
    hidx := CHOOSE hid \in hostidx : TRUE;
    daddr := C; (*hosts[hidx]; *)
    (* *)print <<"PrivToPubMan - Len(connections) > 0: ", indicies, conn, Connections>>; 
    hostMarker := Head(Tail(conn));
    pkt := [saddr |-> Head(conn), sport |-> sourcePort, (*XXX: Might need to change this to make sure the old attacks work*)
            daddr |-> daddr, dport |-> destPort,
            host_marker |-> hostMarker
           ];
    print <<"PrivToPubMan - conn, pkt: ", conn, pkt>>;
           
    entry := [host_marker |-> hostMarker,
              orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                        daddr |-> pkt.daddr, dport |-> pkt.dport],
              reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                         daddr |-> N,  dport |-> pkt.sport ]]; (*Doesn't account for selecting a new packet*)

    otherEntry := SelectSeq(T, LAMBDA k: k.reply.saddr=pkt.daddr /\ k.reply.sport=pkt.dport /\
                                         k.reply.daddr=N /\ k.reply.dport=pkt.sport);
    (* *)print <<"PrivToPubMan - T", T, otherEntry, pkt>>; 
    if ( Len(otherEntry) > 0) {
          T := SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt.daddr /\ e.reply.sport=pkt.dport /\
                                        e.reply.daddr=N /\ e.reply.dport=pkt.sport) );
    };
    privtoPubManAddT: T := Append(T, entry);
    privtopubPkt: pkt := [saddr |->pkt.daddr, sport |-> pkt.dport,
                          daddr |-> N, dport |-> pkt.sport,
                          host_marker |-> hostMarker];
    SendQueue := Append(SendQueue, pkt);
  };
  privtopubRet: return;
}
(*END: vulnerable versions *)

(*BEGIN: fixed version*)
procedure Connect(depth)
  variables host, hidx, host_idx, pidx, port_idx
{
  connectStart: call EventSequence(depth);
  connectIf: if ( Len(FreeHosts) > 0 ) {
      host_idx := DOMAIN FreeHosts;
      hidx := CHOOSE h \in host_idx : TRUE;
      host := FreeHosts[hidx];
      (* print << "Connect - BEFORE ", host, FreeHosts, UsedHosts, Connections>>;
      FreeIPs := SelectSeq(FreeIPs, LAMBDA e: ~(e=ip));
      UsedIPs := Append(UsedIPs, ip); *)
      FreeHosts := SelectSeq(FreeHosts, LAMBDA a: a /= host);
      UsedHosts := Append(UsedHosts, host);
      (* print << "Connect - BEFORE ", host, FreeHosts, UsedHosts, Connections>>;
      Connections := Append(Connections,  <<ip, host>>); *)
      port_idx := DOMAIN Ports;
      pidx := CHOOSE p \in port_idx : TRUE;
      (* The vulnerable version selects an I Pfrom the FreeIPs list, the fixed version does not. Why? Because we are statically assigning an IP to each host and this is this is equivalent to doing that.  *)
      pkt := [ saddr |-> host, sport |-> Ports[pidx],
               daddr |-> N,    dport |-> N,
               cmd |-> CmdConnect,
               host_marker |-> host];

      SendQueue := Append(SendQueue, pkt); 
  };
  connectRet: return;
}

procedure Disconnect(depth)
variables ip, host, connDomain, cidx, conn
{
  disconnectStart: call EventSequence(depth);
  disconnectIf: 
  if ( Len(Connections) > 0) {
    connDomain := DOMAIN Connections;
    cidx := CHOOSE c \in connDomain : TRUE;
    conn := Connections[cidx];
    ip := conn[1];
    host := conn[2];

    print << "Disconnect- Before:", host, ip, Connections>>;
    Connections := SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip);
    UsedIPs := SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip);
    FreeIPs := Append(FreeIPs, ip);
     
    (* Remove translations for host that disconnected. *)
    disconnectPurgeOrphans1: T := SelectSeq(T, LAMBDA e: e.orig.saddr /= ip);
    disconnectPurgeOrphans2: T := SelectSeq(T, LAMBDA e: e.orig.saddr /= host);    
    if (host=H1) {
        PortMap1 := <<>>;
    } else {
        PortMap2 := <<>>;
    };
    FreeHosts := Append(FreeHosts, host);
    UsedHosts := SelectSeq(UsedHosts, LAMBDA m: m /= host);
    print << "Disconnect- After: ", host, ip, Connections>>;
  };
  disconnectRet: return ;
}

procedure PubToPriv(depth)
variables pkt, ipkt, entry, conn, hostMarker, ip_idx, ipidx, ip, host
{
  pubtoprivStart: call EventSequence(depth);

  pubtoprivIf: if (Len(SendQueue) > 0) {
    (*
    1. Select a packet from the send queue
    2. Find the entries mapping, if it exists.
    3. Check that the packets host marker and the table entry's host marker are the same.
    4.  If they are, route it else this is an error
    *)
    pkt := Head(SendQueue);
    print <<"PubToPriv", pkt, Connections>>;
    (* print <<"PubToPriv", pkt, SendQueue>>; *)
    SendQueue := Tail(SendQueue);
    entry := SelectSeq(T, LAMBDA e: e.reply.saddr=pkt.saddr /\ 
                                    e.reply.sport=pkt.sport /\
                                    e.reply.daddr=pkt.daddr /\
                                    e.reply.dport=pkt.dport);
    (* print <<"PubToPriv", pkt, entry>>; *)
    (* If there isn't a translation, it's meant for us. *)
    if (Len(entry) <= 0) {
      if (pkt.dport = N ) {
        (*Connect to a listening port. *)
        if (Len(FreeIPs) > 0) {
          ip_idx := DOMAIN FreeIPs;
          ipidx := CHOOSE ipp \in ip_idx : TRUE;
          ip := FreeIPs[ipidx];
          FreeIPs := SelectSeq(FreeIPs, LAMBDA d: d /= ip);
          UsedIPs := Append(UsedIPs, ip);
          host := pkt.saddr;
          Connections := Append(Connections, <<ip, host>>);
        } (*else {
          assert(TRUE);
        }*);
      } else if ( pkt.dport = NN ) {
        (* XXX: Get the packet back to the private realm hosts
        or DO a check *)
        assert(TRUE);
      } else {
        (*XXX: This is when the destination port is not anything.
          In theory, this would lead to an ICMP or something.
        *)
        assert(TRUE);
      };
    } else {
      (* There is a matching translation/routing rule. *)
      pubtoPrivElse: entry := Head(entry);
      
      if (entry.reply.dport=N) {
        print <<"PubToPriv - PortShadow: ", entry, pkt>>;
      };
      if ( entry.host_marker/=pkt.host_marker ) {
        (* EvictionReroute:
              
        Error because of a bad eviction. The host who generated the packet
        is different from the host receiving the packet. *)
        if (pkt.host_marker = H1) {
           Marker1 := entry.host_marker;
           if (entry.host_marker = H2) {
             EvictionReroute := TRUE;
           };
        } else {
           Marker2 := entry.host_marker;        
           if (entry.host_marker = H1) {
             EvictionReroute := TRUE;
           };
        };
        print <<"PubToPriv-Eviction Error: pkt", pkt, " entry", entry, "Connections:", Connections, "T: ", T>>;              
          (* assert(entry.host_marker= pkt.host_marker); *)
      };
      (* PortScan:
          
      Insecure because the incoming packets host_marker doesn't match 
      the host associated with the incoming packet*)
          
      conn := SelectSeq(Connections, LAMBDA e: entry.orig.saddr = Head(e));
      if (Len(conn) > 0) {
        pubtoprivConngt1: conn := Head(conn);
        pubtoprivConngt2: hostMarker := conn[2];
        (*Error because of a switched host.
        print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
        print <<"Marker1", Marker1, "Marker2", Marker2>>;*)
        if ( hostMarker = H1 ) {
          if (entry.host_marker = H2) {
            PortScanInv := TRUE;
          };
          Marker1 := entry.host_marker;
        } else {
          if (entry.host_marker = H1) {
            PortScanInv := TRUE;
          };       
          Marker2 := entry.host_marker;
        };
        (* print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
        print <<"Marker1", Marker1, "Marker2", Marker2>>;
        HostMarkers[hostMarker] := entry.host_marker;              
        assert( hostMarker = entry.host_marker);*)
      };
    };
  };
  pubtoprivRet: return ;
}

procedure PrivToPub(depth) 
 variables pkt, conn, hostMarker, daddr, hostidx, hidx, otherEntry, i, indicies, portDomain, sourcePort, destPort, new_sport, good
{
  privtopubStart: call EventSequence(depth);
  privtopubIf: 
  good:=TRUE;
  if (Len (Connections) > 0) {
    indicies := DOMAIN Connections;
    portDomain := DOMAIN Ports;
    sourcePort := CHOOSE pr \in portDomain : TRUE;
    i := CHOOSE f \in indicies : TRUE;
    (* print <<"PrivToPub - conn", indecies, conn, Connections>>; *)
    privtopubConn: conn := Connections[i];
    sourcePort := Ports[sourcePort];
    portDomain := DOMAIN Ports;
    destPort := CHOOSE h \in portDomain : TRUE;
    privtopubDport: destPort := Ports[destPort];
    hostidx := DOMAIN hosts;
    hidx := CHOOSE hid \in hostidx : TRUE;
    daddr := hosts[hidx];
    (* print <<"PrivToPub - Conn: ", conn>>; *)
    hostMarker := Head(Tail(conn));

    if (hostMarker=H1) {
      if (Len(PortMap1) >= MaxPorts) {
          good := FALSE;
          privtopubMaxPorts1: return;
      } else {
        PortMap1 := Append(PortMap1, sourcePort);
      }
    } else {
      if (Len(PortMap2) >= MaxPorts) {
          good := FALSE;
          privtopubMaxPorts2: return;
      } else {
         PortMap2 := Append(PortMap2, sourcePort);
      }
    };
    privtopubGood: if ( good ) {
      privToPubPkt1:
      if (sourcePort = N) {
          if ( hostMarker=H1 ) {
            sourcePort := EP1;
          } else {
            sourcePort := EP2;            
          };
      };
      pkt := [saddr |-> Head(conn), sport |-> sourcePort, (*XXX: Might need to change this to make sure the old attacks work*)
              daddr |-> daddr, dport |-> destPort,
              host_marker |-> hostMarker
             ];
      print <<"PrivToPub - pkt: ", conn, pkt>>;

      entry := [host_marker |-> hostMarker,
                orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                          daddr |-> pkt.daddr, dport |-> pkt.dport],
                reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport,
                           daddr |-> N,  dport |-> pkt.sport ]]; (*Doesn't account for selecting a new packet*)

      otherEntry := SelectSeq(T, LAMBDA k: k.reply.saddr=pkt.daddr /\ k.reply.sport=pkt.dport /\
                                           k.reply.daddr=N /\ k.reply.dport=pkt.sport /\
                                           k.hostMarker /= hostMarker);
      (* print <<"PrivToPub - T", T, otherEntry, pkt>>; *)
      if ( Len(otherEntry) > 0) {
          (* Should we force the eviction? Do it for now.*)
          print "Evict";
          if (Len(ExtraPorts) > 0) {
            new_sport := Head(ExtraPorts);
            ExtraPorts := Tail(ExtraPorts);
            privToPubNewPort: entry := [host_marker |-> hostMarker,
                      orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                                daddr |-> pkt.daddr, dport |-> pkt.dport],
                      reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                                 daddr |-> N,  dport |-> new_sport ]]; (*Doesn't account for selecting a new packet*)
          
            (* T := SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt.daddr /\ e.reply.sport=pkt.dport /\
                                        e.reply.daddr=N /\ e.reply.dport=pkt.sport) );*)
            pkt.sport := new_sport;
          } else {
            PortSpaceFull := TRUE;
            (*
            new_sport := Head(ExtraExtraPorts);
            ExtraExtraPorts := Tail(ExtraExtraPorts);          
            privToPubNewPort2: entry := [host_marker |-> hostMarker,
                      orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                                daddr |-> pkt.daddr, dport |-> pkt.dport],
                      reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                                 daddr |-> N,  dport |-> new_sport ]]; (*Doesn't account for selecting a new packet*)
            *)
          };
          (* print <<"PrivToPub - Evicting from T", T, otherEntry>>; *)        
      };
      (* print <<"PrivToPub - T", T, otherEntry>>; *)
      privToPubAppendT: T:= Append(T, entry);
      if ( Len(T) >= MaxTableSize ) {
          TableFull := TRUE;
      };
      (* print <<"PrivToPub - T", T>>; *)
      privtopubPkt: pkt := [saddr |->pkt.daddr, sport |-> pkt.dport,
                            daddr |-> N, dport |-> pkt.sport,
                            host_marker |-> hostMarker];
      SendQueue := Append(SendQueue, pkt);
    };
  };
  privtopubRet: return;
}
(*END: fixed version*)

procedure OldPortScan() {
  portscan1: call ConnectMan(1, B);
  portscan11: print <<"SendQueue:", SendQueue, T>>;
  portscan2: call PrivToPubMan();
  portscan21: print <<"SendQueue:", SendQueue, T>>;  
  portscan3: call DisconnectVulnMan(1, B);
  portscan31: print <<"SendQueue:", SendQueue, T>>;  
  portscan4: call ConnectMan(2, B);
  portscan41: print <<"SendQueue:", SendQueue, T>>;  
  portscan5: call PubToPrivMan();
  portscan51: print <<"SendQueue:", SendQueue, T>>;    
  return ;
}

(*

procedure EvictReroute() {
  evictReroute1: call ConnectMan(1, B);
  evictReroute11: print <<"SendQueue:", SendQueue>>;
  evictReroute2: call PrivToPubMan2(<<B, 1>>, B, C, C);
  evictReroute12: print <<"SendQueue:", SendQueue>>;
  evictReroute3: call ConnectMan(2, A);
  evictReroute13: print <<"SendQueue:", SendQueue>>;
  evictReroute4: call PrivToPubMan2(<<A, 2>>,A, C, C);
  evictReroute14: print <<"SendQueue:", SendQueue>>;
  evictReroute5: call PrivToPubMan2(<<A, 2>>,C,  C, C);
  evictReroute15: print <<"SendQueue:", SendQueue>>;
  evictReroute6: call PrivToPubMan2(<<A, 2>>, B, C, C);
  evictReroute16: print <<"SendQueue:", SendQueue>>;
  evictReroute7: call PubToPrivMan();
  evictReroute17: print <<"SendQueue:", SendQueue>>;
  evictReroute8: call PubToPrivMan();
  evictReroute18: print <<"SendQueue:", SendQueue>>;
  evictReroute9: call PubToPrivMan();
  evictReroute19: print <<"SendQueue:", SendQueue>>;
  evictReroute10: call PubToPrivMan();
  evictReroute110: print <<"SendQueue:", SendQueue>>;
  return ;
}
*)

procedure EventSequenceVuln(depth)
variables i, j, ip, host, indecies
{
        (* print <<"EventSequence - depth=", i>>; *)
      evtSeqVStart:
      if (depth <= 0) {
        return ;
      } else {
        either {
          if ( Len(FreeIPs) > 0) {
            (* eventSeqConnIf1: indecies := DOMAIN FreeIPs;
            eventSeqConnIf2 :j := CHOOSE a \in indecies : TRUE;
            print <<"EventSequence - j = ", j>>; *)
            print <<"EventSequenceVuln - depth = ", depth>>;
            call ConnectVuln(depth - 1);
          };
        } or {
            if (Len (Connections) > 0) {
                (* eventSeqDiscIf1: indecies := DOMAIN Connections;
                eventSeqDiscIf2: j := CHOOSE a \in indecies : TRUE;
                conn := Connections[j]; *)
                print <<"EventSequenceVuln - Disconnect", Connections>>;
                call DisconnectVuln(depth - 1);
            };
        } or {
          if (Len(Connections) > 0) {
              print <<"EventSequenceVuln - PrivToPubVuln:", Connections>>;
              call PrivToPubVuln(depth - 1);
          };
        } or {
           if (Len(SendQueue) > 0) {
               print <<"EventSequenceVuln - PubToPrivVuln: depth - ", depth, SendQueue>>;           
               call PubToPrivVuln(depth - 1);
           };
        };
    };
  evtSeqVRet: return ;
};

procedure EventSequence(depth)
variables i, j, ip, host, indecies
{
     evtSeqStart:
     if (depth <= 0) { 
       evtSeqD0: return ;
     } else {
        (* print <<"EventSequence - depth=", i>>; *)
        either {
          if ( Len(FreeIPs) > 0) {
            (* eventSeqConnIf1: indecies := DOMAIN FreeIPs;
            eventSeqConnIf2 :j := CHOOSE a \in indecies : TRUE;
            print <<"EventSequence - j = ", j>>; *)
            call Connect(depth - 1);
          };
        } or {
            if (Len (Connections) > 0) {
                (* eventSeqDiscIf1: indecies := DOMAIN Connections;
                print <<"EventSequence - FreeIPs", Connections>>;
                eventSeqDiscIf2: j := CHOOSE a \in indecies : TRUE;
                conn := Connections[j]; *)
                call Disconnect(depth - 1);
            };
        } or {
          if (Len(Connections) > 0) {
              call PrivToPub(depth - 1);
          };
        } or {
           if (Len(SendQueue) > 0) {
               call PubToPriv(depth - 1);
           };
        };
    };

  evtSeqRet: return ;
};

procedure CheckModel() 
variables i
{
   
   checkModelStart: 
   i := 0;   
   checkModelWhile: while ( i < MAX) {
     call EventSequence(MAX);
     checkModelInc: i := i + 1; 
   };
   checkModelRet: return;
}

procedure CheckModelVuln() 
variables i
{
   
   checkModelVulnStart: 
   i := 0;   
   checkModelVulnWhile: while ( i < MAX) {
     call EventSequenceVuln(MAX);
     checkModelVulnInc: i := i + 1; 
   };
   checkModelVulnRet: return;
}

procedure PortScan() {
  portscan1: call Connect(0);
  portscan2: call PrivToPub(0);
  portscan3: call Disconnect(0);
  portscan4: call Connect(0);
  portscan5: call PubToPriv(0);
  return ;
}

procedure PubToPrivExitVuln(depth)
variables pkt, ipkt, entry, conn, hostMarker, ip_idx, ipidx, ip, host
{
  pubtoprivVEvt3: call EventSequenceVuln(depth);
  pubtoprivVStart:
  if (Len(SendQueue) > 0) {
    pkt := Head(SendQueue);
    print <<"PubToPrivMan - Len(SendQueue) > 0:", pkt, Connections, T>>;
    SendQueue := Tail(SendQueue);
    if (Len(T) > 0) {
      print <<"PubToPrivMan - Len(T) > 0:">>;
      entry := SelectSeq(T, LAMBDA e: e.reply.saddr=pkt.saddr /\ 
                                      e.reply.sport=pkt.sport /\
                                      e.reply.daddr=pkt.daddr /\
                                      e.reply.dport=pkt.dport);
      if (entry=defaultInitValue) {
        pubtirprivVDE: return ;
      };
      pubtoprivEEmpty:
      if (Len(entry) <= 0) {
         print <<"PubToPrivVuln - Empty Entry">>
         (* assert(FALSE); We can just let this slide since it's OK in real networks.*)
      } else {
        print <<"PubToPrivMan - Len(entry) > -0:", entry, pkt>>;
        (* There is a matching translation/routing rule. *)
        pubtoPrivElse: entry := Head(entry);
        if (entry.reply.dport=E) {
          print <<"PubToPrivMan - PortShadow: ", entry, pkt>>;
        };
        if ( entry.host_marker/=pkt.host_marker ) {
          print <<"PubToPrivMan - entry.host_marker/=pkt.host_marker:", entry, pkt>>;
          (* 
          EvictionReroute and Request Diversion:
 
          The case when the host creates a private host creates an entry and a different host sends a packet
          to the intermediary is not always error in at least two cases, when the host expects 
          a response and its entry is evicted and replaced by anothe private host and when the port
          is a listening port. Otherwise, this looks like NAT traverseral or P2P traffic.
          
          Error because of a bad eviction. The host who generated the packet
          is different from the host receiving the packet. *)
          if (pkt.host_marker = H1) {
            Marker1 := entry.host_marker;
          } else {
            Marker2 := entry.host_marker;
          };
          print <<"PubToPrivMan-Eviction Error: pkt", pkt, " entry", entry, "Connections:", Connections, "T: ", T>>;              
          (* assert(entry.host_marker= pkt.host_marker); *)
        }; 
        conn := SelectSeq(Connections, LAMBDA e: entry.orig.saddr = Head(e));
        if (Len(conn) > 0) {
          pubtoprivVConngt1: conn := Head(conn);
          pubtoprivVConngt2: hostMarker := conn[2];
          (* PortScanning: Error because of a switched private host host.
          print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
          print <<"Marker1", Marker1, "Marker2", Marker2>>;*)
          if ( hostMarker = H1 ) {
            if (entry.host_marker = H2) {
              PortScanInv := TRUE;
            };
            Marker1 := entry.host_marker;
          } else {
            if (entry.host_marker = H1) {
              PortScanInv := TRUE;
            };       
            Marker2 := entry.host_marker;
          };
          (* print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
          print <<"Marker1", Marker1, "Marker2", Marker2>>;
          HostMarkers[hostMarker] := entry.host_marker;              
          assert( hostMarker = entry.host_marker);*)
        };        
      };
    };
  };
  pubtopriVvRet: return ;
}
procedure PrivToPubExitVuln(depth)
 variables pkt, conn, hostMarker, daddr, hostidx, hidx,
 otherEntry, i, indicies, portDomain, sourcePort, destPort, new_sport
{
  privtopubV3: call EventSequenceVuln(depth);
  privtopubManStart:
  if (Len (Connections) > 0) {
    indicies := DOMAIN Connections;
    portDomain := DOMAIN Ports;
    sourcePort := CHOOSE pr \in portDomain : TRUE;
    i := CHOOSE f \in indicies : TRUE;
    (* *)print <<"PrivToPub - conn", indecies, conn, Connections>>; 
    privtopubConn: conn := Connections[i];
    sourcePort := Ports[sourcePort];
    portDomain := DOMAIN Ports;
    destPort := CHOOSE h \in portDomain : TRUE;
    privtopubDport: destPort := Ports[destPort];
    hostidx := DOMAIN hosts;
    hidx := CHOOSE hid \in hostidx : TRUE;
    daddr := hosts[hidx];
    (* *) print <<"PrivToPubVuln - Conn: ", conn>>; 
    hostMarker := Head(Tail(conn));

    pkt := [saddr |-> Head(conn), sport |-> sourcePort, (*XXX: Might need to change this to make sure the old attacks work*)
            daddr |-> daddr, dport |-> destPort,
            host_marker |-> hostMarker
           ];
    print <<"PrivToPubMan - pkt: ", conn, pkt>>;
           
    entry := [host_marker |-> hostMarker,
              orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                        daddr |-> pkt.daddr, dport |-> pkt.dport],
              reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                         daddr |-> E,  dport |-> pkt.sport ]]; (*Doesn't account for selecting a new packet*)

    otherEntry := SelectSeq(T, LAMBDA k: k.reply.saddr=pkt.daddr /\ k.reply.sport=pkt.dport /\
                                         k.reply.daddr=E /\ k.reply.dport=pkt.sport /\ k.host_marker /= hostMarker);
    (* *)print <<"PrivToPub - T", T, otherEntry, pkt>>; 
    if ( Len(otherEntry) > 0) {
          T := SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt.daddr /\ e.reply.sport=pkt.dport /\
                                        e.reply.daddr=E /\ e.reply.dport=pkt.sport) );
    };
    privtoPubManAddT: T := Append(T, entry);
      if ( Len(T) > MaxTableSize ) {
          TableFull := TRUE;
      };
    
    privtopubPkt: pkt := [saddr |->pkt.daddr, sport |-> pkt.dport,
                          daddr |-> E, dport |-> pkt.sport,
                          host_marker |-> hostMarker];
    SendQueue := Append(SendQueue, pkt);
  };
  privtopubRet: return;
}
procedure EventSequenceExitVuln(depth)
variables i, j, ip, host, indecies
{
        (* print <<"EventSequence - depth=", i>>; *)
      evtSeqVStart:
      if (depth <= 0) {
        return ;
      } else {
        either {
          if ( Len(FreeIPs) > 0) {
            (* eventSeqConnIf1: indecies := DOMAIN FreeIPs;
            eventSeqConnIf2 :j := CHOOSE a \in indecies : TRUE;
            print <<"EventSequence - j = ", j>>; *)
            print <<"EventSequenceVuln - depth = ", depth>>;
            call ConnectVuln(depth - 1);
          };
        } or {
            if (Len (Connections) > 0) {
                (* eventSeqDiscIf1: indecies := DOMAIN Connections;
                eventSeqDiscIf2: j := CHOOSE a \in indecies : TRUE;
                conn := Connections[j]; *)
                print <<"EventSequenceVuln - Disconnect", Connections>>;
                call DisconnectVuln(depth - 1);
            };
        } or {
          if (Len(Connections) > 0) {
              print <<"EventSequenceVuln - PrivToPubVuln:", Connections>>;
              call PrivToPubExitVuln(depth - 1);
          };
        } or {
           if (Len(SendQueue) > 0) {
               print <<"EventSequenceVuln - PubToPrivVuln: depth - ", depth, SendQueue>>;           
               call PubToPrivExitVuln(depth - 1);
           };
        };
    };
  evtSeqVRet: return ;
};
procedure PubToPrivExit(depth)
variables pkt, ipkt, entry, conn, hostMarker, ip_idx, ipidx, ip, host
{
  pubtoprivStart: call EventSequence(depth);

  pubtoprivIf: if (Len(SendQueue) > 0) {
    (*
    1. Select a packet from the send queue
    2. Find the entries mapping, if it exists.
    3. Check that the packets host marker and the table entry's host marker are the same.
    4.  If they are, route it else this is an error
    *)
    pkt := Head(SendQueue);
    print <<"PubToPriv", pkt, Connections>>;
    (* print <<"PubToPriv", pkt, SendQueue>>; *)
    SendQueue := Tail(SendQueue);
    entry := SelectSeq(T, LAMBDA e: e.reply.saddr=pkt.saddr /\ 
                                    e.reply.sport=pkt.sport /\
                                    e.reply.daddr=pkt.daddr /\
                                    e.reply.dport=pkt.dport);
    (* print <<"PubToPriv", pkt, entry>>; *)
    (* If there isn't a translation, it's meant for us. *)
    if (Len(entry) <= 0) {
      if (pkt.dport = N ) {
        (*Connect to a listening port. *)
        if (Len(FreeIPs) > 0) {
          ip_idx := DOMAIN FreeIPs;
          ipidx := CHOOSE ipp \in ip_idx : TRUE;
          ip := FreeIPs[ipidx];
          FreeIPs := SelectSeq(FreeIPs, LAMBDA d: d /= ip);
          UsedIPs := Append(UsedIPs, ip);
          host := pkt.saddr;
          Connections := Append(Connections, <<ip, host>>);
        } (*else {
          assert(TRUE);
        }*);
      } else if ( pkt.dport = NN ) {
        (* XXX: Get the packet back to the private realm hosts
        or DO a check *)
        assert(TRUE);
      } else {
        (*XXX: This is when the destination port is not anything.
          In theory, this would lead to an ICMP or something.
        *)
        assert(TRUE);
      };
    } else {
      (* There is a matching translation/routing rule. *)
      pubtoPrivElse: entry := Head(entry);
      
      if (entry.reply.dport=N) {
        print <<"PubToPriv - PortShadow: ", entry, pkt>>;
      };
      if ( entry.host_marker/=pkt.host_marker ) {
        (* EvictionReroute:
              
        Error because of a bad eviction. The host who generated the packet
        is different from the host receiving the packet. *)
        if (pkt.host_marker = H1) {
           Marker1 := entry.host_marker;
           if (entry.host_marker = H2) {
             EvictionReroute := TRUE;
           };
        } else {
           Marker2 := entry.host_marker;        
           if (entry.host_marker = H1) {
             EvictionReroute := TRUE;
           };
        };
        print <<"PubToPriv-Eviction Error: pkt", pkt, " entry", entry, "Connections:", Connections, "T: ", T>>;              
          (* assert(entry.host_marker= pkt.host_marker); *)
      };
      (* PortScan:
          
      Insecure because the incoming packets host_marker doesn't match 
      the host associated with the incoming packet*)
          
      conn := SelectSeq(Connections, LAMBDA e: entry.orig.saddr = Head(e));
      if (Len(conn) > 0) {
        pubtoprivConngt1: conn := Head(conn);
        pubtoprivConngt2: hostMarker := conn[2];
        (*Error because of a switched host.
        print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
        print <<"Marker1", Marker1, "Marker2", Marker2>>;*)
        if ( hostMarker = H1 ) {
          if (entry.host_marker = H2) {
            PortScanInv := TRUE;
          };
          Marker1 := entry.host_marker;
        } else {
          if (entry.host_marker = H1) {
            PortScanInv := TRUE;
          };       
          Marker2 := entry.host_marker;
        };
        (* print <<"PubToPriv - Address Management Error: hostMarker", hostMarker, " entry: ", entry, "conn", conn, "pkt", pkt>>;
        print <<"Marker1", Marker1, "Marker2", Marker2>>;
        HostMarkers[hostMarker] := entry.host_marker;              
        assert( hostMarker = entry.host_marker);*)
      };
    };
  };
  pubtoprivRet: return ;
}

procedure PrivToPubExit(depth) 
 variables pkt, conn, hostMarker, daddr, hostidx, hidx, otherEntry, i, indicies, portDomain, sourcePort, destPort, new_sport, good
{
  privtopubStart: call EventSequence(depth);
  privtopubIf: 
  good:=TRUE;
  if (Len (Connections) > 0) {
    indicies := DOMAIN Connections;
    portDomain := DOMAIN Ports;
    sourcePort := CHOOSE pr \in portDomain : TRUE;
    i := CHOOSE f \in indicies : TRUE;
    (* print <<"PrivToPub - conn", indecies, conn, Connections>>; *)
    privtopubConn: conn := Connections[i];
    sourcePort := Ports[sourcePort];
    portDomain := DOMAIN Ports;
    destPort := CHOOSE h \in portDomain : TRUE;
    privtopubDport: destPort := Ports[destPort];
    hostidx := DOMAIN hosts;
    hidx := CHOOSE hid \in hostidx : TRUE;
    daddr := hosts[hidx];
    (* print <<"PrivToPub - Conn: ", conn>>; *)
    hostMarker := Head(Tail(conn));

    if (hostMarker=H1) {
      if (Len(PortMap1) >= MaxPorts) {
          good := FALSE;
          privtopubMaxPorts1: return;
      } else {
        PortMap1 := Append(PortMap1, sourcePort);
      }
    } else {
      if (Len(PortMap2) >= MaxPorts) {
          good := FALSE;
          privtopubMaxPorts2: return;
      } else {
         PortMap2 := Append(PortMap2, sourcePort);
      }
    };
    privtopubGood: if ( good ) {
      privToPubPkt1:
      if (sourcePort = N) {
          if ( hostMarker=H1 ) {
            sourcePort := EP1;
          } else {
            sourcePort := EP2;            
          };
      };
      pkt := [saddr |-> Head(conn), sport |-> sourcePort, (*XXX: Might need to change this to make sure the old attacks work*)
              daddr |-> daddr, dport |-> destPort,
              host_marker |-> hostMarker
             ];
      print <<"PrivToPub - pkt: ", conn, pkt>>;

      entry := [host_marker |-> hostMarker,
                orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                          daddr |-> pkt.daddr, dport |-> pkt.dport],
                reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport,
                           daddr |-> E,  dport |-> pkt.sport ]]; (*Doesn't account for selecting a new packet*)

      otherEntry := SelectSeq(T, LAMBDA k: k.reply.saddr=pkt.daddr /\ k.reply.sport=pkt.dport /\
                                           k.reply.daddr=E /\ k.reply.dport=pkt.sport /\
                                           k.hostMarker /= hostMarker);
      (* print <<"PrivToPub - T", T, otherEntry, pkt>>; *)
      if ( Len(otherEntry) > 0) {
          (* Should we force the eviction? Do it for now.*)
          print "Evict";
          if (Len(ExtraPorts) > 0) {
            new_sport := Head(ExtraPorts);
            ExtraPorts := Tail(ExtraPorts);
            privToPubNewPort: entry := [host_marker |-> hostMarker,
                      orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                                daddr |-> pkt.daddr, dport |-> pkt.dport],
                      reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                                 daddr |-> E,  dport |-> new_sport ]]; (*Doesn't account for selecting a new packet*)
          
            (* T := SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt.daddr /\ e.reply.sport=pkt.dport /\
                                        e.reply.daddr=N /\ e.reply.dport=pkt.sport) );*)
            pkt.sport := new_sport;
          } else {
            PortSpaceFull := TRUE;
            (*
            new_sport := Head(ExtraExtraPorts);
            ExtraExtraPorts := Tail(ExtraExtraPorts);          
            privToPubNewPort2: entry := [host_marker |-> hostMarker,
                      orig |-> [saddr |-> pkt.saddr, sport |-> pkt.sport,
                                daddr |-> pkt.daddr, dport |-> pkt.dport],
                      reply |-> [saddr |-> pkt.daddr, sport |-> pkt.dport, 
                                 daddr |-> N,  dport |-> new_sport ]]; (*Doesn't account for selecting a new packet*)
            *)
          };
          (* print <<"PrivToPub - Evicting from T", T, otherEntry>>; *)        
      };
      (* print <<"PrivToPub - T", T, otherEntry>>; *)
      privToPubAppendT: T:= Append(T, entry);
      if ( Len(T) >= MaxTableSize ) {
          TableFull := TRUE;
      };
      (* print <<"PrivToPub - T", T>>; *)
      privtopubPkt: pkt := [saddr |->pkt.daddr, sport |-> pkt.dport,
                            daddr |-> E, dport |-> pkt.sport,
                            host_marker |-> hostMarker];
      SendQueue := Append(SendQueue, pkt);
    };
  };
  privtopubRet: return;
}
procedure EventSequenceExit(depth)
variables i, j, ip, host, indecies
{
     evtSeqStart:
     if (depth <= 0) { 
       evtSeqD0: return ;
     } else {
        (* print <<"EventSequence - depth=", i>>; *)
        either {
          if ( Len(FreeIPs) > 0) {
            (* eventSeqConnIf1: indecies := DOMAIN FreeIPs;
            eventSeqConnIf2 :j := CHOOSE a \in indecies : TRUE;
            print <<"EventSequence - j = ", j>>; *)
            call Connect(depth - 1);
          };
        } or {
            if (Len (Connections) > 0) {
                (* eventSeqDiscIf1: indecies := DOMAIN Connections;
                print <<"EventSequence - FreeIPs", Connections>>;
                eventSeqDiscIf2: j := CHOOSE a \in indecies : TRUE;
                conn := Connections[j]; *)
                call Disconnect(depth - 1);
            };
        } or {
          if (Len(Connections) > 0) {
              call PrivToPubExit(depth - 1);
          };
        } or {
           if (Len(SendQueue) > 0) {
               call PubToPrivExit(depth - 1);
           };
        };
    };

  evtSeqRet: return ;
};
procedure CheckModelExit() 
variables i
{
   
   checkModelStart: 
   i := 0;   
   checkModelWhile: while ( i < MAX) {
   print i;
     call EventSequenceExit(MAX);
     checkModelInc: i := i + 1; 
   };
   checkModelRet: return;
}
procedure CheckModelExitVuln() 
variables i
{
   
   checkModelVulnStart: 
   i := 0;   
   checkModelVulnWhile: while ( i < MAX) {
     call EventSequenceExitVuln(MAX);
     checkModelVulnInc: i := i + 1; 
   };
   checkModelVulnRet: return;
}
process (Foo="A") 
variables aa
{
  foo1:
  (* aa := [saddr : {1}, sport : {1, 2},
         daddr : {3, 4}, dport : {5, 6}]; *)
  print "Test";
  
  (* Works again *)
  (* print aa; call OldPortScan(); *) 
  (* Works again *)
  (* call EvictReroute(); *)
  (*   *)
  call CheckModelExitVuln();

}

} *)
\* BEGIN TRANSLATION (chksum(pcal) = "1fd53d53" /\ chksum(tla) = "bcd1a87b")
\* Label disconnectRet of procedure DisconnectVuln at line 128 col 18 changed to disconnectRet_
\* Label pubtoprivVEvt3 of procedure PubToPrivVuln at line 210 col 19 changed to pubtoprivVEvt3_
\* Label pubtoprivVStart of procedure PubToPrivVuln at line 212 col 3 changed to pubtoprivVStart_
\* Label pubtirprivVDE of procedure PubToPrivVuln at line 223 col 24 changed to pubtirprivVDE_
\* Label pubtoprivEEmpty of procedure PubToPrivVuln at line 226 col 7 changed to pubtoprivEEmpty_
\* Label pubtoPrivElse of procedure PubToPrivVuln at line 232 col 24 changed to pubtoPrivElse_
\* Label pubtoprivVConngt1 of procedure PubToPrivVuln at line 258 col 30 changed to pubtoprivVConngt1_
\* Label pubtoprivVConngt2 of procedure PubToPrivVuln at line 259 col 30 changed to pubtoprivVConngt2_
\* Label pubtopriVvRet of procedure PubToPrivVuln at line 282 col 18 changed to pubtopriVvRet_
\* Label pubtoPrivElse of procedure PubToPrivMan at line 304 col 24 changed to pubtoPrivElse_P
\* Label pubtoprivConngt1 of procedure PubToPrivMan at line 329 col 29 changed to pubtoprivConngt1_
\* Label pubtoprivConngt2 of procedure PubToPrivMan at line 330 col 29 changed to pubtoprivConngt2_
\* Label pubtoprivRet of procedure PubToPrivMan at line 355 col 17 changed to pubtoprivRet_
\* Label privtopubManStart of procedure PrivToPubMan2 at line 363 col 3 changed to privtopubManStart_
\* Label privtopubPkt of procedure PrivToPubMan2 at line 389 col 19 changed to privtopubPkt_
\* Label privtopubV3 of procedure PrivToPubVuln at line 401 col 16 changed to privtopubV3_
\* Label privtopubManStart of procedure PrivToPubVuln at line 403 col 3 changed to privtopubManStart_P
\* Label privtopubConn of procedure PrivToPubVuln at line 409 col 20 changed to privtopubConn_
\* Label privtopubDport of procedure PrivToPubVuln at line 413 col 21 changed to privtopubDport_
\* Label privtoPubManAddT of procedure PrivToPubVuln at line 439 col 23 changed to privtoPubManAddT_
\* Label privtopubPkt of procedure PrivToPubVuln at line 444 col 19 changed to privtopubPkt_P
\* Label privtopubRet of procedure PrivToPubVuln at line 449 col 17 changed to privtopubRet_
\* Label privtopubManStart of procedure PrivToPubMan at line 458 col 3 changed to privtopubManStart_Pr
\* Label privtoPubManAddT of procedure PrivToPubMan at line 492 col 23 changed to privtoPubManAddT_P
\* Label privtopubPkt of procedure PrivToPubMan at line 493 col 19 changed to privtopubPkt_Pr
\* Label privtopubRet of procedure PrivToPubMan at line 498 col 17 changed to privtopubRet_P
\* Label pubtoprivStart of procedure PubToPriv at line 566 col 19 changed to pubtoprivStart_
\* Label pubtoprivIf of procedure PubToPriv at line 568 col 16 changed to pubtoprivIf_
\* Label pubtoPrivElse of procedure PubToPriv at line 611 col 22 changed to pubtoPrivElse_Pu
\* Label pubtoprivConngt1 of procedure PubToPriv at line 642 col 27 changed to pubtoprivConngt1_P
\* Label pubtoprivConngt2 of procedure PubToPriv at line 643 col 27 changed to pubtoprivConngt2_P
\* Label pubtoprivRet of procedure PubToPriv at line 665 col 17 changed to pubtoprivRet_P
\* Label privtopubStart of procedure PrivToPub at line 671 col 19 changed to privtopubStart_
\* Label privtopubIf of procedure PrivToPub at line 673 col 3 changed to privtopubIf_
\* Label privtopubConn of procedure PrivToPub at line 680 col 20 changed to privtopubConn_P
\* Label privtopubDport of procedure PrivToPub at line 684 col 21 changed to privtopubDport_P
\* Label privtopubMaxPorts1 of procedure PrivToPub at line 694 col 31 changed to privtopubMaxPorts1_
\* Label privtopubMaxPorts2 of procedure PrivToPub at line 701 col 31 changed to privtopubMaxPorts2_
\* Label privtopubGood of procedure PrivToPub at line 706 col 20 changed to privtopubGood_
\* Label privToPubPkt1 of procedure PrivToPub at line 708 col 7 changed to privToPubPkt1_
\* Label privToPubNewPort of procedure PrivToPub at line 737 col 31 changed to privToPubNewPort_
\* Label privToPubAppendT of procedure PrivToPub at line 761 col 25 changed to privToPubAppendT_
\* Label privtopubPkt of procedure PrivToPub at line 766 col 21 changed to privtopubPkt_Pri
\* Label privtopubRet of procedure PrivToPub at line 772 col 17 changed to privtopubRet_Pr
\* Label portscan1 of procedure OldPortScan at line 777 col 14 changed to portscan1_
\* Label portscan2 of procedure OldPortScan at line 779 col 14 changed to portscan2_
\* Label portscan3 of procedure OldPortScan at line 781 col 14 changed to portscan3_
\* Label portscan4 of procedure OldPortScan at line 783 col 14 changed to portscan4_
\* Label portscan5 of procedure OldPortScan at line 785 col 14 changed to portscan5_
\* Label evtSeqVStart of procedure EventSequenceVuln at line 822 col 7 changed to evtSeqVStart_
\* Label evtSeqVRet of procedure EventSequenceVuln at line 853 col 15 changed to evtSeqVRet_
\* Label evtSeqStart of procedure EventSequence at line 860 col 6 changed to evtSeqStart_
\* Label evtSeqD0 of procedure EventSequence at line 861 col 18 changed to evtSeqD0_
\* Label evtSeqRet of procedure EventSequence at line 890 col 14 changed to evtSeqRet_
\* Label checkModelStart of procedure CheckModel at line 898 col 4 changed to checkModelStart_
\* Label checkModelWhile of procedure CheckModel at line 899 col 21 changed to checkModelWhile_
\* Label checkModelInc of procedure CheckModel at line 901 col 21 changed to checkModelInc_
\* Label checkModelRet of procedure CheckModel at line 903 col 19 changed to checkModelRet_
\* Label checkModelVulnStart of procedure CheckModelVuln at line 911 col 4 changed to checkModelVulnStart_
\* Label checkModelVulnWhile of procedure CheckModelVuln at line 912 col 25 changed to checkModelVulnWhile_
\* Label checkModelVulnInc of procedure CheckModelVuln at line 914 col 25 changed to checkModelVulnInc_
\* Label checkModelVulnRet of procedure CheckModelVuln at line 916 col 23 changed to checkModelVulnRet_
\* Label pubtoPrivElse of procedure PubToPrivExitVuln at line 953 col 24 changed to pubtoPrivElse_Pub
\* Label privtopubConn of procedure PrivToPubExitVuln at line 1017 col 20 changed to privtopubConn_Pr
\* Label privtopubDport of procedure PrivToPubExitVuln at line 1021 col 21 changed to privtopubDport_Pr
\* Label privtopubPkt of procedure PrivToPubExitVuln at line 1052 col 19 changed to privtopubPkt_Priv
\* Label privtopubRet of procedure PrivToPubExitVuln at line 1057 col 17 changed to privtopubRet_Pri
\* Procedure variable host of procedure ConnectVuln at line 80 col 13 changed to host_
\* Procedure variable hidx of procedure ConnectVuln at line 80 col 19 changed to hidx_
\* Procedure variable host_idx of procedure ConnectVuln at line 80 col 25 changed to host_idx_
\* Procedure variable pidx of procedure ConnectVuln at line 80 col 35 changed to pidx_
\* Procedure variable port_idx of procedure ConnectVuln at line 80 col 41 changed to port_idx_
\* Procedure variable ip of procedure DisconnectVuln at line 107 col 11 changed to ip_
\* Procedure variable host of procedure DisconnectVuln at line 107 col 15 changed to host_D
\* Procedure variable connDomain of procedure DisconnectVuln at line 107 col 21 changed to connDomain_
\* Procedure variable cidx of procedure DisconnectVuln at line 107 col 33 changed to cidx_
\* Procedure variable conn of procedure DisconnectVuln at line 107 col 39 changed to conn_
\* Procedure variable hidx of procedure ConnectMan at line 133 col 13 changed to hidx_C
\* Procedure variable host_idx of procedure ConnectMan at line 133 col 19 changed to host_idx_C
\* Procedure variable pidx of procedure ConnectMan at line 133 col 29 changed to pidx_C
\* Procedure variable port_idx of procedure ConnectMan at line 133 col 35 changed to port_idx_C
\* Procedure variable connDomain of procedure DisconnectMan at line 152 col 11 changed to connDomain_D
\* Procedure variable cidx of procedure DisconnectMan at line 152 col 23 changed to cidx_D
\* Procedure variable conn of procedure DisconnectMan at line 152 col 29 changed to conn_D
\* Procedure variable connDomain of procedure DisconnectVulnMan at line 179 col 11 changed to connDomain_Di
\* Procedure variable cidx of procedure DisconnectVulnMan at line 179 col 23 changed to cidx_Di
\* Procedure variable conn of procedure DisconnectVulnMan at line 179 col 29 changed to conn_Di
\* Procedure variable pkt of procedure PubToPrivVuln at line 208 col 11 changed to pkt_
\* Procedure variable ipkt of procedure PubToPrivVuln at line 208 col 16 changed to ipkt_
\* Procedure variable entry of procedure PubToPrivVuln at line 208 col 22 changed to entry_
\* Procedure variable conn of procedure PubToPrivVuln at line 208 col 29 changed to conn_P
\* Procedure variable hostMarker of procedure PubToPrivVuln at line 208 col 35 changed to hostMarker_
\* Procedure variable ip_idx of procedure PubToPrivVuln at line 208 col 47 changed to ip_idx_
\* Procedure variable ipidx of procedure PubToPrivVuln at line 208 col 55 changed to ipidx_
\* Procedure variable ip of procedure PubToPrivVuln at line 208 col 62 changed to ip_P
\* Procedure variable host of procedure PubToPrivVuln at line 208 col 66 changed to host_P
\* Procedure variable pkt of procedure PubToPrivMan at line 286 col 11 changed to pkt_P
\* Procedure variable ipkt of procedure PubToPrivMan at line 286 col 16 changed to ipkt_P
\* Procedure variable entry of procedure PubToPrivMan at line 286 col 22 changed to entry_P
\* Procedure variable conn of procedure PubToPrivMan at line 286 col 29 changed to conn_Pu
\* Procedure variable hostMarker of procedure PubToPrivMan at line 286 col 35 changed to hostMarker_P
\* Procedure variable ip_idx of procedure PubToPrivMan at line 286 col 47 changed to ip_idx_P
\* Procedure variable ipidx of procedure PubToPrivMan at line 286 col 55 changed to ipidx_P
\* Procedure variable ip of procedure PubToPrivMan at line 286 col 62 changed to ip_Pu
\* Procedure variable host of procedure PubToPrivMan at line 286 col 66 changed to host_Pu
\* Procedure variable pkt of procedure PrivToPubMan2 at line 359 col 12 changed to pkt_Pr
\* Procedure variable hostMarker of procedure PrivToPubMan2 at line 359 col 17 changed to hostMarker_Pr
\* Procedure variable daddr of procedure PrivToPubMan2 at line 359 col 29 changed to daddr_
\* Procedure variable hostidx of procedure PrivToPubMan2 at line 359 col 36 changed to hostidx_
\* Procedure variable hidx of procedure PrivToPubMan2 at line 359 col 45 changed to hidx_P
\* Procedure variable otherEntry of procedure PrivToPubMan2 at line 360 col 2 changed to otherEntry_
\* Procedure variable i of procedure PrivToPubMan2 at line 360 col 14 changed to i_
\* Procedure variable indicies of procedure PrivToPubMan2 at line 360 col 17 changed to indicies_
\* Procedure variable portDomain of procedure PrivToPubMan2 at line 360 col 27 changed to portDomain_
\* Procedure variable sourcePort of procedure PrivToPubMan2 at line 360 col 39 changed to sourcePort_
\* Procedure variable destPort of procedure PrivToPubMan2 at line 360 col 51 changed to destPort_
\* Procedure variable new_sport of procedure PrivToPubMan2 at line 360 col 61 changed to new_sport_
\* Procedure variable pkt of procedure PrivToPubVuln at line 398 col 12 changed to pkt_Pri
\* Procedure variable conn of procedure PrivToPubVuln at line 398 col 17 changed to conn_Pr
\* Procedure variable hostMarker of procedure PrivToPubVuln at line 398 col 23 changed to hostMarker_Pri
\* Procedure variable daddr of procedure PrivToPubVuln at line 398 col 35 changed to daddr_P
\* Procedure variable hostidx of procedure PrivToPubVuln at line 398 col 42 changed to hostidx_P
\* Procedure variable hidx of procedure PrivToPubVuln at line 398 col 51 changed to hidx_Pr
\* Procedure variable otherEntry of procedure PrivToPubVuln at line 399 col 2 changed to otherEntry_P
\* Procedure variable i of procedure PrivToPubVuln at line 399 col 14 changed to i_P
\* Procedure variable indicies of procedure PrivToPubVuln at line 399 col 17 changed to indicies_P
\* Procedure variable portDomain of procedure PrivToPubVuln at line 399 col 27 changed to portDomain_P
\* Procedure variable sourcePort of procedure PrivToPubVuln at line 399 col 39 changed to sourcePort_P
\* Procedure variable destPort of procedure PrivToPubVuln at line 399 col 51 changed to destPort_P
\* Procedure variable new_sport of procedure PrivToPubVuln at line 399 col 61 changed to new_sport_P
\* Procedure variable pkt of procedure PrivToPubMan at line 454 col 12 changed to pkt_Priv
\* Procedure variable conn of procedure PrivToPubMan at line 454 col 17 changed to conn_Pri
\* Procedure variable hostMarker of procedure PrivToPubMan at line 454 col 23 changed to hostMarker_Priv
\* Procedure variable daddr of procedure PrivToPubMan at line 454 col 35 changed to daddr_Pr
\* Procedure variable hostidx of procedure PrivToPubMan at line 454 col 42 changed to hostidx_Pr
\* Procedure variable hidx of procedure PrivToPubMan at line 454 col 51 changed to hidx_Pri
\* Procedure variable otherEntry of procedure PrivToPubMan at line 455 col 2 changed to otherEntry_Pr
\* Procedure variable i of procedure PrivToPubMan at line 455 col 14 changed to i_Pr
\* Procedure variable indicies of procedure PrivToPubMan at line 455 col 17 changed to indicies_Pr
\* Procedure variable portDomain of procedure PrivToPubMan at line 455 col 27 changed to portDomain_Pr
\* Procedure variable sourcePort of procedure PrivToPubMan at line 455 col 39 changed to sourcePort_Pr
\* Procedure variable destPort of procedure PrivToPubMan at line 455 col 51 changed to destPort_Pr
\* Procedure variable new_sport of procedure PrivToPubMan at line 455 col 61 changed to new_sport_Pr
\* Procedure variable host of procedure Connect at line 504 col 13 changed to host_C
\* Procedure variable hidx of procedure Connect at line 504 col 19 changed to hidx_Co
\* Procedure variable ip of procedure Disconnect at line 532 col 11 changed to ip_D
\* Procedure variable host of procedure Disconnect at line 532 col 15 changed to host_Di
\* Procedure variable conn of procedure Disconnect at line 532 col 39 changed to conn_Dis
\* Procedure variable pkt of procedure PubToPriv at line 564 col 11 changed to pkt_Pu
\* Procedure variable ipkt of procedure PubToPriv at line 564 col 16 changed to ipkt_Pu
\* Procedure variable entry of procedure PubToPriv at line 564 col 22 changed to entry_Pu
\* Procedure variable conn of procedure PubToPriv at line 564 col 29 changed to conn_Pub
\* Procedure variable hostMarker of procedure PubToPriv at line 564 col 35 changed to hostMarker_Pu
\* Procedure variable ip_idx of procedure PubToPriv at line 564 col 47 changed to ip_idx_Pu
\* Procedure variable ipidx of procedure PubToPriv at line 564 col 55 changed to ipidx_Pu
\* Procedure variable ip of procedure PubToPriv at line 564 col 62 changed to ip_Pub
\* Procedure variable host of procedure PubToPriv at line 564 col 66 changed to host_Pub
\* Procedure variable pkt of procedure PrivToPub at line 669 col 12 changed to pkt_PrivT
\* Procedure variable conn of procedure PrivToPub at line 669 col 17 changed to conn_Priv
\* Procedure variable hostMarker of procedure PrivToPub at line 669 col 23 changed to hostMarker_PrivT
\* Procedure variable daddr of procedure PrivToPub at line 669 col 35 changed to daddr_Pri
\* Procedure variable hostidx of procedure PrivToPub at line 669 col 42 changed to hostidx_Pri
\* Procedure variable hidx of procedure PrivToPub at line 669 col 51 changed to hidx_Priv
\* Procedure variable otherEntry of procedure PrivToPub at line 669 col 57 changed to otherEntry_Pri
\* Procedure variable i of procedure PrivToPub at line 669 col 69 changed to i_Pri
\* Procedure variable indicies of procedure PrivToPub at line 669 col 72 changed to indicies_Pri
\* Procedure variable portDomain of procedure PrivToPub at line 669 col 82 changed to portDomain_Pri
\* Procedure variable sourcePort of procedure PrivToPub at line 669 col 94 changed to sourcePort_Pri
\* Procedure variable destPort of procedure PrivToPub at line 669 col 106 changed to destPort_Pri
\* Procedure variable new_sport of procedure PrivToPub at line 669 col 116 changed to new_sport_Pri
\* Procedure variable good of procedure PrivToPub at line 669 col 127 changed to good_
\* Procedure variable i of procedure EventSequenceVuln at line 818 col 11 changed to i_E
\* Procedure variable j of procedure EventSequenceVuln at line 818 col 14 changed to j_
\* Procedure variable ip of procedure EventSequenceVuln at line 818 col 17 changed to ip_E
\* Procedure variable host of procedure EventSequenceVuln at line 818 col 21 changed to host_E
\* Procedure variable indecies of procedure EventSequenceVuln at line 818 col 27 changed to indecies_
\* Procedure variable i of procedure EventSequence at line 857 col 11 changed to i_Ev
\* Procedure variable j of procedure EventSequence at line 857 col 14 changed to j_E
\* Procedure variable ip of procedure EventSequence at line 857 col 17 changed to ip_Ev
\* Procedure variable host of procedure EventSequence at line 857 col 21 changed to host_Ev
\* Procedure variable indecies of procedure EventSequence at line 857 col 27 changed to indecies_E
\* Procedure variable i of procedure CheckModel at line 894 col 11 changed to i_C
\* Procedure variable i of procedure CheckModelVuln at line 907 col 11 changed to i_Ch
\* Procedure variable pkt of procedure PubToPrivExitVuln at line 929 col 11 changed to pkt_Pub
\* Procedure variable ipkt of procedure PubToPrivExitVuln at line 929 col 16 changed to ipkt_Pub
\* Procedure variable entry of procedure PubToPrivExitVuln at line 929 col 22 changed to entry_Pub
\* Procedure variable conn of procedure PubToPrivExitVuln at line 929 col 29 changed to conn_PubT
\* Procedure variable hostMarker of procedure PubToPrivExitVuln at line 929 col 35 changed to hostMarker_Pub
\* Procedure variable ip_idx of procedure PubToPrivExitVuln at line 929 col 47 changed to ip_idx_Pub
\* Procedure variable ipidx of procedure PubToPrivExitVuln at line 929 col 55 changed to ipidx_Pub
\* Procedure variable ip of procedure PubToPrivExitVuln at line 929 col 62 changed to ip_PubT
\* Procedure variable host of procedure PubToPrivExitVuln at line 929 col 66 changed to host_PubT
\* Procedure variable pkt of procedure PrivToPubExitVuln at line 1006 col 12 changed to pkt_PrivTo
\* Procedure variable conn of procedure PrivToPubExitVuln at line 1006 col 17 changed to conn_PrivT
\* Procedure variable hostMarker of procedure PrivToPubExitVuln at line 1006 col 23 changed to hostMarker_PrivTo
\* Procedure variable daddr of procedure PrivToPubExitVuln at line 1006 col 35 changed to daddr_Priv
\* Procedure variable hostidx of procedure PrivToPubExitVuln at line 1006 col 42 changed to hostidx_Priv
\* Procedure variable hidx of procedure PrivToPubExitVuln at line 1006 col 51 changed to hidx_PrivT
\* Procedure variable otherEntry of procedure PrivToPubExitVuln at line 1007 col 2 changed to otherEntry_Priv
\* Procedure variable i of procedure PrivToPubExitVuln at line 1007 col 14 changed to i_Priv
\* Procedure variable indicies of procedure PrivToPubExitVuln at line 1007 col 17 changed to indicies_Priv
\* Procedure variable portDomain of procedure PrivToPubExitVuln at line 1007 col 27 changed to portDomain_Priv
\* Procedure variable sourcePort of procedure PrivToPubExitVuln at line 1007 col 39 changed to sourcePort_Priv
\* Procedure variable destPort of procedure PrivToPubExitVuln at line 1007 col 51 changed to destPort_Priv
\* Procedure variable new_sport of procedure PrivToPubExitVuln at line 1007 col 61 changed to new_sport_Priv
\* Procedure variable i of procedure EventSequenceExitVuln at line 1060 col 11 changed to i_Eve
\* Procedure variable j of procedure EventSequenceExitVuln at line 1060 col 14 changed to j_Ev
\* Procedure variable ip of procedure EventSequenceExitVuln at line 1060 col 17 changed to ip_Eve
\* Procedure variable host of procedure EventSequenceExitVuln at line 1060 col 21 changed to host_Eve
\* Procedure variable indecies of procedure EventSequenceExitVuln at line 1060 col 27 changed to indecies_Ev
\* Procedure variable pkt of procedure PubToPrivExit at line 1098 col 11 changed to pkt_PubT
\* Procedure variable conn of procedure PubToPrivExit at line 1098 col 29 changed to conn_PubTo
\* Procedure variable hostMarker of procedure PubToPrivExit at line 1098 col 35 changed to hostMarker_PubT
\* Procedure variable ip of procedure PubToPrivExit at line 1098 col 62 changed to ip_PubTo
\* Procedure variable host of procedure PubToPrivExit at line 1098 col 66 changed to host_PubTo
\* Procedure variable conn of procedure PrivToPubExit at line 1203 col 17 changed to conn_PrivTo
\* Procedure variable i of procedure PrivToPubExit at line 1203 col 69 changed to i_PrivT
\* Procedure variable i of procedure EventSequenceExit at line 1309 col 11 changed to i_Even
\* Procedure variable ip of procedure EventSequenceExit at line 1309 col 17 changed to ip_Even
\* Procedure variable host of procedure EventSequenceExit at line 1309 col 21 changed to host_Even
\* Procedure variable i of procedure CheckModelExit at line 1345 col 11 changed to i_Che
\* Parameter depth of procedure ConnectVuln at line 79 col 23 changed to depth_
\* Parameter depth of procedure DisconnectVuln at line 106 col 26 changed to depth_D
\* Parameter host of procedure ConnectMan at line 132 col 22 changed to host_Co
\* Parameter ip of procedure ConnectMan at line 132 col 28 changed to ip_C
\* Parameter host of procedure DisconnectMan at line 151 col 25 changed to host_Dis
\* Parameter ip of procedure DisconnectMan at line 151 col 31 changed to ip_Di
\* Parameter depth of procedure PubToPrivVuln at line 207 col 25 changed to depth_P
\* Parameter depth of procedure PrivToPubVuln at line 397 col 25 changed to depth_Pr
\* Parameter depth of procedure Connect at line 503 col 19 changed to depth_C
\* Parameter depth of procedure Disconnect at line 531 col 22 changed to depth_Di
\* Parameter depth of procedure PubToPriv at line 563 col 21 changed to depth_Pu
\* Parameter depth of procedure PrivToPub at line 668 col 21 changed to depth_Pri
\* Parameter depth of procedure EventSequenceVuln at line 817 col 29 changed to depth_E
\* Parameter depth of procedure EventSequence at line 856 col 25 changed to depth_Ev
\* Parameter depth of procedure PubToPrivExitVuln at line 928 col 29 changed to depth_Pub
\* Parameter depth of procedure PrivToPubExitVuln at line 1005 col 29 changed to depth_Priv
\* Parameter depth of procedure EventSequenceExitVuln at line 1059 col 33 changed to depth_Eve
\* Parameter depth of procedure PubToPrivExit at line 1097 col 25 changed to depth_PubT
\* Parameter depth of procedure PrivToPubExit at line 1202 col 25 changed to depth_PrivT
CONSTANT defaultInitValue
VARIABLES A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
          Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, H2, 
          MaxPorts, EP1, PortMap1, EP2, PortMap2, TableFull, EvictionReroute, 
          PortScanInv, MaxTableSize, hosts, FreeHosts, UsedHosts, Ports, 
          ExtraPorts, ExtraExtraPorts, T, FreeIPs, UsedIPs, Connections, 
          SendQueue, RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
          CmdDisconnect, PortSpaceFull, pc, stack, depth_, host_, hidx_, 
          host_idx_, pidx_, port_idx_, depth_D, ip_, host_D, connDomain_, 
          cidx_, conn_, host_Co, ip_C, hidx_C, host_idx_C, pidx_C, port_idx_C, 
          host_Dis, ip_Di, connDomain_D, cidx_D, conn_D, host, ip, 
          connDomain_Di, cidx_Di, conn_Di, depth_P, pkt_, ipkt_, entry_, 
          conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
          entry_P, conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
          conn, sport, dstAddr, dport, pkt_Pr, hostMarker_Pr, daddr_, 
          hostidx_, hidx_P, otherEntry_, i_, indicies_, portDomain_, 
          sourcePort_, destPort_, new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
          hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, otherEntry_P, i_P, 
          indicies_P, portDomain_P, sourcePort_P, destPort_P, new_sport_P, 
          pkt_Priv, conn_Pri, hostMarker_Priv, daddr_Pr, hostidx_Pr, hidx_Pri, 
          otherEntry_Pr, i_Pr, indicies_Pr, portDomain_Pr, sourcePort_Pr, 
          destPort_Pr, new_sport_Pr, depth_C, host_C, hidx_Co, host_idx, pidx, 
          port_idx, depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, 
          depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, hostMarker_Pu, 
          ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
          conn_Priv, hostMarker_PrivT, daddr_Pri, hostidx_Pri, hidx_Priv, 
          otherEntry_Pri, i_Pri, indicies_Pri, portDomain_Pri, sourcePort_Pri, 
          destPort_Pri, new_sport_Pri, good_, depth_E, i_E, j_, ip_E, host_E, 
          indecies_, depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, indecies_E, i_C, 
          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
          hostMarker_Pub, ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
          depth_Priv, pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
          hostidx_Priv, hidx_PrivT, otherEntry_Priv, i_Priv, indicies_Priv, 
          portDomain_Priv, sourcePort_Priv, destPort_Priv, new_sport_Priv, 
          depth_Eve, i_Eve, j_Ev, ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
          pkt_PubT, ipkt, entry, conn_PubTo, hostMarker_PubT, ip_idx, ipidx, 
          ip_PubTo, host_PubTo, depth_PrivT, pkt, conn_PrivTo, hostMarker, 
          daddr, hostidx, hidx, otherEntry, i_PrivT, indicies, portDomain, 
          sourcePort, destPort, new_sport, good, depth, i_Even, j, ip_Even, 
          host_Even, indecies, i_Che, i, aa

vars == << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
           Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, H2, 
           MaxPorts, EP1, PortMap1, EP2, PortMap2, TableFull, EvictionReroute, 
           PortScanInv, MaxTableSize, hosts, FreeHosts, UsedHosts, Ports, 
           ExtraPorts, ExtraExtraPorts, T, FreeIPs, UsedIPs, Connections, 
           SendQueue, RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
           CmdDisconnect, PortSpaceFull, pc, stack, depth_, host_, hidx_, 
           host_idx_, pidx_, port_idx_, depth_D, ip_, host_D, connDomain_, 
           cidx_, conn_, host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
           port_idx_C, host_Dis, ip_Di, connDomain_D, cidx_D, conn_D, host, 
           ip, connDomain_Di, cidx_Di, conn_Di, depth_P, pkt_, ipkt_, entry_, 
           conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
           entry_P, conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
           conn, sport, dstAddr, dport, pkt_Pr, hostMarker_Pr, daddr_, 
           hostidx_, hidx_P, otherEntry_, i_, indicies_, portDomain_, 
           sourcePort_, destPort_, new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
           hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, otherEntry_P, i_P, 
           indicies_P, portDomain_P, sourcePort_P, destPort_P, new_sport_P, 
           pkt_Priv, conn_Pri, hostMarker_Priv, daddr_Pr, hostidx_Pr, 
           hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, portDomain_Pr, 
           sourcePort_Pr, destPort_Pr, new_sport_Pr, depth_C, host_C, hidx_Co, 
           host_idx, pidx, port_idx, depth_Di, ip_D, host_Di, connDomain, 
           cidx, conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
           pkt_PrivT, conn_Priv, hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
           hidx_Priv, otherEntry_Pri, i_Pri, indicies_Pri, portDomain_Pri, 
           sourcePort_Pri, destPort_Pri, new_sport_Pri, good_, depth_E, i_E, 
           j_, ip_E, host_E, indecies_, depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
           indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
           conn_PubT, hostMarker_Pub, ip_idx_Pub, ipidx_Pub, ip_PubT, 
           host_PubT, depth_Priv, pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, 
           daddr_Priv, hostidx_Priv, hidx_PrivT, otherEntry_Priv, i_Priv, 
           indicies_Priv, portDomain_Priv, sourcePort_Priv, destPort_Priv, 
           new_sport_Priv, depth_Eve, i_Eve, j_Ev, ip_Eve, host_Eve, 
           indecies_Ev, depth_PubT, pkt_PubT, ipkt, entry, conn_PubTo, 
           hostMarker_PubT, ip_idx, ipidx, ip_PubTo, host_PubTo, depth_PrivT, 
           pkt, conn_PrivTo, hostMarker, daddr, hostidx, hidx, otherEntry, 
           i_PrivT, indicies, portDomain, sourcePort, destPort, new_sport, 
           good, depth, i_Even, j, ip_Even, host_Even, indecies, i_Che, i, aa
        >>

ProcSet == {"A"}

Init == (* Global variables *)
        /\ A = "A"
        /\ B = "B"
        /\ C = "C"
        /\ D = "D"
        /\ N = "N"
        /\ E = "E"
        /\ NN = "NN"
        /\ Aa = "a"
        /\ Bb = "b"
        /\ Cc = "c"
        /\ Dd = "d"
        /\ Ee = "e"
        /\ Ff = "f"
        /\ Gg = "g"
        /\ Hh = "h"
        /\ Ii = "i"
        /\ Jj = "j"
        /\ Kk = "k"
        /\ Ll = "l"
        /\ Mm = "m"
        /\ Nn = "n"
        /\ Oo = "o"
        /\ Pp = "p"
        /\ Qq = "q"
        /\ Rr = "r"
        /\ Ss = "s"
        /\ Tt = "t"
        /\ Uu = "u"
        /\ Vv = "v"
        /\ Ww = "w"
        /\ Xx = "x"
        /\ Yy = "y"
        /\ Zz = "z"
        /\ H1 = 1
        /\ H2 = 2
        /\ MaxPorts = 1
        /\ EP1 = "N1"
        /\ PortMap1 = <<>>
        /\ EP2 = "N2"
        /\ PortMap2 = <<>>
        /\ TableFull = FALSE
        /\ EvictionReroute = FALSE
        /\ PortScanInv = FALSE
        /\ MaxTableSize = 2
        /\ hosts = <<H1, H2, C>>
        /\ FreeHosts = <<H1, H2>>
        /\ UsedHosts = <<>>
        /\ Ports = <<A, B, C, NN>>
        /\ ExtraPorts = <<D>>
        /\ ExtraExtraPorts = <<Aa, Bb, Cc, Dd,Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz>>
        /\ T = <<>>
        /\ FreeIPs = <<A, B>>
        /\ UsedIPs = <<>>
        /\ Connections = <<>>
        /\ SendQueue = <<>>
        /\ RcvQueue = <<>>
        /\ MAX = 3
        /\ Marker1 = H1
        /\ Marker2 = H2
        /\ CmdConnect = "Connect"
        /\ CmdDisconnect = "Disconnect"
        /\ PortSpaceFull = FALSE
        (* Procedure ConnectVuln *)
        /\ depth_ = [ self \in ProcSet |-> defaultInitValue]
        /\ host_ = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ host_idx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ pidx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ port_idx_ = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure DisconnectVuln *)
        /\ depth_D = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_ = [ self \in ProcSet |-> defaultInitValue]
        /\ host_D = [ self \in ProcSet |-> defaultInitValue]
        /\ connDomain_ = [ self \in ProcSet |-> defaultInitValue]
        /\ cidx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_ = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure ConnectMan *)
        /\ host_Co = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_C = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_C = [ self \in ProcSet |-> defaultInitValue]
        /\ host_idx_C = [ self \in ProcSet |-> defaultInitValue]
        /\ pidx_C = [ self \in ProcSet |-> defaultInitValue]
        /\ port_idx_C = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure DisconnectMan *)
        /\ host_Dis = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_Di = [ self \in ProcSet |-> defaultInitValue]
        /\ connDomain_D = [ self \in ProcSet |-> defaultInitValue]
        /\ cidx_D = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_D = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure DisconnectVulnMan *)
        /\ host = [ self \in ProcSet |-> defaultInitValue]
        /\ ip = [ self \in ProcSet |-> defaultInitValue]
        /\ connDomain_Di = [ self \in ProcSet |-> defaultInitValue]
        /\ cidx_Di = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Di = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PubToPrivVuln *)
        /\ depth_P = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_ = [ self \in ProcSet |-> defaultInitValue]
        /\ ipkt_ = [ self \in ProcSet |-> defaultInitValue]
        /\ entry_ = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_P = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_ = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_idx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ ipidx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_P = [ self \in ProcSet |-> defaultInitValue]
        /\ host_P = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PubToPrivMan *)
        /\ pkt_P = [ self \in ProcSet |-> defaultInitValue]
        /\ ipkt_P = [ self \in ProcSet |-> defaultInitValue]
        /\ entry_P = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_P = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_idx_P = [ self \in ProcSet |-> defaultInitValue]
        /\ ipidx_P = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ host_Pu = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PrivToPubMan2 *)
        /\ conn = [ self \in ProcSet |-> defaultInitValue]
        /\ sport = [ self \in ProcSet |-> defaultInitValue]
        /\ dstAddr = [ self \in ProcSet |-> defaultInitValue]
        /\ dport = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ daddr_ = [ self \in ProcSet |-> defaultInitValue]
        /\ hostidx_ = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_P = [ self \in ProcSet |-> defaultInitValue]
        /\ otherEntry_ = [ self \in ProcSet |-> defaultInitValue]
        /\ i_ = [ self \in ProcSet |-> defaultInitValue]
        /\ indicies_ = [ self \in ProcSet |-> defaultInitValue]
        /\ portDomain_ = [ self \in ProcSet |-> defaultInitValue]
        /\ sourcePort_ = [ self \in ProcSet |-> defaultInitValue]
        /\ destPort_ = [ self \in ProcSet |-> defaultInitValue]
        /\ new_sport_ = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PrivToPubVuln *)
        /\ depth_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ daddr_P = [ self \in ProcSet |-> defaultInitValue]
        /\ hostidx_P = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ otherEntry_P = [ self \in ProcSet |-> defaultInitValue]
        /\ i_P = [ self \in ProcSet |-> defaultInitValue]
        /\ indicies_P = [ self \in ProcSet |-> defaultInitValue]
        /\ portDomain_P = [ self \in ProcSet |-> defaultInitValue]
        /\ sourcePort_P = [ self \in ProcSet |-> defaultInitValue]
        /\ destPort_P = [ self \in ProcSet |-> defaultInitValue]
        /\ new_sport_P = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PrivToPubMan *)
        /\ pkt_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ daddr_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ hostidx_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ otherEntry_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ i_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ indicies_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ portDomain_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ sourcePort_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ destPort_Pr = [ self \in ProcSet |-> defaultInitValue]
        /\ new_sport_Pr = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure Connect *)
        /\ depth_C = [ self \in ProcSet |-> defaultInitValue]
        /\ host_C = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_Co = [ self \in ProcSet |-> defaultInitValue]
        /\ host_idx = [ self \in ProcSet |-> defaultInitValue]
        /\ pidx = [ self \in ProcSet |-> defaultInitValue]
        /\ port_idx = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure Disconnect *)
        /\ depth_Di = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_D = [ self \in ProcSet |-> defaultInitValue]
        /\ host_Di = [ self \in ProcSet |-> defaultInitValue]
        /\ connDomain = [ self \in ProcSet |-> defaultInitValue]
        /\ cidx = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Dis = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PubToPriv *)
        /\ depth_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ ipkt_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ entry_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_idx_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ ipidx_Pu = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ host_Pub = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PrivToPub *)
        /\ depth_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_PrivT = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_PrivT = [ self \in ProcSet |-> defaultInitValue]
        /\ daddr_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ hostidx_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ otherEntry_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ i_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ indicies_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ portDomain_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ sourcePort_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ destPort_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ new_sport_Pri = [ self \in ProcSet |-> defaultInitValue]
        /\ good_ = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure EventSequenceVuln *)
        /\ depth_E = [ self \in ProcSet |-> defaultInitValue]
        /\ i_E = [ self \in ProcSet |-> defaultInitValue]
        /\ j_ = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_E = [ self \in ProcSet |-> defaultInitValue]
        /\ host_E = [ self \in ProcSet |-> defaultInitValue]
        /\ indecies_ = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure EventSequence *)
        /\ depth_Ev = [ self \in ProcSet |-> defaultInitValue]
        /\ i_Ev = [ self \in ProcSet |-> defaultInitValue]
        /\ j_E = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_Ev = [ self \in ProcSet |-> defaultInitValue]
        /\ host_Ev = [ self \in ProcSet |-> defaultInitValue]
        /\ indecies_E = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure CheckModel *)
        /\ i_C = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure CheckModelVuln *)
        /\ i_Ch = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PubToPrivExitVuln *)
        /\ depth_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ ipkt_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ entry_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_PubT = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_idx_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ ipidx_Pub = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_PubT = [ self \in ProcSet |-> defaultInitValue]
        /\ host_PubT = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PrivToPubExitVuln *)
        /\ depth_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_PrivTo = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_PrivT = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_PrivTo = [ self \in ProcSet |-> defaultInitValue]
        /\ daddr_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ hostidx_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx_PrivT = [ self \in ProcSet |-> defaultInitValue]
        /\ otherEntry_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ i_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ indicies_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ portDomain_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ sourcePort_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ destPort_Priv = [ self \in ProcSet |-> defaultInitValue]
        /\ new_sport_Priv = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure EventSequenceExitVuln *)
        /\ depth_Eve = [ self \in ProcSet |-> defaultInitValue]
        /\ i_Eve = [ self \in ProcSet |-> defaultInitValue]
        /\ j_Ev = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_Eve = [ self \in ProcSet |-> defaultInitValue]
        /\ host_Eve = [ self \in ProcSet |-> defaultInitValue]
        /\ indecies_Ev = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PubToPrivExit *)
        /\ depth_PubT = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt_PubT = [ self \in ProcSet |-> defaultInitValue]
        /\ ipkt = [ self \in ProcSet |-> defaultInitValue]
        /\ entry = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_PubTo = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker_PubT = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_idx = [ self \in ProcSet |-> defaultInitValue]
        /\ ipidx = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_PubTo = [ self \in ProcSet |-> defaultInitValue]
        /\ host_PubTo = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure PrivToPubExit *)
        /\ depth_PrivT = [ self \in ProcSet |-> defaultInitValue]
        /\ pkt = [ self \in ProcSet |-> defaultInitValue]
        /\ conn_PrivTo = [ self \in ProcSet |-> defaultInitValue]
        /\ hostMarker = [ self \in ProcSet |-> defaultInitValue]
        /\ daddr = [ self \in ProcSet |-> defaultInitValue]
        /\ hostidx = [ self \in ProcSet |-> defaultInitValue]
        /\ hidx = [ self \in ProcSet |-> defaultInitValue]
        /\ otherEntry = [ self \in ProcSet |-> defaultInitValue]
        /\ i_PrivT = [ self \in ProcSet |-> defaultInitValue]
        /\ indicies = [ self \in ProcSet |-> defaultInitValue]
        /\ portDomain = [ self \in ProcSet |-> defaultInitValue]
        /\ sourcePort = [ self \in ProcSet |-> defaultInitValue]
        /\ destPort = [ self \in ProcSet |-> defaultInitValue]
        /\ new_sport = [ self \in ProcSet |-> defaultInitValue]
        /\ good = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure EventSequenceExit *)
        /\ depth = [ self \in ProcSet |-> defaultInitValue]
        /\ i_Even = [ self \in ProcSet |-> defaultInitValue]
        /\ j = [ self \in ProcSet |-> defaultInitValue]
        /\ ip_Even = [ self \in ProcSet |-> defaultInitValue]
        /\ host_Even = [ self \in ProcSet |-> defaultInitValue]
        /\ indecies = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure CheckModelExit *)
        /\ i_Che = [ self \in ProcSet |-> defaultInitValue]
        (* Procedure CheckModelExitVuln *)
        /\ i = [ self \in ProcSet |-> defaultInitValue]
        (* Process Foo *)
        /\ aa = defaultInitValue
        /\ stack = [self \in ProcSet |-> << >>]
        /\ pc = [self \in ProcSet |-> "foo1"]

connectVEvtSeqV(self) == /\ pc[self] = "connectVEvtSeqV"
                         /\ /\ depth_E' = [depth_E EXCEPT ![self] = depth_[self]]
                            /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                     pc        |->  "connectVStart",
                                                                     i_E       |->  i_E[self],
                                                                     j_        |->  j_[self],
                                                                     ip_E      |->  ip_E[self],
                                                                     host_E    |->  host_E[self],
                                                                     indecies_ |->  indecies_[self],
                                                                     depth_E   |->  depth_E[self] ] >>
                                                                 \o stack[self]]
                         /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                         /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                         /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                         /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                         /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                         /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                         indecies_E, i_C, i_Ch, depth_Pub, 
                                         pkt_Pub, ipkt_Pub, entry_Pub, 
                                         conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                         ipidx_Pub, ip_PubT, host_PubT, 
                                         depth_Priv, pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

connectVStart(self) == /\ pc[self] = "connectVStart"
                       /\ IF Len(FreeHosts) > 0
                             THEN /\ PrintT(<<"ConnectVuln:", FreeHosts, FreeHosts>>)
                                  /\ host_idx_' = [host_idx_ EXCEPT ![self] = DOMAIN FreeHosts]
                                  /\ hidx_' = [hidx_ EXCEPT ![self] = CHOOSE h \in host_idx_'[self] : TRUE]
                                  /\ host_' = [host_ EXCEPT ![self] = FreeHosts[hidx_'[self]]]
                                  /\ FreeHosts' = SelectSeq(FreeHosts, LAMBDA a: a /= host_'[self])
                                  /\ UsedHosts' = Append(UsedHosts, host_'[self])
                                  /\ ip_idx' = [ip_idx EXCEPT ![self] = DOMAIN FreeIPs]
                                  /\ ipidx' = [ipidx EXCEPT ![self] = CHOOSE ipp \in ip_idx'[self] : TRUE]
                                  /\ ip' = [ip EXCEPT ![self] = FreeIPs[ipidx'[self]]]
                                  /\ FreeIPs' = SelectSeq(FreeIPs, LAMBDA d: d /= ip'[self])
                                  /\ UsedIPs' = Append(UsedIPs, ip'[self])
                                  /\ Connections' = Append(Connections, <<ip'[self], host_'[self]>>)
                             ELSE /\ TRUE
                                  /\ UNCHANGED << FreeHosts, UsedHosts, 
                                                  FreeIPs, UsedIPs, 
                                                  Connections, host_, hidx_, 
                                                  host_idx_, ip, ip_idx, ipidx >>
                       /\ pc' = [pc EXCEPT ![self] = "connectVRet"]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, SendQueue, RcvQueue, 
                                       MAX, Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, stack, 
                                       depth_, pidx_, port_idx_, depth_D, ip_, 
                                       host_D, connDomain_, cidx_, conn_, 
                                       host_Co, ip_C, hidx_C, host_idx_C, 
                                       pidx_C, port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_PubTo, host_PubTo, 
                                       depth_PrivT, pkt, conn_PrivTo, 
                                       hostMarker, daddr, hostidx, hidx, 
                                       otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

connectVRet(self) == /\ pc[self] = "connectVRet"
                     /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                     /\ host_' = [host_ EXCEPT ![self] = Head(stack[self]).host_]
                     /\ hidx_' = [hidx_ EXCEPT ![self] = Head(stack[self]).hidx_]
                     /\ host_idx_' = [host_idx_ EXCEPT ![self] = Head(stack[self]).host_idx_]
                     /\ pidx_' = [pidx_ EXCEPT ![self] = Head(stack[self]).pidx_]
                     /\ port_idx_' = [port_idx_ EXCEPT ![self] = Head(stack[self]).port_idx_]
                     /\ depth_' = [depth_ EXCEPT ![self] = Head(stack[self]).depth_]
                     /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                     Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                     Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                     Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                     PortMap2, TableFull, EvictionReroute, 
                                     PortScanInv, MaxTableSize, hosts, 
                                     FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                     ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                     Connections, SendQueue, RcvQueue, MAX, 
                                     Marker1, Marker2, CmdConnect, 
                                     CmdDisconnect, PortSpaceFull, depth_D, 
                                     ip_, host_D, connDomain_, cidx_, conn_, 
                                     host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                     port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                     cidx_D, conn_D, host, ip, connDomain_Di, 
                                     cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                     entry_, conn_P, hostMarker_, ip_idx_, 
                                     ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                     entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                     ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                     dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                     daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                     indicies_, portDomain_, sourcePort_, 
                                     destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                     conn_Pr, hostMarker_Pri, daddr_P, 
                                     hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                     indicies_P, portDomain_P, sourcePort_P, 
                                     destPort_P, new_sport_P, pkt_Priv, 
                                     conn_Pri, hostMarker_Priv, daddr_Pr, 
                                     hostidx_Pr, hidx_Pri, otherEntry_Pr, i_Pr, 
                                     indicies_Pr, portDomain_Pr, sourcePort_Pr, 
                                     destPort_Pr, new_sport_Pr, depth_C, 
                                     host_C, hidx_Co, host_idx, pidx, port_idx, 
                                     depth_Di, ip_D, host_Di, connDomain, cidx, 
                                     conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                     entry_Pu, conn_Pub, hostMarker_Pu, 
                                     ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                     depth_Pri, pkt_PrivT, conn_Priv, 
                                     hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                     hidx_Priv, otherEntry_Pri, i_Pri, 
                                     indicies_Pri, portDomain_Pri, 
                                     sourcePort_Pri, destPort_Pri, 
                                     new_sport_Pri, good_, depth_E, i_E, j_, 
                                     ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                     j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                     i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                     entry_Pub, conn_PubT, hostMarker_Pub, 
                                     ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                     depth_Priv, pkt_PrivTo, conn_PrivT, 
                                     hostMarker_PrivTo, daddr_Priv, 
                                     hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                     i_Priv, indicies_Priv, portDomain_Priv, 
                                     sourcePort_Priv, destPort_Priv, 
                                     new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                     ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                     pkt_PubT, ipkt, entry, conn_PubTo, 
                                     hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                     host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                     hostMarker, daddr, hostidx, hidx, 
                                     otherEntry, i_PrivT, indicies, portDomain, 
                                     sourcePort, destPort, new_sport, good, 
                                     depth, i_Even, j, ip_Even, host_Even, 
                                     indecies, i_Che, i, aa >>

ConnectVuln(self) == connectVEvtSeqV(self) \/ connectVStart(self)
                        \/ connectVRet(self)

disconnectVEvtSV(self) == /\ pc[self] = "disconnectVEvtSV"
                          /\ /\ depth_E' = [depth_E EXCEPT ![self] = depth_D[self]]
                             /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                      pc        |->  "disconnectVStart",
                                                                      i_E       |->  i_E[self],
                                                                      j_        |->  j_[self],
                                                                      ip_E      |->  ip_E[self],
                                                                      host_E    |->  host_E[self],
                                                                      indecies_ |->  indecies_[self],
                                                                      depth_E   |->  depth_E[self] ] >>
                                                                  \o stack[self]]
                          /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                          /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                          /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                          /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                          /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                          /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, depth_, host_, hidx_, 
                                          host_idx_, pidx_, port_idx_, depth_D, 
                                          ip_, host_D, connDomain_, cidx_, 
                                          conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                          indecies_E, i_C, i_Ch, depth_Pub, 
                                          pkt_Pub, ipkt_Pub, entry_Pub, 
                                          conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

disconnectVStart(self) == /\ pc[self] = "disconnectVStart"
                          /\ IF Len(Connections) > 0
                                THEN /\ connDomain_' = [connDomain_ EXCEPT ![self] = DOMAIN Connections]
                                     /\ cidx_' = [cidx_ EXCEPT ![self] = CHOOSE c \in connDomain_'[self] : TRUE]
                                     /\ conn_' = [conn_ EXCEPT ![self] = Connections[cidx_'[self]]]
                                     /\ ip_' = [ip_ EXCEPT ![self] = conn_'[self][1]]
                                     /\ host_D' = [host_D EXCEPT ![self] = conn_'[self][2]]
                                     /\ PrintT(<< "Disconnect- Before:", host_D'[self], ip_'[self], Connections>>)
                                     /\ Connections' = SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip_'[self])
                                     /\ UsedIPs' = SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip_'[self])
                                     /\ FreeIPs' = Append(FreeIPs, ip_'[self])
                                     /\ FreeHosts' = Append(FreeHosts, host_D'[self])
                                     /\ UsedHosts' = SelectSeq(UsedHosts, LAMBDA m: m /= host_D'[self])
                                     /\ PrintT(<< "Disconnect- After: ", host_D'[self], ip_'[self], Connections'>>)
                                ELSE /\ TRUE
                                     /\ UNCHANGED << FreeHosts, UsedHosts, 
                                                     FreeIPs, UsedIPs, 
                                                     Connections, ip_, host_D, 
                                                     connDomain_, cidx_, conn_ >>
                          /\ pc' = [pc EXCEPT ![self] = "disconnectRet_"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          Ports, ExtraPorts, ExtraExtraPorts, 
                                          T, SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

disconnectRet_(self) == /\ pc[self] = "disconnectRet_"
                        /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                        /\ ip_' = [ip_ EXCEPT ![self] = Head(stack[self]).ip_]
                        /\ host_D' = [host_D EXCEPT ![self] = Head(stack[self]).host_D]
                        /\ connDomain_' = [connDomain_ EXCEPT ![self] = Head(stack[self]).connDomain_]
                        /\ cidx_' = [cidx_ EXCEPT ![self] = Head(stack[self]).cidx_]
                        /\ conn_' = [conn_ EXCEPT ![self] = Head(stack[self]).conn_]
                        /\ depth_D' = [depth_D EXCEPT ![self] = Head(stack[self]).depth_D]
                        /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, host_Co, ip_C, hidx_C, 
                                        host_idx_C, pidx_C, port_idx_C, 
                                        host_Dis, ip_Di, connDomain_D, cidx_D, 
                                        conn_D, host, ip, connDomain_Di, 
                                        cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                        entry_, conn_P, hostMarker_, ip_idx_, 
                                        ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                        entry_P, conn_Pu, hostMarker_P, 
                                        ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                        conn, sport, dstAddr, dport, pkt_Pr, 
                                        hostMarker_Pr, daddr_, hostidx_, 
                                        hidx_P, otherEntry_, i_, indicies_, 
                                        portDomain_, sourcePort_, destPort_, 
                                        new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

DisconnectVuln(self) == disconnectVEvtSV(self) \/ disconnectVStart(self)
                           \/ disconnectRet_(self)

connectManStart(self) == /\ pc[self] = "connectManStart"
                         /\ IF Len(FreeHosts) > 0
                               THEN /\ PrintT(<< "ConnectMan - BEFORE ", FreeHosts, FreeIPs, Connections>>)
                                    /\ FreeIPs' = SelectSeq(FreeIPs, LAMBDA e: ~(e=ip_C[self]))
                                    /\ UsedIPs' = Append(UsedIPs, ip_C[self])
                                    /\ FreeHosts' = SelectSeq(FreeHosts, LAMBDA a: a /= host_Co[self])
                                    /\ UsedHosts' = Append(UsedHosts, host_Co[self])
                                    /\ Connections' = Append(Connections,  <<ip_C[self], host_Co[self]>>)
                                    /\ PrintT(<< "ConnectMan - AFTER ", FreeHosts', FreeIPs', Connections'>>)
                                    /\ port_idx_C' = [port_idx_C EXCEPT ![self] = DOMAIN Ports]
                                    /\ pidx_C' = [pidx_C EXCEPT ![self] = CHOOSE p \in port_idx_C'[self] : TRUE]
                               ELSE /\ TRUE
                                    /\ UNCHANGED << FreeHosts, UsedHosts, 
                                                    FreeIPs, UsedIPs, 
                                                    Connections, pidx_C, 
                                                    port_idx_C >>
                         /\ pc' = [pc EXCEPT ![self] = "connectManRet"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, Ports, 
                                         ExtraPorts, ExtraExtraPorts, T, 
                                         SendQueue, RcvQueue, MAX, Marker1, 
                                         Marker2, CmdConnect, CmdDisconnect, 
                                         PortSpaceFull, stack, depth_, host_, 
                                         hidx_, host_idx_, pidx_, port_idx_, 
                                         depth_D, ip_, host_D, connDomain_, 
                                         cidx_, conn_, host_Co, ip_C, hidx_C, 
                                         host_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

connectManRet(self) == /\ pc[self] = "connectManRet"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ hidx_C' = [hidx_C EXCEPT ![self] = Head(stack[self]).hidx_C]
                       /\ host_idx_C' = [host_idx_C EXCEPT ![self] = Head(stack[self]).host_idx_C]
                       /\ pidx_C' = [pidx_C EXCEPT ![self] = Head(stack[self]).pidx_C]
                       /\ port_idx_C' = [port_idx_C EXCEPT ![self] = Head(stack[self]).port_idx_C]
                       /\ host_Co' = [host_Co EXCEPT ![self] = Head(stack[self]).host_Co]
                       /\ ip_C' = [ip_C EXCEPT ![self] = Head(stack[self]).ip_C]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Dis, 
                                       ip_Di, connDomain_D, cidx_D, conn_D, 
                                       host, ip, connDomain_Di, cidx_Di, 
                                       conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                       conn_P, hostMarker_, ip_idx_, ipidx_, 
                                       ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                       conn_Pu, hostMarker_P, ip_idx_P, 
                                       ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                       dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                       daddr_, hostidx_, hidx_P, otherEntry_, 
                                       i_, indicies_, portDomain_, sourcePort_, 
                                       destPort_, new_sport_, depth_Pr, 
                                       pkt_Pri, conn_Pr, hostMarker_Pri, 
                                       daddr_P, hostidx_P, hidx_Pr, 
                                       otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

ConnectMan(self) == connectManStart(self) \/ connectManRet(self)

disconnectManStart(self) == /\ pc[self] = "disconnectManStart"
                            /\ IF Len(Connections) > 0
                                  THEN /\ PrintT(<< "DisconnectMan - Before:", host_Dis[self], ip_Di[self], Connections>>)
                                       /\ Connections' = SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip_Di[self])
                                       /\ UsedIPs' = SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip_Di[self])
                                       /\ FreeIPs' = Append(FreeIPs, ip_Di[self])
                                       /\ FreeHosts' = Append(FreeHosts, host_Dis[self])
                                       /\ UsedHosts' = SelectSeq(UsedHosts, LAMBDA m: m /= host_Dis[self])
                                       /\ PrintT(<< "DisconnectMan - After: ", host_Dis[self], ip_Di[self], Connections'>>)
                                       /\ pc' = [pc EXCEPT ![self] = "disconnectVulnPurgeOrphans1"]
                                  ELSE /\ pc' = [pc EXCEPT ![self] = "disconnectManRet"]
                                       /\ UNCHANGED << FreeHosts, UsedHosts, 
                                                       FreeIPs, UsedIPs, 
                                                       Connections >>
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, Ports, 
                                            ExtraPorts, ExtraExtraPorts, T, 
                                            SendQueue, RcvQueue, MAX, Marker1, 
                                            Marker2, CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

disconnectVulnPurgeOrphans1(self) == /\ pc[self] = "disconnectVulnPurgeOrphans1"
                                     /\ T' = SelectSeq(T, LAMBDA e: e.orig.saddr /= ip_Di[self])
                                     /\ pc' = [pc EXCEPT ![self] = "disconnectVulnPurgeOrphans2"]
                                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, 
                                                     Bb, Cc, Dd, Ee, Ff, Gg, 
                                                     Hh, Ii, Jj, Kk, Ll, Mm, 
                                                     Nn, Oo, Pp, Qq, Rr, Ss, 
                                                     Tt, Uu, Vv, Ww, Xx, Yy, 
                                                     Zz, H1, H2, MaxPorts, EP1, 
                                                     PortMap1, EP2, PortMap2, 
                                                     TableFull, 
                                                     EvictionReroute, 
                                                     PortScanInv, MaxTableSize, 
                                                     hosts, FreeHosts, 
                                                     UsedHosts, Ports, 
                                                     ExtraPorts, 
                                                     ExtraExtraPorts, FreeIPs, 
                                                     UsedIPs, Connections, 
                                                     SendQueue, RcvQueue, MAX, 
                                                     Marker1, Marker2, 
                                                     CmdConnect, CmdDisconnect, 
                                                     PortSpaceFull, stack, 
                                                     depth_, host_, hidx_, 
                                                     host_idx_, pidx_, 
                                                     port_idx_, depth_D, ip_, 
                                                     host_D, connDomain_, 
                                                     cidx_, conn_, host_Co, 
                                                     ip_C, hidx_C, host_idx_C, 
                                                     pidx_C, port_idx_C, 
                                                     host_Dis, ip_Di, 
                                                     connDomain_D, cidx_D, 
                                                     conn_D, host, ip, 
                                                     connDomain_Di, cidx_Di, 
                                                     conn_Di, depth_P, pkt_, 
                                                     ipkt_, entry_, conn_P, 
                                                     hostMarker_, ip_idx_, 
                                                     ipidx_, ip_P, host_P, 
                                                     pkt_P, ipkt_P, entry_P, 
                                                     conn_Pu, hostMarker_P, 
                                                     ip_idx_P, ipidx_P, ip_Pu, 
                                                     host_Pu, conn, sport, 
                                                     dstAddr, dport, pkt_Pr, 
                                                     hostMarker_Pr, daddr_, 
                                                     hostidx_, hidx_P, 
                                                     otherEntry_, i_, 
                                                     indicies_, portDomain_, 
                                                     sourcePort_, destPort_, 
                                                     new_sport_, depth_Pr, 
                                                     pkt_Pri, conn_Pr, 
                                                     hostMarker_Pri, daddr_P, 
                                                     hostidx_P, hidx_Pr, 
                                                     otherEntry_P, i_P, 
                                                     indicies_P, portDomain_P, 
                                                     sourcePort_P, destPort_P, 
                                                     new_sport_P, pkt_Priv, 
                                                     conn_Pri, hostMarker_Priv, 
                                                     daddr_Pr, hostidx_Pr, 
                                                     hidx_Pri, otherEntry_Pr, 
                                                     i_Pr, indicies_Pr, 
                                                     portDomain_Pr, 
                                                     sourcePort_Pr, 
                                                     destPort_Pr, new_sport_Pr, 
                                                     depth_C, host_C, hidx_Co, 
                                                     host_idx, pidx, port_idx, 
                                                     depth_Di, ip_D, host_Di, 
                                                     connDomain, cidx, 
                                                     conn_Dis, depth_Pu, 
                                                     pkt_Pu, ipkt_Pu, entry_Pu, 
                                                     conn_Pub, hostMarker_Pu, 
                                                     ip_idx_Pu, ipidx_Pu, 
                                                     ip_Pub, host_Pub, 
                                                     depth_Pri, pkt_PrivT, 
                                                     conn_Priv, 
                                                     hostMarker_PrivT, 
                                                     daddr_Pri, hostidx_Pri, 
                                                     hidx_Priv, otherEntry_Pri, 
                                                     i_Pri, indicies_Pri, 
                                                     portDomain_Pri, 
                                                     sourcePort_Pri, 
                                                     destPort_Pri, 
                                                     new_sport_Pri, good_, 
                                                     depth_E, i_E, j_, ip_E, 
                                                     host_E, indecies_, 
                                                     depth_Ev, i_Ev, j_E, 
                                                     ip_Ev, host_Ev, 
                                                     indecies_E, i_C, i_Ch, 
                                                     depth_Pub, pkt_Pub, 
                                                     ipkt_Pub, entry_Pub, 
                                                     conn_PubT, hostMarker_Pub, 
                                                     ip_idx_Pub, ipidx_Pub, 
                                                     ip_PubT, host_PubT, 
                                                     depth_Priv, pkt_PrivTo, 
                                                     conn_PrivT, 
                                                     hostMarker_PrivTo, 
                                                     daddr_Priv, hostidx_Priv, 
                                                     hidx_PrivT, 
                                                     otherEntry_Priv, i_Priv, 
                                                     indicies_Priv, 
                                                     portDomain_Priv, 
                                                     sourcePort_Priv, 
                                                     destPort_Priv, 
                                                     new_sport_Priv, depth_Eve, 
                                                     i_Eve, j_Ev, ip_Eve, 
                                                     host_Eve, indecies_Ev, 
                                                     depth_PubT, pkt_PubT, 
                                                     ipkt, entry, conn_PubTo, 
                                                     hostMarker_PubT, ip_idx, 
                                                     ipidx, ip_PubTo, 
                                                     host_PubTo, depth_PrivT, 
                                                     pkt, conn_PrivTo, 
                                                     hostMarker, daddr, 
                                                     hostidx, hidx, otherEntry, 
                                                     i_PrivT, indicies, 
                                                     portDomain, sourcePort, 
                                                     destPort, new_sport, good, 
                                                     depth, i_Even, j, ip_Even, 
                                                     host_Even, indecies, 
                                                     i_Che, i, aa >>

disconnectVulnPurgeOrphans2(self) == /\ pc[self] = "disconnectVulnPurgeOrphans2"
                                     /\ T' = SelectSeq(T, LAMBDA e: e.orig.saddr /= host_Dis[self])
                                     /\ IF host_Dis[self]=H1
                                           THEN /\ PortMap1' = <<>>
                                                /\ UNCHANGED PortMap2
                                           ELSE /\ PortMap2' = <<>>
                                                /\ UNCHANGED PortMap1
                                     /\ pc' = [pc EXCEPT ![self] = "disconnectManRet"]
                                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, 
                                                     Bb, Cc, Dd, Ee, Ff, Gg, 
                                                     Hh, Ii, Jj, Kk, Ll, Mm, 
                                                     Nn, Oo, Pp, Qq, Rr, Ss, 
                                                     Tt, Uu, Vv, Ww, Xx, Yy, 
                                                     Zz, H1, H2, MaxPorts, EP1, 
                                                     EP2, TableFull, 
                                                     EvictionReroute, 
                                                     PortScanInv, MaxTableSize, 
                                                     hosts, FreeHosts, 
                                                     UsedHosts, Ports, 
                                                     ExtraPorts, 
                                                     ExtraExtraPorts, FreeIPs, 
                                                     UsedIPs, Connections, 
                                                     SendQueue, RcvQueue, MAX, 
                                                     Marker1, Marker2, 
                                                     CmdConnect, CmdDisconnect, 
                                                     PortSpaceFull, stack, 
                                                     depth_, host_, hidx_, 
                                                     host_idx_, pidx_, 
                                                     port_idx_, depth_D, ip_, 
                                                     host_D, connDomain_, 
                                                     cidx_, conn_, host_Co, 
                                                     ip_C, hidx_C, host_idx_C, 
                                                     pidx_C, port_idx_C, 
                                                     host_Dis, ip_Di, 
                                                     connDomain_D, cidx_D, 
                                                     conn_D, host, ip, 
                                                     connDomain_Di, cidx_Di, 
                                                     conn_Di, depth_P, pkt_, 
                                                     ipkt_, entry_, conn_P, 
                                                     hostMarker_, ip_idx_, 
                                                     ipidx_, ip_P, host_P, 
                                                     pkt_P, ipkt_P, entry_P, 
                                                     conn_Pu, hostMarker_P, 
                                                     ip_idx_P, ipidx_P, ip_Pu, 
                                                     host_Pu, conn, sport, 
                                                     dstAddr, dport, pkt_Pr, 
                                                     hostMarker_Pr, daddr_, 
                                                     hostidx_, hidx_P, 
                                                     otherEntry_, i_, 
                                                     indicies_, portDomain_, 
                                                     sourcePort_, destPort_, 
                                                     new_sport_, depth_Pr, 
                                                     pkt_Pri, conn_Pr, 
                                                     hostMarker_Pri, daddr_P, 
                                                     hostidx_P, hidx_Pr, 
                                                     otherEntry_P, i_P, 
                                                     indicies_P, portDomain_P, 
                                                     sourcePort_P, destPort_P, 
                                                     new_sport_P, pkt_Priv, 
                                                     conn_Pri, hostMarker_Priv, 
                                                     daddr_Pr, hostidx_Pr, 
                                                     hidx_Pri, otherEntry_Pr, 
                                                     i_Pr, indicies_Pr, 
                                                     portDomain_Pr, 
                                                     sourcePort_Pr, 
                                                     destPort_Pr, new_sport_Pr, 
                                                     depth_C, host_C, hidx_Co, 
                                                     host_idx, pidx, port_idx, 
                                                     depth_Di, ip_D, host_Di, 
                                                     connDomain, cidx, 
                                                     conn_Dis, depth_Pu, 
                                                     pkt_Pu, ipkt_Pu, entry_Pu, 
                                                     conn_Pub, hostMarker_Pu, 
                                                     ip_idx_Pu, ipidx_Pu, 
                                                     ip_Pub, host_Pub, 
                                                     depth_Pri, pkt_PrivT, 
                                                     conn_Priv, 
                                                     hostMarker_PrivT, 
                                                     daddr_Pri, hostidx_Pri, 
                                                     hidx_Priv, otherEntry_Pri, 
                                                     i_Pri, indicies_Pri, 
                                                     portDomain_Pri, 
                                                     sourcePort_Pri, 
                                                     destPort_Pri, 
                                                     new_sport_Pri, good_, 
                                                     depth_E, i_E, j_, ip_E, 
                                                     host_E, indecies_, 
                                                     depth_Ev, i_Ev, j_E, 
                                                     ip_Ev, host_Ev, 
                                                     indecies_E, i_C, i_Ch, 
                                                     depth_Pub, pkt_Pub, 
                                                     ipkt_Pub, entry_Pub, 
                                                     conn_PubT, hostMarker_Pub, 
                                                     ip_idx_Pub, ipidx_Pub, 
                                                     ip_PubT, host_PubT, 
                                                     depth_Priv, pkt_PrivTo, 
                                                     conn_PrivT, 
                                                     hostMarker_PrivTo, 
                                                     daddr_Priv, hostidx_Priv, 
                                                     hidx_PrivT, 
                                                     otherEntry_Priv, i_Priv, 
                                                     indicies_Priv, 
                                                     portDomain_Priv, 
                                                     sourcePort_Priv, 
                                                     destPort_Priv, 
                                                     new_sport_Priv, depth_Eve, 
                                                     i_Eve, j_Ev, ip_Eve, 
                                                     host_Eve, indecies_Ev, 
                                                     depth_PubT, pkt_PubT, 
                                                     ipkt, entry, conn_PubTo, 
                                                     hostMarker_PubT, ip_idx, 
                                                     ipidx, ip_PubTo, 
                                                     host_PubTo, depth_PrivT, 
                                                     pkt, conn_PrivTo, 
                                                     hostMarker, daddr, 
                                                     hostidx, hidx, otherEntry, 
                                                     i_PrivT, indicies, 
                                                     portDomain, sourcePort, 
                                                     destPort, new_sport, good, 
                                                     depth, i_Even, j, ip_Even, 
                                                     host_Even, indecies, 
                                                     i_Che, i, aa >>

disconnectManRet(self) == /\ pc[self] = "disconnectManRet"
                          /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                          /\ connDomain_D' = [connDomain_D EXCEPT ![self] = Head(stack[self]).connDomain_D]
                          /\ cidx_D' = [cidx_D EXCEPT ![self] = Head(stack[self]).cidx_D]
                          /\ conn_D' = [conn_D EXCEPT ![self] = Head(stack[self]).conn_D]
                          /\ host_Dis' = [host_Dis EXCEPT ![self] = Head(stack[self]).host_Dis]
                          /\ ip_Di' = [ip_Di EXCEPT ![self] = Head(stack[self]).ip_Di]
                          /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, depth_, host_, hidx_, 
                                          host_idx_, pidx_, port_idx_, depth_D, 
                                          ip_, host_D, connDomain_, cidx_, 
                                          conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, host, 
                                          ip, connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

DisconnectMan(self) == disconnectManStart(self)
                          \/ disconnectVulnPurgeOrphans1(self)
                          \/ disconnectVulnPurgeOrphans2(self)
                          \/ disconnectManRet(self)

disconnectVulnManStart(self) == /\ pc[self] = "disconnectVulnManStart"
                                /\ IF Len(Connections) > 0
                                      THEN /\ PrintT(<< "DisconnectVulnMan- Before:", host[self], ip[self], Connections>>)
                                           /\ Connections' = SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip[self])
                                           /\ UsedIPs' = SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip[self])
                                           /\ FreeIPs' = Append(FreeIPs, ip[self])
                                           /\ FreeHosts' = Append(FreeHosts, host[self])
                                           /\ UsedHosts' = SelectSeq(UsedHosts, LAMBDA m: m /= host[self])
                                           /\ PrintT(<< "DisconnectVulnMan - After: ", host[self], ip[self], Connections'>>)
                                      ELSE /\ TRUE
                                           /\ UNCHANGED << FreeHosts, 
                                                           UsedHosts, FreeIPs, 
                                                           UsedIPs, 
                                                           Connections >>
                                /\ pc' = [pc EXCEPT ![self] = "disconnectVulnManRet"]
                                /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, 
                                                Cc, Dd, Ee, Ff, Gg, Hh, Ii, Jj, 
                                                Kk, Ll, Mm, Nn, Oo, Pp, Qq, Rr, 
                                                Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, 
                                                H1, H2, MaxPorts, EP1, 
                                                PortMap1, EP2, PortMap2, 
                                                TableFull, EvictionReroute, 
                                                PortScanInv, MaxTableSize, 
                                                hosts, Ports, ExtraPorts, 
                                                ExtraExtraPorts, T, SendQueue, 
                                                RcvQueue, MAX, Marker1, 
                                                Marker2, CmdConnect, 
                                                CmdDisconnect, PortSpaceFull, 
                                                stack, depth_, host_, hidx_, 
                                                host_idx_, pidx_, port_idx_, 
                                                depth_D, ip_, host_D, 
                                                connDomain_, cidx_, conn_, 
                                                host_Co, ip_C, hidx_C, 
                                                host_idx_C, pidx_C, port_idx_C, 
                                                host_Dis, ip_Di, connDomain_D, 
                                                cidx_D, conn_D, host, ip, 
                                                connDomain_Di, cidx_Di, 
                                                conn_Di, depth_P, pkt_, ipkt_, 
                                                entry_, conn_P, hostMarker_, 
                                                ip_idx_, ipidx_, ip_P, host_P, 
                                                pkt_P, ipkt_P, entry_P, 
                                                conn_Pu, hostMarker_P, 
                                                ip_idx_P, ipidx_P, ip_Pu, 
                                                host_Pu, conn, sport, dstAddr, 
                                                dport, pkt_Pr, hostMarker_Pr, 
                                                daddr_, hostidx_, hidx_P, 
                                                otherEntry_, i_, indicies_, 
                                                portDomain_, sourcePort_, 
                                                destPort_, new_sport_, 
                                                depth_Pr, pkt_Pri, conn_Pr, 
                                                hostMarker_Pri, daddr_P, 
                                                hostidx_P, hidx_Pr, 
                                                otherEntry_P, i_P, indicies_P, 
                                                portDomain_P, sourcePort_P, 
                                                destPort_P, new_sport_P, 
                                                pkt_Priv, conn_Pri, 
                                                hostMarker_Priv, daddr_Pr, 
                                                hostidx_Pr, hidx_Pri, 
                                                otherEntry_Pr, i_Pr, 
                                                indicies_Pr, portDomain_Pr, 
                                                sourcePort_Pr, destPort_Pr, 
                                                new_sport_Pr, depth_C, host_C, 
                                                hidx_Co, host_idx, pidx, 
                                                port_idx, depth_Di, ip_D, 
                                                host_Di, connDomain, cidx, 
                                                conn_Dis, depth_Pu, pkt_Pu, 
                                                ipkt_Pu, entry_Pu, conn_Pub, 
                                                hostMarker_Pu, ip_idx_Pu, 
                                                ipidx_Pu, ip_Pub, host_Pub, 
                                                depth_Pri, pkt_PrivT, 
                                                conn_Priv, hostMarker_PrivT, 
                                                daddr_Pri, hostidx_Pri, 
                                                hidx_Priv, otherEntry_Pri, 
                                                i_Pri, indicies_Pri, 
                                                portDomain_Pri, sourcePort_Pri, 
                                                destPort_Pri, new_sport_Pri, 
                                                good_, depth_E, i_E, j_, ip_E, 
                                                host_E, indecies_, depth_Ev, 
                                                i_Ev, j_E, ip_Ev, host_Ev, 
                                                indecies_E, i_C, i_Ch, 
                                                depth_Pub, pkt_Pub, ipkt_Pub, 
                                                entry_Pub, conn_PubT, 
                                                hostMarker_Pub, ip_idx_Pub, 
                                                ipidx_Pub, ip_PubT, host_PubT, 
                                                depth_Priv, pkt_PrivTo, 
                                                conn_PrivT, hostMarker_PrivTo, 
                                                daddr_Priv, hostidx_Priv, 
                                                hidx_PrivT, otherEntry_Priv, 
                                                i_Priv, indicies_Priv, 
                                                portDomain_Priv, 
                                                sourcePort_Priv, destPort_Priv, 
                                                new_sport_Priv, depth_Eve, 
                                                i_Eve, j_Ev, ip_Eve, host_Eve, 
                                                indecies_Ev, depth_PubT, 
                                                pkt_PubT, ipkt, entry, 
                                                conn_PubTo, hostMarker_PubT, 
                                                ip_idx, ipidx, ip_PubTo, 
                                                host_PubTo, depth_PrivT, pkt, 
                                                conn_PrivTo, hostMarker, daddr, 
                                                hostidx, hidx, otherEntry, 
                                                i_PrivT, indicies, portDomain, 
                                                sourcePort, destPort, 
                                                new_sport, good, depth, i_Even, 
                                                j, ip_Even, host_Even, 
                                                indecies, i_Che, i, aa >>

disconnectVulnManRet(self) == /\ pc[self] = "disconnectVulnManRet"
                              /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                              /\ connDomain_Di' = [connDomain_Di EXCEPT ![self] = Head(stack[self]).connDomain_Di]
                              /\ cidx_Di' = [cidx_Di EXCEPT ![self] = Head(stack[self]).cidx_Di]
                              /\ conn_Di' = [conn_Di EXCEPT ![self] = Head(stack[self]).conn_Di]
                              /\ host' = [host EXCEPT ![self] = Head(stack[self]).host]
                              /\ ip' = [ip EXCEPT ![self] = Head(stack[self]).ip]
                              /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                              /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                              Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                              Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                              Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                              H2, MaxPorts, EP1, PortMap1, EP2, 
                                              PortMap2, TableFull, 
                                              EvictionReroute, PortScanInv, 
                                              MaxTableSize, hosts, FreeHosts, 
                                              UsedHosts, Ports, ExtraPorts, 
                                              ExtraExtraPorts, T, FreeIPs, 
                                              UsedIPs, Connections, SendQueue, 
                                              RcvQueue, MAX, Marker1, Marker2, 
                                              CmdConnect, CmdDisconnect, 
                                              PortSpaceFull, depth_, host_, 
                                              hidx_, host_idx_, pidx_, 
                                              port_idx_, depth_D, ip_, host_D, 
                                              connDomain_, cidx_, conn_, 
                                              host_Co, ip_C, hidx_C, 
                                              host_idx_C, pidx_C, port_idx_C, 
                                              host_Dis, ip_Di, connDomain_D, 
                                              cidx_D, conn_D, depth_P, pkt_, 
                                              ipkt_, entry_, conn_P, 
                                              hostMarker_, ip_idx_, ipidx_, 
                                              ip_P, host_P, pkt_P, ipkt_P, 
                                              entry_P, conn_Pu, hostMarker_P, 
                                              ip_idx_P, ipidx_P, ip_Pu, 
                                              host_Pu, conn, sport, dstAddr, 
                                              dport, pkt_Pr, hostMarker_Pr, 
                                              daddr_, hostidx_, hidx_P, 
                                              otherEntry_, i_, indicies_, 
                                              portDomain_, sourcePort_, 
                                              destPort_, new_sport_, depth_Pr, 
                                              pkt_Pri, conn_Pr, hostMarker_Pri, 
                                              daddr_P, hostidx_P, hidx_Pr, 
                                              otherEntry_P, i_P, indicies_P, 
                                              portDomain_P, sourcePort_P, 
                                              destPort_P, new_sport_P, 
                                              pkt_Priv, conn_Pri, 
                                              hostMarker_Priv, daddr_Pr, 
                                              hostidx_Pr, hidx_Pri, 
                                              otherEntry_Pr, i_Pr, indicies_Pr, 
                                              portDomain_Pr, sourcePort_Pr, 
                                              destPort_Pr, new_sport_Pr, 
                                              depth_C, host_C, hidx_Co, 
                                              host_idx, pidx, port_idx, 
                                              depth_Di, ip_D, host_Di, 
                                              connDomain, cidx, conn_Dis, 
                                              depth_Pu, pkt_Pu, ipkt_Pu, 
                                              entry_Pu, conn_Pub, 
                                              hostMarker_Pu, ip_idx_Pu, 
                                              ipidx_Pu, ip_Pub, host_Pub, 
                                              depth_Pri, pkt_PrivT, conn_Priv, 
                                              hostMarker_PrivT, daddr_Pri, 
                                              hostidx_Pri, hidx_Priv, 
                                              otherEntry_Pri, i_Pri, 
                                              indicies_Pri, portDomain_Pri, 
                                              sourcePort_Pri, destPort_Pri, 
                                              new_sport_Pri, good_, depth_E, 
                                              i_E, j_, ip_E, host_E, indecies_, 
                                              depth_Ev, i_Ev, j_E, ip_Ev, 
                                              host_Ev, indecies_E, i_C, i_Ch, 
                                              depth_Pub, pkt_Pub, ipkt_Pub, 
                                              entry_Pub, conn_PubT, 
                                              hostMarker_Pub, ip_idx_Pub, 
                                              ipidx_Pub, ip_PubT, host_PubT, 
                                              depth_Priv, pkt_PrivTo, 
                                              conn_PrivT, hostMarker_PrivTo, 
                                              daddr_Priv, hostidx_Priv, 
                                              hidx_PrivT, otherEntry_Priv, 
                                              i_Priv, indicies_Priv, 
                                              portDomain_Priv, sourcePort_Priv, 
                                              destPort_Priv, new_sport_Priv, 
                                              depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                              host_Eve, indecies_Ev, 
                                              depth_PubT, pkt_PubT, ipkt, 
                                              entry, conn_PubTo, 
                                              hostMarker_PubT, ip_idx, ipidx, 
                                              ip_PubTo, host_PubTo, 
                                              depth_PrivT, pkt, conn_PrivTo, 
                                              hostMarker, daddr, hostidx, hidx, 
                                              otherEntry, i_PrivT, indicies, 
                                              portDomain, sourcePort, destPort, 
                                              new_sport, good, depth, i_Even, 
                                              j, ip_Even, host_Even, indecies, 
                                              i_Che, i, aa >>

DisconnectVulnMan(self) == disconnectVulnManStart(self)
                              \/ disconnectVulnManRet(self)

evictStart(self) == /\ pc[self] = "evictStart"
                    /\ PrintT("Evict")
                    /\ IF Len(T) > 0
                          THEN /\ T' = Tail(T)
                          ELSE /\ TRUE
                               /\ T' = T
                    /\ pc' = [pc EXCEPT ![self] = "evictRet"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    stack, depth_, host_, hidx_, host_idx_, 
                                    pidx_, port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

evictRet(self) == /\ pc[self] = "evictRet"
                  /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                  /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                  /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, Ff, 
                                  Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, Qq, 
                                  Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                  MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                  TableFull, EvictionReroute, PortScanInv, 
                                  MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                  Ports, ExtraPorts, ExtraExtraPorts, T, 
                                  FreeIPs, UsedIPs, Connections, SendQueue, 
                                  RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                  CmdDisconnect, PortSpaceFull, depth_, host_, 
                                  hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                  ip_, host_D, connDomain_, cidx_, conn_, 
                                  host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                  port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                  cidx_D, conn_D, host, ip, connDomain_Di, 
                                  cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                  entry_, conn_P, hostMarker_, ip_idx_, ipidx_, 
                                  ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                  conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                  ip_Pu, host_Pu, conn, sport, dstAddr, dport, 
                                  pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                  hidx_P, otherEntry_, i_, indicies_, 
                                  portDomain_, sourcePort_, destPort_, 
                                  new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                  hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, 
                                  otherEntry_P, i_P, indicies_P, portDomain_P, 
                                  sourcePort_P, destPort_P, new_sport_P, 
                                  pkt_Priv, conn_Pri, hostMarker_Priv, 
                                  daddr_Pr, hostidx_Pr, hidx_Pri, 
                                  otherEntry_Pr, i_Pr, indicies_Pr, 
                                  portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                  new_sport_Pr, depth_C, host_C, hidx_Co, 
                                  host_idx, pidx, port_idx, depth_Di, ip_D, 
                                  host_Di, connDomain, cidx, conn_Dis, 
                                  depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                  conn_Pub, hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                  ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                  conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                  hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                  i_Pri, indicies_Pri, portDomain_Pri, 
                                  sourcePort_Pri, destPort_Pri, new_sport_Pri, 
                                  good_, depth_E, i_E, j_, ip_E, host_E, 
                                  indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                  host_Ev, indecies_E, i_C, i_Ch, depth_Pub, 
                                  pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                  hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                  ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                  conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                  hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                  i_Priv, indicies_Priv, portDomain_Priv, 
                                  sourcePort_Priv, destPort_Priv, 
                                  new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                  ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                  pkt_PubT, ipkt, entry, conn_PubTo, 
                                  hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                  host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                  hostMarker, daddr, hostidx, hidx, otherEntry, 
                                  i_PrivT, indicies, portDomain, sourcePort, 
                                  destPort, new_sport, good, depth, i_Even, j, 
                                  ip_Even, host_Even, indecies, i_Che, i, aa >>

Evict(self) == evictStart(self) \/ evictRet(self)

pubtoprivVEvt3_(self) == /\ pc[self] = "pubtoprivVEvt3_"
                         /\ /\ depth_E' = [depth_E EXCEPT ![self] = depth_P[self]]
                            /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                     pc        |->  "pubtoprivVStart_",
                                                                     i_E       |->  i_E[self],
                                                                     j_        |->  j_[self],
                                                                     ip_E      |->  ip_E[self],
                                                                     host_E    |->  host_E[self],
                                                                     indecies_ |->  indecies_[self],
                                                                     depth_E   |->  depth_E[self] ] >>
                                                                 \o stack[self]]
                         /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                         /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                         /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                         /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                         /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                         /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                         indecies_E, i_C, i_Ch, depth_Pub, 
                                         pkt_Pub, ipkt_Pub, entry_Pub, 
                                         conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                         ipidx_Pub, ip_PubT, host_PubT, 
                                         depth_Priv, pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

pubtoprivVStart_(self) == /\ pc[self] = "pubtoprivVStart_"
                          /\ IF Len(SendQueue) > 0
                                THEN /\ pkt_' = [pkt_ EXCEPT ![self] = Head(SendQueue)]
                                     /\ PrintT(<<"PubToPrivMan - Len(SendQueue) > 0:", pkt_'[self], Connections, T>>)
                                     /\ SendQueue' = Tail(SendQueue)
                                     /\ IF Len(T) > 0
                                           THEN /\ PrintT(<<"PubToPrivMan - Len(T) > 0:">>)
                                                /\ entry_' = [entry_ EXCEPT ![self] = SelectSeq(T, LAMBDA e: e.reply.saddr=pkt_'[self].saddr /\
                                                                                                             e.reply.sport=pkt_'[self].sport /\
                                                                                                             e.reply.daddr=pkt_'[self].daddr /\
                                                                                                             e.reply.dport=pkt_'[self].dport)]
                                                /\ IF entry_'[self]=defaultInitValue
                                                      THEN /\ pc' = [pc EXCEPT ![self] = "pubtirprivVDE_"]
                                                      ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivEEmpty_"]
                                           ELSE /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet_"]
                                                /\ UNCHANGED entry_
                                ELSE /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet_"]
                                     /\ UNCHANGED << SendQueue, pkt_, entry_ >>
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          RcvQueue, MAX, Marker1, Marker2, 
                                          CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, ipkt_, conn_P, hostMarker_, 
                                          ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                          ipkt_P, entry_P, conn_Pu, 
                                          hostMarker_P, ip_idx_P, ipidx_P, 
                                          ip_Pu, host_Pu, conn, sport, dstAddr, 
                                          dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                          hostidx_, hidx_P, otherEntry_, i_, 
                                          indicies_, portDomain_, sourcePort_, 
                                          destPort_, new_sport_, depth_Pr, 
                                          pkt_Pri, conn_Pr, hostMarker_Pri, 
                                          daddr_P, hostidx_P, hidx_Pr, 
                                          otherEntry_P, i_P, indicies_P, 
                                          portDomain_P, sourcePort_P, 
                                          destPort_P, new_sport_P, pkt_Priv, 
                                          conn_Pri, hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

pubtoprivEEmpty_(self) == /\ pc[self] = "pubtoprivEEmpty_"
                          /\ IF Len(entry_[self]) <= 0
                                THEN /\ PrintT(<<"PubToPrivVuln - Empty Entry">>)
                                     /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet_"]
                                ELSE /\ PrintT(<<"PubToPrivMan - Len(entry) > -0:", entry_[self], pkt_[self]>>)
                                     /\ pc' = [pc EXCEPT ![self] = "pubtoPrivElse_"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

pubtoPrivElse_(self) == /\ pc[self] = "pubtoPrivElse_"
                        /\ entry_' = [entry_ EXCEPT ![self] = Head(entry_[self])]
                        /\ IF entry_'[self].reply.dport=N
                              THEN /\ PrintT(<<"PubToPrivMan - PortShadow: ", entry_'[self], pkt_[self]>>)
                              ELSE /\ TRUE
                        /\ IF entry_'[self].host_marker/=pkt_[self].host_marker
                              THEN /\ PrintT(<<"PubToPrivMan - entry.host_marker/=pkt.host_marker:", entry_'[self], pkt_[self]>>)
                                   /\ IF pkt_[self].host_marker = H1
                                         THEN /\ Marker1' = entry_'[self].host_marker
                                              /\ UNCHANGED Marker2
                                         ELSE /\ Marker2' = entry_'[self].host_marker
                                              /\ UNCHANGED Marker1
                                   /\ PrintT(<<"PubToPrivMan-Eviction Error: pkt", pkt_[self], " entry", entry_'[self], "Connections:", Connections, "T: ", T>>)
                              ELSE /\ TRUE
                                   /\ UNCHANGED << Marker1, Marker2 >>
                        /\ conn_P' = [conn_P EXCEPT ![self] = SelectSeq(Connections, LAMBDA e: entry_'[self].orig.saddr = Head(e))]
                        /\ IF Len(conn_P'[self]) > 0
                              THEN /\ pc' = [pc EXCEPT ![self] = "pubtoprivVConngt1_"]
                              ELSE /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        CmdConnect, CmdDisconnect, 
                                        PortSpaceFull, stack, depth_, host_, 
                                        hidx_, host_idx_, pidx_, port_idx_, 
                                        depth_D, ip_, host_D, connDomain_, 
                                        cidx_, conn_, host_Co, ip_C, hidx_C, 
                                        host_idx_C, pidx_C, port_idx_C, 
                                        host_Dis, ip_Di, connDomain_D, cidx_D, 
                                        conn_D, host, ip, connDomain_Di, 
                                        cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

pubtoprivVConngt1_(self) == /\ pc[self] = "pubtoprivVConngt1_"
                            /\ conn_P' = [conn_P EXCEPT ![self] = Head(conn_P[self])]
                            /\ pc' = [pc EXCEPT ![self] = "pubtoprivVConngt2_"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, hostMarker_, ip_idx_, 
                                            ipidx_, ip_P, host_P, pkt_P, 
                                            ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

pubtoprivVConngt2_(self) == /\ pc[self] = "pubtoprivVConngt2_"
                            /\ hostMarker_' = [hostMarker_ EXCEPT ![self] = conn_P[self][2]]
                            /\ IF hostMarker_'[self] = H1
                                  THEN /\ IF entry_[self].host_marker = H2
                                             THEN /\ PortScanInv' = TRUE
                                             ELSE /\ TRUE
                                                  /\ UNCHANGED PortScanInv
                                       /\ Marker1' = entry_[self].host_marker
                                       /\ UNCHANGED Marker2
                                  ELSE /\ IF entry_[self].host_marker = H1
                                             THEN /\ PortScanInv' = TRUE
                                             ELSE /\ TRUE
                                                  /\ UNCHANGED PortScanInv
                                       /\ Marker2' = entry_[self].host_marker
                                       /\ UNCHANGED Marker1
                            /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet_"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, MaxTableSize, 
                                            hosts, FreeHosts, UsedHosts, Ports, 
                                            ExtraPorts, ExtraExtraPorts, T, 
                                            FreeIPs, UsedIPs, Connections, 
                                            SendQueue, RcvQueue, MAX, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, ip_idx_, ipidx_, 
                                            ip_P, host_P, pkt_P, ipkt_P, 
                                            entry_P, conn_Pu, hostMarker_P, 
                                            ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                            conn, sport, dstAddr, dport, 
                                            pkt_Pr, hostMarker_Pr, daddr_, 
                                            hostidx_, hidx_P, otherEntry_, i_, 
                                            indicies_, portDomain_, 
                                            sourcePort_, destPort_, new_sport_, 
                                            depth_Pr, pkt_Pri, conn_Pr, 
                                            hostMarker_Pri, daddr_P, hostidx_P, 
                                            hidx_Pr, otherEntry_P, i_P, 
                                            indicies_P, portDomain_P, 
                                            sourcePort_P, destPort_P, 
                                            new_sport_P, pkt_Priv, conn_Pri, 
                                            hostMarker_Priv, daddr_Pr, 
                                            hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

pubtirprivVDE_(self) == /\ pc[self] = "pubtirprivVDE_"
                        /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                        /\ pkt_' = [pkt_ EXCEPT ![self] = Head(stack[self]).pkt_]
                        /\ ipkt_' = [ipkt_ EXCEPT ![self] = Head(stack[self]).ipkt_]
                        /\ entry_' = [entry_ EXCEPT ![self] = Head(stack[self]).entry_]
                        /\ conn_P' = [conn_P EXCEPT ![self] = Head(stack[self]).conn_P]
                        /\ hostMarker_' = [hostMarker_ EXCEPT ![self] = Head(stack[self]).hostMarker_]
                        /\ ip_idx_' = [ip_idx_ EXCEPT ![self] = Head(stack[self]).ip_idx_]
                        /\ ipidx_' = [ipidx_ EXCEPT ![self] = Head(stack[self]).ipidx_]
                        /\ ip_P' = [ip_P EXCEPT ![self] = Head(stack[self]).ip_P]
                        /\ host_P' = [host_P EXCEPT ![self] = Head(stack[self]).host_P]
                        /\ depth_P' = [depth_P EXCEPT ![self] = Head(stack[self]).depth_P]
                        /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, pkt_P, 
                                        ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                        ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                        conn, sport, dstAddr, dport, pkt_Pr, 
                                        hostMarker_Pr, daddr_, hostidx_, 
                                        hidx_P, otherEntry_, i_, indicies_, 
                                        portDomain_, sourcePort_, destPort_, 
                                        new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

pubtopriVvRet_(self) == /\ pc[self] = "pubtopriVvRet_"
                        /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                        /\ pkt_' = [pkt_ EXCEPT ![self] = Head(stack[self]).pkt_]
                        /\ ipkt_' = [ipkt_ EXCEPT ![self] = Head(stack[self]).ipkt_]
                        /\ entry_' = [entry_ EXCEPT ![self] = Head(stack[self]).entry_]
                        /\ conn_P' = [conn_P EXCEPT ![self] = Head(stack[self]).conn_P]
                        /\ hostMarker_' = [hostMarker_ EXCEPT ![self] = Head(stack[self]).hostMarker_]
                        /\ ip_idx_' = [ip_idx_ EXCEPT ![self] = Head(stack[self]).ip_idx_]
                        /\ ipidx_' = [ipidx_ EXCEPT ![self] = Head(stack[self]).ipidx_]
                        /\ ip_P' = [ip_P EXCEPT ![self] = Head(stack[self]).ip_P]
                        /\ host_P' = [host_P EXCEPT ![self] = Head(stack[self]).host_P]
                        /\ depth_P' = [depth_P EXCEPT ![self] = Head(stack[self]).depth_P]
                        /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, pkt_P, 
                                        ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                        ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                        conn, sport, dstAddr, dport, pkt_Pr, 
                                        hostMarker_Pr, daddr_, hostidx_, 
                                        hidx_P, otherEntry_, i_, indicies_, 
                                        portDomain_, sourcePort_, destPort_, 
                                        new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

PubToPrivVuln(self) == pubtoprivVEvt3_(self) \/ pubtoprivVStart_(self)
                          \/ pubtoprivEEmpty_(self) \/ pubtoPrivElse_(self)
                          \/ pubtoprivVConngt1_(self)
                          \/ pubtoprivVConngt2_(self)
                          \/ pubtirprivVDE_(self) \/ pubtopriVvRet_(self)

pubtoprivManStart(self) == /\ pc[self] = "pubtoprivManStart"
                           /\ IF Len(SendQueue) > 0
                                 THEN /\ pkt_P' = [pkt_P EXCEPT ![self] = Head(SendQueue)]
                                      /\ PrintT(<<"PubToPrivMan - Len(SendQueue) > 0:", pkt_P'[self], Connections, T>>)
                                      /\ SendQueue' = Tail(SendQueue)
                                      /\ IF Len(T) > 0
                                            THEN /\ PrintT(<<"PubToPrivMan - Len(T) > 0:">>)
                                                 /\ entry_P' = [entry_P EXCEPT ![self] = SelectSeq(T, LAMBDA e: e.reply.saddr=pkt_P'[self].saddr /\
                                                                                                                e.reply.sport=pkt_P'[self].sport /\
                                                                                                                e.reply.daddr=pkt_P'[self].daddr /\
                                                                                                                e.reply.dport=pkt_P'[self].dport)]
                                                 /\ IF Len(entry_P'[self]) <= 0
                                                       THEN /\ Assert((FALSE), 
                                                                      "Failure of assertion at line 300, column 9.")
                                                            /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_"]
                                                       ELSE /\ PrintT(<<"PubToPrivMan - Len(entry) > -0:", entry_P'[self], pkt_P'[self]>>)
                                                            /\ pc' = [pc EXCEPT ![self] = "pubtoPrivElse_P"]
                                            ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_"]
                                                 /\ UNCHANGED entry_P
                                 ELSE /\ PrintT(<<"PubToPrivMan - Else Len(SendQueue) <= 0">>)
                                      /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_"]
                                      /\ UNCHANGED << SendQueue, pkt_P, 
                                                      entry_P >>
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, RcvQueue, MAX, 
                                           Marker1, Marker2, CmdConnect, 
                                           CmdDisconnect, PortSpaceFull, stack, 
                                           depth_, host_, hidx_, host_idx_, 
                                           pidx_, port_idx_, depth_D, ip_, 
                                           host_D, connDomain_, cidx_, conn_, 
                                           host_Co, ip_C, hidx_C, host_idx_C, 
                                           pidx_C, port_idx_C, host_Dis, ip_Di, 
                                           connDomain_D, cidx_D, conn_D, host, 
                                           ip, connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, ipkt_P, 
                                           conn_Pu, hostMarker_P, ip_idx_P, 
                                           ipidx_P, ip_Pu, host_Pu, conn, 
                                           sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

pubtoPrivElse_P(self) == /\ pc[self] = "pubtoPrivElse_P"
                         /\ entry_P' = [entry_P EXCEPT ![self] = Head(entry_P[self])]
                         /\ IF entry_P'[self].reply.dport=N
                               THEN /\ PrintT(<<"PubToPrivMan - PortShadow: ", entry_P'[self], pkt_P[self]>>)
                               ELSE /\ TRUE
                         /\ IF entry_P'[self].host_marker/=pkt_P[self].host_marker
                               THEN /\ PrintT(<<"PubToPrivMan - entry.host_marker/=pkt.host_marker:", entry_P'[self], pkt_P[self]>>)
                                    /\ IF pkt_P[self].host_marker = H1
                                          THEN /\ Marker1' = entry_P'[self].host_marker
                                               /\ IF entry_P'[self].host_marker = H2
                                                     THEN /\ EvictionReroute' = TRUE
                                                     ELSE /\ TRUE
                                                          /\ UNCHANGED EvictionReroute
                                               /\ UNCHANGED Marker2
                                          ELSE /\ Marker2' = entry_P'[self].host_marker
                                               /\ IF entry_P'[self].host_marker = H1
                                                     THEN /\ EvictionReroute' = TRUE
                                                     ELSE /\ TRUE
                                                          /\ UNCHANGED EvictionReroute
                                               /\ UNCHANGED Marker1
                                    /\ PrintT(<<"PubToPrivMan - Eviction Error: pkt", pkt_P[self], " entry", entry_P'[self], "Connections:", Connections, "T: ", T>>)
                               ELSE /\ TRUE
                                    /\ UNCHANGED << EvictionReroute, Marker1, 
                                                    Marker2 >>
                         /\ conn_Pu' = [conn_Pu EXCEPT ![self] = SelectSeq(Connections, LAMBDA e: entry_P'[self].orig.saddr = Head(e))]
                         /\ IF Len(conn_Pu'[self]) > 0
                               THEN /\ pc' = [pc EXCEPT ![self] = "pubtoprivConngt1_"]
                               ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         PortScanInv, MaxTableSize, hosts, 
                                         FreeHosts, UsedHosts, Ports, 
                                         ExtraPorts, ExtraExtraPorts, T, 
                                         FreeIPs, UsedIPs, Connections, 
                                         SendQueue, RcvQueue, MAX, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, stack, 
                                         depth_, host_, hidx_, host_idx_, 
                                         pidx_, port_idx_, depth_D, ip_, 
                                         host_D, connDomain_, cidx_, conn_, 
                                         host_Co, ip_C, hidx_C, host_idx_C, 
                                         pidx_C, port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, hostMarker_P, 
                                         ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                         conn, sport, dstAddr, dport, pkt_Pr, 
                                         hostMarker_Pr, daddr_, hostidx_, 
                                         hidx_P, otherEntry_, i_, indicies_, 
                                         portDomain_, sourcePort_, destPort_, 
                                         new_sport_, depth_Pr, pkt_Pri, 
                                         conn_Pr, hostMarker_Pri, daddr_P, 
                                         hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

pubtoprivConngt1_(self) == /\ pc[self] = "pubtoprivConngt1_"
                           /\ conn_Pu' = [conn_Pu EXCEPT ![self] = Head(conn_Pu[self])]
                           /\ pc' = [pc EXCEPT ![self] = "pubtoprivConngt2_"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, Marker1, Marker2, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, hostMarker_P, ip_idx_P, 
                                           ipidx_P, ip_Pu, host_Pu, conn, 
                                           sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

pubtoprivConngt2_(self) == /\ pc[self] = "pubtoprivConngt2_"
                           /\ hostMarker_P' = [hostMarker_P EXCEPT ![self] = conn_Pu[self][2]]
                           /\ IF hostMarker_P'[self] = H1
                                 THEN /\ IF entry_P[self].host_marker = H2
                                            THEN /\ PortScanInv' = TRUE
                                            ELSE /\ TRUE
                                                 /\ UNCHANGED PortScanInv
                                      /\ Marker1' = entry_P[self].host_marker
                                      /\ UNCHANGED Marker2
                                 ELSE /\ IF entry_P[self].host_marker = H1
                                            THEN /\ PortScanInv' = TRUE
                                            ELSE /\ TRUE
                                                 /\ UNCHANGED PortScanInv
                                      /\ Marker2' = entry_P[self].host_marker
                                      /\ UNCHANGED Marker1
                           /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, MaxTableSize, 
                                           hosts, FreeHosts, UsedHosts, Ports, 
                                           ExtraPorts, ExtraExtraPorts, T, 
                                           FreeIPs, UsedIPs, Connections, 
                                           SendQueue, RcvQueue, MAX, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, ip_idx_P, ipidx_P, 
                                           ip_Pu, host_Pu, conn, sport, 
                                           dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

pubtoprivRet_(self) == /\ pc[self] = "pubtoprivRet_"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ pkt_P' = [pkt_P EXCEPT ![self] = Head(stack[self]).pkt_P]
                       /\ ipkt_P' = [ipkt_P EXCEPT ![self] = Head(stack[self]).ipkt_P]
                       /\ entry_P' = [entry_P EXCEPT ![self] = Head(stack[self]).entry_P]
                       /\ conn_Pu' = [conn_Pu EXCEPT ![self] = Head(stack[self]).conn_Pu]
                       /\ hostMarker_P' = [hostMarker_P EXCEPT ![self] = Head(stack[self]).hostMarker_P]
                       /\ ip_idx_P' = [ip_idx_P EXCEPT ![self] = Head(stack[self]).ip_idx_P]
                       /\ ipidx_P' = [ipidx_P EXCEPT ![self] = Head(stack[self]).ipidx_P]
                       /\ ip_Pu' = [ip_Pu EXCEPT ![self] = Head(stack[self]).ip_Pu]
                       /\ host_Pu' = [host_Pu EXCEPT ![self] = Head(stack[self]).host_Pu]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

PubToPrivMan(self) == pubtoprivManStart(self) \/ pubtoPrivElse_P(self)
                         \/ pubtoprivConngt1_(self)
                         \/ pubtoprivConngt2_(self) \/ pubtoprivRet_(self)

privtopubManStart_(self) == /\ pc[self] = "privtopubManStart_"
                            /\ IF Len (Connections) > 0
                                  THEN /\ sourcePort_' = [sourcePort_ EXCEPT ![self] = sport[self]]
                                       /\ pc' = [pc EXCEPT ![self] = "privtopubMan2Dport"]
                                  ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubMan2Ret"]
                                       /\ UNCHANGED sourcePort_
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, destPort_, new_sport_, 
                                            depth_Pr, pkt_Pri, conn_Pr, 
                                            hostMarker_Pri, daddr_P, hostidx_P, 
                                            hidx_Pr, otherEntry_P, i_P, 
                                            indicies_P, portDomain_P, 
                                            sourcePort_P, destPort_P, 
                                            new_sport_P, pkt_Priv, conn_Pri, 
                                            hostMarker_Priv, daddr_Pr, 
                                            hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

privtopubMan2Dport(self) == /\ pc[self] = "privtopubMan2Dport"
                            /\ destPort_' = [destPort_ EXCEPT ![self] = dport[self]]
                            /\ daddr_' = [daddr_ EXCEPT ![self] = dstAddr[self]]
                            /\ PrintT(<<"PrivToPub - Conn: ", conn[self]>>)
                            /\ hostMarker_Pr' = [hostMarker_Pr EXCEPT ![self] = Head(Tail(conn[self]))]
                            /\ pkt_Pr' = [pkt_Pr EXCEPT ![self] = [saddr |-> Head(conn[self]), sport |-> sourcePort_[self],
                                                                   daddr |-> daddr_'[self], dport |-> destPort_'[self],
                                                                   host_marker |-> hostMarker_Pr'[self]
                                                                  ]]
                            /\ PrintT(<<"PrivToPubMan - pkt: ", conn[self], pkt_Pr'[self]>>)
                            /\ entry' = [entry EXCEPT ![self] = [host_marker |-> hostMarker_Pr'[self],
                                                                 orig |-> [saddr |-> pkt_Pr'[self].saddr, sport |-> pkt_Pr'[self].sport,
                                                                           daddr |-> pkt_Pr'[self].daddr, dport |-> pkt_Pr'[self].dport],
                                                                 reply |-> [saddr |-> pkt_Pr'[self].daddr, sport |-> pkt_Pr'[self].dport,
                                                                            daddr |-> N,  dport |-> pkt_Pr'[self].sport ]]]
                            /\ otherEntry_' = [otherEntry_ EXCEPT ![self] = SelectSeq(T, LAMBDA k: k.reply.saddr=pkt_Pr'[self].daddr /\ k.reply.sport=pkt_Pr'[self].dport /\
                                                                                                   k.reply.daddr=N /\ k.reply.dport=pkt_Pr'[self].sport)]
                            /\ PrintT(<<"PrivToPub - T", T, otherEntry_'[self], pkt_Pr'[self]>>)
                            /\ IF Len(otherEntry_'[self]) > 0
                                  THEN /\ T' = SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt_Pr'[self].daddr /\ e.reply.sport=pkt_Pr'[self].dport /\
                                                                        e.reply.daddr=N /\ e.reply.dport=pkt_Pr'[self].sport) )
                                  ELSE /\ TRUE
                                       /\ T' = T
                            /\ pc' = [pc EXCEPT ![self] = "privtoPubMan2AddT"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, FreeIPs, UsedIPs, 
                                            Connections, SendQueue, RcvQueue, 
                                            MAX, Marker1, Marker2, CmdConnect, 
                                            CmdDisconnect, PortSpaceFull, 
                                            stack, depth_, host_, hidx_, 
                                            host_idx_, pidx_, port_idx_, 
                                            depth_D, ip_, host_D, connDomain_, 
                                            cidx_, conn_, host_Co, ip_C, 
                                            hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, hostidx_, hidx_P, 
                                            i_, indicies_, portDomain_, 
                                            sourcePort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, conn_PubTo, hostMarker_PubT, 
                                            ip_idx, ipidx, ip_PubTo, 
                                            host_PubTo, depth_PrivT, pkt, 
                                            conn_PrivTo, hostMarker, daddr, 
                                            hostidx, hidx, otherEntry, i_PrivT, 
                                            indicies, portDomain, sourcePort, 
                                            destPort, new_sport, good, depth, 
                                            i_Even, j, ip_Even, host_Even, 
                                            indecies, i_Che, i, aa >>

privtoPubMan2AddT(self) == /\ pc[self] = "privtoPubMan2AddT"
                           /\ T' = Append(T, entry[self])
                           /\ pc' = [pc EXCEPT ![self] = "privtopubPkt_"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, FreeIPs, UsedIPs, 
                                           Connections, SendQueue, RcvQueue, 
                                           MAX, Marker1, Marker2, CmdConnect, 
                                           CmdDisconnect, PortSpaceFull, stack, 
                                           depth_, host_, hidx_, host_idx_, 
                                           pidx_, port_idx_, depth_D, ip_, 
                                           host_D, connDomain_, cidx_, conn_, 
                                           host_Co, ip_C, hidx_C, host_idx_C, 
                                           pidx_C, port_idx_C, host_Dis, ip_Di, 
                                           connDomain_D, cidx_D, conn_D, host, 
                                           ip, connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privtopubPkt_(self) == /\ pc[self] = "privtopubPkt_"
                       /\ pkt_Pr' = [pkt_Pr EXCEPT ![self] = [saddr |->pkt_Pr[self].daddr, sport |-> pkt_Pr[self].dport,
                                                              daddr |-> N, dport |-> pkt_Pr[self].sport,
                                                              host_marker |-> hostMarker_Pr[self]]]
                       /\ SendQueue' = Append(SendQueue, pkt_Pr'[self])
                       /\ pc' = [pc EXCEPT ![self] = "privtopubMan2Ret"]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, RcvQueue, MAX, Marker1, 
                                       Marker2, CmdConnect, CmdDisconnect, 
                                       PortSpaceFull, stack, depth_, host_, 
                                       hidx_, host_idx_, pidx_, port_idx_, 
                                       depth_D, ip_, host_D, connDomain_, 
                                       cidx_, conn_, host_Co, ip_C, hidx_C, 
                                       host_idx_C, pidx_C, port_idx_C, 
                                       host_Dis, ip_Di, connDomain_D, cidx_D, 
                                       conn_D, host, ip, connDomain_Di, 
                                       cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                       entry_, conn_P, hostMarker_, ip_idx_, 
                                       ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                       entry_P, conn_Pu, hostMarker_P, 
                                       ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                       sport, dstAddr, dport, hostMarker_Pr, 
                                       daddr_, hostidx_, hidx_P, otherEntry_, 
                                       i_, indicies_, portDomain_, sourcePort_, 
                                       destPort_, new_sport_, depth_Pr, 
                                       pkt_Pri, conn_Pr, hostMarker_Pri, 
                                       daddr_P, hostidx_P, hidx_Pr, 
                                       otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

privtopubMan2Ret(self) == /\ pc[self] = "privtopubMan2Ret"
                          /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                          /\ pkt_Pr' = [pkt_Pr EXCEPT ![self] = Head(stack[self]).pkt_Pr]
                          /\ hostMarker_Pr' = [hostMarker_Pr EXCEPT ![self] = Head(stack[self]).hostMarker_Pr]
                          /\ daddr_' = [daddr_ EXCEPT ![self] = Head(stack[self]).daddr_]
                          /\ hostidx_' = [hostidx_ EXCEPT ![self] = Head(stack[self]).hostidx_]
                          /\ hidx_P' = [hidx_P EXCEPT ![self] = Head(stack[self]).hidx_P]
                          /\ otherEntry_' = [otherEntry_ EXCEPT ![self] = Head(stack[self]).otherEntry_]
                          /\ i_' = [i_ EXCEPT ![self] = Head(stack[self]).i_]
                          /\ indicies_' = [indicies_ EXCEPT ![self] = Head(stack[self]).indicies_]
                          /\ portDomain_' = [portDomain_ EXCEPT ![self] = Head(stack[self]).portDomain_]
                          /\ sourcePort_' = [sourcePort_ EXCEPT ![self] = Head(stack[self]).sourcePort_]
                          /\ destPort_' = [destPort_ EXCEPT ![self] = Head(stack[self]).destPort_]
                          /\ new_sport_' = [new_sport_ EXCEPT ![self] = Head(stack[self]).new_sport_]
                          /\ conn' = [conn EXCEPT ![self] = Head(stack[self]).conn]
                          /\ sport' = [sport EXCEPT ![self] = Head(stack[self]).sport]
                          /\ dstAddr' = [dstAddr EXCEPT ![self] = Head(stack[self]).dstAddr]
                          /\ dport' = [dport EXCEPT ![self] = Head(stack[self]).dport]
                          /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, depth_, host_, hidx_, 
                                          host_idx_, pidx_, port_idx_, depth_D, 
                                          ip_, host_D, connDomain_, cidx_, 
                                          conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, depth_Pr, 
                                          pkt_Pri, conn_Pr, hostMarker_Pri, 
                                          daddr_P, hostidx_P, hidx_Pr, 
                                          otherEntry_P, i_P, indicies_P, 
                                          portDomain_P, sourcePort_P, 
                                          destPort_P, new_sport_P, pkt_Priv, 
                                          conn_Pri, hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

PrivToPubMan2(self) == privtopubManStart_(self) \/ privtopubMan2Dport(self)
                          \/ privtoPubMan2AddT(self) \/ privtopubPkt_(self)
                          \/ privtopubMan2Ret(self)

privtopubV3_(self) == /\ pc[self] = "privtopubV3_"
                      /\ /\ depth_E' = [depth_E EXCEPT ![self] = depth_Pr[self]]
                         /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                  pc        |->  "privtopubManStart_P",
                                                                  i_E       |->  i_E[self],
                                                                  j_        |->  j_[self],
                                                                  ip_E      |->  ip_E[self],
                                                                  host_E    |->  host_E[self],
                                                                  indecies_ |->  indecies_[self],
                                                                  depth_E   |->  depth_E[self] ] >>
                                                              \o stack[self]]
                      /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                      /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                      /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                      /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                      /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                      /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, depth_, 
                                      host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                      entry_Pub, conn_PubT, hostMarker_Pub, 
                                      ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                      host_PubT, depth_Priv, pkt_PrivTo, 
                                      conn_PrivT, hostMarker_PrivTo, 
                                      daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, pkt, conn_PrivTo, 
                                      hostMarker, daddr, hostidx, hidx, 
                                      otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

privtopubManStart_P(self) == /\ pc[self] = "privtopubManStart_P"
                             /\ IF Len (Connections) > 0
                                   THEN /\ indicies_P' = [indicies_P EXCEPT ![self] = DOMAIN Connections]
                                        /\ portDomain_P' = [portDomain_P EXCEPT ![self] = DOMAIN Ports]
                                        /\ sourcePort_P' = [sourcePort_P EXCEPT ![self] = CHOOSE pr \in portDomain_P'[self] : TRUE]
                                        /\ i_P' = [i_P EXCEPT ![self] = CHOOSE f \in indicies_P'[self] : TRUE]
                                        /\ PrintT(<<"PrivToPub - conn", indecies[self], conn_Pr[self], Connections>>)
                                        /\ pc' = [pc EXCEPT ![self] = "privtopubConn_"]
                                   ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet_"]
                                        /\ UNCHANGED << i_P, indicies_P, 
                                                        portDomain_P, 
                                                        sourcePort_P >>
                             /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                             Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                             Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                             Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                             H2, MaxPorts, EP1, PortMap1, EP2, 
                                             PortMap2, TableFull, 
                                             EvictionReroute, PortScanInv, 
                                             MaxTableSize, hosts, FreeHosts, 
                                             UsedHosts, Ports, ExtraPorts, 
                                             ExtraExtraPorts, T, FreeIPs, 
                                             UsedIPs, Connections, SendQueue, 
                                             RcvQueue, MAX, Marker1, Marker2, 
                                             CmdConnect, CmdDisconnect, 
                                             PortSpaceFull, stack, depth_, 
                                             host_, hidx_, host_idx_, pidx_, 
                                             port_idx_, depth_D, ip_, host_D, 
                                             connDomain_, cidx_, conn_, 
                                             host_Co, ip_C, hidx_C, host_idx_C, 
                                             pidx_C, port_idx_C, host_Dis, 
                                             ip_Di, connDomain_D, cidx_D, 
                                             conn_D, host, ip, connDomain_Di, 
                                             cidx_Di, conn_Di, depth_P, pkt_, 
                                             ipkt_, entry_, conn_P, 
                                             hostMarker_, ip_idx_, ipidx_, 
                                             ip_P, host_P, pkt_P, ipkt_P, 
                                             entry_P, conn_Pu, hostMarker_P, 
                                             ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                             conn, sport, dstAddr, dport, 
                                             pkt_Pr, hostMarker_Pr, daddr_, 
                                             hostidx_, hidx_P, otherEntry_, i_, 
                                             indicies_, portDomain_, 
                                             sourcePort_, destPort_, 
                                             new_sport_, depth_Pr, pkt_Pri, 
                                             conn_Pr, hostMarker_Pri, daddr_P, 
                                             hostidx_P, hidx_Pr, otherEntry_P, 
                                             destPort_P, new_sport_P, pkt_Priv, 
                                             conn_Pri, hostMarker_Priv, 
                                             daddr_Pr, hostidx_Pr, hidx_Pri, 
                                             otherEntry_Pr, i_Pr, indicies_Pr, 
                                             portDomain_Pr, sourcePort_Pr, 
                                             destPort_Pr, new_sport_Pr, 
                                             depth_C, host_C, hidx_Co, 
                                             host_idx, pidx, port_idx, 
                                             depth_Di, ip_D, host_Di, 
                                             connDomain, cidx, conn_Dis, 
                                             depth_Pu, pkt_Pu, ipkt_Pu, 
                                             entry_Pu, conn_Pub, hostMarker_Pu, 
                                             ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                             host_Pub, depth_Pri, pkt_PrivT, 
                                             conn_Priv, hostMarker_PrivT, 
                                             daddr_Pri, hostidx_Pri, hidx_Priv, 
                                             otherEntry_Pri, i_Pri, 
                                             indicies_Pri, portDomain_Pri, 
                                             sourcePort_Pri, destPort_Pri, 
                                             new_sport_Pri, good_, depth_E, 
                                             i_E, j_, ip_E, host_E, indecies_, 
                                             depth_Ev, i_Ev, j_E, ip_Ev, 
                                             host_Ev, indecies_E, i_C, i_Ch, 
                                             depth_Pub, pkt_Pub, ipkt_Pub, 
                                             entry_Pub, conn_PubT, 
                                             hostMarker_Pub, ip_idx_Pub, 
                                             ipidx_Pub, ip_PubT, host_PubT, 
                                             depth_Priv, pkt_PrivTo, 
                                             conn_PrivT, hostMarker_PrivTo, 
                                             daddr_Priv, hostidx_Priv, 
                                             hidx_PrivT, otherEntry_Priv, 
                                             i_Priv, indicies_Priv, 
                                             portDomain_Priv, sourcePort_Priv, 
                                             destPort_Priv, new_sport_Priv, 
                                             depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                             host_Eve, indecies_Ev, depth_PubT, 
                                             pkt_PubT, ipkt, entry, conn_PubTo, 
                                             hostMarker_PubT, ip_idx, ipidx, 
                                             ip_PubTo, host_PubTo, depth_PrivT, 
                                             pkt, conn_PrivTo, hostMarker, 
                                             daddr, hostidx, hidx, otherEntry, 
                                             i_PrivT, indicies, portDomain, 
                                             sourcePort, destPort, new_sport, 
                                             good, depth, i_Even, j, ip_Even, 
                                             host_Even, indecies, i_Che, i, aa >>

privtopubConn_(self) == /\ pc[self] = "privtopubConn_"
                        /\ conn_Pr' = [conn_Pr EXCEPT ![self] = Connections[i_P[self]]]
                        /\ sourcePort_P' = [sourcePort_P EXCEPT ![self] = Ports[sourcePort_P[self]]]
                        /\ portDomain_P' = [portDomain_P EXCEPT ![self] = DOMAIN Ports]
                        /\ destPort_P' = [destPort_P EXCEPT ![self] = CHOOSE h \in portDomain_P'[self] : TRUE]
                        /\ pc' = [pc EXCEPT ![self] = "privtopubDport_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, stack, 
                                        depth_, host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, hostMarker_Pri, 
                                        daddr_P, hostidx_P, hidx_Pr, 
                                        otherEntry_P, i_P, indicies_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

privtopubDport_(self) == /\ pc[self] = "privtopubDport_"
                         /\ destPort_P' = [destPort_P EXCEPT ![self] = Ports[destPort_P[self]]]
                         /\ hostidx_P' = [hostidx_P EXCEPT ![self] = DOMAIN hosts]
                         /\ hidx_Pr' = [hidx_Pr EXCEPT ![self] = CHOOSE hid \in hostidx_P'[self] : TRUE]
                         /\ daddr_P' = [daddr_P EXCEPT ![self] = hosts[hidx_Pr'[self]]]
                         /\ PrintT(<<"PrivToPubVuln - Conn: ", conn_Pr[self]>>)
                         /\ hostMarker_Pri' = [hostMarker_Pri EXCEPT ![self] = Head(Tail(conn_Pr[self]))]
                         /\ pkt_Pri' = [pkt_Pri EXCEPT ![self] = [saddr |-> Head(conn_Pr[self]), sport |-> sourcePort_P[self],
                                                                  daddr |-> daddr_P'[self], dport |-> destPort_P'[self],
                                                                  host_marker |-> hostMarker_Pri'[self]
                                                                 ]]
                         /\ PrintT(<<"PrivToPubMan - pkt: ", conn_Pr[self], pkt_Pri'[self]>>)
                         /\ entry' = [entry EXCEPT ![self] = [host_marker |-> hostMarker_Pri'[self],
                                                              orig |-> [saddr |-> pkt_Pri'[self].saddr, sport |-> pkt_Pri'[self].sport,
                                                                        daddr |-> pkt_Pri'[self].daddr, dport |-> pkt_Pri'[self].dport],
                                                              reply |-> [saddr |-> pkt_Pri'[self].daddr, sport |-> pkt_Pri'[self].dport,
                                                                         daddr |-> N,  dport |-> pkt_Pri'[self].sport ]]]
                         /\ otherEntry_P' = [otherEntry_P EXCEPT ![self] = SelectSeq(T, LAMBDA k: k.reply.saddr=pkt_Pri'[self].daddr /\ k.reply.sport=pkt_Pri'[self].dport /\
                                                                                                  k.reply.daddr=N /\ k.reply.dport=pkt_Pri'[self].sport /\ k.host_marker /= hostMarker_Pri'[self])]
                         /\ PrintT(<<"PrivToPub - T", T, otherEntry_P'[self], pkt_Pri'[self]>>)
                         /\ IF Len(otherEntry_P'[self]) > 0
                               THEN /\ T' = SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt_Pri'[self].daddr /\ e.reply.sport=pkt_Pri'[self].dport /\
                                                                     e.reply.daddr=N /\ e.reply.dport=pkt_Pri'[self].sport) )
                               ELSE /\ TRUE
                                    /\ T' = T
                         /\ pc' = [pc EXCEPT ![self] = "privtoPubManAddT_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, stack, 
                                         depth_, host_, hidx_, host_idx_, 
                                         pidx_, port_idx_, depth_D, ip_, 
                                         host_D, connDomain_, cidx_, conn_, 
                                         host_Co, ip_C, hidx_C, host_idx_C, 
                                         pidx_C, port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, conn_Pr, i_P, indicies_P, 
                                         portDomain_P, sourcePort_P, 
                                         new_sport_P, pkt_Priv, conn_Pri, 
                                         hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                         hidx_Pri, otherEntry_Pr, i_Pr, 
                                         indicies_Pr, portDomain_Pr, 
                                         sourcePort_Pr, destPort_Pr, 
                                         new_sport_Pr, depth_C, host_C, 
                                         hidx_Co, host_idx, pidx, port_idx, 
                                         depth_Di, ip_D, host_Di, connDomain, 
                                         cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                         ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

privtoPubManAddT_(self) == /\ pc[self] = "privtoPubManAddT_"
                           /\ T' = Append(T, entry[self])
                           /\ IF Len(T') > MaxTableSize
                                 THEN /\ TableFull' = TRUE
                                 ELSE /\ TRUE
                                      /\ UNCHANGED TableFull
                           /\ pc' = [pc EXCEPT ![self] = "privtopubPkt_P"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, EvictionReroute, 
                                           PortScanInv, MaxTableSize, hosts, 
                                           FreeHosts, UsedHosts, Ports, 
                                           ExtraPorts, ExtraExtraPorts, 
                                           FreeIPs, UsedIPs, Connections, 
                                           SendQueue, RcvQueue, MAX, Marker1, 
                                           Marker2, CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privtopubPkt_P(self) == /\ pc[self] = "privtopubPkt_P"
                        /\ pkt_Pri' = [pkt_Pri EXCEPT ![self] = [saddr |->pkt_Pri[self].daddr, sport |-> pkt_Pri[self].dport,
                                                                 daddr |-> N, dport |-> pkt_Pri[self].sport,
                                                                 host_marker |-> hostMarker_Pri[self]]]
                        /\ SendQueue' = Append(SendQueue, pkt_Pri'[self])
                        /\ pc' = [pc EXCEPT ![self] = "privtopubRet_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, RcvQueue, MAX, Marker1, 
                                        Marker2, CmdConnect, CmdDisconnect, 
                                        PortSpaceFull, stack, depth_, host_, 
                                        hidx_, host_idx_, pidx_, port_idx_, 
                                        depth_D, ip_, host_D, connDomain_, 
                                        cidx_, conn_, host_Co, ip_C, hidx_C, 
                                        host_idx_C, pidx_C, port_idx_C, 
                                        host_Dis, ip_Di, connDomain_D, cidx_D, 
                                        conn_D, host, ip, connDomain_Di, 
                                        cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                        entry_, conn_P, hostMarker_, ip_idx_, 
                                        ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                        entry_P, conn_Pu, hostMarker_P, 
                                        ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                        conn, sport, dstAddr, dport, pkt_Pr, 
                                        hostMarker_Pr, daddr_, hostidx_, 
                                        hidx_P, otherEntry_, i_, indicies_, 
                                        portDomain_, sourcePort_, destPort_, 
                                        new_sport_, depth_Pr, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

privtopubRet_(self) == /\ pc[self] = "privtopubRet_"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ pkt_Pri' = [pkt_Pri EXCEPT ![self] = Head(stack[self]).pkt_Pri]
                       /\ conn_Pr' = [conn_Pr EXCEPT ![self] = Head(stack[self]).conn_Pr]
                       /\ hostMarker_Pri' = [hostMarker_Pri EXCEPT ![self] = Head(stack[self]).hostMarker_Pri]
                       /\ daddr_P' = [daddr_P EXCEPT ![self] = Head(stack[self]).daddr_P]
                       /\ hostidx_P' = [hostidx_P EXCEPT ![self] = Head(stack[self]).hostidx_P]
                       /\ hidx_Pr' = [hidx_Pr EXCEPT ![self] = Head(stack[self]).hidx_Pr]
                       /\ otherEntry_P' = [otherEntry_P EXCEPT ![self] = Head(stack[self]).otherEntry_P]
                       /\ i_P' = [i_P EXCEPT ![self] = Head(stack[self]).i_P]
                       /\ indicies_P' = [indicies_P EXCEPT ![self] = Head(stack[self]).indicies_P]
                       /\ portDomain_P' = [portDomain_P EXCEPT ![self] = Head(stack[self]).portDomain_P]
                       /\ sourcePort_P' = [sourcePort_P EXCEPT ![self] = Head(stack[self]).sourcePort_P]
                       /\ destPort_P' = [destPort_P EXCEPT ![self] = Head(stack[self]).destPort_P]
                       /\ new_sport_P' = [new_sport_P EXCEPT ![self] = Head(stack[self]).new_sport_P]
                       /\ depth_Pr' = [depth_Pr EXCEPT ![self] = Head(stack[self]).depth_Pr]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

PrivToPubVuln(self) == privtopubV3_(self) \/ privtopubManStart_P(self)
                          \/ privtopubConn_(self) \/ privtopubDport_(self)
                          \/ privtoPubManAddT_(self)
                          \/ privtopubPkt_P(self) \/ privtopubRet_(self)

privtopubManStart_Pr(self) == /\ pc[self] = "privtopubManStart_Pr"
                              /\ IF Len (Connections) > 0
                                    THEN /\ indicies_Pr' = [indicies_Pr EXCEPT ![self] = DOMAIN Connections]
                                         /\ portDomain_Pr' = [portDomain_Pr EXCEPT ![self] = DOMAIN Ports]
                                         /\ sourcePort_Pr' = [sourcePort_Pr EXCEPT ![self] = CHOOSE pr \in portDomain_Pr'[self] : TRUE]
                                         /\ i_Pr' = [i_Pr EXCEPT ![self] = CHOOSE f \in indicies_Pr'[self] : TRUE]
                                         /\ pc' = [pc EXCEPT ![self] = "privtopubManConn"]
                                    ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet_P"]
                                         /\ UNCHANGED << i_Pr, indicies_Pr, 
                                                         portDomain_Pr, 
                                                         sourcePort_Pr >>
                              /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                              Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                              Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                              Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                              H2, MaxPorts, EP1, PortMap1, EP2, 
                                              PortMap2, TableFull, 
                                              EvictionReroute, PortScanInv, 
                                              MaxTableSize, hosts, FreeHosts, 
                                              UsedHosts, Ports, ExtraPorts, 
                                              ExtraExtraPorts, T, FreeIPs, 
                                              UsedIPs, Connections, SendQueue, 
                                              RcvQueue, MAX, Marker1, Marker2, 
                                              CmdConnect, CmdDisconnect, 
                                              PortSpaceFull, stack, depth_, 
                                              host_, hidx_, host_idx_, pidx_, 
                                              port_idx_, depth_D, ip_, host_D, 
                                              connDomain_, cidx_, conn_, 
                                              host_Co, ip_C, hidx_C, 
                                              host_idx_C, pidx_C, port_idx_C, 
                                              host_Dis, ip_Di, connDomain_D, 
                                              cidx_D, conn_D, host, ip, 
                                              connDomain_Di, cidx_Di, conn_Di, 
                                              depth_P, pkt_, ipkt_, entry_, 
                                              conn_P, hostMarker_, ip_idx_, 
                                              ipidx_, ip_P, host_P, pkt_P, 
                                              ipkt_P, entry_P, conn_Pu, 
                                              hostMarker_P, ip_idx_P, ipidx_P, 
                                              ip_Pu, host_Pu, conn, sport, 
                                              dstAddr, dport, pkt_Pr, 
                                              hostMarker_Pr, daddr_, hostidx_, 
                                              hidx_P, otherEntry_, i_, 
                                              indicies_, portDomain_, 
                                              sourcePort_, destPort_, 
                                              new_sport_, depth_Pr, pkt_Pri, 
                                              conn_Pr, hostMarker_Pri, daddr_P, 
                                              hostidx_P, hidx_Pr, otherEntry_P, 
                                              i_P, indicies_P, portDomain_P, 
                                              sourcePort_P, destPort_P, 
                                              new_sport_P, pkt_Priv, conn_Pri, 
                                              hostMarker_Priv, daddr_Pr, 
                                              hostidx_Pr, hidx_Pri, 
                                              otherEntry_Pr, destPort_Pr, 
                                              new_sport_Pr, depth_C, host_C, 
                                              hidx_Co, host_idx, pidx, 
                                              port_idx, depth_Di, ip_D, 
                                              host_Di, connDomain, cidx, 
                                              conn_Dis, depth_Pu, pkt_Pu, 
                                              ipkt_Pu, entry_Pu, conn_Pub, 
                                              hostMarker_Pu, ip_idx_Pu, 
                                              ipidx_Pu, ip_Pub, host_Pub, 
                                              depth_Pri, pkt_PrivT, conn_Priv, 
                                              hostMarker_PrivT, daddr_Pri, 
                                              hostidx_Pri, hidx_Priv, 
                                              otherEntry_Pri, i_Pri, 
                                              indicies_Pri, portDomain_Pri, 
                                              sourcePort_Pri, destPort_Pri, 
                                              new_sport_Pri, good_, depth_E, 
                                              i_E, j_, ip_E, host_E, indecies_, 
                                              depth_Ev, i_Ev, j_E, ip_Ev, 
                                              host_Ev, indecies_E, i_C, i_Ch, 
                                              depth_Pub, pkt_Pub, ipkt_Pub, 
                                              entry_Pub, conn_PubT, 
                                              hostMarker_Pub, ip_idx_Pub, 
                                              ipidx_Pub, ip_PubT, host_PubT, 
                                              depth_Priv, pkt_PrivTo, 
                                              conn_PrivT, hostMarker_PrivTo, 
                                              daddr_Priv, hostidx_Priv, 
                                              hidx_PrivT, otherEntry_Priv, 
                                              i_Priv, indicies_Priv, 
                                              portDomain_Priv, sourcePort_Priv, 
                                              destPort_Priv, new_sport_Priv, 
                                              depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                              host_Eve, indecies_Ev, 
                                              depth_PubT, pkt_PubT, ipkt, 
                                              entry, conn_PubTo, 
                                              hostMarker_PubT, ip_idx, ipidx, 
                                              ip_PubTo, host_PubTo, 
                                              depth_PrivT, pkt, conn_PrivTo, 
                                              hostMarker, daddr, hostidx, hidx, 
                                              otherEntry, i_PrivT, indicies, 
                                              portDomain, sourcePort, destPort, 
                                              new_sport, good, depth, i_Even, 
                                              j, ip_Even, host_Even, indecies, 
                                              i_Che, i, aa >>

privtopubManConn(self) == /\ pc[self] = "privtopubManConn"
                          /\ conn_Pri' = [conn_Pri EXCEPT ![self] = Connections[i_Pr[self]]]
                          /\ sourcePort_Pr' = [sourcePort_Pr EXCEPT ![self] = B]
                          /\ portDomain_Pr' = [portDomain_Pr EXCEPT ![self] = DOMAIN Ports]
                          /\ destPort_Pr' = [destPort_Pr EXCEPT ![self] = CHOOSE h \in portDomain_Pr'[self] : TRUE]
                          /\ pc' = [pc EXCEPT ![self] = "privtopubManDport"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, new_sport_Pr, 
                                          depth_C, host_C, hidx_Co, host_idx, 
                                          pidx, port_idx, depth_Di, ip_D, 
                                          host_Di, connDomain, cidx, conn_Dis, 
                                          depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                          conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                          ipidx_Pu, ip_Pub, host_Pub, 
                                          depth_Pri, pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

privtopubManDport(self) == /\ pc[self] = "privtopubManDport"
                           /\ destPort_Pr' = [destPort_Pr EXCEPT ![self] = C]
                           /\ hostidx_Pr' = [hostidx_Pr EXCEPT ![self] = DOMAIN hosts]
                           /\ hidx_Pri' = [hidx_Pri EXCEPT ![self] = CHOOSE hid \in hostidx_Pr'[self] : TRUE]
                           /\ daddr_Pr' = [daddr_Pr EXCEPT ![self] = C]
                           /\ PrintT(<<"PrivToPubMan - Len(connections) > 0: ", indicies_Pr[self], conn_Pri[self], Connections>>)
                           /\ hostMarker_Priv' = [hostMarker_Priv EXCEPT ![self] = Head(Tail(conn_Pri[self]))]
                           /\ pkt_Priv' = [pkt_Priv EXCEPT ![self] = [saddr |-> Head(conn_Pri[self]), sport |-> sourcePort_Pr[self],
                                                                      daddr |-> daddr_Pr'[self], dport |-> destPort_Pr'[self],
                                                                      host_marker |-> hostMarker_Priv'[self]
                                                                     ]]
                           /\ PrintT(<<"PrivToPubMan - conn, pkt: ", conn_Pri[self], pkt_Priv'[self]>>)
                           /\ entry' = [entry EXCEPT ![self] = [host_marker |-> hostMarker_Priv'[self],
                                                                orig |-> [saddr |-> pkt_Priv'[self].saddr, sport |-> pkt_Priv'[self].sport,
                                                                          daddr |-> pkt_Priv'[self].daddr, dport |-> pkt_Priv'[self].dport],
                                                                reply |-> [saddr |-> pkt_Priv'[self].daddr, sport |-> pkt_Priv'[self].dport,
                                                                           daddr |-> N,  dport |-> pkt_Priv'[self].sport ]]]
                           /\ otherEntry_Pr' = [otherEntry_Pr EXCEPT ![self] = SelectSeq(T, LAMBDA k: k.reply.saddr=pkt_Priv'[self].daddr /\ k.reply.sport=pkt_Priv'[self].dport /\
                                                                                                      k.reply.daddr=N /\ k.reply.dport=pkt_Priv'[self].sport)]
                           /\ PrintT(<<"PrivToPubMan - T", T, otherEntry_Pr'[self], pkt_Priv'[self]>>)
                           /\ IF Len(otherEntry_Pr'[self]) > 0
                                 THEN /\ T' = SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt_Priv'[self].daddr /\ e.reply.sport=pkt_Priv'[self].dport /\
                                                                       e.reply.daddr=N /\ e.reply.dport=pkt_Priv'[self].sport) )
                                 ELSE /\ TRUE
                                      /\ T' = T
                           /\ pc' = [pc EXCEPT ![self] = "privtoPubManAddT_P"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, FreeIPs, UsedIPs, 
                                           Connections, SendQueue, RcvQueue, 
                                           MAX, Marker1, Marker2, CmdConnect, 
                                           CmdDisconnect, PortSpaceFull, stack, 
                                           depth_, host_, hidx_, host_idx_, 
                                           pidx_, port_idx_, depth_D, ip_, 
                                           host_D, connDomain_, cidx_, conn_, 
                                           host_Co, ip_C, hidx_C, host_idx_C, 
                                           pidx_C, port_idx_C, host_Dis, ip_Di, 
                                           connDomain_D, cidx_D, conn_D, host, 
                                           ip, connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, conn_Pri, i_Pr, 
                                           indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, new_sport_Pr, 
                                           depth_C, host_C, hidx_Co, host_idx, 
                                           pidx, port_idx, depth_Di, ip_D, 
                                           host_Di, connDomain, cidx, conn_Dis, 
                                           depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                           conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                           ipidx_Pu, ip_Pub, host_Pub, 
                                           depth_Pri, pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privtoPubManAddT_P(self) == /\ pc[self] = "privtoPubManAddT_P"
                            /\ T' = Append(T, entry[self])
                            /\ pc' = [pc EXCEPT ![self] = "privtopubPkt_Pr"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, FreeIPs, UsedIPs, 
                                            Connections, SendQueue, RcvQueue, 
                                            MAX, Marker1, Marker2, CmdConnect, 
                                            CmdDisconnect, PortSpaceFull, 
                                            stack, depth_, host_, hidx_, 
                                            host_idx_, pidx_, port_idx_, 
                                            depth_D, ip_, host_D, connDomain_, 
                                            cidx_, conn_, host_Co, ip_C, 
                                            hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

privtopubPkt_Pr(self) == /\ pc[self] = "privtopubPkt_Pr"
                         /\ pkt_Priv' = [pkt_Priv EXCEPT ![self] = [saddr |->pkt_Priv[self].daddr, sport |-> pkt_Priv[self].dport,
                                                                    daddr |-> N, dport |-> pkt_Priv[self].sport,
                                                                    host_marker |-> hostMarker_Priv[self]]]
                         /\ SendQueue' = Append(SendQueue, pkt_Priv'[self])
                         /\ pc' = [pc EXCEPT ![self] = "privtopubRet_P"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, RcvQueue, MAX, Marker1, 
                                         Marker2, CmdConnect, CmdDisconnect, 
                                         PortSpaceFull, stack, depth_, host_, 
                                         hidx_, host_idx_, pidx_, port_idx_, 
                                         depth_D, ip_, host_D, connDomain_, 
                                         cidx_, conn_, host_Co, ip_C, hidx_C, 
                                         host_idx_C, pidx_C, port_idx_C, 
                                         host_Dis, ip_Di, connDomain_D, cidx_D, 
                                         conn_D, host, ip, connDomain_Di, 
                                         cidx_Di, conn_Di, depth_P, pkt_, 
                                         ipkt_, entry_, conn_P, hostMarker_, 
                                         ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                         ipkt_P, entry_P, conn_Pu, 
                                         hostMarker_P, ip_idx_P, ipidx_P, 
                                         ip_Pu, host_Pu, conn, sport, dstAddr, 
                                         dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                         hostidx_, hidx_P, otherEntry_, i_, 
                                         indicies_, portDomain_, sourcePort_, 
                                         destPort_, new_sport_, depth_Pr, 
                                         pkt_Pri, conn_Pr, hostMarker_Pri, 
                                         daddr_P, hostidx_P, hidx_Pr, 
                                         otherEntry_P, i_P, indicies_P, 
                                         portDomain_P, sourcePort_P, 
                                         destPort_P, new_sport_P, conn_Pri, 
                                         hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                         hidx_Pri, otherEntry_Pr, i_Pr, 
                                         indicies_Pr, portDomain_Pr, 
                                         sourcePort_Pr, destPort_Pr, 
                                         new_sport_Pr, depth_C, host_C, 
                                         hidx_Co, host_idx, pidx, port_idx, 
                                         depth_Di, ip_D, host_Di, connDomain, 
                                         cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                         ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

privtopubRet_P(self) == /\ pc[self] = "privtopubRet_P"
                        /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                        /\ pkt_Priv' = [pkt_Priv EXCEPT ![self] = Head(stack[self]).pkt_Priv]
                        /\ conn_Pri' = [conn_Pri EXCEPT ![self] = Head(stack[self]).conn_Pri]
                        /\ hostMarker_Priv' = [hostMarker_Priv EXCEPT ![self] = Head(stack[self]).hostMarker_Priv]
                        /\ daddr_Pr' = [daddr_Pr EXCEPT ![self] = Head(stack[self]).daddr_Pr]
                        /\ hostidx_Pr' = [hostidx_Pr EXCEPT ![self] = Head(stack[self]).hostidx_Pr]
                        /\ hidx_Pri' = [hidx_Pri EXCEPT ![self] = Head(stack[self]).hidx_Pri]
                        /\ otherEntry_Pr' = [otherEntry_Pr EXCEPT ![self] = Head(stack[self]).otherEntry_Pr]
                        /\ i_Pr' = [i_Pr EXCEPT ![self] = Head(stack[self]).i_Pr]
                        /\ indicies_Pr' = [indicies_Pr EXCEPT ![self] = Head(stack[self]).indicies_Pr]
                        /\ portDomain_Pr' = [portDomain_Pr EXCEPT ![self] = Head(stack[self]).portDomain_Pr]
                        /\ sourcePort_Pr' = [sourcePort_Pr EXCEPT ![self] = Head(stack[self]).sourcePort_Pr]
                        /\ destPort_Pr' = [destPort_Pr EXCEPT ![self] = Head(stack[self]).destPort_Pr]
                        /\ new_sport_Pr' = [new_sport_Pr EXCEPT ![self] = Head(stack[self]).new_sport_Pr]
                        /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

PrivToPubMan(self) == privtopubManStart_Pr(self) \/ privtopubManConn(self)
                         \/ privtopubManDport(self)
                         \/ privtoPubManAddT_P(self)
                         \/ privtopubPkt_Pr(self) \/ privtopubRet_P(self)

connectStart(self) == /\ pc[self] = "connectStart"
                      /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = depth_C[self]]
                         /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                  pc        |->  "connectIf",
                                                                  i_Ev      |->  i_Ev[self],
                                                                  j_E       |->  j_E[self],
                                                                  ip_Ev     |->  ip_Ev[self],
                                                                  host_Ev   |->  host_Ev[self],
                                                                  indecies_E |->  indecies_E[self],
                                                                  depth_Ev  |->  depth_Ev[self] ] >>
                                                              \o stack[self]]
                      /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                      /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                      /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                      /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                      /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                      /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, depth_, 
                                      host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, i_C, i_Ch, 
                                      depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                      conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                      ipidx_Pub, ip_PubT, host_PubT, 
                                      depth_Priv, pkt_PrivTo, conn_PrivT, 
                                      hostMarker_PrivTo, daddr_Priv, 
                                      hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, pkt, conn_PrivTo, 
                                      hostMarker, daddr, hostidx, hidx, 
                                      otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

connectIf(self) == /\ pc[self] = "connectIf"
                   /\ IF Len(FreeHosts) > 0
                         THEN /\ host_idx' = [host_idx EXCEPT ![self] = DOMAIN FreeHosts]
                              /\ hidx_Co' = [hidx_Co EXCEPT ![self] = CHOOSE h \in host_idx'[self] : TRUE]
                              /\ host_C' = [host_C EXCEPT ![self] = FreeHosts[hidx_Co'[self]]]
                              /\ FreeHosts' = SelectSeq(FreeHosts, LAMBDA a: a /= host_C'[self])
                              /\ UsedHosts' = Append(UsedHosts, host_C'[self])
                              /\ port_idx' = [port_idx EXCEPT ![self] = DOMAIN Ports]
                              /\ pidx' = [pidx EXCEPT ![self] = CHOOSE p \in port_idx'[self] : TRUE]
                              /\ pkt' = [pkt EXCEPT ![self] = [ saddr |-> host_C'[self], sport |-> Ports[pidx'[self]],
                                                                daddr |-> N,    dport |-> N,
                                                                cmd |-> CmdConnect,
                                                                host_marker |-> host_C'[self]]]
                              /\ SendQueue' = Append(SendQueue, pkt'[self])
                         ELSE /\ TRUE
                              /\ UNCHANGED << FreeHosts, UsedHosts, SendQueue, 
                                              host_C, hidx_Co, host_idx, pidx, 
                                              port_idx, pkt >>
                   /\ pc' = [pc EXCEPT ![self] = "connectRet"]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, Ports, ExtraPorts, 
                                   ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                   Connections, RcvQueue, MAX, Marker1, 
                                   Marker2, CmdConnect, CmdDisconnect, 
                                   PortSpaceFull, stack, depth_, host_, hidx_, 
                                   host_idx_, pidx_, port_idx_, depth_D, ip_, 
                                   host_D, connDomain_, cidx_, conn_, host_Co, 
                                   ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_C, depth_Di, ip_D, 
                                   host_Di, connDomain, cidx, conn_Dis, 
                                   depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                   conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                   ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                   pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                   daddr_Pri, hostidx_Pri, hidx_Priv, 
                                   otherEntry_Pri, i_Pri, indicies_Pri, 
                                   portDomain_Pri, sourcePort_Pri, 
                                   destPort_Pri, new_sport_Pri, good_, depth_E, 
                                   i_E, j_, ip_E, host_E, indecies_, depth_Ev, 
                                   i_Ev, j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                   i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                   entry_Pub, conn_PubT, hostMarker_Pub, 
                                   ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                   depth_Priv, pkt_PrivTo, conn_PrivT, 
                                   hostMarker_PrivTo, daddr_Priv, hostidx_Priv, 
                                   hidx_PrivT, otherEntry_Priv, i_Priv, 
                                   indicies_Priv, portDomain_Priv, 
                                   sourcePort_Priv, destPort_Priv, 
                                   new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                   ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                   pkt_PubT, ipkt, entry, conn_PubTo, 
                                   hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                   host_PubTo, depth_PrivT, conn_PrivTo, 
                                   hostMarker, daddr, hostidx, hidx, 
                                   otherEntry, i_PrivT, indicies, portDomain, 
                                   sourcePort, destPort, new_sport, good, 
                                   depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

connectRet(self) == /\ pc[self] = "connectRet"
                    /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                    /\ host_C' = [host_C EXCEPT ![self] = Head(stack[self]).host_C]
                    /\ hidx_Co' = [hidx_Co EXCEPT ![self] = Head(stack[self]).hidx_Co]
                    /\ host_idx' = [host_idx EXCEPT ![self] = Head(stack[self]).host_idx]
                    /\ pidx' = [pidx EXCEPT ![self] = Head(stack[self]).pidx]
                    /\ port_idx' = [port_idx EXCEPT ![self] = Head(stack[self]).port_idx]
                    /\ depth_C' = [depth_C EXCEPT ![self] = Head(stack[self]).depth_C]
                    /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_Di, ip_D, host_Di, 
                                    connDomain, cidx, conn_Dis, depth_Pu, 
                                    pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                    hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                    host_Pub, depth_Pri, pkt_PrivT, conn_Priv, 
                                    hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                    hidx_Priv, otherEntry_Pri, i_Pri, 
                                    indicies_Pri, portDomain_Pri, 
                                    sourcePort_Pri, destPort_Pri, 
                                    new_sport_Pri, good_, depth_E, i_E, j_, 
                                    ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                    j_E, ip_Ev, host_Ev, indecies_E, i_C, i_Ch, 
                                    depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                    conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                    ipidx_Pub, ip_PubT, host_PubT, depth_Priv, 
                                    pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, 
                                    daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                    otherEntry_Priv, i_Priv, indicies_Priv, 
                                    portDomain_Priv, sourcePort_Priv, 
                                    destPort_Priv, new_sport_Priv, depth_Eve, 
                                    i_Eve, j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                    depth_PubT, pkt_PubT, ipkt, entry, 
                                    conn_PubTo, hostMarker_PubT, ip_idx, ipidx, 
                                    ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                    conn_PrivTo, hostMarker, daddr, hostidx, 
                                    hidx, otherEntry, i_PrivT, indicies, 
                                    portDomain, sourcePort, destPort, 
                                    new_sport, good, depth, i_Even, j, ip_Even, 
                                    host_Even, indecies, i_Che, i, aa >>

Connect(self) == connectStart(self) \/ connectIf(self) \/ connectRet(self)

disconnectStart(self) == /\ pc[self] = "disconnectStart"
                         /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = depth_Di[self]]
                            /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                     pc        |->  "disconnectIf",
                                                                     i_Ev      |->  i_Ev[self],
                                                                     j_E       |->  j_E[self],
                                                                     ip_Ev     |->  ip_Ev[self],
                                                                     host_Ev   |->  host_Ev[self],
                                                                     indecies_E |->  indecies_E[self],
                                                                     depth_Ev  |->  depth_Ev[self] ] >>
                                                                 \o stack[self]]
                         /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                         /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                         /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                         /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                         /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                         /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, i_C, i_Ch, depth_Pub, 
                                         pkt_Pub, ipkt_Pub, entry_Pub, 
                                         conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                         ipidx_Pub, ip_PubT, host_PubT, 
                                         depth_Priv, pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

disconnectIf(self) == /\ pc[self] = "disconnectIf"
                      /\ IF Len(Connections) > 0
                            THEN /\ connDomain' = [connDomain EXCEPT ![self] = DOMAIN Connections]
                                 /\ cidx' = [cidx EXCEPT ![self] = CHOOSE c \in connDomain'[self] : TRUE]
                                 /\ conn_Dis' = [conn_Dis EXCEPT ![self] = Connections[cidx'[self]]]
                                 /\ ip_D' = [ip_D EXCEPT ![self] = conn_Dis'[self][1]]
                                 /\ host_Di' = [host_Di EXCEPT ![self] = conn_Dis'[self][2]]
                                 /\ PrintT(<< "Disconnect- Before:", host_Di'[self], ip_D'[self], Connections>>)
                                 /\ Connections' = SelectSeq(Connections, LAMBDA cc: Head(cc)/=ip_D'[self])
                                 /\ UsedIPs' = SelectSeq(UsedIPs, LAMBDA ccc: ccc/=ip_D'[self])
                                 /\ FreeIPs' = Append(FreeIPs, ip_D'[self])
                                 /\ pc' = [pc EXCEPT ![self] = "disconnectPurgeOrphans1"]
                            ELSE /\ pc' = [pc EXCEPT ![self] = "disconnectRet"]
                                 /\ UNCHANGED << FreeIPs, UsedIPs, Connections, 
                                                 ip_D, host_Di, connDomain, 
                                                 cidx, conn_Dis >>
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, SendQueue, RcvQueue, 
                                      MAX, Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, stack, 
                                      depth_, host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, depth_Pu, pkt_Pu, 
                                      ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                      entry_Pub, conn_PubT, hostMarker_Pub, 
                                      ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                      host_PubT, depth_Priv, pkt_PrivTo, 
                                      conn_PrivT, hostMarker_PrivTo, 
                                      daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, pkt, conn_PrivTo, 
                                      hostMarker, daddr, hostidx, hidx, 
                                      otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

disconnectPurgeOrphans1(self) == /\ pc[self] = "disconnectPurgeOrphans1"
                                 /\ T' = SelectSeq(T, LAMBDA e: e.orig.saddr /= ip_D[self])
                                 /\ pc' = [pc EXCEPT ![self] = "disconnectPurgeOrphans2"]
                                 /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, 
                                                 Cc, Dd, Ee, Ff, Gg, Hh, Ii, 
                                                 Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                                 Qq, Rr, Ss, Tt, Uu, Vv, Ww, 
                                                 Xx, Yy, Zz, H1, H2, MaxPorts, 
                                                 EP1, PortMap1, EP2, PortMap2, 
                                                 TableFull, EvictionReroute, 
                                                 PortScanInv, MaxTableSize, 
                                                 hosts, FreeHosts, UsedHosts, 
                                                 Ports, ExtraPorts, 
                                                 ExtraExtraPorts, FreeIPs, 
                                                 UsedIPs, Connections, 
                                                 SendQueue, RcvQueue, MAX, 
                                                 Marker1, Marker2, CmdConnect, 
                                                 CmdDisconnect, PortSpaceFull, 
                                                 stack, depth_, host_, hidx_, 
                                                 host_idx_, pidx_, port_idx_, 
                                                 depth_D, ip_, host_D, 
                                                 connDomain_, cidx_, conn_, 
                                                 host_Co, ip_C, hidx_C, 
                                                 host_idx_C, pidx_C, 
                                                 port_idx_C, host_Dis, ip_Di, 
                                                 connDomain_D, cidx_D, conn_D, 
                                                 host, ip, connDomain_Di, 
                                                 cidx_Di, conn_Di, depth_P, 
                                                 pkt_, ipkt_, entry_, conn_P, 
                                                 hostMarker_, ip_idx_, ipidx_, 
                                                 ip_P, host_P, pkt_P, ipkt_P, 
                                                 entry_P, conn_Pu, 
                                                 hostMarker_P, ip_idx_P, 
                                                 ipidx_P, ip_Pu, host_Pu, conn, 
                                                 sport, dstAddr, dport, pkt_Pr, 
                                                 hostMarker_Pr, daddr_, 
                                                 hostidx_, hidx_P, otherEntry_, 
                                                 i_, indicies_, portDomain_, 
                                                 sourcePort_, destPort_, 
                                                 new_sport_, depth_Pr, pkt_Pri, 
                                                 conn_Pr, hostMarker_Pri, 
                                                 daddr_P, hostidx_P, hidx_Pr, 
                                                 otherEntry_P, i_P, indicies_P, 
                                                 portDomain_P, sourcePort_P, 
                                                 destPort_P, new_sport_P, 
                                                 pkt_Priv, conn_Pri, 
                                                 hostMarker_Priv, daddr_Pr, 
                                                 hostidx_Pr, hidx_Pri, 
                                                 otherEntry_Pr, i_Pr, 
                                                 indicies_Pr, portDomain_Pr, 
                                                 sourcePort_Pr, destPort_Pr, 
                                                 new_sport_Pr, depth_C, host_C, 
                                                 hidx_Co, host_idx, pidx, 
                                                 port_idx, depth_Di, ip_D, 
                                                 host_Di, connDomain, cidx, 
                                                 conn_Dis, depth_Pu, pkt_Pu, 
                                                 ipkt_Pu, entry_Pu, conn_Pub, 
                                                 hostMarker_Pu, ip_idx_Pu, 
                                                 ipidx_Pu, ip_Pub, host_Pub, 
                                                 depth_Pri, pkt_PrivT, 
                                                 conn_Priv, hostMarker_PrivT, 
                                                 daddr_Pri, hostidx_Pri, 
                                                 hidx_Priv, otherEntry_Pri, 
                                                 i_Pri, indicies_Pri, 
                                                 portDomain_Pri, 
                                                 sourcePort_Pri, destPort_Pri, 
                                                 new_sport_Pri, good_, depth_E, 
                                                 i_E, j_, ip_E, host_E, 
                                                 indecies_, depth_Ev, i_Ev, 
                                                 j_E, ip_Ev, host_Ev, 
                                                 indecies_E, i_C, i_Ch, 
                                                 depth_Pub, pkt_Pub, ipkt_Pub, 
                                                 entry_Pub, conn_PubT, 
                                                 hostMarker_Pub, ip_idx_Pub, 
                                                 ipidx_Pub, ip_PubT, host_PubT, 
                                                 depth_Priv, pkt_PrivTo, 
                                                 conn_PrivT, hostMarker_PrivTo, 
                                                 daddr_Priv, hostidx_Priv, 
                                                 hidx_PrivT, otherEntry_Priv, 
                                                 i_Priv, indicies_Priv, 
                                                 portDomain_Priv, 
                                                 sourcePort_Priv, 
                                                 destPort_Priv, new_sport_Priv, 
                                                 depth_Eve, i_Eve, j_Ev, 
                                                 ip_Eve, host_Eve, indecies_Ev, 
                                                 depth_PubT, pkt_PubT, ipkt, 
                                                 entry, conn_PubTo, 
                                                 hostMarker_PubT, ip_idx, 
                                                 ipidx, ip_PubTo, host_PubTo, 
                                                 depth_PrivT, pkt, conn_PrivTo, 
                                                 hostMarker, daddr, hostidx, 
                                                 hidx, otherEntry, i_PrivT, 
                                                 indicies, portDomain, 
                                                 sourcePort, destPort, 
                                                 new_sport, good, depth, 
                                                 i_Even, j, ip_Even, host_Even, 
                                                 indecies, i_Che, i, aa >>

disconnectPurgeOrphans2(self) == /\ pc[self] = "disconnectPurgeOrphans2"
                                 /\ T' = SelectSeq(T, LAMBDA e: e.orig.saddr /= host_Di[self])
                                 /\ IF host_Di[self]=H1
                                       THEN /\ PortMap1' = <<>>
                                            /\ UNCHANGED PortMap2
                                       ELSE /\ PortMap2' = <<>>
                                            /\ UNCHANGED PortMap1
                                 /\ FreeHosts' = Append(FreeHosts, host_Di[self])
                                 /\ UsedHosts' = SelectSeq(UsedHosts, LAMBDA m: m /= host_Di[self])
                                 /\ PrintT(<< "Disconnect- After: ", host_Di[self], ip_D[self], Connections>>)
                                 /\ pc' = [pc EXCEPT ![self] = "disconnectRet"]
                                 /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, 
                                                 Cc, Dd, Ee, Ff, Gg, Hh, Ii, 
                                                 Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                                 Qq, Rr, Ss, Tt, Uu, Vv, Ww, 
                                                 Xx, Yy, Zz, H1, H2, MaxPorts, 
                                                 EP1, EP2, TableFull, 
                                                 EvictionReroute, PortScanInv, 
                                                 MaxTableSize, hosts, Ports, 
                                                 ExtraPorts, ExtraExtraPorts, 
                                                 FreeIPs, UsedIPs, Connections, 
                                                 SendQueue, RcvQueue, MAX, 
                                                 Marker1, Marker2, CmdConnect, 
                                                 CmdDisconnect, PortSpaceFull, 
                                                 stack, depth_, host_, hidx_, 
                                                 host_idx_, pidx_, port_idx_, 
                                                 depth_D, ip_, host_D, 
                                                 connDomain_, cidx_, conn_, 
                                                 host_Co, ip_C, hidx_C, 
                                                 host_idx_C, pidx_C, 
                                                 port_idx_C, host_Dis, ip_Di, 
                                                 connDomain_D, cidx_D, conn_D, 
                                                 host, ip, connDomain_Di, 
                                                 cidx_Di, conn_Di, depth_P, 
                                                 pkt_, ipkt_, entry_, conn_P, 
                                                 hostMarker_, ip_idx_, ipidx_, 
                                                 ip_P, host_P, pkt_P, ipkt_P, 
                                                 entry_P, conn_Pu, 
                                                 hostMarker_P, ip_idx_P, 
                                                 ipidx_P, ip_Pu, host_Pu, conn, 
                                                 sport, dstAddr, dport, pkt_Pr, 
                                                 hostMarker_Pr, daddr_, 
                                                 hostidx_, hidx_P, otherEntry_, 
                                                 i_, indicies_, portDomain_, 
                                                 sourcePort_, destPort_, 
                                                 new_sport_, depth_Pr, pkt_Pri, 
                                                 conn_Pr, hostMarker_Pri, 
                                                 daddr_P, hostidx_P, hidx_Pr, 
                                                 otherEntry_P, i_P, indicies_P, 
                                                 portDomain_P, sourcePort_P, 
                                                 destPort_P, new_sport_P, 
                                                 pkt_Priv, conn_Pri, 
                                                 hostMarker_Priv, daddr_Pr, 
                                                 hostidx_Pr, hidx_Pri, 
                                                 otherEntry_Pr, i_Pr, 
                                                 indicies_Pr, portDomain_Pr, 
                                                 sourcePort_Pr, destPort_Pr, 
                                                 new_sport_Pr, depth_C, host_C, 
                                                 hidx_Co, host_idx, pidx, 
                                                 port_idx, depth_Di, ip_D, 
                                                 host_Di, connDomain, cidx, 
                                                 conn_Dis, depth_Pu, pkt_Pu, 
                                                 ipkt_Pu, entry_Pu, conn_Pub, 
                                                 hostMarker_Pu, ip_idx_Pu, 
                                                 ipidx_Pu, ip_Pub, host_Pub, 
                                                 depth_Pri, pkt_PrivT, 
                                                 conn_Priv, hostMarker_PrivT, 
                                                 daddr_Pri, hostidx_Pri, 
                                                 hidx_Priv, otherEntry_Pri, 
                                                 i_Pri, indicies_Pri, 
                                                 portDomain_Pri, 
                                                 sourcePort_Pri, destPort_Pri, 
                                                 new_sport_Pri, good_, depth_E, 
                                                 i_E, j_, ip_E, host_E, 
                                                 indecies_, depth_Ev, i_Ev, 
                                                 j_E, ip_Ev, host_Ev, 
                                                 indecies_E, i_C, i_Ch, 
                                                 depth_Pub, pkt_Pub, ipkt_Pub, 
                                                 entry_Pub, conn_PubT, 
                                                 hostMarker_Pub, ip_idx_Pub, 
                                                 ipidx_Pub, ip_PubT, host_PubT, 
                                                 depth_Priv, pkt_PrivTo, 
                                                 conn_PrivT, hostMarker_PrivTo, 
                                                 daddr_Priv, hostidx_Priv, 
                                                 hidx_PrivT, otherEntry_Priv, 
                                                 i_Priv, indicies_Priv, 
                                                 portDomain_Priv, 
                                                 sourcePort_Priv, 
                                                 destPort_Priv, new_sport_Priv, 
                                                 depth_Eve, i_Eve, j_Ev, 
                                                 ip_Eve, host_Eve, indecies_Ev, 
                                                 depth_PubT, pkt_PubT, ipkt, 
                                                 entry, conn_PubTo, 
                                                 hostMarker_PubT, ip_idx, 
                                                 ipidx, ip_PubTo, host_PubTo, 
                                                 depth_PrivT, pkt, conn_PrivTo, 
                                                 hostMarker, daddr, hostidx, 
                                                 hidx, otherEntry, i_PrivT, 
                                                 indicies, portDomain, 
                                                 sourcePort, destPort, 
                                                 new_sport, good, depth, 
                                                 i_Even, j, ip_Even, host_Even, 
                                                 indecies, i_Che, i, aa >>

disconnectRet(self) == /\ pc[self] = "disconnectRet"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ ip_D' = [ip_D EXCEPT ![self] = Head(stack[self]).ip_D]
                       /\ host_Di' = [host_Di EXCEPT ![self] = Head(stack[self]).host_Di]
                       /\ connDomain' = [connDomain EXCEPT ![self] = Head(stack[self]).connDomain]
                       /\ cidx' = [cidx EXCEPT ![self] = Head(stack[self]).cidx]
                       /\ conn_Dis' = [conn_Dis EXCEPT ![self] = Head(stack[self]).conn_Dis]
                       /\ depth_Di' = [depth_Di EXCEPT ![self] = Head(stack[self]).depth_Di]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Pu, 
                                       pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                       hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                       ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                       conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

Disconnect(self) == disconnectStart(self) \/ disconnectIf(self)
                       \/ disconnectPurgeOrphans1(self)
                       \/ disconnectPurgeOrphans2(self)
                       \/ disconnectRet(self)

pubtoprivStart_(self) == /\ pc[self] = "pubtoprivStart_"
                         /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = depth_Pu[self]]
                            /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                     pc        |->  "pubtoprivIf_",
                                                                     i_Ev      |->  i_Ev[self],
                                                                     j_E       |->  j_E[self],
                                                                     ip_Ev     |->  ip_Ev[self],
                                                                     host_Ev   |->  host_Ev[self],
                                                                     indecies_E |->  indecies_E[self],
                                                                     depth_Ev  |->  depth_Ev[self] ] >>
                                                                 \o stack[self]]
                         /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                         /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                         /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                         /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                         /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                         /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, i_C, i_Ch, depth_Pub, 
                                         pkt_Pub, ipkt_Pub, entry_Pub, 
                                         conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                         ipidx_Pub, ip_PubT, host_PubT, 
                                         depth_Priv, pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

pubtoprivIf_(self) == /\ pc[self] = "pubtoprivIf_"
                      /\ IF Len(SendQueue) > 0
                            THEN /\ pkt_Pu' = [pkt_Pu EXCEPT ![self] = Head(SendQueue)]
                                 /\ PrintT(<<"PubToPriv", pkt_Pu'[self], Connections>>)
                                 /\ SendQueue' = Tail(SendQueue)
                                 /\ entry_Pu' = [entry_Pu EXCEPT ![self] = SelectSeq(T, LAMBDA e: e.reply.saddr=pkt_Pu'[self].saddr /\
                                                                                                  e.reply.sport=pkt_Pu'[self].sport /\
                                                                                                  e.reply.daddr=pkt_Pu'[self].daddr /\
                                                                                                  e.reply.dport=pkt_Pu'[self].dport)]
                                 /\ IF Len(entry_Pu'[self]) <= 0
                                       THEN /\ IF pkt_Pu'[self].dport = N
                                                  THEN /\ IF Len(FreeIPs) > 0
                                                             THEN /\ ip_idx_Pu' = [ip_idx_Pu EXCEPT ![self] = DOMAIN FreeIPs]
                                                                  /\ ipidx_Pu' = [ipidx_Pu EXCEPT ![self] = CHOOSE ipp \in ip_idx_Pu'[self] : TRUE]
                                                                  /\ ip_Pub' = [ip_Pub EXCEPT ![self] = FreeIPs[ipidx_Pu'[self]]]
                                                                  /\ FreeIPs' = SelectSeq(FreeIPs, LAMBDA d: d /= ip_Pub'[self])
                                                                  /\ UsedIPs' = Append(UsedIPs, ip_Pub'[self])
                                                                  /\ host_Pub' = [host_Pub EXCEPT ![self] = pkt_Pu'[self].saddr]
                                                                  /\ Connections' = Append(Connections, <<ip_Pub'[self], host_Pub'[self]>>)
                                                             ELSE /\ TRUE
                                                                  /\ UNCHANGED << FreeIPs, 
                                                                                  UsedIPs, 
                                                                                  Connections, 
                                                                                  ip_idx_Pu, 
                                                                                  ipidx_Pu, 
                                                                                  ip_Pub, 
                                                                                  host_Pub >>
                                                  ELSE /\ IF pkt_Pu'[self].dport = NN
                                                             THEN /\ Assert((TRUE), 
                                                                            "Failure of assertion at line 602, column 9.")
                                                             ELSE /\ Assert((TRUE), 
                                                                            "Failure of assertion at line 607, column 9.")
                                                       /\ UNCHANGED << FreeIPs, 
                                                                       UsedIPs, 
                                                                       Connections, 
                                                                       ip_idx_Pu, 
                                                                       ipidx_Pu, 
                                                                       ip_Pub, 
                                                                       host_Pub >>
                                            /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_P"]
                                       ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoPrivElse_Pu"]
                                            /\ UNCHANGED << FreeIPs, UsedIPs, 
                                                            Connections, 
                                                            ip_idx_Pu, 
                                                            ipidx_Pu, ip_Pub, 
                                                            host_Pub >>
                            ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_P"]
                                 /\ UNCHANGED << FreeIPs, UsedIPs, Connections, 
                                                 SendQueue, pkt_Pu, entry_Pu, 
                                                 ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                                 host_Pub >>
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, stack, 
                                      depth_, host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      ipkt_Pu, conn_Pub, hostMarker_Pu, 
                                      depth_Pri, pkt_PrivT, conn_Priv, 
                                      hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                      hidx_Priv, otherEntry_Pri, i_Pri, 
                                      indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                      entry_Pub, conn_PubT, hostMarker_Pub, 
                                      ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                      host_PubT, depth_Priv, pkt_PrivTo, 
                                      conn_PrivT, hostMarker_PrivTo, 
                                      daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, pkt, conn_PrivTo, 
                                      hostMarker, daddr, hostidx, hidx, 
                                      otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

pubtoPrivElse_Pu(self) == /\ pc[self] = "pubtoPrivElse_Pu"
                          /\ entry_Pu' = [entry_Pu EXCEPT ![self] = Head(entry_Pu[self])]
                          /\ IF entry_Pu'[self].reply.dport=N
                                THEN /\ PrintT(<<"PubToPriv - PortShadow: ", entry_Pu'[self], pkt_Pu[self]>>)
                                ELSE /\ TRUE
                          /\ IF entry_Pu'[self].host_marker/=pkt_Pu[self].host_marker
                                THEN /\ IF pkt_Pu[self].host_marker = H1
                                           THEN /\ Marker1' = entry_Pu'[self].host_marker
                                                /\ IF entry_Pu'[self].host_marker = H2
                                                      THEN /\ EvictionReroute' = TRUE
                                                      ELSE /\ TRUE
                                                           /\ UNCHANGED EvictionReroute
                                                /\ UNCHANGED Marker2
                                           ELSE /\ Marker2' = entry_Pu'[self].host_marker
                                                /\ IF entry_Pu'[self].host_marker = H1
                                                      THEN /\ EvictionReroute' = TRUE
                                                      ELSE /\ TRUE
                                                           /\ UNCHANGED EvictionReroute
                                                /\ UNCHANGED Marker1
                                     /\ PrintT(<<"PubToPriv-Eviction Error: pkt", pkt_Pu[self], " entry", entry_Pu'[self], "Connections:", Connections, "T: ", T>>)
                                ELSE /\ TRUE
                                     /\ UNCHANGED << EvictionReroute, Marker1, 
                                                     Marker2 >>
                          /\ conn_Pub' = [conn_Pub EXCEPT ![self] = SelectSeq(Connections, LAMBDA e: entry_Pu'[self].orig.saddr = Head(e))]
                          /\ IF Len(conn_Pub'[self]) > 0
                                THEN /\ pc' = [pc EXCEPT ![self] = "pubtoprivConngt1_P"]
                                ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_P"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, PortScanInv, MaxTableSize, 
                                          hosts, FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, CmdConnect, 
                                          CmdDisconnect, PortSpaceFull, stack, 
                                          depth_, host_, hidx_, host_idx_, 
                                          pidx_, port_idx_, depth_D, ip_, 
                                          host_D, connDomain_, cidx_, conn_, 
                                          host_Co, ip_C, hidx_C, host_idx_C, 
                                          pidx_C, port_idx_C, host_Dis, ip_Di, 
                                          connDomain_D, cidx_D, conn_D, host, 
                                          ip, connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, hostMarker_Pu, ip_idx_Pu, 
                                          ipidx_Pu, ip_Pub, host_Pub, 
                                          depth_Pri, pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

pubtoprivConngt1_P(self) == /\ pc[self] = "pubtoprivConngt1_P"
                            /\ conn_Pub' = [conn_Pub EXCEPT ![self] = Head(conn_Pub[self])]
                            /\ pc' = [pc EXCEPT ![self] = "pubtoprivConngt2_P"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, hostMarker_Pu, ip_idx_Pu, 
                                            ipidx_Pu, ip_Pub, host_Pub, 
                                            depth_Pri, pkt_PrivT, conn_Priv, 
                                            hostMarker_PrivT, daddr_Pri, 
                                            hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

pubtoprivConngt2_P(self) == /\ pc[self] = "pubtoprivConngt2_P"
                            /\ hostMarker_Pu' = [hostMarker_Pu EXCEPT ![self] = conn_Pub[self][2]]
                            /\ IF hostMarker_Pu'[self] = H1
                                  THEN /\ IF entry_Pu[self].host_marker = H2
                                             THEN /\ PortScanInv' = TRUE
                                             ELSE /\ TRUE
                                                  /\ UNCHANGED PortScanInv
                                       /\ Marker1' = entry_Pu[self].host_marker
                                       /\ UNCHANGED Marker2
                                  ELSE /\ IF entry_Pu[self].host_marker = H1
                                             THEN /\ PortScanInv' = TRUE
                                             ELSE /\ TRUE
                                                  /\ UNCHANGED PortScanInv
                                       /\ Marker2' = entry_Pu[self].host_marker
                                       /\ UNCHANGED Marker1
                            /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet_P"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, MaxTableSize, 
                                            hosts, FreeHosts, UsedHosts, Ports, 
                                            ExtraPorts, ExtraExtraPorts, T, 
                                            FreeIPs, UsedIPs, Connections, 
                                            SendQueue, RcvQueue, MAX, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, ip_idx_Pu, 
                                            ipidx_Pu, ip_Pub, host_Pub, 
                                            depth_Pri, pkt_PrivT, conn_Priv, 
                                            hostMarker_PrivT, daddr_Pri, 
                                            hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

pubtoprivRet_P(self) == /\ pc[self] = "pubtoprivRet_P"
                        /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                        /\ pkt_Pu' = [pkt_Pu EXCEPT ![self] = Head(stack[self]).pkt_Pu]
                        /\ ipkt_Pu' = [ipkt_Pu EXCEPT ![self] = Head(stack[self]).ipkt_Pu]
                        /\ entry_Pu' = [entry_Pu EXCEPT ![self] = Head(stack[self]).entry_Pu]
                        /\ conn_Pub' = [conn_Pub EXCEPT ![self] = Head(stack[self]).conn_Pub]
                        /\ hostMarker_Pu' = [hostMarker_Pu EXCEPT ![self] = Head(stack[self]).hostMarker_Pu]
                        /\ ip_idx_Pu' = [ip_idx_Pu EXCEPT ![self] = Head(stack[self]).ip_idx_Pu]
                        /\ ipidx_Pu' = [ipidx_Pu EXCEPT ![self] = Head(stack[self]).ipidx_Pu]
                        /\ ip_Pub' = [ip_Pub EXCEPT ![self] = Head(stack[self]).ip_Pub]
                        /\ host_Pub' = [host_Pub EXCEPT ![self] = Head(stack[self]).host_Pub]
                        /\ depth_Pu' = [depth_Pu EXCEPT ![self] = Head(stack[self]).depth_Pu]
                        /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pri, pkt_PrivT, 
                                        conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

PubToPriv(self) == pubtoprivStart_(self) \/ pubtoprivIf_(self)
                      \/ pubtoPrivElse_Pu(self) \/ pubtoprivConngt1_P(self)
                      \/ pubtoprivConngt2_P(self) \/ pubtoprivRet_P(self)

privtopubStart_(self) == /\ pc[self] = "privtopubStart_"
                         /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = depth_Pri[self]]
                            /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                     pc        |->  "privtopubIf_",
                                                                     i_Ev      |->  i_Ev[self],
                                                                     j_E       |->  j_E[self],
                                                                     ip_Ev     |->  ip_Ev[self],
                                                                     host_Ev   |->  host_Ev[self],
                                                                     indecies_E |->  indecies_E[self],
                                                                     depth_Ev  |->  depth_Ev[self] ] >>
                                                                 \o stack[self]]
                         /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                         /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                         /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                         /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                         /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                         /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, i_C, i_Ch, depth_Pub, 
                                         pkt_Pub, ipkt_Pub, entry_Pub, 
                                         conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                         ipidx_Pub, ip_PubT, host_PubT, 
                                         depth_Priv, pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

privtopubIf_(self) == /\ pc[self] = "privtopubIf_"
                      /\ good_' = [good_ EXCEPT ![self] = TRUE]
                      /\ IF Len (Connections) > 0
                            THEN /\ indicies_Pri' = [indicies_Pri EXCEPT ![self] = DOMAIN Connections]
                                 /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = DOMAIN Ports]
                                 /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = CHOOSE pr \in portDomain_Pri'[self] : TRUE]
                                 /\ i_Pri' = [i_Pri EXCEPT ![self] = CHOOSE f \in indicies_Pri'[self] : TRUE]
                                 /\ pc' = [pc EXCEPT ![self] = "privtopubConn_P"]
                            ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet_Pr"]
                                 /\ UNCHANGED << i_Pri, indicies_Pri, 
                                                 portDomain_Pri, 
                                                 sourcePort_Pri >>
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, stack, 
                                      depth_, host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      destPort_Pri, new_sport_Pri, depth_E, 
                                      i_E, j_, ip_E, host_E, indecies_, 
                                      depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                      indecies_E, i_C, i_Ch, depth_Pub, 
                                      pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                      hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                      ip_PubT, host_PubT, depth_Priv, 
                                      pkt_PrivTo, conn_PrivT, 
                                      hostMarker_PrivTo, daddr_Priv, 
                                      hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, pkt, conn_PrivTo, 
                                      hostMarker, daddr, hostidx, hidx, 
                                      otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

privtopubConn_P(self) == /\ pc[self] = "privtopubConn_P"
                         /\ conn_Priv' = [conn_Priv EXCEPT ![self] = Connections[i_Pri[self]]]
                         /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = Ports[sourcePort_Pri[self]]]
                         /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = DOMAIN Ports]
                         /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = CHOOSE h \in portDomain_Pri'[self] : TRUE]
                         /\ pc' = [pc EXCEPT ![self] = "privtopubDport_P"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, stack, 
                                         depth_, host_, hidx_, host_idx_, 
                                         pidx_, port_idx_, depth_D, ip_, 
                                         host_D, connDomain_, cidx_, conn_, 
                                         host_Co, ip_C, hidx_C, host_idx_C, 
                                         pidx_C, port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, hostMarker_PrivT, 
                                         daddr_Pri, hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         new_sport_Pri, good_, depth_E, i_E, 
                                         j_, ip_E, host_E, indecies_, depth_Ev, 
                                         i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                         i_C, i_Ch, depth_Pub, pkt_Pub, 
                                         ipkt_Pub, entry_Pub, conn_PubT, 
                                         hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                         ip_PubT, host_PubT, depth_Priv, 
                                         pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

privtopubDport_P(self) == /\ pc[self] = "privtopubDport_P"
                          /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = Ports[destPort_Pri[self]]]
                          /\ hostidx_Pri' = [hostidx_Pri EXCEPT ![self] = DOMAIN hosts]
                          /\ hidx_Priv' = [hidx_Priv EXCEPT ![self] = CHOOSE hid \in hostidx_Pri'[self] : TRUE]
                          /\ daddr_Pri' = [daddr_Pri EXCEPT ![self] = hosts[hidx_Priv'[self]]]
                          /\ hostMarker_PrivT' = [hostMarker_PrivT EXCEPT ![self] = Head(Tail(conn_Priv[self]))]
                          /\ IF hostMarker_PrivT'[self]=H1
                                THEN /\ IF Len(PortMap1) >= MaxPorts
                                           THEN /\ good_' = [good_ EXCEPT ![self] = FALSE]
                                                /\ pc' = [pc EXCEPT ![self] = "privtopubMaxPorts1_"]
                                                /\ UNCHANGED PortMap1
                                           ELSE /\ PortMap1' = Append(PortMap1, sourcePort_Pri[self])
                                                /\ pc' = [pc EXCEPT ![self] = "privtopubGood_"]
                                                /\ good_' = good_
                                     /\ UNCHANGED PortMap2
                                ELSE /\ IF Len(PortMap2) >= MaxPorts
                                           THEN /\ good_' = [good_ EXCEPT ![self] = FALSE]
                                                /\ pc' = [pc EXCEPT ![self] = "privtopubMaxPorts2_"]
                                                /\ UNCHANGED PortMap2
                                           ELSE /\ PortMap2' = Append(PortMap2, sourcePort_Pri[self])
                                                /\ pc' = [pc EXCEPT ![self] = "privtopubGood_"]
                                                /\ good_' = good_
                                     /\ UNCHANGED PortMap1
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, EP2, TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, otherEntry_Pri, 
                                          i_Pri, indicies_Pri, portDomain_Pri, 
                                          sourcePort_Pri, new_sport_Pri, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

privtopubMaxPorts1_(self) == /\ pc[self] = "privtopubMaxPorts1_"
                             /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                             /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = Head(stack[self]).pkt_PrivT]
                             /\ conn_Priv' = [conn_Priv EXCEPT ![self] = Head(stack[self]).conn_Priv]
                             /\ hostMarker_PrivT' = [hostMarker_PrivT EXCEPT ![self] = Head(stack[self]).hostMarker_PrivT]
                             /\ daddr_Pri' = [daddr_Pri EXCEPT ![self] = Head(stack[self]).daddr_Pri]
                             /\ hostidx_Pri' = [hostidx_Pri EXCEPT ![self] = Head(stack[self]).hostidx_Pri]
                             /\ hidx_Priv' = [hidx_Priv EXCEPT ![self] = Head(stack[self]).hidx_Priv]
                             /\ otherEntry_Pri' = [otherEntry_Pri EXCEPT ![self] = Head(stack[self]).otherEntry_Pri]
                             /\ i_Pri' = [i_Pri EXCEPT ![self] = Head(stack[self]).i_Pri]
                             /\ indicies_Pri' = [indicies_Pri EXCEPT ![self] = Head(stack[self]).indicies_Pri]
                             /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = Head(stack[self]).portDomain_Pri]
                             /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = Head(stack[self]).sourcePort_Pri]
                             /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = Head(stack[self]).destPort_Pri]
                             /\ new_sport_Pri' = [new_sport_Pri EXCEPT ![self] = Head(stack[self]).new_sport_Pri]
                             /\ good_' = [good_ EXCEPT ![self] = Head(stack[self]).good_]
                             /\ depth_Pri' = [depth_Pri EXCEPT ![self] = Head(stack[self]).depth_Pri]
                             /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                             /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                             Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                             Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                             Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                             H2, MaxPorts, EP1, PortMap1, EP2, 
                                             PortMap2, TableFull, 
                                             EvictionReroute, PortScanInv, 
                                             MaxTableSize, hosts, FreeHosts, 
                                             UsedHosts, Ports, ExtraPorts, 
                                             ExtraExtraPorts, T, FreeIPs, 
                                             UsedIPs, Connections, SendQueue, 
                                             RcvQueue, MAX, Marker1, Marker2, 
                                             CmdConnect, CmdDisconnect, 
                                             PortSpaceFull, depth_, host_, 
                                             hidx_, host_idx_, pidx_, 
                                             port_idx_, depth_D, ip_, host_D, 
                                             connDomain_, cidx_, conn_, 
                                             host_Co, ip_C, hidx_C, host_idx_C, 
                                             pidx_C, port_idx_C, host_Dis, 
                                             ip_Di, connDomain_D, cidx_D, 
                                             conn_D, host, ip, connDomain_Di, 
                                             cidx_Di, conn_Di, depth_P, pkt_, 
                                             ipkt_, entry_, conn_P, 
                                             hostMarker_, ip_idx_, ipidx_, 
                                             ip_P, host_P, pkt_P, ipkt_P, 
                                             entry_P, conn_Pu, hostMarker_P, 
                                             ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                             conn, sport, dstAddr, dport, 
                                             pkt_Pr, hostMarker_Pr, daddr_, 
                                             hostidx_, hidx_P, otherEntry_, i_, 
                                             indicies_, portDomain_, 
                                             sourcePort_, destPort_, 
                                             new_sport_, depth_Pr, pkt_Pri, 
                                             conn_Pr, hostMarker_Pri, daddr_P, 
                                             hostidx_P, hidx_Pr, otherEntry_P, 
                                             i_P, indicies_P, portDomain_P, 
                                             sourcePort_P, destPort_P, 
                                             new_sport_P, pkt_Priv, conn_Pri, 
                                             hostMarker_Priv, daddr_Pr, 
                                             hostidx_Pr, hidx_Pri, 
                                             otherEntry_Pr, i_Pr, indicies_Pr, 
                                             portDomain_Pr, sourcePort_Pr, 
                                             destPort_Pr, new_sport_Pr, 
                                             depth_C, host_C, hidx_Co, 
                                             host_idx, pidx, port_idx, 
                                             depth_Di, ip_D, host_Di, 
                                             connDomain, cidx, conn_Dis, 
                                             depth_Pu, pkt_Pu, ipkt_Pu, 
                                             entry_Pu, conn_Pub, hostMarker_Pu, 
                                             ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                             host_Pub, depth_E, i_E, j_, ip_E, 
                                             host_E, indecies_, depth_Ev, i_Ev, 
                                             j_E, ip_Ev, host_Ev, indecies_E, 
                                             i_C, i_Ch, depth_Pub, pkt_Pub, 
                                             ipkt_Pub, entry_Pub, conn_PubT, 
                                             hostMarker_Pub, ip_idx_Pub, 
                                             ipidx_Pub, ip_PubT, host_PubT, 
                                             depth_Priv, pkt_PrivTo, 
                                             conn_PrivT, hostMarker_PrivTo, 
                                             daddr_Priv, hostidx_Priv, 
                                             hidx_PrivT, otherEntry_Priv, 
                                             i_Priv, indicies_Priv, 
                                             portDomain_Priv, sourcePort_Priv, 
                                             destPort_Priv, new_sport_Priv, 
                                             depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                             host_Eve, indecies_Ev, depth_PubT, 
                                             pkt_PubT, ipkt, entry, conn_PubTo, 
                                             hostMarker_PubT, ip_idx, ipidx, 
                                             ip_PubTo, host_PubTo, depth_PrivT, 
                                             pkt, conn_PrivTo, hostMarker, 
                                             daddr, hostidx, hidx, otherEntry, 
                                             i_PrivT, indicies, portDomain, 
                                             sourcePort, destPort, new_sport, 
                                             good, depth, i_Even, j, ip_Even, 
                                             host_Even, indecies, i_Che, i, aa >>

privtopubMaxPorts2_(self) == /\ pc[self] = "privtopubMaxPorts2_"
                             /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                             /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = Head(stack[self]).pkt_PrivT]
                             /\ conn_Priv' = [conn_Priv EXCEPT ![self] = Head(stack[self]).conn_Priv]
                             /\ hostMarker_PrivT' = [hostMarker_PrivT EXCEPT ![self] = Head(stack[self]).hostMarker_PrivT]
                             /\ daddr_Pri' = [daddr_Pri EXCEPT ![self] = Head(stack[self]).daddr_Pri]
                             /\ hostidx_Pri' = [hostidx_Pri EXCEPT ![self] = Head(stack[self]).hostidx_Pri]
                             /\ hidx_Priv' = [hidx_Priv EXCEPT ![self] = Head(stack[self]).hidx_Priv]
                             /\ otherEntry_Pri' = [otherEntry_Pri EXCEPT ![self] = Head(stack[self]).otherEntry_Pri]
                             /\ i_Pri' = [i_Pri EXCEPT ![self] = Head(stack[self]).i_Pri]
                             /\ indicies_Pri' = [indicies_Pri EXCEPT ![self] = Head(stack[self]).indicies_Pri]
                             /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = Head(stack[self]).portDomain_Pri]
                             /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = Head(stack[self]).sourcePort_Pri]
                             /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = Head(stack[self]).destPort_Pri]
                             /\ new_sport_Pri' = [new_sport_Pri EXCEPT ![self] = Head(stack[self]).new_sport_Pri]
                             /\ good_' = [good_ EXCEPT ![self] = Head(stack[self]).good_]
                             /\ depth_Pri' = [depth_Pri EXCEPT ![self] = Head(stack[self]).depth_Pri]
                             /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                             /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                             Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                             Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                             Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                             H2, MaxPorts, EP1, PortMap1, EP2, 
                                             PortMap2, TableFull, 
                                             EvictionReroute, PortScanInv, 
                                             MaxTableSize, hosts, FreeHosts, 
                                             UsedHosts, Ports, ExtraPorts, 
                                             ExtraExtraPorts, T, FreeIPs, 
                                             UsedIPs, Connections, SendQueue, 
                                             RcvQueue, MAX, Marker1, Marker2, 
                                             CmdConnect, CmdDisconnect, 
                                             PortSpaceFull, depth_, host_, 
                                             hidx_, host_idx_, pidx_, 
                                             port_idx_, depth_D, ip_, host_D, 
                                             connDomain_, cidx_, conn_, 
                                             host_Co, ip_C, hidx_C, host_idx_C, 
                                             pidx_C, port_idx_C, host_Dis, 
                                             ip_Di, connDomain_D, cidx_D, 
                                             conn_D, host, ip, connDomain_Di, 
                                             cidx_Di, conn_Di, depth_P, pkt_, 
                                             ipkt_, entry_, conn_P, 
                                             hostMarker_, ip_idx_, ipidx_, 
                                             ip_P, host_P, pkt_P, ipkt_P, 
                                             entry_P, conn_Pu, hostMarker_P, 
                                             ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                             conn, sport, dstAddr, dport, 
                                             pkt_Pr, hostMarker_Pr, daddr_, 
                                             hostidx_, hidx_P, otherEntry_, i_, 
                                             indicies_, portDomain_, 
                                             sourcePort_, destPort_, 
                                             new_sport_, depth_Pr, pkt_Pri, 
                                             conn_Pr, hostMarker_Pri, daddr_P, 
                                             hostidx_P, hidx_Pr, otherEntry_P, 
                                             i_P, indicies_P, portDomain_P, 
                                             sourcePort_P, destPort_P, 
                                             new_sport_P, pkt_Priv, conn_Pri, 
                                             hostMarker_Priv, daddr_Pr, 
                                             hostidx_Pr, hidx_Pri, 
                                             otherEntry_Pr, i_Pr, indicies_Pr, 
                                             portDomain_Pr, sourcePort_Pr, 
                                             destPort_Pr, new_sport_Pr, 
                                             depth_C, host_C, hidx_Co, 
                                             host_idx, pidx, port_idx, 
                                             depth_Di, ip_D, host_Di, 
                                             connDomain, cidx, conn_Dis, 
                                             depth_Pu, pkt_Pu, ipkt_Pu, 
                                             entry_Pu, conn_Pub, hostMarker_Pu, 
                                             ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                             host_Pub, depth_E, i_E, j_, ip_E, 
                                             host_E, indecies_, depth_Ev, i_Ev, 
                                             j_E, ip_Ev, host_Ev, indecies_E, 
                                             i_C, i_Ch, depth_Pub, pkt_Pub, 
                                             ipkt_Pub, entry_Pub, conn_PubT, 
                                             hostMarker_Pub, ip_idx_Pub, 
                                             ipidx_Pub, ip_PubT, host_PubT, 
                                             depth_Priv, pkt_PrivTo, 
                                             conn_PrivT, hostMarker_PrivTo, 
                                             daddr_Priv, hostidx_Priv, 
                                             hidx_PrivT, otherEntry_Priv, 
                                             i_Priv, indicies_Priv, 
                                             portDomain_Priv, sourcePort_Priv, 
                                             destPort_Priv, new_sport_Priv, 
                                             depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                             host_Eve, indecies_Ev, depth_PubT, 
                                             pkt_PubT, ipkt, entry, conn_PubTo, 
                                             hostMarker_PubT, ip_idx, ipidx, 
                                             ip_PubTo, host_PubTo, depth_PrivT, 
                                             pkt, conn_PrivTo, hostMarker, 
                                             daddr, hostidx, hidx, otherEntry, 
                                             i_PrivT, indicies, portDomain, 
                                             sourcePort, destPort, new_sport, 
                                             good, depth, i_Even, j, ip_Even, 
                                             host_Even, indecies, i_Che, i, aa >>

privtopubGood_(self) == /\ pc[self] = "privtopubGood_"
                        /\ IF good_[self]
                              THEN /\ pc' = [pc EXCEPT ![self] = "privToPubPkt1_"]
                              ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet_Pr"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, stack, 
                                        depth_, host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

privToPubPkt1_(self) == /\ pc[self] = "privToPubPkt1_"
                        /\ IF sourcePort_Pri[self] = N
                              THEN /\ IF hostMarker_PrivT[self]=H1
                                         THEN /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = EP1]
                                         ELSE /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = EP2]
                              ELSE /\ TRUE
                                   /\ UNCHANGED sourcePort_Pri
                        /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = [saddr |-> Head(conn_Priv[self]), sport |-> sourcePort_Pri'[self],
                                                                     daddr |-> daddr_Pri[self], dport |-> destPort_Pri[self],
                                                                     host_marker |-> hostMarker_PrivT[self]
                                                                    ]]
                        /\ PrintT(<<"PrivToPub - pkt: ", conn_Priv[self], pkt_PrivT'[self]>>)
                        /\ entry' = [entry EXCEPT ![self] = [host_marker |-> hostMarker_PrivT[self],
                                                             orig |-> [saddr |-> pkt_PrivT'[self].saddr, sport |-> pkt_PrivT'[self].sport,
                                                                       daddr |-> pkt_PrivT'[self].daddr, dport |-> pkt_PrivT'[self].dport],
                                                             reply |-> [saddr |-> pkt_PrivT'[self].daddr, sport |-> pkt_PrivT'[self].dport,
                                                                        daddr |-> N,  dport |-> pkt_PrivT'[self].sport ]]]
                        /\ otherEntry_Pri' = [otherEntry_Pri EXCEPT ![self] = SelectSeq(T, LAMBDA k: k.reply.saddr=pkt_PrivT'[self].daddr /\ k.reply.sport=pkt_PrivT'[self].dport /\
                                                                                                     k.reply.daddr=N /\ k.reply.dport=pkt_PrivT'[self].sport /\
                                                                                                     k.hostMarker /= hostMarker_PrivT[self])]
                        /\ IF Len(otherEntry_Pri'[self]) > 0
                              THEN /\ PrintT("Evict")
                                   /\ IF Len(ExtraPorts) > 0
                                         THEN /\ new_sport_Pri' = [new_sport_Pri EXCEPT ![self] = Head(ExtraPorts)]
                                              /\ ExtraPorts' = Tail(ExtraPorts)
                                              /\ pc' = [pc EXCEPT ![self] = "privToPubNewPort_"]
                                              /\ UNCHANGED PortSpaceFull
                                         ELSE /\ PortSpaceFull' = TRUE
                                              /\ pc' = [pc EXCEPT ![self] = "privToPubAppendT_"]
                                              /\ UNCHANGED << ExtraPorts, 
                                                              new_sport_Pri >>
                              ELSE /\ pc' = [pc EXCEPT ![self] = "privToPubAppendT_"]
                                   /\ UNCHANGED << ExtraPorts, PortSpaceFull, 
                                                   new_sport_Pri >>
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraExtraPorts, T, 
                                        FreeIPs, UsedIPs, Connections, 
                                        SendQueue, RcvQueue, MAX, Marker1, 
                                        Marker2, CmdConnect, CmdDisconnect, 
                                        stack, depth_, host_, hidx_, host_idx_, 
                                        pidx_, port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, conn_Priv, hostMarker_PrivT, 
                                        daddr_Pri, hostidx_Pri, hidx_Priv, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        destPort_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

privToPubNewPort_(self) == /\ pc[self] = "privToPubNewPort_"
                           /\ entry' = [entry EXCEPT ![self] =                  [host_marker |-> hostMarker_PrivT[self],
                                                               orig |-> [saddr |-> pkt_PrivT[self].saddr, sport |-> pkt_PrivT[self].sport,
                                                                         daddr |-> pkt_PrivT[self].daddr, dport |-> pkt_PrivT[self].dport],
                                                               reply |-> [saddr |-> pkt_PrivT[self].daddr, sport |-> pkt_PrivT[self].dport,
                                                                          daddr |-> N,  dport |-> new_sport_Pri[self] ]]]
                           /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self].sport = new_sport_Pri[self]]
                           /\ pc' = [pc EXCEPT ![self] = "privToPubAppendT_"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, Marker1, Marker2, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           conn_Priv, hostMarker_PrivT, 
                                           daddr_Pri, hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privToPubAppendT_(self) == /\ pc[self] = "privToPubAppendT_"
                           /\ T' = Append(T, entry[self])
                           /\ IF Len(T') >= MaxTableSize
                                 THEN /\ TableFull' = TRUE
                                 ELSE /\ TRUE
                                      /\ UNCHANGED TableFull
                           /\ pc' = [pc EXCEPT ![self] = "privtopubPkt_Pri"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, EvictionReroute, 
                                           PortScanInv, MaxTableSize, hosts, 
                                           FreeHosts, UsedHosts, Ports, 
                                           ExtraPorts, ExtraExtraPorts, 
                                           FreeIPs, UsedIPs, Connections, 
                                           SendQueue, RcvQueue, MAX, Marker1, 
                                           Marker2, CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privtopubPkt_Pri(self) == /\ pc[self] = "privtopubPkt_Pri"
                          /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = [saddr |->pkt_PrivT[self].daddr, sport |-> pkt_PrivT[self].dport,
                                                                       daddr |-> N, dport |-> pkt_PrivT[self].sport,
                                                                       host_marker |-> hostMarker_PrivT[self]]]
                          /\ SendQueue' = Append(SendQueue, pkt_PrivT'[self])
                          /\ pc' = [pc EXCEPT ![self] = "privtopubRet_Pr"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          RcvQueue, MAX, Marker1, Marker2, 
                                          CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          conn_Priv, hostMarker_PrivT, 
                                          daddr_Pri, hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

privtopubRet_Pr(self) == /\ pc[self] = "privtopubRet_Pr"
                         /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                         /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = Head(stack[self]).pkt_PrivT]
                         /\ conn_Priv' = [conn_Priv EXCEPT ![self] = Head(stack[self]).conn_Priv]
                         /\ hostMarker_PrivT' = [hostMarker_PrivT EXCEPT ![self] = Head(stack[self]).hostMarker_PrivT]
                         /\ daddr_Pri' = [daddr_Pri EXCEPT ![self] = Head(stack[self]).daddr_Pri]
                         /\ hostidx_Pri' = [hostidx_Pri EXCEPT ![self] = Head(stack[self]).hostidx_Pri]
                         /\ hidx_Priv' = [hidx_Priv EXCEPT ![self] = Head(stack[self]).hidx_Priv]
                         /\ otherEntry_Pri' = [otherEntry_Pri EXCEPT ![self] = Head(stack[self]).otherEntry_Pri]
                         /\ i_Pri' = [i_Pri EXCEPT ![self] = Head(stack[self]).i_Pri]
                         /\ indicies_Pri' = [indicies_Pri EXCEPT ![self] = Head(stack[self]).indicies_Pri]
                         /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = Head(stack[self]).portDomain_Pri]
                         /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = Head(stack[self]).sourcePort_Pri]
                         /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = Head(stack[self]).destPort_Pri]
                         /\ new_sport_Pri' = [new_sport_Pri EXCEPT ![self] = Head(stack[self]).new_sport_Pri]
                         /\ good_' = [good_ EXCEPT ![self] = Head(stack[self]).good_]
                         /\ depth_Pri' = [depth_Pri EXCEPT ![self] = Head(stack[self]).depth_Pri]
                         /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_E, i_E, j_, 
                                         ip_E, host_E, indecies_, depth_Ev, 
                                         i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                         i_C, i_Ch, depth_Pub, pkt_Pub, 
                                         ipkt_Pub, entry_Pub, conn_PubT, 
                                         hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                         ip_PubT, host_PubT, depth_Priv, 
                                         pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

PrivToPub(self) == privtopubStart_(self) \/ privtopubIf_(self)
                      \/ privtopubConn_P(self) \/ privtopubDport_P(self)
                      \/ privtopubMaxPorts1_(self)
                      \/ privtopubMaxPorts2_(self) \/ privtopubGood_(self)
                      \/ privToPubPkt1_(self) \/ privToPubNewPort_(self)
                      \/ privToPubAppendT_(self) \/ privtopubPkt_Pri(self)
                      \/ privtopubRet_Pr(self)

portscan1_(self) == /\ pc[self] = "portscan1_"
                    /\ /\ host_Co' = [host_Co EXCEPT ![self] = 1]
                       /\ ip_C' = [ip_C EXCEPT ![self] = B]
                       /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "ConnectMan",
                                                                pc        |->  "portscan11",
                                                                hidx_C    |->  hidx_C[self],
                                                                host_idx_C |->  host_idx_C[self],
                                                                pidx_C    |->  pidx_C[self],
                                                                port_idx_C |->  port_idx_C[self],
                                                                host_Co   |->  host_Co[self],
                                                                ip_C      |->  ip_C[self] ] >>
                                                            \o stack[self]]
                    /\ hidx_C' = [hidx_C EXCEPT ![self] = defaultInitValue]
                    /\ host_idx_C' = [host_idx_C EXCEPT ![self] = defaultInitValue]
                    /\ pidx_C' = [pidx_C EXCEPT ![self] = defaultInitValue]
                    /\ port_idx_C' = [port_idx_C EXCEPT ![self] = defaultInitValue]
                    /\ pc' = [pc EXCEPT ![self] = "connectManStart"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Dis, ip_Di, 
                                    connDomain_D, cidx_D, conn_D, host, ip, 
                                    connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                    pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                    ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                    ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                    ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                    sport, dstAddr, dport, pkt_Pr, 
                                    hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                    otherEntry_, i_, indicies_, portDomain_, 
                                    sourcePort_, destPort_, new_sport_, 
                                    depth_Pr, pkt_Pri, conn_Pr, hostMarker_Pri, 
                                    daddr_P, hostidx_P, hidx_Pr, otherEntry_P, 
                                    i_P, indicies_P, portDomain_P, 
                                    sourcePort_P, destPort_P, new_sport_P, 
                                    pkt_Priv, conn_Pri, hostMarker_Priv, 
                                    daddr_Pr, hostidx_Pr, hidx_Pri, 
                                    otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan11(self) == /\ pc[self] = "portscan11"
                    /\ PrintT(<<"SendQueue:", SendQueue, T>>)
                    /\ pc' = [pc EXCEPT ![self] = "portscan2_"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    stack, depth_, host_, hidx_, host_idx_, 
                                    pidx_, port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan2_(self) == /\ pc[self] = "portscan2_"
                    /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PrivToPubMan",
                                                             pc        |->  "portscan21",
                                                             pkt_Priv  |->  pkt_Priv[self],
                                                             conn_Pri  |->  conn_Pri[self],
                                                             hostMarker_Priv |->  hostMarker_Priv[self],
                                                             daddr_Pr  |->  daddr_Pr[self],
                                                             hostidx_Pr |->  hostidx_Pr[self],
                                                             hidx_Pri  |->  hidx_Pri[self],
                                                             otherEntry_Pr |->  otherEntry_Pr[self],
                                                             i_Pr      |->  i_Pr[self],
                                                             indicies_Pr |->  indicies_Pr[self],
                                                             portDomain_Pr |->  portDomain_Pr[self],
                                                             sourcePort_Pr |->  sourcePort_Pr[self],
                                                             destPort_Pr |->  destPort_Pr[self],
                                                             new_sport_Pr |->  new_sport_Pr[self] ] >>
                                                         \o stack[self]]
                    /\ pkt_Priv' = [pkt_Priv EXCEPT ![self] = defaultInitValue]
                    /\ conn_Pri' = [conn_Pri EXCEPT ![self] = defaultInitValue]
                    /\ hostMarker_Priv' = [hostMarker_Priv EXCEPT ![self] = defaultInitValue]
                    /\ daddr_Pr' = [daddr_Pr EXCEPT ![self] = defaultInitValue]
                    /\ hostidx_Pr' = [hostidx_Pr EXCEPT ![self] = defaultInitValue]
                    /\ hidx_Pri' = [hidx_Pri EXCEPT ![self] = defaultInitValue]
                    /\ otherEntry_Pr' = [otherEntry_Pr EXCEPT ![self] = defaultInitValue]
                    /\ i_Pr' = [i_Pr EXCEPT ![self] = defaultInitValue]
                    /\ indicies_Pr' = [indicies_Pr EXCEPT ![self] = defaultInitValue]
                    /\ portDomain_Pr' = [portDomain_Pr EXCEPT ![self] = defaultInitValue]
                    /\ sourcePort_Pr' = [sourcePort_Pr EXCEPT ![self] = defaultInitValue]
                    /\ destPort_Pr' = [destPort_Pr EXCEPT ![self] = defaultInitValue]
                    /\ new_sport_Pr' = [new_sport_Pr EXCEPT ![self] = defaultInitValue]
                    /\ pc' = [pc EXCEPT ![self] = "privtopubManStart_Pr"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan21(self) == /\ pc[self] = "portscan21"
                    /\ PrintT(<<"SendQueue:", SendQueue, T>>)
                    /\ pc' = [pc EXCEPT ![self] = "portscan3_"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    stack, depth_, host_, hidx_, host_idx_, 
                                    pidx_, port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan3_(self) == /\ pc[self] = "portscan3_"
                    /\ /\ host' = [host EXCEPT ![self] = 1]
                       /\ ip' = [ip EXCEPT ![self] = B]
                       /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "DisconnectVulnMan",
                                                                pc        |->  "portscan31",
                                                                connDomain_Di |->  connDomain_Di[self],
                                                                cidx_Di   |->  cidx_Di[self],
                                                                conn_Di   |->  conn_Di[self],
                                                                host      |->  host[self],
                                                                ip        |->  ip[self] ] >>
                                                            \o stack[self]]
                    /\ connDomain_Di' = [connDomain_Di EXCEPT ![self] = defaultInitValue]
                    /\ cidx_Di' = [cidx_Di EXCEPT ![self] = defaultInitValue]
                    /\ conn_Di' = [conn_Di EXCEPT ![self] = defaultInitValue]
                    /\ pc' = [pc EXCEPT ![self] = "disconnectVulnManStart"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan31(self) == /\ pc[self] = "portscan31"
                    /\ PrintT(<<"SendQueue:", SendQueue, T>>)
                    /\ pc' = [pc EXCEPT ![self] = "portscan4_"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    stack, depth_, host_, hidx_, host_idx_, 
                                    pidx_, port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan4_(self) == /\ pc[self] = "portscan4_"
                    /\ /\ host_Co' = [host_Co EXCEPT ![self] = 2]
                       /\ ip_C' = [ip_C EXCEPT ![self] = B]
                       /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "ConnectMan",
                                                                pc        |->  "portscan41",
                                                                hidx_C    |->  hidx_C[self],
                                                                host_idx_C |->  host_idx_C[self],
                                                                pidx_C    |->  pidx_C[self],
                                                                port_idx_C |->  port_idx_C[self],
                                                                host_Co   |->  host_Co[self],
                                                                ip_C      |->  ip_C[self] ] >>
                                                            \o stack[self]]
                    /\ hidx_C' = [hidx_C EXCEPT ![self] = defaultInitValue]
                    /\ host_idx_C' = [host_idx_C EXCEPT ![self] = defaultInitValue]
                    /\ pidx_C' = [pidx_C EXCEPT ![self] = defaultInitValue]
                    /\ port_idx_C' = [port_idx_C EXCEPT ![self] = defaultInitValue]
                    /\ pc' = [pc EXCEPT ![self] = "connectManStart"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Dis, ip_Di, 
                                    connDomain_D, cidx_D, conn_D, host, ip, 
                                    connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                    pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                    ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                    ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                    ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                    sport, dstAddr, dport, pkt_Pr, 
                                    hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                    otherEntry_, i_, indicies_, portDomain_, 
                                    sourcePort_, destPort_, new_sport_, 
                                    depth_Pr, pkt_Pri, conn_Pr, hostMarker_Pri, 
                                    daddr_P, hostidx_P, hidx_Pr, otherEntry_P, 
                                    i_P, indicies_P, portDomain_P, 
                                    sourcePort_P, destPort_P, new_sport_P, 
                                    pkt_Priv, conn_Pri, hostMarker_Priv, 
                                    daddr_Pr, hostidx_Pr, hidx_Pri, 
                                    otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan41(self) == /\ pc[self] = "portscan41"
                    /\ PrintT(<<"SendQueue:", SendQueue, T>>)
                    /\ pc' = [pc EXCEPT ![self] = "portscan5_"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    stack, depth_, host_, hidx_, host_idx_, 
                                    pidx_, port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan5_(self) == /\ pc[self] = "portscan5_"
                    /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PubToPrivMan",
                                                             pc        |->  "portscan51",
                                                             pkt_P     |->  pkt_P[self],
                                                             ipkt_P    |->  ipkt_P[self],
                                                             entry_P   |->  entry_P[self],
                                                             conn_Pu   |->  conn_Pu[self],
                                                             hostMarker_P |->  hostMarker_P[self],
                                                             ip_idx_P  |->  ip_idx_P[self],
                                                             ipidx_P   |->  ipidx_P[self],
                                                             ip_Pu     |->  ip_Pu[self],
                                                             host_Pu   |->  host_Pu[self] ] >>
                                                         \o stack[self]]
                    /\ pkt_P' = [pkt_P EXCEPT ![self] = defaultInitValue]
                    /\ ipkt_P' = [ipkt_P EXCEPT ![self] = defaultInitValue]
                    /\ entry_P' = [entry_P EXCEPT ![self] = defaultInitValue]
                    /\ conn_Pu' = [conn_Pu EXCEPT ![self] = defaultInitValue]
                    /\ hostMarker_P' = [hostMarker_P EXCEPT ![self] = defaultInitValue]
                    /\ ip_idx_P' = [ip_idx_P EXCEPT ![self] = defaultInitValue]
                    /\ ipidx_P' = [ipidx_P EXCEPT ![self] = defaultInitValue]
                    /\ ip_Pu' = [ip_Pu EXCEPT ![self] = defaultInitValue]
                    /\ host_Pu' = [host_Pu EXCEPT ![self] = defaultInitValue]
                    /\ pc' = [pc EXCEPT ![self] = "pubtoprivManStart"]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

portscan51(self) == /\ pc[self] = "portscan51"
                    /\ PrintT(<<"SendQueue:", SendQueue, T>>)
                    /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                    /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

OldPortScan(self) == portscan1_(self) \/ portscan11(self)
                        \/ portscan2_(self) \/ portscan21(self)
                        \/ portscan3_(self) \/ portscan31(self)
                        \/ portscan4_(self) \/ portscan41(self)
                        \/ portscan5_(self) \/ portscan51(self)

evtSeqVStart_(self) == /\ pc[self] = "evtSeqVStart_"
                       /\ IF depth_E[self] <= 0
                             THEN /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                                  /\ i_E' = [i_E EXCEPT ![self] = Head(stack[self]).i_E]
                                  /\ j_' = [j_ EXCEPT ![self] = Head(stack[self]).j_]
                                  /\ ip_E' = [ip_E EXCEPT ![self] = Head(stack[self]).ip_E]
                                  /\ host_E' = [host_E EXCEPT ![self] = Head(stack[self]).host_E]
                                  /\ indecies_' = [indecies_ EXCEPT ![self] = Head(stack[self]).indecies_]
                                  /\ depth_E' = [depth_E EXCEPT ![self] = Head(stack[self]).depth_E]
                                  /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                                  /\ UNCHANGED << depth_, host_, hidx_, 
                                                  host_idx_, pidx_, port_idx_, 
                                                  depth_D, ip_, host_D, 
                                                  connDomain_, cidx_, conn_, 
                                                  depth_P, pkt_, ipkt_, entry_, 
                                                  conn_P, hostMarker_, ip_idx_, 
                                                  ipidx_, ip_P, host_P, 
                                                  depth_Pr, pkt_Pri, conn_Pr, 
                                                  hostMarker_Pri, daddr_P, 
                                                  hostidx_P, hidx_Pr, 
                                                  otherEntry_P, i_P, 
                                                  indicies_P, portDomain_P, 
                                                  sourcePort_P, destPort_P, 
                                                  new_sport_P >>
                             ELSE /\ \/ /\ IF Len(FreeIPs) > 0
                                              THEN /\ PrintT(<<"EventSequenceVuln - depth = ", depth_E[self]>>)
                                                   /\ /\ depth_' = [depth_ EXCEPT ![self] = depth_E[self] - 1]
                                                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "ConnectVuln",
                                                                                               pc        |->  "evtSeqVRet_",
                                                                                               host_     |->  host_[self],
                                                                                               hidx_     |->  hidx_[self],
                                                                                               host_idx_ |->  host_idx_[self],
                                                                                               pidx_     |->  pidx_[self],
                                                                                               port_idx_ |->  port_idx_[self],
                                                                                               depth_    |->  depth_[self] ] >>
                                                                                           \o stack[self]]
                                                   /\ host_' = [host_ EXCEPT ![self] = defaultInitValue]
                                                   /\ hidx_' = [hidx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ host_idx_' = [host_idx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ pidx_' = [pidx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ port_idx_' = [port_idx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ pc' = [pc EXCEPT ![self] = "connectVEvtSeqV"]
                                              ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet_"]
                                                   /\ UNCHANGED << stack, 
                                                                   depth_, 
                                                                   host_, 
                                                                   hidx_, 
                                                                   host_idx_, 
                                                                   pidx_, 
                                                                   port_idx_ >>
                                        /\ UNCHANGED <<depth_D, ip_, host_D, connDomain_, cidx_, conn_, depth_P, pkt_, ipkt_, entry_, conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, host_P, depth_Pr, pkt_Pri, conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, otherEntry_P, i_P, indicies_P, portDomain_P, sourcePort_P, destPort_P, new_sport_P>>
                                     \/ /\ IF Len (Connections) > 0
                                              THEN /\ PrintT(<<"EventSequenceVuln - Disconnect", Connections>>)
                                                   /\ /\ depth_D' = [depth_D EXCEPT ![self] = depth_E[self] - 1]
                                                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "DisconnectVuln",
                                                                                               pc        |->  "evtSeqVRet_",
                                                                                               ip_       |->  ip_[self],
                                                                                               host_D    |->  host_D[self],
                                                                                               connDomain_ |->  connDomain_[self],
                                                                                               cidx_     |->  cidx_[self],
                                                                                               conn_     |->  conn_[self],
                                                                                               depth_D   |->  depth_D[self] ] >>
                                                                                           \o stack[self]]
                                                   /\ ip_' = [ip_ EXCEPT ![self] = defaultInitValue]
                                                   /\ host_D' = [host_D EXCEPT ![self] = defaultInitValue]
                                                   /\ connDomain_' = [connDomain_ EXCEPT ![self] = defaultInitValue]
                                                   /\ cidx_' = [cidx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ conn_' = [conn_ EXCEPT ![self] = defaultInitValue]
                                                   /\ pc' = [pc EXCEPT ![self] = "disconnectVEvtSV"]
                                              ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet_"]
                                                   /\ UNCHANGED << stack, 
                                                                   depth_D, 
                                                                   ip_, host_D, 
                                                                   connDomain_, 
                                                                   cidx_, 
                                                                   conn_ >>
                                        /\ UNCHANGED <<depth_, host_, hidx_, host_idx_, pidx_, port_idx_, depth_P, pkt_, ipkt_, entry_, conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, host_P, depth_Pr, pkt_Pri, conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, otherEntry_P, i_P, indicies_P, portDomain_P, sourcePort_P, destPort_P, new_sport_P>>
                                     \/ /\ IF Len(Connections) > 0
                                              THEN /\ PrintT(<<"EventSequenceVuln - PrivToPubVuln:", Connections>>)
                                                   /\ /\ depth_Pr' = [depth_Pr EXCEPT ![self] = depth_E[self] - 1]
                                                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PrivToPubVuln",
                                                                                               pc        |->  "evtSeqVRet_",
                                                                                               pkt_Pri   |->  pkt_Pri[self],
                                                                                               conn_Pr   |->  conn_Pr[self],
                                                                                               hostMarker_Pri |->  hostMarker_Pri[self],
                                                                                               daddr_P   |->  daddr_P[self],
                                                                                               hostidx_P |->  hostidx_P[self],
                                                                                               hidx_Pr   |->  hidx_Pr[self],
                                                                                               otherEntry_P |->  otherEntry_P[self],
                                                                                               i_P       |->  i_P[self],
                                                                                               indicies_P |->  indicies_P[self],
                                                                                               portDomain_P |->  portDomain_P[self],
                                                                                               sourcePort_P |->  sourcePort_P[self],
                                                                                               destPort_P |->  destPort_P[self],
                                                                                               new_sport_P |->  new_sport_P[self],
                                                                                               depth_Pr  |->  depth_Pr[self] ] >>
                                                                                           \o stack[self]]
                                                   /\ pkt_Pri' = [pkt_Pri EXCEPT ![self] = defaultInitValue]
                                                   /\ conn_Pr' = [conn_Pr EXCEPT ![self] = defaultInitValue]
                                                   /\ hostMarker_Pri' = [hostMarker_Pri EXCEPT ![self] = defaultInitValue]
                                                   /\ daddr_P' = [daddr_P EXCEPT ![self] = defaultInitValue]
                                                   /\ hostidx_P' = [hostidx_P EXCEPT ![self] = defaultInitValue]
                                                   /\ hidx_Pr' = [hidx_Pr EXCEPT ![self] = defaultInitValue]
                                                   /\ otherEntry_P' = [otherEntry_P EXCEPT ![self] = defaultInitValue]
                                                   /\ i_P' = [i_P EXCEPT ![self] = defaultInitValue]
                                                   /\ indicies_P' = [indicies_P EXCEPT ![self] = defaultInitValue]
                                                   /\ portDomain_P' = [portDomain_P EXCEPT ![self] = defaultInitValue]
                                                   /\ sourcePort_P' = [sourcePort_P EXCEPT ![self] = defaultInitValue]
                                                   /\ destPort_P' = [destPort_P EXCEPT ![self] = defaultInitValue]
                                                   /\ new_sport_P' = [new_sport_P EXCEPT ![self] = defaultInitValue]
                                                   /\ pc' = [pc EXCEPT ![self] = "privtopubV3_"]
                                              ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet_"]
                                                   /\ UNCHANGED << stack, 
                                                                   depth_Pr, 
                                                                   pkt_Pri, 
                                                                   conn_Pr, 
                                                                   hostMarker_Pri, 
                                                                   daddr_P, 
                                                                   hostidx_P, 
                                                                   hidx_Pr, 
                                                                   otherEntry_P, 
                                                                   i_P, 
                                                                   indicies_P, 
                                                                   portDomain_P, 
                                                                   sourcePort_P, 
                                                                   destPort_P, 
                                                                   new_sport_P >>
                                        /\ UNCHANGED <<depth_, host_, hidx_, host_idx_, pidx_, port_idx_, depth_D, ip_, host_D, connDomain_, cidx_, conn_, depth_P, pkt_, ipkt_, entry_, conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, host_P>>
                                     \/ /\ IF Len(SendQueue) > 0
                                              THEN /\ PrintT(<<"EventSequenceVuln - PubToPrivVuln: depth - ", depth_E[self], SendQueue>>)
                                                   /\ /\ depth_P' = [depth_P EXCEPT ![self] = depth_E[self] - 1]
                                                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PubToPrivVuln",
                                                                                               pc        |->  "evtSeqVRet_",
                                                                                               pkt_      |->  pkt_[self],
                                                                                               ipkt_     |->  ipkt_[self],
                                                                                               entry_    |->  entry_[self],
                                                                                               conn_P    |->  conn_P[self],
                                                                                               hostMarker_ |->  hostMarker_[self],
                                                                                               ip_idx_   |->  ip_idx_[self],
                                                                                               ipidx_    |->  ipidx_[self],
                                                                                               ip_P      |->  ip_P[self],
                                                                                               host_P    |->  host_P[self],
                                                                                               depth_P   |->  depth_P[self] ] >>
                                                                                           \o stack[self]]
                                                   /\ pkt_' = [pkt_ EXCEPT ![self] = defaultInitValue]
                                                   /\ ipkt_' = [ipkt_ EXCEPT ![self] = defaultInitValue]
                                                   /\ entry_' = [entry_ EXCEPT ![self] = defaultInitValue]
                                                   /\ conn_P' = [conn_P EXCEPT ![self] = defaultInitValue]
                                                   /\ hostMarker_' = [hostMarker_ EXCEPT ![self] = defaultInitValue]
                                                   /\ ip_idx_' = [ip_idx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ ipidx_' = [ipidx_ EXCEPT ![self] = defaultInitValue]
                                                   /\ ip_P' = [ip_P EXCEPT ![self] = defaultInitValue]
                                                   /\ host_P' = [host_P EXCEPT ![self] = defaultInitValue]
                                                   /\ pc' = [pc EXCEPT ![self] = "pubtoprivVEvt3_"]
                                              ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet_"]
                                                   /\ UNCHANGED << stack, 
                                                                   depth_P, 
                                                                   pkt_, ipkt_, 
                                                                   entry_, 
                                                                   conn_P, 
                                                                   hostMarker_, 
                                                                   ip_idx_, 
                                                                   ipidx_, 
                                                                   ip_P, 
                                                                   host_P >>
                                        /\ UNCHANGED <<depth_, host_, hidx_, host_idx_, pidx_, port_idx_, depth_D, ip_, host_D, connDomain_, cidx_, conn_, depth_Pr, pkt_Pri, conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, otherEntry_P, i_P, indicies_P, portDomain_P, sourcePort_P, destPort_P, new_sport_P>>
                                  /\ UNCHANGED << depth_E, i_E, j_, ip_E, 
                                                  host_E, indecies_ >>
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, pkt_P, 
                                       ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                       ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                       sport, dstAddr, dport, pkt_Pr, 
                                       hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                       otherEntry_, i_, indicies_, portDomain_, 
                                       sourcePort_, destPort_, new_sport_, 
                                       pkt_Priv, conn_Pri, hostMarker_Priv, 
                                       daddr_Pr, hostidx_Pr, hidx_Pri, 
                                       otherEntry_Pr, i_Pr, indicies_Pr, 
                                       portDomain_Pr, sourcePort_Pr, 
                                       destPort_Pr, new_sport_Pr, depth_C, 
                                       host_C, hidx_Co, host_idx, pidx, 
                                       port_idx, depth_Di, ip_D, host_Di, 
                                       connDomain, cidx, conn_Dis, depth_Pu, 
                                       pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                       hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                       ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                       conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

evtSeqVRet_(self) == /\ pc[self] = "evtSeqVRet_"
                     /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                     /\ i_E' = [i_E EXCEPT ![self] = Head(stack[self]).i_E]
                     /\ j_' = [j_ EXCEPT ![self] = Head(stack[self]).j_]
                     /\ ip_E' = [ip_E EXCEPT ![self] = Head(stack[self]).ip_E]
                     /\ host_E' = [host_E EXCEPT ![self] = Head(stack[self]).host_E]
                     /\ indecies_' = [indecies_ EXCEPT ![self] = Head(stack[self]).indecies_]
                     /\ depth_E' = [depth_E EXCEPT ![self] = Head(stack[self]).depth_E]
                     /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                     Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                     Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                     Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                     PortMap2, TableFull, EvictionReroute, 
                                     PortScanInv, MaxTableSize, hosts, 
                                     FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                     ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                     Connections, SendQueue, RcvQueue, MAX, 
                                     Marker1, Marker2, CmdConnect, 
                                     CmdDisconnect, PortSpaceFull, depth_, 
                                     host_, hidx_, host_idx_, pidx_, port_idx_, 
                                     depth_D, ip_, host_D, connDomain_, cidx_, 
                                     conn_, host_Co, ip_C, hidx_C, host_idx_C, 
                                     pidx_C, port_idx_C, host_Dis, ip_Di, 
                                     connDomain_D, cidx_D, conn_D, host, ip, 
                                     connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                     pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                     ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                     ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                     ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                     sport, dstAddr, dport, pkt_Pr, 
                                     hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                     otherEntry_, i_, indicies_, portDomain_, 
                                     sourcePort_, destPort_, new_sport_, 
                                     depth_Pr, pkt_Pri, conn_Pr, 
                                     hostMarker_Pri, daddr_P, hostidx_P, 
                                     hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                     portDomain_P, sourcePort_P, destPort_P, 
                                     new_sport_P, pkt_Priv, conn_Pri, 
                                     hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                     hidx_Pri, otherEntry_Pr, i_Pr, 
                                     indicies_Pr, portDomain_Pr, sourcePort_Pr, 
                                     destPort_Pr, new_sport_Pr, depth_C, 
                                     host_C, hidx_Co, host_idx, pidx, port_idx, 
                                     depth_Di, ip_D, host_Di, connDomain, cidx, 
                                     conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                     entry_Pu, conn_Pub, hostMarker_Pu, 
                                     ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                     depth_Pri, pkt_PrivT, conn_Priv, 
                                     hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                     hidx_Priv, otherEntry_Pri, i_Pri, 
                                     indicies_Pri, portDomain_Pri, 
                                     sourcePort_Pri, destPort_Pri, 
                                     new_sport_Pri, good_, depth_Ev, i_Ev, j_E, 
                                     ip_Ev, host_Ev, indecies_E, i_C, i_Ch, 
                                     depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                     conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                     ipidx_Pub, ip_PubT, host_PubT, depth_Priv, 
                                     pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, 
                                     daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                     otherEntry_Priv, i_Priv, indicies_Priv, 
                                     portDomain_Priv, sourcePort_Priv, 
                                     destPort_Priv, new_sport_Priv, depth_Eve, 
                                     i_Eve, j_Ev, ip_Eve, host_Eve, 
                                     indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                     entry, conn_PubTo, hostMarker_PubT, 
                                     ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                     depth_PrivT, pkt, conn_PrivTo, hostMarker, 
                                     daddr, hostidx, hidx, otherEntry, i_PrivT, 
                                     indicies, portDomain, sourcePort, 
                                     destPort, new_sport, good, depth, i_Even, 
                                     j, ip_Even, host_Even, indecies, i_Che, i, 
                                     aa >>

EventSequenceVuln(self) == evtSeqVStart_(self) \/ evtSeqVRet_(self)

evtSeqStart_(self) == /\ pc[self] = "evtSeqStart_"
                      /\ IF depth_Ev[self] <= 0
                            THEN /\ pc' = [pc EXCEPT ![self] = "evtSeqD0_"]
                                 /\ UNCHANGED << stack, depth_C, host_C, 
                                                 hidx_Co, host_idx, pidx, 
                                                 port_idx, depth_Di, ip_D, 
                                                 host_Di, connDomain, cidx, 
                                                 conn_Dis, depth_Pu, pkt_Pu, 
                                                 ipkt_Pu, entry_Pu, conn_Pub, 
                                                 hostMarker_Pu, ip_idx_Pu, 
                                                 ipidx_Pu, ip_Pub, host_Pub, 
                                                 depth_Pri, pkt_PrivT, 
                                                 conn_Priv, hostMarker_PrivT, 
                                                 daddr_Pri, hostidx_Pri, 
                                                 hidx_Priv, otherEntry_Pri, 
                                                 i_Pri, indicies_Pri, 
                                                 portDomain_Pri, 
                                                 sourcePort_Pri, destPort_Pri, 
                                                 new_sport_Pri, good_ >>
                            ELSE /\ \/ /\ IF Len(FreeIPs) > 0
                                             THEN /\ /\ depth_C' = [depth_C EXCEPT ![self] = depth_Ev[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Connect",
                                                                                              pc        |->  "evtSeqRet_",
                                                                                              host_C    |->  host_C[self],
                                                                                              hidx_Co   |->  hidx_Co[self],
                                                                                              host_idx  |->  host_idx[self],
                                                                                              pidx      |->  pidx[self],
                                                                                              port_idx  |->  port_idx[self],
                                                                                              depth_C   |->  depth_C[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ host_C' = [host_C EXCEPT ![self] = defaultInitValue]
                                                  /\ hidx_Co' = [hidx_Co EXCEPT ![self] = defaultInitValue]
                                                  /\ host_idx' = [host_idx EXCEPT ![self] = defaultInitValue]
                                                  /\ pidx' = [pidx EXCEPT ![self] = defaultInitValue]
                                                  /\ port_idx' = [port_idx EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "connectStart"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet_"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_C, 
                                                                  host_C, 
                                                                  hidx_Co, 
                                                                  host_idx, 
                                                                  pidx, 
                                                                  port_idx >>
                                       /\ UNCHANGED <<depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, depth_Pri, pkt_PrivT, conn_Priv, hostMarker_PrivT, daddr_Pri, hostidx_Pri, hidx_Priv, otherEntry_Pri, i_Pri, indicies_Pri, portDomain_Pri, sourcePort_Pri, destPort_Pri, new_sport_Pri, good_>>
                                    \/ /\ IF Len (Connections) > 0
                                             THEN /\ /\ depth_Di' = [depth_Di EXCEPT ![self] = depth_Ev[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Disconnect",
                                                                                              pc        |->  "evtSeqRet_",
                                                                                              ip_D      |->  ip_D[self],
                                                                                              host_Di   |->  host_Di[self],
                                                                                              connDomain |->  connDomain[self],
                                                                                              cidx      |->  cidx[self],
                                                                                              conn_Dis  |->  conn_Dis[self],
                                                                                              depth_Di  |->  depth_Di[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ ip_D' = [ip_D EXCEPT ![self] = defaultInitValue]
                                                  /\ host_Di' = [host_Di EXCEPT ![self] = defaultInitValue]
                                                  /\ connDomain' = [connDomain EXCEPT ![self] = defaultInitValue]
                                                  /\ cidx' = [cidx EXCEPT ![self] = defaultInitValue]
                                                  /\ conn_Dis' = [conn_Dis EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "disconnectStart"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet_"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_Di, 
                                                                  ip_D, 
                                                                  host_Di, 
                                                                  connDomain, 
                                                                  cidx, 
                                                                  conn_Dis >>
                                       /\ UNCHANGED <<depth_C, host_C, hidx_Co, host_idx, pidx, port_idx, depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, depth_Pri, pkt_PrivT, conn_Priv, hostMarker_PrivT, daddr_Pri, hostidx_Pri, hidx_Priv, otherEntry_Pri, i_Pri, indicies_Pri, portDomain_Pri, sourcePort_Pri, destPort_Pri, new_sport_Pri, good_>>
                                    \/ /\ IF Len(Connections) > 0
                                             THEN /\ /\ depth_Pri' = [depth_Pri EXCEPT ![self] = depth_Ev[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PrivToPub",
                                                                                              pc        |->  "evtSeqRet_",
                                                                                              pkt_PrivT |->  pkt_PrivT[self],
                                                                                              conn_Priv |->  conn_Priv[self],
                                                                                              hostMarker_PrivT |->  hostMarker_PrivT[self],
                                                                                              daddr_Pri |->  daddr_Pri[self],
                                                                                              hostidx_Pri |->  hostidx_Pri[self],
                                                                                              hidx_Priv |->  hidx_Priv[self],
                                                                                              otherEntry_Pri |->  otherEntry_Pri[self],
                                                                                              i_Pri     |->  i_Pri[self],
                                                                                              indicies_Pri |->  indicies_Pri[self],
                                                                                              portDomain_Pri |->  portDomain_Pri[self],
                                                                                              sourcePort_Pri |->  sourcePort_Pri[self],
                                                                                              destPort_Pri |->  destPort_Pri[self],
                                                                                              new_sport_Pri |->  new_sport_Pri[self],
                                                                                              good_     |->  good_[self],
                                                                                              depth_Pri |->  depth_Pri[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = defaultInitValue]
                                                  /\ conn_Priv' = [conn_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ hostMarker_PrivT' = [hostMarker_PrivT EXCEPT ![self] = defaultInitValue]
                                                  /\ daddr_Pri' = [daddr_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ hostidx_Pri' = [hostidx_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ hidx_Priv' = [hidx_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ otherEntry_Pri' = [otherEntry_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ i_Pri' = [i_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ indicies_Pri' = [indicies_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ new_sport_Pri' = [new_sport_Pri EXCEPT ![self] = defaultInitValue]
                                                  /\ good_' = [good_ EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "privtopubStart_"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet_"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_Pri, 
                                                                  pkt_PrivT, 
                                                                  conn_Priv, 
                                                                  hostMarker_PrivT, 
                                                                  daddr_Pri, 
                                                                  hostidx_Pri, 
                                                                  hidx_Priv, 
                                                                  otherEntry_Pri, 
                                                                  i_Pri, 
                                                                  indicies_Pri, 
                                                                  portDomain_Pri, 
                                                                  sourcePort_Pri, 
                                                                  destPort_Pri, 
                                                                  new_sport_Pri, 
                                                                  good_ >>
                                       /\ UNCHANGED <<depth_C, host_C, hidx_Co, host_idx, pidx, port_idx, depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub>>
                                    \/ /\ IF Len(SendQueue) > 0
                                             THEN /\ /\ depth_Pu' = [depth_Pu EXCEPT ![self] = depth_Ev[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PubToPriv",
                                                                                              pc        |->  "evtSeqRet_",
                                                                                              pkt_Pu    |->  pkt_Pu[self],
                                                                                              ipkt_Pu   |->  ipkt_Pu[self],
                                                                                              entry_Pu  |->  entry_Pu[self],
                                                                                              conn_Pub  |->  conn_Pub[self],
                                                                                              hostMarker_Pu |->  hostMarker_Pu[self],
                                                                                              ip_idx_Pu |->  ip_idx_Pu[self],
                                                                                              ipidx_Pu  |->  ipidx_Pu[self],
                                                                                              ip_Pub    |->  ip_Pub[self],
                                                                                              host_Pub  |->  host_Pub[self],
                                                                                              depth_Pu  |->  depth_Pu[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ pkt_Pu' = [pkt_Pu EXCEPT ![self] = defaultInitValue]
                                                  /\ ipkt_Pu' = [ipkt_Pu EXCEPT ![self] = defaultInitValue]
                                                  /\ entry_Pu' = [entry_Pu EXCEPT ![self] = defaultInitValue]
                                                  /\ conn_Pub' = [conn_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ hostMarker_Pu' = [hostMarker_Pu EXCEPT ![self] = defaultInitValue]
                                                  /\ ip_idx_Pu' = [ip_idx_Pu EXCEPT ![self] = defaultInitValue]
                                                  /\ ipidx_Pu' = [ipidx_Pu EXCEPT ![self] = defaultInitValue]
                                                  /\ ip_Pub' = [ip_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ host_Pub' = [host_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "pubtoprivStart_"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet_"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_Pu, 
                                                                  pkt_Pu, 
                                                                  ipkt_Pu, 
                                                                  entry_Pu, 
                                                                  conn_Pub, 
                                                                  hostMarker_Pu, 
                                                                  ip_idx_Pu, 
                                                                  ipidx_Pu, 
                                                                  ip_Pub, 
                                                                  host_Pub >>
                                       /\ UNCHANGED <<depth_C, host_C, hidx_Co, host_idx, pidx, port_idx, depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, depth_Pri, pkt_PrivT, conn_Priv, hostMarker_PrivT, daddr_Pri, hostidx_Pri, hidx_Priv, otherEntry_Pri, i_Pri, indicies_Pri, portDomain_Pri, sourcePort_Pri, destPort_Pri, new_sport_Pri, good_>>
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, depth_, 
                                      host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_E, i_E, j_, ip_E, host_E, 
                                      indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                      host_Ev, indecies_E, i_C, i_Ch, 
                                      depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                      conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                      ipidx_Pub, ip_PubT, host_PubT, 
                                      depth_Priv, pkt_PrivTo, conn_PrivT, 
                                      hostMarker_PrivTo, daddr_Priv, 
                                      hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, pkt, conn_PrivTo, 
                                      hostMarker, daddr, hostidx, hidx, 
                                      otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

evtSeqD0_(self) == /\ pc[self] = "evtSeqD0_"
                   /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                   /\ i_Ev' = [i_Ev EXCEPT ![self] = Head(stack[self]).i_Ev]
                   /\ j_E' = [j_E EXCEPT ![self] = Head(stack[self]).j_E]
                   /\ ip_Ev' = [ip_Ev EXCEPT ![self] = Head(stack[self]).ip_Ev]
                   /\ host_Ev' = [host_Ev EXCEPT ![self] = Head(stack[self]).host_Ev]
                   /\ indecies_E' = [indecies_E EXCEPT ![self] = Head(stack[self]).indecies_E]
                   /\ depth_Ev' = [depth_Ev EXCEPT ![self] = Head(stack[self]).depth_Ev]
                   /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_C, host_C, hidx_Co, 
                                   host_idx, pidx, port_idx, depth_Di, ip_D, 
                                   host_Di, connDomain, cidx, conn_Dis, 
                                   depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                   conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                   ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                   pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                   daddr_Pri, hostidx_Pri, hidx_Priv, 
                                   otherEntry_Pri, i_Pri, indicies_Pri, 
                                   portDomain_Pri, sourcePort_Pri, 
                                   destPort_Pri, new_sport_Pri, good_, depth_E, 
                                   i_E, j_, ip_E, host_E, indecies_, i_C, i_Ch, 
                                   depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                   conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                   ipidx_Pub, ip_PubT, host_PubT, depth_Priv, 
                                   pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, 
                                   daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                   otherEntry_Priv, i_Priv, indicies_Priv, 
                                   portDomain_Priv, sourcePort_Priv, 
                                   destPort_Priv, new_sport_Priv, depth_Eve, 
                                   i_Eve, j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                   depth_PubT, pkt_PubT, ipkt, entry, 
                                   conn_PubTo, hostMarker_PubT, ip_idx, ipidx, 
                                   ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                   conn_PrivTo, hostMarker, daddr, hostidx, 
                                   hidx, otherEntry, i_PrivT, indicies, 
                                   portDomain, sourcePort, destPort, new_sport, 
                                   good, depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

evtSeqRet_(self) == /\ pc[self] = "evtSeqRet_"
                    /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                    /\ i_Ev' = [i_Ev EXCEPT ![self] = Head(stack[self]).i_Ev]
                    /\ j_E' = [j_E EXCEPT ![self] = Head(stack[self]).j_E]
                    /\ ip_Ev' = [ip_Ev EXCEPT ![self] = Head(stack[self]).ip_Ev]
                    /\ host_Ev' = [host_Ev EXCEPT ![self] = Head(stack[self]).host_Ev]
                    /\ indecies_E' = [indecies_E EXCEPT ![self] = Head(stack[self]).indecies_E]
                    /\ depth_Ev' = [depth_Ev EXCEPT ![self] = Head(stack[self]).depth_Ev]
                    /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    i_C, i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                    entry_Pub, conn_PubT, hostMarker_Pub, 
                                    ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                    depth_Priv, pkt_PrivTo, conn_PrivT, 
                                    hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                    ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                    pkt_PubT, ipkt, entry, conn_PubTo, 
                                    hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                    host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                    hostMarker, daddr, hostidx, hidx, 
                                    otherEntry, i_PrivT, indicies, portDomain, 
                                    sourcePort, destPort, new_sport, good, 
                                    depth, i_Even, j, ip_Even, host_Even, 
                                    indecies, i_Che, i, aa >>

EventSequence(self) == evtSeqStart_(self) \/ evtSeqD0_(self)
                          \/ evtSeqRet_(self)

checkModelStart_(self) == /\ pc[self] = "checkModelStart_"
                          /\ i_C' = [i_C EXCEPT ![self] = 0]
                          /\ pc' = [pc EXCEPT ![self] = "checkModelWhile_"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_Ch, 
                                          depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

checkModelWhile_(self) == /\ pc[self] = "checkModelWhile_"
                          /\ IF i_C[self] < MAX
                                THEN /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = MAX]
                                        /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                                 pc        |->  "checkModelInc_",
                                                                                 i_Ev      |->  i_Ev[self],
                                                                                 j_E       |->  j_E[self],
                                                                                 ip_Ev     |->  ip_Ev[self],
                                                                                 host_Ev   |->  host_Ev[self],
                                                                                 indecies_E |->  indecies_E[self],
                                                                                 depth_Ev  |->  depth_Ev[self] ] >>
                                                                             \o stack[self]]
                                     /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                                     /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                                     /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                                     /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                                     /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                                     /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                                ELSE /\ pc' = [pc EXCEPT ![self] = "checkModelRet_"]
                                     /\ UNCHANGED << stack, depth_Ev, i_Ev, 
                                                     j_E, ip_Ev, host_Ev, 
                                                     indecies_E >>
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, depth_, host_, hidx_, 
                                          host_idx_, pidx_, port_idx_, depth_D, 
                                          ip_, host_D, connDomain_, cidx_, 
                                          conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, i_C, i_Ch, depth_Pub, 
                                          pkt_Pub, ipkt_Pub, entry_Pub, 
                                          conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

checkModelInc_(self) == /\ pc[self] = "checkModelInc_"
                        /\ i_C' = [i_C EXCEPT ![self] = i_C[self] + 1]
                        /\ pc' = [pc EXCEPT ![self] = "checkModelWhile_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, stack, 
                                        depth_, host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                        entry_Pub, conn_PubT, hostMarker_Pub, 
                                        ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                        host_PubT, depth_Priv, pkt_PrivTo, 
                                        conn_PrivT, hostMarker_PrivTo, 
                                        daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

checkModelRet_(self) == /\ pc[self] = "checkModelRet_"
                        /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                        /\ i_C' = [i_C EXCEPT ![self] = Head(stack[self]).i_C]
                        /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                        entry_Pub, conn_PubT, hostMarker_Pub, 
                                        ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                        host_PubT, depth_Priv, pkt_PrivTo, 
                                        conn_PrivT, hostMarker_PrivTo, 
                                        daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

CheckModel(self) == checkModelStart_(self) \/ checkModelWhile_(self)
                       \/ checkModelInc_(self) \/ checkModelRet_(self)

checkModelVulnStart_(self) == /\ pc[self] = "checkModelVulnStart_"
                              /\ i_Ch' = [i_Ch EXCEPT ![self] = 0]
                              /\ pc' = [pc EXCEPT ![self] = "checkModelVulnWhile_"]
                              /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                              Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                              Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                              Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                              H2, MaxPorts, EP1, PortMap1, EP2, 
                                              PortMap2, TableFull, 
                                              EvictionReroute, PortScanInv, 
                                              MaxTableSize, hosts, FreeHosts, 
                                              UsedHosts, Ports, ExtraPorts, 
                                              ExtraExtraPorts, T, FreeIPs, 
                                              UsedIPs, Connections, SendQueue, 
                                              RcvQueue, MAX, Marker1, Marker2, 
                                              CmdConnect, CmdDisconnect, 
                                              PortSpaceFull, stack, depth_, 
                                              host_, hidx_, host_idx_, pidx_, 
                                              port_idx_, depth_D, ip_, host_D, 
                                              connDomain_, cidx_, conn_, 
                                              host_Co, ip_C, hidx_C, 
                                              host_idx_C, pidx_C, port_idx_C, 
                                              host_Dis, ip_Di, connDomain_D, 
                                              cidx_D, conn_D, host, ip, 
                                              connDomain_Di, cidx_Di, conn_Di, 
                                              depth_P, pkt_, ipkt_, entry_, 
                                              conn_P, hostMarker_, ip_idx_, 
                                              ipidx_, ip_P, host_P, pkt_P, 
                                              ipkt_P, entry_P, conn_Pu, 
                                              hostMarker_P, ip_idx_P, ipidx_P, 
                                              ip_Pu, host_Pu, conn, sport, 
                                              dstAddr, dport, pkt_Pr, 
                                              hostMarker_Pr, daddr_, hostidx_, 
                                              hidx_P, otherEntry_, i_, 
                                              indicies_, portDomain_, 
                                              sourcePort_, destPort_, 
                                              new_sport_, depth_Pr, pkt_Pri, 
                                              conn_Pr, hostMarker_Pri, daddr_P, 
                                              hostidx_P, hidx_Pr, otherEntry_P, 
                                              i_P, indicies_P, portDomain_P, 
                                              sourcePort_P, destPort_P, 
                                              new_sport_P, pkt_Priv, conn_Pri, 
                                              hostMarker_Priv, daddr_Pr, 
                                              hostidx_Pr, hidx_Pri, 
                                              otherEntry_Pr, i_Pr, indicies_Pr, 
                                              portDomain_Pr, sourcePort_Pr, 
                                              destPort_Pr, new_sport_Pr, 
                                              depth_C, host_C, hidx_Co, 
                                              host_idx, pidx, port_idx, 
                                              depth_Di, ip_D, host_Di, 
                                              connDomain, cidx, conn_Dis, 
                                              depth_Pu, pkt_Pu, ipkt_Pu, 
                                              entry_Pu, conn_Pub, 
                                              hostMarker_Pu, ip_idx_Pu, 
                                              ipidx_Pu, ip_Pub, host_Pub, 
                                              depth_Pri, pkt_PrivT, conn_Priv, 
                                              hostMarker_PrivT, daddr_Pri, 
                                              hostidx_Pri, hidx_Priv, 
                                              otherEntry_Pri, i_Pri, 
                                              indicies_Pri, portDomain_Pri, 
                                              sourcePort_Pri, destPort_Pri, 
                                              new_sport_Pri, good_, depth_E, 
                                              i_E, j_, ip_E, host_E, indecies_, 
                                              depth_Ev, i_Ev, j_E, ip_Ev, 
                                              host_Ev, indecies_E, i_C, 
                                              depth_Pub, pkt_Pub, ipkt_Pub, 
                                              entry_Pub, conn_PubT, 
                                              hostMarker_Pub, ip_idx_Pub, 
                                              ipidx_Pub, ip_PubT, host_PubT, 
                                              depth_Priv, pkt_PrivTo, 
                                              conn_PrivT, hostMarker_PrivTo, 
                                              daddr_Priv, hostidx_Priv, 
                                              hidx_PrivT, otherEntry_Priv, 
                                              i_Priv, indicies_Priv, 
                                              portDomain_Priv, sourcePort_Priv, 
                                              destPort_Priv, new_sport_Priv, 
                                              depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                              host_Eve, indecies_Ev, 
                                              depth_PubT, pkt_PubT, ipkt, 
                                              entry, conn_PubTo, 
                                              hostMarker_PubT, ip_idx, ipidx, 
                                              ip_PubTo, host_PubTo, 
                                              depth_PrivT, pkt, conn_PrivTo, 
                                              hostMarker, daddr, hostidx, hidx, 
                                              otherEntry, i_PrivT, indicies, 
                                              portDomain, sourcePort, destPort, 
                                              new_sport, good, depth, i_Even, 
                                              j, ip_Even, host_Even, indecies, 
                                              i_Che, i, aa >>

checkModelVulnWhile_(self) == /\ pc[self] = "checkModelVulnWhile_"
                              /\ IF i_Ch[self] < MAX
                                    THEN /\ /\ depth_E' = [depth_E EXCEPT ![self] = MAX]
                                            /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                                     pc        |->  "checkModelVulnInc_",
                                                                                     i_E       |->  i_E[self],
                                                                                     j_        |->  j_[self],
                                                                                     ip_E      |->  ip_E[self],
                                                                                     host_E    |->  host_E[self],
                                                                                     indecies_ |->  indecies_[self],
                                                                                     depth_E   |->  depth_E[self] ] >>
                                                                                 \o stack[self]]
                                         /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                                         /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                                         /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                                         /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                                         /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                                         /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                                    ELSE /\ pc' = [pc EXCEPT ![self] = "checkModelVulnRet_"]
                                         /\ UNCHANGED << stack, depth_E, i_E, 
                                                         j_, ip_E, host_E, 
                                                         indecies_ >>
                              /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                              Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                              Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                              Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                              H2, MaxPorts, EP1, PortMap1, EP2, 
                                              PortMap2, TableFull, 
                                              EvictionReroute, PortScanInv, 
                                              MaxTableSize, hosts, FreeHosts, 
                                              UsedHosts, Ports, ExtraPorts, 
                                              ExtraExtraPorts, T, FreeIPs, 
                                              UsedIPs, Connections, SendQueue, 
                                              RcvQueue, MAX, Marker1, Marker2, 
                                              CmdConnect, CmdDisconnect, 
                                              PortSpaceFull, depth_, host_, 
                                              hidx_, host_idx_, pidx_, 
                                              port_idx_, depth_D, ip_, host_D, 
                                              connDomain_, cidx_, conn_, 
                                              host_Co, ip_C, hidx_C, 
                                              host_idx_C, pidx_C, port_idx_C, 
                                              host_Dis, ip_Di, connDomain_D, 
                                              cidx_D, conn_D, host, ip, 
                                              connDomain_Di, cidx_Di, conn_Di, 
                                              depth_P, pkt_, ipkt_, entry_, 
                                              conn_P, hostMarker_, ip_idx_, 
                                              ipidx_, ip_P, host_P, pkt_P, 
                                              ipkt_P, entry_P, conn_Pu, 
                                              hostMarker_P, ip_idx_P, ipidx_P, 
                                              ip_Pu, host_Pu, conn, sport, 
                                              dstAddr, dport, pkt_Pr, 
                                              hostMarker_Pr, daddr_, hostidx_, 
                                              hidx_P, otherEntry_, i_, 
                                              indicies_, portDomain_, 
                                              sourcePort_, destPort_, 
                                              new_sport_, depth_Pr, pkt_Pri, 
                                              conn_Pr, hostMarker_Pri, daddr_P, 
                                              hostidx_P, hidx_Pr, otherEntry_P, 
                                              i_P, indicies_P, portDomain_P, 
                                              sourcePort_P, destPort_P, 
                                              new_sport_P, pkt_Priv, conn_Pri, 
                                              hostMarker_Priv, daddr_Pr, 
                                              hostidx_Pr, hidx_Pri, 
                                              otherEntry_Pr, i_Pr, indicies_Pr, 
                                              portDomain_Pr, sourcePort_Pr, 
                                              destPort_Pr, new_sport_Pr, 
                                              depth_C, host_C, hidx_Co, 
                                              host_idx, pidx, port_idx, 
                                              depth_Di, ip_D, host_Di, 
                                              connDomain, cidx, conn_Dis, 
                                              depth_Pu, pkt_Pu, ipkt_Pu, 
                                              entry_Pu, conn_Pub, 
                                              hostMarker_Pu, ip_idx_Pu, 
                                              ipidx_Pu, ip_Pub, host_Pub, 
                                              depth_Pri, pkt_PrivT, conn_Priv, 
                                              hostMarker_PrivT, daddr_Pri, 
                                              hostidx_Pri, hidx_Priv, 
                                              otherEntry_Pri, i_Pri, 
                                              indicies_Pri, portDomain_Pri, 
                                              sourcePort_Pri, destPort_Pri, 
                                              new_sport_Pri, good_, depth_Ev, 
                                              i_Ev, j_E, ip_Ev, host_Ev, 
                                              indecies_E, i_C, i_Ch, depth_Pub, 
                                              pkt_Pub, ipkt_Pub, entry_Pub, 
                                              conn_PubT, hostMarker_Pub, 
                                              ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                              host_PubT, depth_Priv, 
                                              pkt_PrivTo, conn_PrivT, 
                                              hostMarker_PrivTo, daddr_Priv, 
                                              hostidx_Priv, hidx_PrivT, 
                                              otherEntry_Priv, i_Priv, 
                                              indicies_Priv, portDomain_Priv, 
                                              sourcePort_Priv, destPort_Priv, 
                                              new_sport_Priv, depth_Eve, i_Eve, 
                                              j_Ev, ip_Eve, host_Eve, 
                                              indecies_Ev, depth_PubT, 
                                              pkt_PubT, ipkt, entry, 
                                              conn_PubTo, hostMarker_PubT, 
                                              ip_idx, ipidx, ip_PubTo, 
                                              host_PubTo, depth_PrivT, pkt, 
                                              conn_PrivTo, hostMarker, daddr, 
                                              hostidx, hidx, otherEntry, 
                                              i_PrivT, indicies, portDomain, 
                                              sourcePort, destPort, new_sport, 
                                              good, depth, i_Even, j, ip_Even, 
                                              host_Even, indecies, i_Che, i, 
                                              aa >>

checkModelVulnInc_(self) == /\ pc[self] = "checkModelVulnInc_"
                            /\ i_Ch' = [i_Ch EXCEPT ![self] = i_Ch[self] + 1]
                            /\ pc' = [pc EXCEPT ![self] = "checkModelVulnWhile_"]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, stack, depth_, 
                                            host_, hidx_, host_idx_, pidx_, 
                                            port_idx_, depth_D, ip_, host_D, 
                                            connDomain_, cidx_, conn_, host_Co, 
                                            ip_C, hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

checkModelVulnRet_(self) == /\ pc[self] = "checkModelVulnRet_"
                            /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                            /\ i_Ch' = [i_Ch EXCEPT ![self] = Head(stack[self]).i_Ch]
                            /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, depth_, host_, 
                                            hidx_, host_idx_, pidx_, port_idx_, 
                                            depth_D, ip_, host_D, connDomain_, 
                                            cidx_, conn_, host_Co, ip_C, 
                                            hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth_PrivT, 
                                            pkt, conn_PrivTo, hostMarker, 
                                            daddr, hostidx, hidx, otherEntry, 
                                            i_PrivT, indicies, portDomain, 
                                            sourcePort, destPort, new_sport, 
                                            good, depth, i_Even, j, ip_Even, 
                                            host_Even, indecies, i_Che, i, aa >>

CheckModelVuln(self) == checkModelVulnStart_(self)
                           \/ checkModelVulnWhile_(self)
                           \/ checkModelVulnInc_(self)
                           \/ checkModelVulnRet_(self)

portscan1(self) == /\ pc[self] = "portscan1"
                   /\ /\ depth_C' = [depth_C EXCEPT ![self] = 0]
                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Connect",
                                                               pc        |->  "portscan2",
                                                               host_C    |->  host_C[self],
                                                               hidx_Co   |->  hidx_Co[self],
                                                               host_idx  |->  host_idx[self],
                                                               pidx      |->  pidx[self],
                                                               port_idx  |->  port_idx[self],
                                                               depth_C   |->  depth_C[self] ] >>
                                                           \o stack[self]]
                   /\ host_C' = [host_C EXCEPT ![self] = defaultInitValue]
                   /\ hidx_Co' = [hidx_Co EXCEPT ![self] = defaultInitValue]
                   /\ host_idx' = [host_idx EXCEPT ![self] = defaultInitValue]
                   /\ pidx' = [pidx EXCEPT ![self] = defaultInitValue]
                   /\ port_idx' = [port_idx EXCEPT ![self] = defaultInitValue]
                   /\ pc' = [pc EXCEPT ![self] = "connectStart"]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_Di, ip_D, host_Di, 
                                   connDomain, cidx, conn_Dis, depth_Pu, 
                                   pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                   hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                   host_Pub, depth_Pri, pkt_PrivT, conn_Priv, 
                                   hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                   hidx_Priv, otherEntry_Pri, i_Pri, 
                                   indicies_Pri, portDomain_Pri, 
                                   sourcePort_Pri, destPort_Pri, new_sport_Pri, 
                                   good_, depth_E, i_E, j_, ip_E, host_E, 
                                   indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                   host_Ev, indecies_E, i_C, i_Ch, depth_Pub, 
                                   pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                   hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                   ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                   conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                   hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                   i_Priv, indicies_Priv, portDomain_Priv, 
                                   sourcePort_Priv, destPort_Priv, 
                                   new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                   ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                   pkt_PubT, ipkt, entry, conn_PubTo, 
                                   hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                   host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                   hostMarker, daddr, hostidx, hidx, 
                                   otherEntry, i_PrivT, indicies, portDomain, 
                                   sourcePort, destPort, new_sport, good, 
                                   depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

portscan2(self) == /\ pc[self] = "portscan2"
                   /\ /\ depth_Pri' = [depth_Pri EXCEPT ![self] = 0]
                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PrivToPub",
                                                               pc        |->  "portscan3",
                                                               pkt_PrivT |->  pkt_PrivT[self],
                                                               conn_Priv |->  conn_Priv[self],
                                                               hostMarker_PrivT |->  hostMarker_PrivT[self],
                                                               daddr_Pri |->  daddr_Pri[self],
                                                               hostidx_Pri |->  hostidx_Pri[self],
                                                               hidx_Priv |->  hidx_Priv[self],
                                                               otherEntry_Pri |->  otherEntry_Pri[self],
                                                               i_Pri     |->  i_Pri[self],
                                                               indicies_Pri |->  indicies_Pri[self],
                                                               portDomain_Pri |->  portDomain_Pri[self],
                                                               sourcePort_Pri |->  sourcePort_Pri[self],
                                                               destPort_Pri |->  destPort_Pri[self],
                                                               new_sport_Pri |->  new_sport_Pri[self],
                                                               good_     |->  good_[self],
                                                               depth_Pri |->  depth_Pri[self] ] >>
                                                           \o stack[self]]
                   /\ pkt_PrivT' = [pkt_PrivT EXCEPT ![self] = defaultInitValue]
                   /\ conn_Priv' = [conn_Priv EXCEPT ![self] = defaultInitValue]
                   /\ hostMarker_PrivT' = [hostMarker_PrivT EXCEPT ![self] = defaultInitValue]
                   /\ daddr_Pri' = [daddr_Pri EXCEPT ![self] = defaultInitValue]
                   /\ hostidx_Pri' = [hostidx_Pri EXCEPT ![self] = defaultInitValue]
                   /\ hidx_Priv' = [hidx_Priv EXCEPT ![self] = defaultInitValue]
                   /\ otherEntry_Pri' = [otherEntry_Pri EXCEPT ![self] = defaultInitValue]
                   /\ i_Pri' = [i_Pri EXCEPT ![self] = defaultInitValue]
                   /\ indicies_Pri' = [indicies_Pri EXCEPT ![self] = defaultInitValue]
                   /\ portDomain_Pri' = [portDomain_Pri EXCEPT ![self] = defaultInitValue]
                   /\ sourcePort_Pri' = [sourcePort_Pri EXCEPT ![self] = defaultInitValue]
                   /\ destPort_Pri' = [destPort_Pri EXCEPT ![self] = defaultInitValue]
                   /\ new_sport_Pri' = [new_sport_Pri EXCEPT ![self] = defaultInitValue]
                   /\ good_' = [good_ EXCEPT ![self] = defaultInitValue]
                   /\ pc' = [pc EXCEPT ![self] = "privtopubStart_"]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_C, host_C, hidx_Co, 
                                   host_idx, pidx, port_idx, depth_Di, ip_D, 
                                   host_Di, connDomain, cidx, conn_Dis, 
                                   depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                   conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                   ipidx_Pu, ip_Pub, host_Pub, depth_E, i_E, 
                                   j_, ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                   j_E, ip_Ev, host_Ev, indecies_E, i_C, i_Ch, 
                                   depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                   conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                   ipidx_Pub, ip_PubT, host_PubT, depth_Priv, 
                                   pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, 
                                   daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                   otherEntry_Priv, i_Priv, indicies_Priv, 
                                   portDomain_Priv, sourcePort_Priv, 
                                   destPort_Priv, new_sport_Priv, depth_Eve, 
                                   i_Eve, j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                   depth_PubT, pkt_PubT, ipkt, entry, 
                                   conn_PubTo, hostMarker_PubT, ip_idx, ipidx, 
                                   ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                   conn_PrivTo, hostMarker, daddr, hostidx, 
                                   hidx, otherEntry, i_PrivT, indicies, 
                                   portDomain, sourcePort, destPort, new_sport, 
                                   good, depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

portscan3(self) == /\ pc[self] = "portscan3"
                   /\ /\ depth_Di' = [depth_Di EXCEPT ![self] = 0]
                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Disconnect",
                                                               pc        |->  "portscan4",
                                                               ip_D      |->  ip_D[self],
                                                               host_Di   |->  host_Di[self],
                                                               connDomain |->  connDomain[self],
                                                               cidx      |->  cidx[self],
                                                               conn_Dis  |->  conn_Dis[self],
                                                               depth_Di  |->  depth_Di[self] ] >>
                                                           \o stack[self]]
                   /\ ip_D' = [ip_D EXCEPT ![self] = defaultInitValue]
                   /\ host_Di' = [host_Di EXCEPT ![self] = defaultInitValue]
                   /\ connDomain' = [connDomain EXCEPT ![self] = defaultInitValue]
                   /\ cidx' = [cidx EXCEPT ![self] = defaultInitValue]
                   /\ conn_Dis' = [conn_Dis EXCEPT ![self] = defaultInitValue]
                   /\ pc' = [pc EXCEPT ![self] = "disconnectStart"]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_C, host_C, hidx_Co, 
                                   host_idx, pidx, port_idx, depth_Pu, pkt_Pu, 
                                   ipkt_Pu, entry_Pu, conn_Pub, hostMarker_Pu, 
                                   ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                   depth_Pri, pkt_PrivT, conn_Priv, 
                                   hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                   hidx_Priv, otherEntry_Pri, i_Pri, 
                                   indicies_Pri, portDomain_Pri, 
                                   sourcePort_Pri, destPort_Pri, new_sport_Pri, 
                                   good_, depth_E, i_E, j_, ip_E, host_E, 
                                   indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                   host_Ev, indecies_E, i_C, i_Ch, depth_Pub, 
                                   pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                   hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                   ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                   conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                   hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                   i_Priv, indicies_Priv, portDomain_Priv, 
                                   sourcePort_Priv, destPort_Priv, 
                                   new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                   ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                   pkt_PubT, ipkt, entry, conn_PubTo, 
                                   hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                   host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                   hostMarker, daddr, hostidx, hidx, 
                                   otherEntry, i_PrivT, indicies, portDomain, 
                                   sourcePort, destPort, new_sport, good, 
                                   depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

portscan4(self) == /\ pc[self] = "portscan4"
                   /\ /\ depth_C' = [depth_C EXCEPT ![self] = 0]
                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Connect",
                                                               pc        |->  "portscan5",
                                                               host_C    |->  host_C[self],
                                                               hidx_Co   |->  hidx_Co[self],
                                                               host_idx  |->  host_idx[self],
                                                               pidx      |->  pidx[self],
                                                               port_idx  |->  port_idx[self],
                                                               depth_C   |->  depth_C[self] ] >>
                                                           \o stack[self]]
                   /\ host_C' = [host_C EXCEPT ![self] = defaultInitValue]
                   /\ hidx_Co' = [hidx_Co EXCEPT ![self] = defaultInitValue]
                   /\ host_idx' = [host_idx EXCEPT ![self] = defaultInitValue]
                   /\ pidx' = [pidx EXCEPT ![self] = defaultInitValue]
                   /\ port_idx' = [port_idx EXCEPT ![self] = defaultInitValue]
                   /\ pc' = [pc EXCEPT ![self] = "connectStart"]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_Di, ip_D, host_Di, 
                                   connDomain, cidx, conn_Dis, depth_Pu, 
                                   pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                   hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                   host_Pub, depth_Pri, pkt_PrivT, conn_Priv, 
                                   hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                   hidx_Priv, otherEntry_Pri, i_Pri, 
                                   indicies_Pri, portDomain_Pri, 
                                   sourcePort_Pri, destPort_Pri, new_sport_Pri, 
                                   good_, depth_E, i_E, j_, ip_E, host_E, 
                                   indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                   host_Ev, indecies_E, i_C, i_Ch, depth_Pub, 
                                   pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                   hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                   ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                   conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                   hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                   i_Priv, indicies_Priv, portDomain_Priv, 
                                   sourcePort_Priv, destPort_Priv, 
                                   new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                   ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                   pkt_PubT, ipkt, entry, conn_PubTo, 
                                   hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                   host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                   hostMarker, daddr, hostidx, hidx, 
                                   otherEntry, i_PrivT, indicies, portDomain, 
                                   sourcePort, destPort, new_sport, good, 
                                   depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

portscan5(self) == /\ pc[self] = "portscan5"
                   /\ /\ depth_Pu' = [depth_Pu EXCEPT ![self] = 0]
                      /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PubToPriv",
                                                               pc        |->  Head(stack[self]).pc,
                                                               pkt_Pu    |->  pkt_Pu[self],
                                                               ipkt_Pu   |->  ipkt_Pu[self],
                                                               entry_Pu  |->  entry_Pu[self],
                                                               conn_Pub  |->  conn_Pub[self],
                                                               hostMarker_Pu |->  hostMarker_Pu[self],
                                                               ip_idx_Pu |->  ip_idx_Pu[self],
                                                               ipidx_Pu  |->  ipidx_Pu[self],
                                                               ip_Pub    |->  ip_Pub[self],
                                                               host_Pub  |->  host_Pub[self],
                                                               depth_Pu  |->  depth_Pu[self] ] >>
                                                           \o Tail(stack[self])]
                   /\ pkt_Pu' = [pkt_Pu EXCEPT ![self] = defaultInitValue]
                   /\ ipkt_Pu' = [ipkt_Pu EXCEPT ![self] = defaultInitValue]
                   /\ entry_Pu' = [entry_Pu EXCEPT ![self] = defaultInitValue]
                   /\ conn_Pub' = [conn_Pub EXCEPT ![self] = defaultInitValue]
                   /\ hostMarker_Pu' = [hostMarker_Pu EXCEPT ![self] = defaultInitValue]
                   /\ ip_idx_Pu' = [ip_idx_Pu EXCEPT ![self] = defaultInitValue]
                   /\ ipidx_Pu' = [ipidx_Pu EXCEPT ![self] = defaultInitValue]
                   /\ ip_Pub' = [ip_Pub EXCEPT ![self] = defaultInitValue]
                   /\ host_Pub' = [host_Pub EXCEPT ![self] = defaultInitValue]
                   /\ pc' = [pc EXCEPT ![self] = "pubtoprivStart_"]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_C, host_C, hidx_Co, 
                                   host_idx, pidx, port_idx, depth_Di, ip_D, 
                                   host_Di, connDomain, cidx, conn_Dis, 
                                   depth_Pri, pkt_PrivT, conn_Priv, 
                                   hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                   hidx_Priv, otherEntry_Pri, i_Pri, 
                                   indicies_Pri, portDomain_Pri, 
                                   sourcePort_Pri, destPort_Pri, new_sport_Pri, 
                                   good_, depth_E, i_E, j_, ip_E, host_E, 
                                   indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                   host_Ev, indecies_E, i_C, i_Ch, depth_Pub, 
                                   pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                   hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                   ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                   conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                   hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                   i_Priv, indicies_Priv, portDomain_Priv, 
                                   sourcePort_Priv, destPort_Priv, 
                                   new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                   ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                   pkt_PubT, ipkt, entry, conn_PubTo, 
                                   hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                   host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                   hostMarker, daddr, hostidx, hidx, 
                                   otherEntry, i_PrivT, indicies, portDomain, 
                                   sourcePort, destPort, new_sport, good, 
                                   depth, i_Even, j, ip_Even, host_Even, 
                                   indecies, i_Che, i, aa >>

PortScan(self) == portscan1(self) \/ portscan2(self) \/ portscan3(self)
                     \/ portscan4(self) \/ portscan5(self)

pubtoprivVEvt3(self) == /\ pc[self] = "pubtoprivVEvt3"
                        /\ /\ depth_E' = [depth_E EXCEPT ![self] = depth_Pub[self]]
                           /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                    pc        |->  "pubtoprivVStart",
                                                                    i_E       |->  i_E[self],
                                                                    j_        |->  j_[self],
                                                                    ip_E      |->  ip_E[self],
                                                                    host_E    |->  host_E[self],
                                                                    indecies_ |->  indecies_[self],
                                                                    depth_E   |->  depth_E[self] ] >>
                                                                \o stack[self]]
                        /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                        /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                        /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                        /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                        /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                        /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_Ev, i_Ev, 
                                        j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                        i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                        entry_Pub, conn_PubT, hostMarker_Pub, 
                                        ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                        host_PubT, depth_Priv, pkt_PrivTo, 
                                        conn_PrivT, hostMarker_PrivTo, 
                                        daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

pubtoprivVStart(self) == /\ pc[self] = "pubtoprivVStart"
                         /\ IF Len(SendQueue) > 0
                               THEN /\ pkt_Pub' = [pkt_Pub EXCEPT ![self] = Head(SendQueue)]
                                    /\ PrintT(<<"PubToPrivMan - Len(SendQueue) > 0:", pkt_Pub'[self], Connections, T>>)
                                    /\ SendQueue' = Tail(SendQueue)
                                    /\ IF Len(T) > 0
                                          THEN /\ PrintT(<<"PubToPrivMan - Len(T) > 0:">>)
                                               /\ entry_Pub' = [entry_Pub EXCEPT ![self] = SelectSeq(T, LAMBDA e: e.reply.saddr=pkt_Pub'[self].saddr /\
                                                                                                                  e.reply.sport=pkt_Pub'[self].sport /\
                                                                                                                  e.reply.daddr=pkt_Pub'[self].daddr /\
                                                                                                                  e.reply.dport=pkt_Pub'[self].dport)]
                                               /\ IF entry_Pub'[self]=defaultInitValue
                                                     THEN /\ pc' = [pc EXCEPT ![self] = "pubtirprivVDE"]
                                                     ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivEEmpty"]
                                          ELSE /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet"]
                                               /\ UNCHANGED entry_Pub
                               ELSE /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet"]
                                    /\ UNCHANGED << SendQueue, pkt_Pub, 
                                                    entry_Pub >>
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, RcvQueue, MAX, Marker1, 
                                         Marker2, CmdConnect, CmdDisconnect, 
                                         PortSpaceFull, stack, depth_, host_, 
                                         hidx_, host_idx_, pidx_, port_idx_, 
                                         depth_D, ip_, host_D, connDomain_, 
                                         cidx_, conn_, host_Co, ip_C, hidx_C, 
                                         host_idx_C, pidx_C, port_idx_C, 
                                         host_Dis, ip_Di, connDomain_D, cidx_D, 
                                         conn_D, host, ip, connDomain_Di, 
                                         cidx_Di, conn_Di, depth_P, pkt_, 
                                         ipkt_, entry_, conn_P, hostMarker_, 
                                         ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                         ipkt_P, entry_P, conn_Pu, 
                                         hostMarker_P, ip_idx_P, ipidx_P, 
                                         ip_Pu, host_Pu, conn, sport, dstAddr, 
                                         dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                         hostidx_, hidx_P, otherEntry_, i_, 
                                         indicies_, portDomain_, sourcePort_, 
                                         destPort_, new_sport_, depth_Pr, 
                                         pkt_Pri, conn_Pr, hostMarker_Pri, 
                                         daddr_P, hostidx_P, hidx_Pr, 
                                         otherEntry_P, i_P, indicies_P, 
                                         portDomain_P, sourcePort_P, 
                                         destPort_P, new_sport_P, pkt_Priv, 
                                         conn_Pri, hostMarker_Priv, daddr_Pr, 
                                         hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                         i_Pr, indicies_Pr, portDomain_Pr, 
                                         sourcePort_Pr, destPort_Pr, 
                                         new_sport_Pr, depth_C, host_C, 
                                         hidx_Co, host_idx, pidx, port_idx, 
                                         depth_Di, ip_D, host_Di, connDomain, 
                                         cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                         ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, ipkt_Pub, conn_PubT, 
                                         hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                         ip_PubT, host_PubT, depth_Priv, 
                                         pkt_PrivTo, conn_PrivT, 
                                         hostMarker_PrivTo, daddr_Priv, 
                                         hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

pubtoprivEEmpty(self) == /\ pc[self] = "pubtoprivEEmpty"
                         /\ IF Len(entry_Pub[self]) <= 0
                               THEN /\ PrintT(<<"PubToPrivVuln - Empty Entry">>)
                                    /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet"]
                               ELSE /\ PrintT(<<"PubToPrivMan - Len(entry) > -0:", entry_Pub[self], pkt_Pub[self]>>)
                                    /\ pc' = [pc EXCEPT ![self] = "pubtoPrivElse_Pub"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, stack, 
                                         depth_, host_, hidx_, host_idx_, 
                                         pidx_, port_idx_, depth_D, ip_, 
                                         host_D, connDomain_, cidx_, conn_, 
                                         host_Co, ip_C, hidx_C, host_idx_C, 
                                         pidx_C, port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i_Che, 
                                         i, aa >>

pubtoPrivElse_Pub(self) == /\ pc[self] = "pubtoPrivElse_Pub"
                           /\ entry_Pub' = [entry_Pub EXCEPT ![self] = Head(entry_Pub[self])]
                           /\ IF entry_Pub'[self].reply.dport=E
                                 THEN /\ PrintT(<<"PubToPrivMan - PortShadow: ", entry_Pub'[self], pkt_Pub[self]>>)
                                 ELSE /\ TRUE
                           /\ IF entry_Pub'[self].host_marker/=pkt_Pub[self].host_marker
                                 THEN /\ PrintT(<<"PubToPrivMan - entry.host_marker/=pkt.host_marker:", entry_Pub'[self], pkt_Pub[self]>>)
                                      /\ IF pkt_Pub[self].host_marker = H1
                                            THEN /\ Marker1' = entry_Pub'[self].host_marker
                                                 /\ UNCHANGED Marker2
                                            ELSE /\ Marker2' = entry_Pub'[self].host_marker
                                                 /\ UNCHANGED Marker1
                                      /\ PrintT(<<"PubToPrivMan-Eviction Error: pkt", pkt_Pub[self], " entry", entry_Pub'[self], "Connections:", Connections, "T: ", T>>)
                                 ELSE /\ TRUE
                                      /\ UNCHANGED << Marker1, Marker2 >>
                           /\ conn_PubT' = [conn_PubT EXCEPT ![self] = SelectSeq(Connections, LAMBDA e: entry_Pub'[self].orig.saddr = Head(e))]
                           /\ IF Len(conn_PubT'[self]) > 0
                                 THEN /\ pc' = [pc EXCEPT ![self] = "pubtoprivVConngt1"]
                                 ELSE /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, CmdConnect, 
                                           CmdDisconnect, PortSpaceFull, stack, 
                                           depth_, host_, hidx_, host_idx_, 
                                           pidx_, port_idx_, depth_D, ip_, 
                                           host_D, connDomain_, cidx_, conn_, 
                                           host_Co, ip_C, hidx_C, host_idx_C, 
                                           pidx_C, port_idx_C, host_Dis, ip_Di, 
                                           connDomain_D, cidx_D, conn_D, host, 
                                           ip, connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

pubtoprivVConngt1(self) == /\ pc[self] = "pubtoprivVConngt1"
                           /\ conn_PubT' = [conn_PubT EXCEPT ![self] = Head(conn_PubT[self])]
                           /\ pc' = [pc EXCEPT ![self] = "pubtoprivVConngt2"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, Marker1, Marker2, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, hostMarker_Pub, 
                                           ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                           host_PubT, depth_Priv, pkt_PrivTo, 
                                           conn_PrivT, hostMarker_PrivTo, 
                                           daddr_Priv, hostidx_Priv, 
                                           hidx_PrivT, otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

pubtoprivVConngt2(self) == /\ pc[self] = "pubtoprivVConngt2"
                           /\ hostMarker_Pub' = [hostMarker_Pub EXCEPT ![self] = conn_PubT[self][2]]
                           /\ IF hostMarker_Pub'[self] = H1
                                 THEN /\ IF entry_Pub[self].host_marker = H2
                                            THEN /\ PortScanInv' = TRUE
                                            ELSE /\ TRUE
                                                 /\ UNCHANGED PortScanInv
                                      /\ Marker1' = entry_Pub[self].host_marker
                                      /\ UNCHANGED Marker2
                                 ELSE /\ IF entry_Pub[self].host_marker = H1
                                            THEN /\ PortScanInv' = TRUE
                                            ELSE /\ TRUE
                                                 /\ UNCHANGED PortScanInv
                                      /\ Marker2' = entry_Pub[self].host_marker
                                      /\ UNCHANGED Marker1
                           /\ pc' = [pc EXCEPT ![self] = "pubtopriVvRet"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, MaxTableSize, 
                                           hosts, FreeHosts, UsedHosts, Ports, 
                                           ExtraPorts, ExtraExtraPorts, T, 
                                           FreeIPs, UsedIPs, Connections, 
                                           SendQueue, RcvQueue, MAX, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

pubtirprivVDE(self) == /\ pc[self] = "pubtirprivVDE"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ pkt_Pub' = [pkt_Pub EXCEPT ![self] = Head(stack[self]).pkt_Pub]
                       /\ ipkt_Pub' = [ipkt_Pub EXCEPT ![self] = Head(stack[self]).ipkt_Pub]
                       /\ entry_Pub' = [entry_Pub EXCEPT ![self] = Head(stack[self]).entry_Pub]
                       /\ conn_PubT' = [conn_PubT EXCEPT ![self] = Head(stack[self]).conn_PubT]
                       /\ hostMarker_Pub' = [hostMarker_Pub EXCEPT ![self] = Head(stack[self]).hostMarker_Pub]
                       /\ ip_idx_Pub' = [ip_idx_Pub EXCEPT ![self] = Head(stack[self]).ip_idx_Pub]
                       /\ ipidx_Pub' = [ipidx_Pub EXCEPT ![self] = Head(stack[self]).ipidx_Pub]
                       /\ ip_PubT' = [ip_PubT EXCEPT ![self] = Head(stack[self]).ip_PubT]
                       /\ host_PubT' = [host_PubT EXCEPT ![self] = Head(stack[self]).host_PubT]
                       /\ depth_Pub' = [depth_Pub EXCEPT ![self] = Head(stack[self]).depth_Pub]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

pubtopriVvRet(self) == /\ pc[self] = "pubtopriVvRet"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ pkt_Pub' = [pkt_Pub EXCEPT ![self] = Head(stack[self]).pkt_Pub]
                       /\ ipkt_Pub' = [ipkt_Pub EXCEPT ![self] = Head(stack[self]).ipkt_Pub]
                       /\ entry_Pub' = [entry_Pub EXCEPT ![self] = Head(stack[self]).entry_Pub]
                       /\ conn_PubT' = [conn_PubT EXCEPT ![self] = Head(stack[self]).conn_PubT]
                       /\ hostMarker_Pub' = [hostMarker_Pub EXCEPT ![self] = Head(stack[self]).hostMarker_Pub]
                       /\ ip_idx_Pub' = [ip_idx_Pub EXCEPT ![self] = Head(stack[self]).ip_idx_Pub]
                       /\ ipidx_Pub' = [ipidx_Pub EXCEPT ![self] = Head(stack[self]).ipidx_Pub]
                       /\ ip_PubT' = [ip_PubT EXCEPT ![self] = Head(stack[self]).ip_PubT]
                       /\ host_PubT' = [host_PubT EXCEPT ![self] = Head(stack[self]).host_PubT]
                       /\ depth_Pub' = [depth_Pub EXCEPT ![self] = Head(stack[self]).depth_Pub]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

PubToPrivExitVuln(self) == pubtoprivVEvt3(self) \/ pubtoprivVStart(self)
                              \/ pubtoprivEEmpty(self)
                              \/ pubtoPrivElse_Pub(self)
                              \/ pubtoprivVConngt1(self)
                              \/ pubtoprivVConngt2(self)
                              \/ pubtirprivVDE(self) \/ pubtopriVvRet(self)

privtopubV3(self) == /\ pc[self] = "privtopubV3"
                     /\ /\ depth_E' = [depth_E EXCEPT ![self] = depth_Priv[self]]
                        /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceVuln",
                                                                 pc        |->  "privtopubManStart",
                                                                 i_E       |->  i_E[self],
                                                                 j_        |->  j_[self],
                                                                 ip_E      |->  ip_E[self],
                                                                 host_E    |->  host_E[self],
                                                                 indecies_ |->  indecies_[self],
                                                                 depth_E   |->  depth_E[self] ] >>
                                                             \o stack[self]]
                     /\ i_E' = [i_E EXCEPT ![self] = defaultInitValue]
                     /\ j_' = [j_ EXCEPT ![self] = defaultInitValue]
                     /\ ip_E' = [ip_E EXCEPT ![self] = defaultInitValue]
                     /\ host_E' = [host_E EXCEPT ![self] = defaultInitValue]
                     /\ indecies_' = [indecies_ EXCEPT ![self] = defaultInitValue]
                     /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart_"]
                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                     Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                     Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                     Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                     PortMap2, TableFull, EvictionReroute, 
                                     PortScanInv, MaxTableSize, hosts, 
                                     FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                     ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                     Connections, SendQueue, RcvQueue, MAX, 
                                     Marker1, Marker2, CmdConnect, 
                                     CmdDisconnect, PortSpaceFull, depth_, 
                                     host_, hidx_, host_idx_, pidx_, port_idx_, 
                                     depth_D, ip_, host_D, connDomain_, cidx_, 
                                     conn_, host_Co, ip_C, hidx_C, host_idx_C, 
                                     pidx_C, port_idx_C, host_Dis, ip_Di, 
                                     connDomain_D, cidx_D, conn_D, host, ip, 
                                     connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                     pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                     ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                     ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                     ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                     sport, dstAddr, dport, pkt_Pr, 
                                     hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                     otherEntry_, i_, indicies_, portDomain_, 
                                     sourcePort_, destPort_, new_sport_, 
                                     depth_Pr, pkt_Pri, conn_Pr, 
                                     hostMarker_Pri, daddr_P, hostidx_P, 
                                     hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                     portDomain_P, sourcePort_P, destPort_P, 
                                     new_sport_P, pkt_Priv, conn_Pri, 
                                     hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                     hidx_Pri, otherEntry_Pr, i_Pr, 
                                     indicies_Pr, portDomain_Pr, sourcePort_Pr, 
                                     destPort_Pr, new_sport_Pr, depth_C, 
                                     host_C, hidx_Co, host_idx, pidx, port_idx, 
                                     depth_Di, ip_D, host_Di, connDomain, cidx, 
                                     conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                     entry_Pu, conn_Pub, hostMarker_Pu, 
                                     ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                     depth_Pri, pkt_PrivT, conn_Priv, 
                                     hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                     hidx_Priv, otherEntry_Pri, i_Pri, 
                                     indicies_Pri, portDomain_Pri, 
                                     sourcePort_Pri, destPort_Pri, 
                                     new_sport_Pri, good_, depth_Ev, i_Ev, j_E, 
                                     ip_Ev, host_Ev, indecies_E, i_C, i_Ch, 
                                     depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, 
                                     conn_PubT, hostMarker_Pub, ip_idx_Pub, 
                                     ipidx_Pub, ip_PubT, host_PubT, depth_Priv, 
                                     pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, 
                                     daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                     otherEntry_Priv, i_Priv, indicies_Priv, 
                                     portDomain_Priv, sourcePort_Priv, 
                                     destPort_Priv, new_sport_Priv, depth_Eve, 
                                     i_Eve, j_Ev, ip_Eve, host_Eve, 
                                     indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                     entry, conn_PubTo, hostMarker_PubT, 
                                     ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                     depth_PrivT, pkt, conn_PrivTo, hostMarker, 
                                     daddr, hostidx, hidx, otherEntry, i_PrivT, 
                                     indicies, portDomain, sourcePort, 
                                     destPort, new_sport, good, depth, i_Even, 
                                     j, ip_Even, host_Even, indecies, i_Che, i, 
                                     aa >>

privtopubManStart(self) == /\ pc[self] = "privtopubManStart"
                           /\ IF Len (Connections) > 0
                                 THEN /\ indicies_Priv' = [indicies_Priv EXCEPT ![self] = DOMAIN Connections]
                                      /\ portDomain_Priv' = [portDomain_Priv EXCEPT ![self] = DOMAIN Ports]
                                      /\ sourcePort_Priv' = [sourcePort_Priv EXCEPT ![self] = CHOOSE pr \in portDomain_Priv'[self] : TRUE]
                                      /\ i_Priv' = [i_Priv EXCEPT ![self] = CHOOSE f \in indicies_Priv'[self] : TRUE]
                                      /\ PrintT(<<"PrivToPub - conn", indecies[self], conn_PrivT[self], Connections>>)
                                      /\ pc' = [pc EXCEPT ![self] = "privtopubConn_Pr"]
                                 ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet_Pri"]
                                      /\ UNCHANGED << i_Priv, indicies_Priv, 
                                                      portDomain_Priv, 
                                                      sourcePort_Priv >>
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, Marker1, Marker2, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privtopubConn_Pr(self) == /\ pc[self] = "privtopubConn_Pr"
                          /\ conn_PrivT' = [conn_PrivT EXCEPT ![self] = Connections[i_Priv[self]]]
                          /\ sourcePort_Priv' = [sourcePort_Priv EXCEPT ![self] = Ports[sourcePort_Priv[self]]]
                          /\ portDomain_Priv' = [portDomain_Priv EXCEPT ![self] = DOMAIN Ports]
                          /\ destPort_Priv' = [destPort_Priv EXCEPT ![self] = CHOOSE h \in portDomain_Priv'[self] : TRUE]
                          /\ pc' = [pc EXCEPT ![self] = "privtopubDport_Pr"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          hostMarker_PrivTo, daddr_Priv, 
                                          hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, new_sport_Priv, 
                                          depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                          host_Eve, indecies_Ev, depth_PubT, 
                                          pkt_PubT, ipkt, entry, conn_PubTo, 
                                          hostMarker_PubT, ip_idx, ipidx, 
                                          ip_PubTo, host_PubTo, depth_PrivT, 
                                          pkt, conn_PrivTo, hostMarker, daddr, 
                                          hostidx, hidx, otherEntry, i_PrivT, 
                                          indicies, portDomain, sourcePort, 
                                          destPort, new_sport, good, depth, 
                                          i_Even, j, ip_Even, host_Even, 
                                          indecies, i_Che, i, aa >>

privtopubDport_Pr(self) == /\ pc[self] = "privtopubDport_Pr"
                           /\ destPort_Priv' = [destPort_Priv EXCEPT ![self] = Ports[destPort_Priv[self]]]
                           /\ hostidx_Priv' = [hostidx_Priv EXCEPT ![self] = DOMAIN hosts]
                           /\ hidx_PrivT' = [hidx_PrivT EXCEPT ![self] = CHOOSE hid \in hostidx_Priv'[self] : TRUE]
                           /\ daddr_Priv' = [daddr_Priv EXCEPT ![self] = hosts[hidx_PrivT'[self]]]
                           /\ PrintT(<<"PrivToPubVuln - Conn: ", conn_PrivT[self]>>)
                           /\ hostMarker_PrivTo' = [hostMarker_PrivTo EXCEPT ![self] = Head(Tail(conn_PrivT[self]))]
                           /\ pkt_PrivTo' = [pkt_PrivTo EXCEPT ![self] = [saddr |-> Head(conn_PrivT[self]), sport |-> sourcePort_Priv[self],
                                                                          daddr |-> daddr_Priv'[self], dport |-> destPort_Priv'[self],
                                                                          host_marker |-> hostMarker_PrivTo'[self]
                                                                         ]]
                           /\ PrintT(<<"PrivToPubMan - pkt: ", conn_PrivT[self], pkt_PrivTo'[self]>>)
                           /\ entry' = [entry EXCEPT ![self] = [host_marker |-> hostMarker_PrivTo'[self],
                                                                orig |-> [saddr |-> pkt_PrivTo'[self].saddr, sport |-> pkt_PrivTo'[self].sport,
                                                                          daddr |-> pkt_PrivTo'[self].daddr, dport |-> pkt_PrivTo'[self].dport],
                                                                reply |-> [saddr |-> pkt_PrivTo'[self].daddr, sport |-> pkt_PrivTo'[self].dport,
                                                                           daddr |-> E,  dport |-> pkt_PrivTo'[self].sport ]]]
                           /\ otherEntry_Priv' = [otherEntry_Priv EXCEPT ![self] = SelectSeq(T, LAMBDA k: k.reply.saddr=pkt_PrivTo'[self].daddr /\ k.reply.sport=pkt_PrivTo'[self].dport /\
                                                                                                          k.reply.daddr=E /\ k.reply.dport=pkt_PrivTo'[self].sport /\ k.host_marker /= hostMarker_PrivTo'[self])]
                           /\ PrintT(<<"PrivToPub - T", T, otherEntry_Priv'[self], pkt_PrivTo'[self]>>)
                           /\ IF Len(otherEntry_Priv'[self]) > 0
                                 THEN /\ T' = SelectSeq(T, LAMBDA e: ~(e.reply.saddr=pkt_PrivTo'[self].daddr /\ e.reply.sport=pkt_PrivTo'[self].dport /\
                                                                       e.reply.daddr=E /\ e.reply.dport=pkt_PrivTo'[self].sport) )
                                 ELSE /\ TRUE
                                      /\ T' = T
                           /\ pc' = [pc EXCEPT ![self] = "privtoPubManAddT"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, FreeIPs, UsedIPs, 
                                           Connections, SendQueue, RcvQueue, 
                                           MAX, Marker1, Marker2, CmdConnect, 
                                           CmdDisconnect, PortSpaceFull, stack, 
                                           depth_, host_, hidx_, host_idx_, 
                                           pidx_, port_idx_, depth_D, ip_, 
                                           host_D, connDomain_, cidx_, conn_, 
                                           host_Co, ip_C, hidx_C, host_idx_C, 
                                           pidx_C, port_idx_C, host_Dis, ip_Di, 
                                           connDomain_D, cidx_D, conn_D, host, 
                                           ip, connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, conn_PrivT, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, new_sport_Priv, 
                                           depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                           host_Eve, indecies_Ev, depth_PubT, 
                                           pkt_PubT, ipkt, conn_PubTo, 
                                           hostMarker_PubT, ip_idx, ipidx, 
                                           ip_PubTo, host_PubTo, depth_PrivT, 
                                           pkt, conn_PrivTo, hostMarker, daddr, 
                                           hostidx, hidx, otherEntry, i_PrivT, 
                                           indicies, portDomain, sourcePort, 
                                           destPort, new_sport, good, depth, 
                                           i_Even, j, ip_Even, host_Even, 
                                           indecies, i_Che, i, aa >>

privtoPubManAddT(self) == /\ pc[self] = "privtoPubManAddT"
                          /\ T' = Append(T, entry[self])
                          /\ IF Len(T') > MaxTableSize
                                THEN /\ TableFull' = TRUE
                                ELSE /\ TRUE
                                     /\ UNCHANGED TableFull
                          /\ pc' = [pc EXCEPT ![self] = "privtopubPkt_Priv"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          EvictionReroute, PortScanInv, 
                                          MaxTableSize, hosts, FreeHosts, 
                                          UsedHosts, Ports, ExtraPorts, 
                                          ExtraExtraPorts, FreeIPs, UsedIPs, 
                                          Connections, SendQueue, RcvQueue, 
                                          MAX, Marker1, Marker2, CmdConnect, 
                                          CmdDisconnect, PortSpaceFull, stack, 
                                          depth_, host_, hidx_, host_idx_, 
                                          pidx_, port_idx_, depth_D, ip_, 
                                          host_D, connDomain_, cidx_, conn_, 
                                          host_Co, ip_C, hidx_C, host_idx_C, 
                                          pidx_C, port_idx_C, host_Dis, ip_Di, 
                                          connDomain_D, cidx_D, conn_D, host, 
                                          ip, connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

privtopubPkt_Priv(self) == /\ pc[self] = "privtopubPkt_Priv"
                           /\ pkt_PrivTo' = [pkt_PrivTo EXCEPT ![self] = [saddr |->pkt_PrivTo[self].daddr, sport |-> pkt_PrivTo[self].dport,
                                                                          daddr |-> E, dport |-> pkt_PrivTo[self].sport,
                                                                          host_marker |-> hostMarker_PrivTo[self]]]
                           /\ SendQueue' = Append(SendQueue, pkt_PrivTo'[self])
                           /\ pc' = [pc EXCEPT ![self] = "privtopubRet_Pri"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, RcvQueue, MAX, 
                                           Marker1, Marker2, CmdConnect, 
                                           CmdDisconnect, PortSpaceFull, stack, 
                                           depth_, host_, hidx_, host_idx_, 
                                           pidx_, port_idx_, depth_D, ip_, 
                                           host_D, connDomain_, cidx_, conn_, 
                                           host_Co, ip_C, hidx_C, host_idx_C, 
                                           pidx_C, port_idx_C, host_Dis, ip_Di, 
                                           connDomain_D, cidx_D, conn_D, host, 
                                           ip, connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           i, aa >>

privtopubRet_Pri(self) == /\ pc[self] = "privtopubRet_Pri"
                          /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                          /\ pkt_PrivTo' = [pkt_PrivTo EXCEPT ![self] = Head(stack[self]).pkt_PrivTo]
                          /\ conn_PrivT' = [conn_PrivT EXCEPT ![self] = Head(stack[self]).conn_PrivT]
                          /\ hostMarker_PrivTo' = [hostMarker_PrivTo EXCEPT ![self] = Head(stack[self]).hostMarker_PrivTo]
                          /\ daddr_Priv' = [daddr_Priv EXCEPT ![self] = Head(stack[self]).daddr_Priv]
                          /\ hostidx_Priv' = [hostidx_Priv EXCEPT ![self] = Head(stack[self]).hostidx_Priv]
                          /\ hidx_PrivT' = [hidx_PrivT EXCEPT ![self] = Head(stack[self]).hidx_PrivT]
                          /\ otherEntry_Priv' = [otherEntry_Priv EXCEPT ![self] = Head(stack[self]).otherEntry_Priv]
                          /\ i_Priv' = [i_Priv EXCEPT ![self] = Head(stack[self]).i_Priv]
                          /\ indicies_Priv' = [indicies_Priv EXCEPT ![self] = Head(stack[self]).indicies_Priv]
                          /\ portDomain_Priv' = [portDomain_Priv EXCEPT ![self] = Head(stack[self]).portDomain_Priv]
                          /\ sourcePort_Priv' = [sourcePort_Priv EXCEPT ![self] = Head(stack[self]).sourcePort_Priv]
                          /\ destPort_Priv' = [destPort_Priv EXCEPT ![self] = Head(stack[self]).destPort_Priv]
                          /\ new_sport_Priv' = [new_sport_Priv EXCEPT ![self] = Head(stack[self]).new_sport_Priv]
                          /\ depth_Priv' = [depth_Priv EXCEPT ![self] = Head(stack[self]).depth_Priv]
                          /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, depth_, host_, hidx_, 
                                          host_idx_, pidx_, port_idx_, depth_D, 
                                          ip_, host_D, connDomain_, cidx_, 
                                          conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Eve, i_Eve, j_Ev, 
                                          ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

PrivToPubExitVuln(self) == privtopubV3(self) \/ privtopubManStart(self)
                              \/ privtopubConn_Pr(self)
                              \/ privtopubDport_Pr(self)
                              \/ privtoPubManAddT(self)
                              \/ privtopubPkt_Priv(self)
                              \/ privtopubRet_Pri(self)

evtSeqVStart(self) == /\ pc[self] = "evtSeqVStart"
                      /\ IF depth_Eve[self] <= 0
                            THEN /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                                 /\ i_Eve' = [i_Eve EXCEPT ![self] = Head(stack[self]).i_Eve]
                                 /\ j_Ev' = [j_Ev EXCEPT ![self] = Head(stack[self]).j_Ev]
                                 /\ ip_Eve' = [ip_Eve EXCEPT ![self] = Head(stack[self]).ip_Eve]
                                 /\ host_Eve' = [host_Eve EXCEPT ![self] = Head(stack[self]).host_Eve]
                                 /\ indecies_Ev' = [indecies_Ev EXCEPT ![self] = Head(stack[self]).indecies_Ev]
                                 /\ depth_Eve' = [depth_Eve EXCEPT ![self] = Head(stack[self]).depth_Eve]
                                 /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                                 /\ UNCHANGED << depth_, host_, hidx_, 
                                                 host_idx_, pidx_, port_idx_, 
                                                 depth_D, ip_, host_D, 
                                                 connDomain_, cidx_, conn_, 
                                                 depth_Pub, pkt_Pub, ipkt_Pub, 
                                                 entry_Pub, conn_PubT, 
                                                 hostMarker_Pub, ip_idx_Pub, 
                                                 ipidx_Pub, ip_PubT, host_PubT, 
                                                 depth_Priv, pkt_PrivTo, 
                                                 conn_PrivT, hostMarker_PrivTo, 
                                                 daddr_Priv, hostidx_Priv, 
                                                 hidx_PrivT, otherEntry_Priv, 
                                                 i_Priv, indicies_Priv, 
                                                 portDomain_Priv, 
                                                 sourcePort_Priv, 
                                                 destPort_Priv, new_sport_Priv >>
                            ELSE /\ \/ /\ IF Len(FreeIPs) > 0
                                             THEN /\ PrintT(<<"EventSequenceVuln - depth = ", depth_Eve[self]>>)
                                                  /\ /\ depth_' = [depth_ EXCEPT ![self] = depth_Eve[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "ConnectVuln",
                                                                                              pc        |->  "evtSeqVRet",
                                                                                              host_     |->  host_[self],
                                                                                              hidx_     |->  hidx_[self],
                                                                                              host_idx_ |->  host_idx_[self],
                                                                                              pidx_     |->  pidx_[self],
                                                                                              port_idx_ |->  port_idx_[self],
                                                                                              depth_    |->  depth_[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ host_' = [host_ EXCEPT ![self] = defaultInitValue]
                                                  /\ hidx_' = [hidx_ EXCEPT ![self] = defaultInitValue]
                                                  /\ host_idx_' = [host_idx_ EXCEPT ![self] = defaultInitValue]
                                                  /\ pidx_' = [pidx_ EXCEPT ![self] = defaultInitValue]
                                                  /\ port_idx_' = [port_idx_ EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "connectVEvtSeqV"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_, 
                                                                  host_, hidx_, 
                                                                  host_idx_, 
                                                                  pidx_, 
                                                                  port_idx_ >>
                                       /\ UNCHANGED <<depth_D, ip_, host_D, connDomain_, cidx_, conn_, depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, hostMarker_Pub, ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, daddr_Priv, hostidx_Priv, hidx_PrivT, otherEntry_Priv, i_Priv, indicies_Priv, portDomain_Priv, sourcePort_Priv, destPort_Priv, new_sport_Priv>>
                                    \/ /\ IF Len (Connections) > 0
                                             THEN /\ PrintT(<<"EventSequenceVuln - Disconnect", Connections>>)
                                                  /\ /\ depth_D' = [depth_D EXCEPT ![self] = depth_Eve[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "DisconnectVuln",
                                                                                              pc        |->  "evtSeqVRet",
                                                                                              ip_       |->  ip_[self],
                                                                                              host_D    |->  host_D[self],
                                                                                              connDomain_ |->  connDomain_[self],
                                                                                              cidx_     |->  cidx_[self],
                                                                                              conn_     |->  conn_[self],
                                                                                              depth_D   |->  depth_D[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ ip_' = [ip_ EXCEPT ![self] = defaultInitValue]
                                                  /\ host_D' = [host_D EXCEPT ![self] = defaultInitValue]
                                                  /\ connDomain_' = [connDomain_ EXCEPT ![self] = defaultInitValue]
                                                  /\ cidx_' = [cidx_ EXCEPT ![self] = defaultInitValue]
                                                  /\ conn_' = [conn_ EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "disconnectVEvtSV"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_D, ip_, 
                                                                  host_D, 
                                                                  connDomain_, 
                                                                  cidx_, conn_ >>
                                       /\ UNCHANGED <<depth_, host_, hidx_, host_idx_, pidx_, port_idx_, depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, hostMarker_Pub, ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, daddr_Priv, hostidx_Priv, hidx_PrivT, otherEntry_Priv, i_Priv, indicies_Priv, portDomain_Priv, sourcePort_Priv, destPort_Priv, new_sport_Priv>>
                                    \/ /\ IF Len(Connections) > 0
                                             THEN /\ PrintT(<<"EventSequenceVuln - PrivToPubVuln:", Connections>>)
                                                  /\ /\ depth_Priv' = [depth_Priv EXCEPT ![self] = depth_Eve[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PrivToPubExitVuln",
                                                                                              pc        |->  "evtSeqVRet",
                                                                                              pkt_PrivTo |->  pkt_PrivTo[self],
                                                                                              conn_PrivT |->  conn_PrivT[self],
                                                                                              hostMarker_PrivTo |->  hostMarker_PrivTo[self],
                                                                                              daddr_Priv |->  daddr_Priv[self],
                                                                                              hostidx_Priv |->  hostidx_Priv[self],
                                                                                              hidx_PrivT |->  hidx_PrivT[self],
                                                                                              otherEntry_Priv |->  otherEntry_Priv[self],
                                                                                              i_Priv    |->  i_Priv[self],
                                                                                              indicies_Priv |->  indicies_Priv[self],
                                                                                              portDomain_Priv |->  portDomain_Priv[self],
                                                                                              sourcePort_Priv |->  sourcePort_Priv[self],
                                                                                              destPort_Priv |->  destPort_Priv[self],
                                                                                              new_sport_Priv |->  new_sport_Priv[self],
                                                                                              depth_Priv |->  depth_Priv[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ pkt_PrivTo' = [pkt_PrivTo EXCEPT ![self] = defaultInitValue]
                                                  /\ conn_PrivT' = [conn_PrivT EXCEPT ![self] = defaultInitValue]
                                                  /\ hostMarker_PrivTo' = [hostMarker_PrivTo EXCEPT ![self] = defaultInitValue]
                                                  /\ daddr_Priv' = [daddr_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ hostidx_Priv' = [hostidx_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ hidx_PrivT' = [hidx_PrivT EXCEPT ![self] = defaultInitValue]
                                                  /\ otherEntry_Priv' = [otherEntry_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ i_Priv' = [i_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ indicies_Priv' = [indicies_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ portDomain_Priv' = [portDomain_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ sourcePort_Priv' = [sourcePort_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ destPort_Priv' = [destPort_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ new_sport_Priv' = [new_sport_Priv EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "privtopubV3"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_Priv, 
                                                                  pkt_PrivTo, 
                                                                  conn_PrivT, 
                                                                  hostMarker_PrivTo, 
                                                                  daddr_Priv, 
                                                                  hostidx_Priv, 
                                                                  hidx_PrivT, 
                                                                  otherEntry_Priv, 
                                                                  i_Priv, 
                                                                  indicies_Priv, 
                                                                  portDomain_Priv, 
                                                                  sourcePort_Priv, 
                                                                  destPort_Priv, 
                                                                  new_sport_Priv >>
                                       /\ UNCHANGED <<depth_, host_, hidx_, host_idx_, pidx_, port_idx_, depth_D, ip_, host_D, connDomain_, cidx_, conn_, depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, hostMarker_Pub, ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT>>
                                    \/ /\ IF Len(SendQueue) > 0
                                             THEN /\ PrintT(<<"EventSequenceVuln - PubToPrivVuln: depth - ", depth_Eve[self], SendQueue>>)
                                                  /\ /\ depth_Pub' = [depth_Pub EXCEPT ![self] = depth_Eve[self] - 1]
                                                     /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PubToPrivExitVuln",
                                                                                              pc        |->  "evtSeqVRet",
                                                                                              pkt_Pub   |->  pkt_Pub[self],
                                                                                              ipkt_Pub  |->  ipkt_Pub[self],
                                                                                              entry_Pub |->  entry_Pub[self],
                                                                                              conn_PubT |->  conn_PubT[self],
                                                                                              hostMarker_Pub |->  hostMarker_Pub[self],
                                                                                              ip_idx_Pub |->  ip_idx_Pub[self],
                                                                                              ipidx_Pub |->  ipidx_Pub[self],
                                                                                              ip_PubT   |->  ip_PubT[self],
                                                                                              host_PubT |->  host_PubT[self],
                                                                                              depth_Pub |->  depth_Pub[self] ] >>
                                                                                          \o stack[self]]
                                                  /\ pkt_Pub' = [pkt_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ ipkt_Pub' = [ipkt_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ entry_Pub' = [entry_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ conn_PubT' = [conn_PubT EXCEPT ![self] = defaultInitValue]
                                                  /\ hostMarker_Pub' = [hostMarker_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ ip_idx_Pub' = [ip_idx_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ ipidx_Pub' = [ipidx_Pub EXCEPT ![self] = defaultInitValue]
                                                  /\ ip_PubT' = [ip_PubT EXCEPT ![self] = defaultInitValue]
                                                  /\ host_PubT' = [host_PubT EXCEPT ![self] = defaultInitValue]
                                                  /\ pc' = [pc EXCEPT ![self] = "pubtoprivVEvt3"]
                                             ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqVRet"]
                                                  /\ UNCHANGED << stack, 
                                                                  depth_Pub, 
                                                                  pkt_Pub, 
                                                                  ipkt_Pub, 
                                                                  entry_Pub, 
                                                                  conn_PubT, 
                                                                  hostMarker_Pub, 
                                                                  ip_idx_Pub, 
                                                                  ipidx_Pub, 
                                                                  ip_PubT, 
                                                                  host_PubT >>
                                       /\ UNCHANGED <<depth_, host_, hidx_, host_idx_, pidx_, port_idx_, depth_D, ip_, host_D, connDomain_, cidx_, conn_, depth_Priv, pkt_PrivTo, conn_PrivT, hostMarker_PrivTo, daddr_Priv, hostidx_Priv, hidx_PrivT, otherEntry_Priv, i_Priv, indicies_Priv, portDomain_Priv, sourcePort_Priv, destPort_Priv, new_sport_Priv>>
                                 /\ UNCHANGED << depth_Eve, i_Eve, j_Ev, 
                                                 ip_Eve, host_Eve, indecies_Ev >>
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, host_Co, 
                                      ip_C, hidx_C, host_idx_C, pidx_C, 
                                      port_idx_C, host_Dis, ip_Di, 
                                      connDomain_D, cidx_D, conn_D, host, ip, 
                                      connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                      pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                      ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                      ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                      ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                      sport, dstAddr, dport, pkt_Pr, 
                                      hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                      otherEntry_, i_, indicies_, portDomain_, 
                                      sourcePort_, destPort_, new_sport_, 
                                      depth_Pr, pkt_Pri, conn_Pr, 
                                      hostMarker_Pri, daddr_P, hostidx_P, 
                                      hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                      portDomain_P, sourcePort_P, destPort_P, 
                                      new_sport_P, pkt_Priv, conn_Pri, 
                                      hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                      hidx_Pri, otherEntry_Pr, i_Pr, 
                                      indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_PubT, pkt_PubT, ipkt, entry, 
                                      conn_PubTo, hostMarker_PubT, ip_idx, 
                                      ipidx, ip_PubTo, host_PubTo, depth_PrivT, 
                                      pkt, conn_PrivTo, hostMarker, daddr, 
                                      hostidx, hidx, otherEntry, i_PrivT, 
                                      indicies, portDomain, sourcePort, 
                                      destPort, new_sport, good, depth, i_Even, 
                                      j, ip_Even, host_Even, indecies, i_Che, 
                                      i, aa >>

evtSeqVRet(self) == /\ pc[self] = "evtSeqVRet"
                    /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                    /\ i_Eve' = [i_Eve EXCEPT ![self] = Head(stack[self]).i_Eve]
                    /\ j_Ev' = [j_Ev EXCEPT ![self] = Head(stack[self]).j_Ev]
                    /\ ip_Eve' = [ip_Eve EXCEPT ![self] = Head(stack[self]).ip_Eve]
                    /\ host_Eve' = [host_Eve EXCEPT ![self] = Head(stack[self]).host_Eve]
                    /\ indecies_Ev' = [indecies_Ev EXCEPT ![self] = Head(stack[self]).indecies_Ev]
                    /\ depth_Eve' = [depth_Eve EXCEPT ![self] = Head(stack[self]).depth_Eve]
                    /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                    /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                    Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                    Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                    H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                    TableFull, EvictionReroute, PortScanInv, 
                                    MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                    Ports, ExtraPorts, ExtraExtraPorts, T, 
                                    FreeIPs, UsedIPs, Connections, SendQueue, 
                                    RcvQueue, MAX, Marker1, Marker2, 
                                    CmdConnect, CmdDisconnect, PortSpaceFull, 
                                    depth_, host_, hidx_, host_idx_, pidx_, 
                                    port_idx_, depth_D, ip_, host_D, 
                                    connDomain_, cidx_, conn_, host_Co, ip_C, 
                                    hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                    host_Dis, ip_Di, connDomain_D, cidx_D, 
                                    conn_D, host, ip, connDomain_Di, cidx_Di, 
                                    conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                    conn_P, hostMarker_, ip_idx_, ipidx_, ip_P, 
                                    host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                    hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                    host_Pu, conn, sport, dstAddr, dport, 
                                    pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                    hidx_P, otherEntry_, i_, indicies_, 
                                    portDomain_, sourcePort_, destPort_, 
                                    new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                    hostMarker_Pri, daddr_P, hostidx_P, 
                                    hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                    portDomain_P, sourcePort_P, destPort_P, 
                                    new_sport_P, pkt_Priv, conn_Pri, 
                                    hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                    hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                    portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                    new_sport_Pr, depth_C, host_C, hidx_Co, 
                                    host_idx, pidx, port_idx, depth_Di, ip_D, 
                                    host_Di, connDomain, cidx, conn_Dis, 
                                    depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                    conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                    ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                    pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                    daddr_Pri, hostidx_Pri, hidx_Priv, 
                                    otherEntry_Pri, i_Pri, indicies_Pri, 
                                    portDomain_Pri, sourcePort_Pri, 
                                    destPort_Pri, new_sport_Pri, good_, 
                                    depth_E, i_E, j_, ip_E, host_E, indecies_, 
                                    depth_Ev, i_Ev, j_E, ip_Ev, host_Ev, 
                                    indecies_E, i_C, i_Ch, depth_Pub, pkt_Pub, 
                                    ipkt_Pub, entry_Pub, conn_PubT, 
                                    hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                    ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                    conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                    hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                    i_Priv, indicies_Priv, portDomain_Priv, 
                                    sourcePort_Priv, destPort_Priv, 
                                    new_sport_Priv, depth_PubT, pkt_PubT, ipkt, 
                                    entry, conn_PubTo, hostMarker_PubT, ip_idx, 
                                    ipidx, ip_PubTo, host_PubTo, depth_PrivT, 
                                    pkt, conn_PrivTo, hostMarker, daddr, 
                                    hostidx, hidx, otherEntry, i_PrivT, 
                                    indicies, portDomain, sourcePort, destPort, 
                                    new_sport, good, depth, i_Even, j, ip_Even, 
                                    host_Even, indecies, i_Che, i, aa >>

EventSequenceExitVuln(self) == evtSeqVStart(self) \/ evtSeqVRet(self)

pubtoprivStart(self) == /\ pc[self] = "pubtoprivStart"
                        /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = depth_PubT[self]]
                           /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                    pc        |->  "pubtoprivIf",
                                                                    i_Ev      |->  i_Ev[self],
                                                                    j_E       |->  j_E[self],
                                                                    ip_Ev     |->  ip_Ev[self],
                                                                    host_Ev   |->  host_Ev[self],
                                                                    indecies_E |->  indecies_E[self],
                                                                    depth_Ev  |->  depth_Ev[self] ] >>
                                                                \o stack[self]]
                        /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                        /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                        /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                        /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                        /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                        /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, i_C, i_Ch, 
                                        depth_Pub, pkt_Pub, ipkt_Pub, 
                                        entry_Pub, conn_PubT, hostMarker_Pub, 
                                        ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                        host_PubT, depth_Priv, pkt_PrivTo, 
                                        conn_PrivT, hostMarker_PrivTo, 
                                        daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

pubtoprivIf(self) == /\ pc[self] = "pubtoprivIf"
                     /\ IF Len(SendQueue) > 0
                           THEN /\ pkt_PubT' = [pkt_PubT EXCEPT ![self] = Head(SendQueue)]
                                /\ PrintT(<<"PubToPriv", pkt_PubT'[self], Connections>>)
                                /\ SendQueue' = Tail(SendQueue)
                                /\ entry' = [entry EXCEPT ![self] = SelectSeq(T, LAMBDA e: e.reply.saddr=pkt_PubT'[self].saddr /\
                                                                                           e.reply.sport=pkt_PubT'[self].sport /\
                                                                                           e.reply.daddr=pkt_PubT'[self].daddr /\
                                                                                           e.reply.dport=pkt_PubT'[self].dport)]
                                /\ IF Len(entry'[self]) <= 0
                                      THEN /\ IF pkt_PubT'[self].dport = N
                                                 THEN /\ IF Len(FreeIPs) > 0
                                                            THEN /\ ip_idx' = [ip_idx EXCEPT ![self] = DOMAIN FreeIPs]
                                                                 /\ ipidx' = [ipidx EXCEPT ![self] = CHOOSE ipp \in ip_idx'[self] : TRUE]
                                                                 /\ ip_PubTo' = [ip_PubTo EXCEPT ![self] = FreeIPs[ipidx'[self]]]
                                                                 /\ FreeIPs' = SelectSeq(FreeIPs, LAMBDA d: d /= ip_PubTo'[self])
                                                                 /\ UsedIPs' = Append(UsedIPs, ip_PubTo'[self])
                                                                 /\ host_PubTo' = [host_PubTo EXCEPT ![self] = pkt_PubT'[self].saddr]
                                                                 /\ Connections' = Append(Connections, <<ip_PubTo'[self], host_PubTo'[self]>>)
                                                            ELSE /\ TRUE
                                                                 /\ UNCHANGED << FreeIPs, 
                                                                                 UsedIPs, 
                                                                                 Connections, 
                                                                                 ip_idx, 
                                                                                 ipidx, 
                                                                                 ip_PubTo, 
                                                                                 host_PubTo >>
                                                 ELSE /\ IF pkt_PubT'[self].dport = NN
                                                            THEN /\ Assert((TRUE), 
                                                                           "Failure of assertion at line 1136, column 9.")
                                                            ELSE /\ Assert((TRUE), 
                                                                           "Failure of assertion at line 1141, column 9.")
                                                      /\ UNCHANGED << FreeIPs, 
                                                                      UsedIPs, 
                                                                      Connections, 
                                                                      ip_idx, 
                                                                      ipidx, 
                                                                      ip_PubTo, 
                                                                      host_PubTo >>
                                           /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet"]
                                      ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoPrivElse"]
                                           /\ UNCHANGED << FreeIPs, UsedIPs, 
                                                           Connections, ip_idx, 
                                                           ipidx, ip_PubTo, 
                                                           host_PubTo >>
                           ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet"]
                                /\ UNCHANGED << FreeIPs, UsedIPs, Connections, 
                                                SendQueue, pkt_PubT, entry, 
                                                ip_idx, ipidx, ip_PubTo, 
                                                host_PubTo >>
                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                     Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                     Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                     Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                     PortMap2, TableFull, EvictionReroute, 
                                     PortScanInv, MaxTableSize, hosts, 
                                     FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                     ExtraExtraPorts, T, RcvQueue, MAX, 
                                     Marker1, Marker2, CmdConnect, 
                                     CmdDisconnect, PortSpaceFull, stack, 
                                     depth_, host_, hidx_, host_idx_, pidx_, 
                                     port_idx_, depth_D, ip_, host_D, 
                                     connDomain_, cidx_, conn_, host_Co, ip_C, 
                                     hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                     host_Dis, ip_Di, connDomain_D, cidx_D, 
                                     conn_D, host, ip, connDomain_Di, cidx_Di, 
                                     conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                     conn_P, hostMarker_, ip_idx_, ipidx_, 
                                     ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                     conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                     ip_Pu, host_Pu, conn, sport, dstAddr, 
                                     dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                     hostidx_, hidx_P, otherEntry_, i_, 
                                     indicies_, portDomain_, sourcePort_, 
                                     destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                     conn_Pr, hostMarker_Pri, daddr_P, 
                                     hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                     indicies_P, portDomain_P, sourcePort_P, 
                                     destPort_P, new_sport_P, pkt_Priv, 
                                     conn_Pri, hostMarker_Priv, daddr_Pr, 
                                     hostidx_Pr, hidx_Pri, otherEntry_Pr, i_Pr, 
                                     indicies_Pr, portDomain_Pr, sourcePort_Pr, 
                                     destPort_Pr, new_sport_Pr, depth_C, 
                                     host_C, hidx_Co, host_idx, pidx, port_idx, 
                                     depth_Di, ip_D, host_Di, connDomain, cidx, 
                                     conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                     entry_Pu, conn_Pub, hostMarker_Pu, 
                                     ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                     depth_Pri, pkt_PrivT, conn_Priv, 
                                     hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                     hidx_Priv, otherEntry_Pri, i_Pri, 
                                     indicies_Pri, portDomain_Pri, 
                                     sourcePort_Pri, destPort_Pri, 
                                     new_sport_Pri, good_, depth_E, i_E, j_, 
                                     ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                     j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                     i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                     entry_Pub, conn_PubT, hostMarker_Pub, 
                                     ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                     depth_Priv, pkt_PrivTo, conn_PrivT, 
                                     hostMarker_PrivTo, daddr_Priv, 
                                     hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                     i_Priv, indicies_Priv, portDomain_Priv, 
                                     sourcePort_Priv, destPort_Priv, 
                                     new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                     ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                     ipkt, conn_PubTo, hostMarker_PubT, 
                                     depth_PrivT, pkt, conn_PrivTo, hostMarker, 
                                     daddr, hostidx, hidx, otherEntry, i_PrivT, 
                                     indicies, portDomain, sourcePort, 
                                     destPort, new_sport, good, depth, i_Even, 
                                     j, ip_Even, host_Even, indecies, i_Che, i, 
                                     aa >>

pubtoPrivElse(self) == /\ pc[self] = "pubtoPrivElse"
                       /\ entry' = [entry EXCEPT ![self] = Head(entry[self])]
                       /\ IF entry'[self].reply.dport=N
                             THEN /\ PrintT(<<"PubToPriv - PortShadow: ", entry'[self], pkt_PubT[self]>>)
                             ELSE /\ TRUE
                       /\ IF entry'[self].host_marker/=pkt_PubT[self].host_marker
                             THEN /\ IF pkt_PubT[self].host_marker = H1
                                        THEN /\ Marker1' = entry'[self].host_marker
                                             /\ IF entry'[self].host_marker = H2
                                                   THEN /\ EvictionReroute' = TRUE
                                                   ELSE /\ TRUE
                                                        /\ UNCHANGED EvictionReroute
                                             /\ UNCHANGED Marker2
                                        ELSE /\ Marker2' = entry'[self].host_marker
                                             /\ IF entry'[self].host_marker = H1
                                                   THEN /\ EvictionReroute' = TRUE
                                                   ELSE /\ TRUE
                                                        /\ UNCHANGED EvictionReroute
                                             /\ UNCHANGED Marker1
                                  /\ PrintT(<<"PubToPriv-Eviction Error: pkt", pkt_PubT[self], " entry", entry'[self], "Connections:", Connections, "T: ", T>>)
                             ELSE /\ TRUE
                                  /\ UNCHANGED << EvictionReroute, Marker1, 
                                                  Marker2 >>
                       /\ conn_PubTo' = [conn_PubTo EXCEPT ![self] = SelectSeq(Connections, LAMBDA e: entry'[self].orig.saddr = Head(e))]
                       /\ IF Len(conn_PubTo'[self]) > 0
                             THEN /\ pc' = [pc EXCEPT ![self] = "pubtoprivConngt1"]
                             ELSE /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet"]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       CmdConnect, CmdDisconnect, 
                                       PortSpaceFull, stack, depth_, host_, 
                                       hidx_, host_idx_, pidx_, port_idx_, 
                                       depth_D, ip_, host_D, connDomain_, 
                                       cidx_, conn_, host_Co, ip_C, hidx_C, 
                                       host_idx_C, pidx_C, port_idx_C, 
                                       host_Dis, ip_Di, connDomain_D, cidx_D, 
                                       conn_D, host, ip, connDomain_Di, 
                                       cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                       entry_, conn_P, hostMarker_, ip_idx_, 
                                       ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                       entry_P, conn_Pu, hostMarker_P, 
                                       ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                       sport, dstAddr, dport, pkt_Pr, 
                                       hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                       otherEntry_, i_, indicies_, portDomain_, 
                                       sourcePort_, destPort_, new_sport_, 
                                       depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, hostMarker_PubT, ip_idx, 
                                       ipidx, ip_PubTo, host_PubTo, 
                                       depth_PrivT, pkt, conn_PrivTo, 
                                       hostMarker, daddr, hostidx, hidx, 
                                       otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

pubtoprivConngt1(self) == /\ pc[self] = "pubtoprivConngt1"
                          /\ conn_PubTo' = [conn_PubTo EXCEPT ![self] = Head(conn_PubTo[self])]
                          /\ pc' = [pc EXCEPT ![self] = "pubtoprivConngt2"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          hostMarker_PubT, ip_idx, ipidx, 
                                          ip_PubTo, host_PubTo, depth_PrivT, 
                                          pkt, conn_PrivTo, hostMarker, daddr, 
                                          hostidx, hidx, otherEntry, i_PrivT, 
                                          indicies, portDomain, sourcePort, 
                                          destPort, new_sport, good, depth, 
                                          i_Even, j, ip_Even, host_Even, 
                                          indecies, i_Che, i, aa >>

pubtoprivConngt2(self) == /\ pc[self] = "pubtoprivConngt2"
                          /\ hostMarker_PubT' = [hostMarker_PubT EXCEPT ![self] = conn_PubTo[self][2]]
                          /\ IF hostMarker_PubT'[self] = H1
                                THEN /\ IF entry[self].host_marker = H2
                                           THEN /\ PortScanInv' = TRUE
                                           ELSE /\ TRUE
                                                /\ UNCHANGED PortScanInv
                                     /\ Marker1' = entry[self].host_marker
                                     /\ UNCHANGED Marker2
                                ELSE /\ IF entry[self].host_marker = H1
                                           THEN /\ PortScanInv' = TRUE
                                           ELSE /\ TRUE
                                                /\ UNCHANGED PortScanInv
                                     /\ Marker2' = entry[self].host_marker
                                     /\ UNCHANGED Marker1
                          /\ pc' = [pc EXCEPT ![self] = "pubtoprivRet"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          MaxTableSize, hosts, FreeHosts, 
                                          UsedHosts, Ports, ExtraPorts, 
                                          ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                          Connections, SendQueue, RcvQueue, 
                                          MAX, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, ip_idx, ipidx, ip_PubTo, 
                                          host_PubTo, depth_PrivT, pkt, 
                                          conn_PrivTo, hostMarker, daddr, 
                                          hostidx, hidx, otherEntry, i_PrivT, 
                                          indicies, portDomain, sourcePort, 
                                          destPort, new_sport, good, depth, 
                                          i_Even, j, ip_Even, host_Even, 
                                          indecies, i_Che, i, aa >>

pubtoprivRet(self) == /\ pc[self] = "pubtoprivRet"
                      /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                      /\ pkt_PubT' = [pkt_PubT EXCEPT ![self] = Head(stack[self]).pkt_PubT]
                      /\ ipkt' = [ipkt EXCEPT ![self] = Head(stack[self]).ipkt]
                      /\ entry' = [entry EXCEPT ![self] = Head(stack[self]).entry]
                      /\ conn_PubTo' = [conn_PubTo EXCEPT ![self] = Head(stack[self]).conn_PubTo]
                      /\ hostMarker_PubT' = [hostMarker_PubT EXCEPT ![self] = Head(stack[self]).hostMarker_PubT]
                      /\ ip_idx' = [ip_idx EXCEPT ![self] = Head(stack[self]).ip_idx]
                      /\ ipidx' = [ipidx EXCEPT ![self] = Head(stack[self]).ipidx]
                      /\ ip_PubTo' = [ip_PubTo EXCEPT ![self] = Head(stack[self]).ip_PubTo]
                      /\ host_PubTo' = [host_PubTo EXCEPT ![self] = Head(stack[self]).host_PubTo]
                      /\ depth_PubT' = [depth_PubT EXCEPT ![self] = Head(stack[self]).depth_PubT]
                      /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, depth_, 
                                      host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                      entry_Pub, conn_PubT, hostMarker_Pub, 
                                      ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                      host_PubT, depth_Priv, pkt_PrivTo, 
                                      conn_PrivT, hostMarker_PrivTo, 
                                      daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PrivT, pkt, 
                                      conn_PrivTo, hostMarker, daddr, hostidx, 
                                      hidx, otherEntry, i_PrivT, indicies, 
                                      portDomain, sourcePort, destPort, 
                                      new_sport, good, depth, i_Even, j, 
                                      ip_Even, host_Even, indecies, i_Che, i, 
                                      aa >>

PubToPrivExit(self) == pubtoprivStart(self) \/ pubtoprivIf(self)
                          \/ pubtoPrivElse(self) \/ pubtoprivConngt1(self)
                          \/ pubtoprivConngt2(self) \/ pubtoprivRet(self)

privtopubStart(self) == /\ pc[self] = "privtopubStart"
                        /\ /\ depth_Ev' = [depth_Ev EXCEPT ![self] = depth_PrivT[self]]
                           /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequence",
                                                                    pc        |->  "privtopubIf",
                                                                    i_Ev      |->  i_Ev[self],
                                                                    j_E       |->  j_E[self],
                                                                    ip_Ev     |->  ip_Ev[self],
                                                                    host_Ev   |->  host_Ev[self],
                                                                    indecies_E |->  indecies_E[self],
                                                                    depth_Ev  |->  depth_Ev[self] ] >>
                                                                \o stack[self]]
                        /\ i_Ev' = [i_Ev EXCEPT ![self] = defaultInitValue]
                        /\ j_E' = [j_E EXCEPT ![self] = defaultInitValue]
                        /\ ip_Ev' = [ip_Ev EXCEPT ![self] = defaultInitValue]
                        /\ host_Ev' = [host_Ev EXCEPT ![self] = defaultInitValue]
                        /\ indecies_E' = [indecies_E EXCEPT ![self] = defaultInitValue]
                        /\ pc' = [pc EXCEPT ![self] = "evtSeqStart_"]
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, 
                                        PortMap1, EP2, PortMap2, TableFull, 
                                        EvictionReroute, PortScanInv, 
                                        MaxTableSize, hosts, FreeHosts, 
                                        UsedHosts, Ports, ExtraPorts, 
                                        ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                        Connections, SendQueue, RcvQueue, MAX, 
                                        Marker1, Marker2, CmdConnect, 
                                        CmdDisconnect, PortSpaceFull, depth_, 
                                        host_, hidx_, host_idx_, pidx_, 
                                        port_idx_, depth_D, ip_, host_D, 
                                        connDomain_, cidx_, conn_, host_Co, 
                                        ip_C, hidx_C, host_idx_C, pidx_C, 
                                        port_idx_C, host_Dis, ip_Di, 
                                        connDomain_D, cidx_D, conn_D, host, ip, 
                                        connDomain_Di, cidx_Di, conn_Di, 
                                        depth_P, pkt_, ipkt_, entry_, conn_P, 
                                        hostMarker_, ip_idx_, ipidx_, ip_P, 
                                        host_P, pkt_P, ipkt_P, entry_P, 
                                        conn_Pu, hostMarker_P, ip_idx_P, 
                                        ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                        dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                        daddr_, hostidx_, hidx_P, otherEntry_, 
                                        i_, indicies_, portDomain_, 
                                        sourcePort_, destPort_, new_sport_, 
                                        depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, i_C, i_Ch, 
                                        depth_Pub, pkt_Pub, ipkt_Pub, 
                                        entry_Pub, conn_PubT, hostMarker_Pub, 
                                        ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                        host_PubT, depth_Priv, pkt_PrivTo, 
                                        conn_PrivT, hostMarker_PrivTo, 
                                        daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, hostMarker, daddr, 
                                        hostidx, hidx, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        destPort, new_sport, good, depth, 
                                        i_Even, j, ip_Even, host_Even, 
                                        indecies, i_Che, i, aa >>

privtopubIf(self) == /\ pc[self] = "privtopubIf"
                     /\ good' = [good EXCEPT ![self] = TRUE]
                     /\ IF Len (Connections) > 0
                           THEN /\ indicies' = [indicies EXCEPT ![self] = DOMAIN Connections]
                                /\ portDomain' = [portDomain EXCEPT ![self] = DOMAIN Ports]
                                /\ sourcePort' = [sourcePort EXCEPT ![self] = CHOOSE pr \in portDomain'[self] : TRUE]
                                /\ i_PrivT' = [i_PrivT EXCEPT ![self] = CHOOSE f \in indicies'[self] : TRUE]
                                /\ pc' = [pc EXCEPT ![self] = "privtopubConn"]
                           ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet"]
                                /\ UNCHANGED << i_PrivT, indicies, portDomain, 
                                                sourcePort >>
                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                     Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                     Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                     Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                     PortMap2, TableFull, EvictionReroute, 
                                     PortScanInv, MaxTableSize, hosts, 
                                     FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                     ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                     Connections, SendQueue, RcvQueue, MAX, 
                                     Marker1, Marker2, CmdConnect, 
                                     CmdDisconnect, PortSpaceFull, stack, 
                                     depth_, host_, hidx_, host_idx_, pidx_, 
                                     port_idx_, depth_D, ip_, host_D, 
                                     connDomain_, cidx_, conn_, host_Co, ip_C, 
                                     hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                     host_Dis, ip_Di, connDomain_D, cidx_D, 
                                     conn_D, host, ip, connDomain_Di, cidx_Di, 
                                     conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                     conn_P, hostMarker_, ip_idx_, ipidx_, 
                                     ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                     conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                     ip_Pu, host_Pu, conn, sport, dstAddr, 
                                     dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                     hostidx_, hidx_P, otherEntry_, i_, 
                                     indicies_, portDomain_, sourcePort_, 
                                     destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                     conn_Pr, hostMarker_Pri, daddr_P, 
                                     hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                     indicies_P, portDomain_P, sourcePort_P, 
                                     destPort_P, new_sport_P, pkt_Priv, 
                                     conn_Pri, hostMarker_Priv, daddr_Pr, 
                                     hostidx_Pr, hidx_Pri, otherEntry_Pr, i_Pr, 
                                     indicies_Pr, portDomain_Pr, sourcePort_Pr, 
                                     destPort_Pr, new_sport_Pr, depth_C, 
                                     host_C, hidx_Co, host_idx, pidx, port_idx, 
                                     depth_Di, ip_D, host_Di, connDomain, cidx, 
                                     conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                     entry_Pu, conn_Pub, hostMarker_Pu, 
                                     ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                     depth_Pri, pkt_PrivT, conn_Priv, 
                                     hostMarker_PrivT, daddr_Pri, hostidx_Pri, 
                                     hidx_Priv, otherEntry_Pri, i_Pri, 
                                     indicies_Pri, portDomain_Pri, 
                                     sourcePort_Pri, destPort_Pri, 
                                     new_sport_Pri, good_, depth_E, i_E, j_, 
                                     ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                     j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                     i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                     entry_Pub, conn_PubT, hostMarker_Pub, 
                                     ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                     depth_Priv, pkt_PrivTo, conn_PrivT, 
                                     hostMarker_PrivTo, daddr_Priv, 
                                     hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                     i_Priv, indicies_Priv, portDomain_Priv, 
                                     sourcePort_Priv, destPort_Priv, 
                                     new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                     ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                     pkt_PubT, ipkt, entry, conn_PubTo, 
                                     hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                     host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                     hostMarker, daddr, hostidx, hidx, 
                                     otherEntry, destPort, new_sport, depth, 
                                     i_Even, j, ip_Even, host_Even, indecies, 
                                     i_Che, i, aa >>

privtopubConn(self) == /\ pc[self] = "privtopubConn"
                       /\ conn_PrivTo' = [conn_PrivTo EXCEPT ![self] = Connections[i_PrivT[self]]]
                       /\ sourcePort' = [sourcePort EXCEPT ![self] = Ports[sourcePort[self]]]
                       /\ portDomain' = [portDomain EXCEPT ![self] = DOMAIN Ports]
                       /\ destPort' = [destPort EXCEPT ![self] = CHOOSE h \in portDomain'[self] : TRUE]
                       /\ pc' = [pc EXCEPT ![self] = "privtopubDport"]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, stack, 
                                       depth_, host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       hostMarker, daddr, hostidx, hidx, 
                                       otherEntry, i_PrivT, indicies, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

privtopubDport(self) == /\ pc[self] = "privtopubDport"
                        /\ destPort' = [destPort EXCEPT ![self] = Ports[destPort[self]]]
                        /\ hostidx' = [hostidx EXCEPT ![self] = DOMAIN hosts]
                        /\ hidx' = [hidx EXCEPT ![self] = CHOOSE hid \in hostidx'[self] : TRUE]
                        /\ daddr' = [daddr EXCEPT ![self] = hosts[hidx'[self]]]
                        /\ hostMarker' = [hostMarker EXCEPT ![self] = Head(Tail(conn_PrivTo[self]))]
                        /\ IF hostMarker'[self]=H1
                              THEN /\ IF Len(PortMap1) >= MaxPorts
                                         THEN /\ good' = [good EXCEPT ![self] = FALSE]
                                              /\ pc' = [pc EXCEPT ![self] = "privtopubMaxPorts1"]
                                              /\ UNCHANGED PortMap1
                                         ELSE /\ PortMap1' = Append(PortMap1, sourcePort[self])
                                              /\ pc' = [pc EXCEPT ![self] = "privtopubGood"]
                                              /\ good' = good
                                   /\ UNCHANGED PortMap2
                              ELSE /\ IF Len(PortMap2) >= MaxPorts
                                         THEN /\ good' = [good EXCEPT ![self] = FALSE]
                                              /\ pc' = [pc EXCEPT ![self] = "privtopubMaxPorts2"]
                                              /\ UNCHANGED PortMap2
                                         ELSE /\ PortMap2' = Append(PortMap2, sourcePort[self])
                                              /\ pc' = [pc EXCEPT ![self] = "privtopubGood"]
                                              /\ good' = good
                                   /\ UNCHANGED PortMap1
                        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                        Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                        Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                        Yy, Zz, H1, H2, MaxPorts, EP1, EP2, 
                                        TableFull, EvictionReroute, 
                                        PortScanInv, MaxTableSize, hosts, 
                                        FreeHosts, UsedHosts, Ports, 
                                        ExtraPorts, ExtraExtraPorts, T, 
                                        FreeIPs, UsedIPs, Connections, 
                                        SendQueue, RcvQueue, MAX, Marker1, 
                                        Marker2, CmdConnect, CmdDisconnect, 
                                        PortSpaceFull, stack, depth_, host_, 
                                        hidx_, host_idx_, pidx_, port_idx_, 
                                        depth_D, ip_, host_D, connDomain_, 
                                        cidx_, conn_, host_Co, ip_C, hidx_C, 
                                        host_idx_C, pidx_C, port_idx_C, 
                                        host_Dis, ip_Di, connDomain_D, cidx_D, 
                                        conn_D, host, ip, connDomain_Di, 
                                        cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                        entry_, conn_P, hostMarker_, ip_idx_, 
                                        ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                        entry_P, conn_Pu, hostMarker_P, 
                                        ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                        conn, sport, dstAddr, dport, pkt_Pr, 
                                        hostMarker_Pr, daddr_, hostidx_, 
                                        hidx_P, otherEntry_, i_, indicies_, 
                                        portDomain_, sourcePort_, destPort_, 
                                        new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                        hostMarker_Pri, daddr_P, hostidx_P, 
                                        hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                        portDomain_P, sourcePort_P, destPort_P, 
                                        new_sport_P, pkt_Priv, conn_Pri, 
                                        hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                        hidx_Pri, otherEntry_Pr, i_Pr, 
                                        indicies_Pr, portDomain_Pr, 
                                        sourcePort_Pr, destPort_Pr, 
                                        new_sport_Pr, depth_C, host_C, hidx_Co, 
                                        host_idx, pidx, port_idx, depth_Di, 
                                        ip_D, host_Di, connDomain, cidx, 
                                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                        entry_Pu, conn_Pub, hostMarker_Pu, 
                                        ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                        depth_Pri, pkt_PrivT, conn_Priv, 
                                        hostMarker_PrivT, daddr_Pri, 
                                        hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                        i_Pri, indicies_Pri, portDomain_Pri, 
                                        sourcePort_Pri, destPort_Pri, 
                                        new_sport_Pri, good_, depth_E, i_E, j_, 
                                        ip_E, host_E, indecies_, depth_Ev, 
                                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, 
                                        i_C, i_Ch, depth_Pub, pkt_Pub, 
                                        ipkt_Pub, entry_Pub, conn_PubT, 
                                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                        ip_PubT, host_PubT, depth_Priv, 
                                        pkt_PrivTo, conn_PrivT, 
                                        hostMarker_PrivTo, daddr_Priv, 
                                        hostidx_Priv, hidx_PrivT, 
                                        otherEntry_Priv, i_Priv, indicies_Priv, 
                                        portDomain_Priv, sourcePort_Priv, 
                                        destPort_Priv, new_sport_Priv, 
                                        depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                        host_Eve, indecies_Ev, depth_PubT, 
                                        pkt_PubT, ipkt, entry, conn_PubTo, 
                                        hostMarker_PubT, ip_idx, ipidx, 
                                        ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                        conn_PrivTo, otherEntry, i_PrivT, 
                                        indicies, portDomain, sourcePort, 
                                        new_sport, depth, i_Even, j, ip_Even, 
                                        host_Even, indecies, i_Che, i, aa >>

privtopubMaxPorts1(self) == /\ pc[self] = "privtopubMaxPorts1"
                            /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                            /\ pkt' = [pkt EXCEPT ![self] = Head(stack[self]).pkt]
                            /\ conn_PrivTo' = [conn_PrivTo EXCEPT ![self] = Head(stack[self]).conn_PrivTo]
                            /\ hostMarker' = [hostMarker EXCEPT ![self] = Head(stack[self]).hostMarker]
                            /\ daddr' = [daddr EXCEPT ![self] = Head(stack[self]).daddr]
                            /\ hostidx' = [hostidx EXCEPT ![self] = Head(stack[self]).hostidx]
                            /\ hidx' = [hidx EXCEPT ![self] = Head(stack[self]).hidx]
                            /\ otherEntry' = [otherEntry EXCEPT ![self] = Head(stack[self]).otherEntry]
                            /\ i_PrivT' = [i_PrivT EXCEPT ![self] = Head(stack[self]).i_PrivT]
                            /\ indicies' = [indicies EXCEPT ![self] = Head(stack[self]).indicies]
                            /\ portDomain' = [portDomain EXCEPT ![self] = Head(stack[self]).portDomain]
                            /\ sourcePort' = [sourcePort EXCEPT ![self] = Head(stack[self]).sourcePort]
                            /\ destPort' = [destPort EXCEPT ![self] = Head(stack[self]).destPort]
                            /\ new_sport' = [new_sport EXCEPT ![self] = Head(stack[self]).new_sport]
                            /\ good' = [good EXCEPT ![self] = Head(stack[self]).good]
                            /\ depth_PrivT' = [depth_PrivT EXCEPT ![self] = Head(stack[self]).depth_PrivT]
                            /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, depth_, host_, 
                                            hidx_, host_idx_, pidx_, port_idx_, 
                                            depth_D, ip_, host_D, connDomain_, 
                                            cidx_, conn_, host_Co, ip_C, 
                                            hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth, 
                                            i_Even, j, ip_Even, host_Even, 
                                            indecies, i_Che, i, aa >>

privtopubMaxPorts2(self) == /\ pc[self] = "privtopubMaxPorts2"
                            /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                            /\ pkt' = [pkt EXCEPT ![self] = Head(stack[self]).pkt]
                            /\ conn_PrivTo' = [conn_PrivTo EXCEPT ![self] = Head(stack[self]).conn_PrivTo]
                            /\ hostMarker' = [hostMarker EXCEPT ![self] = Head(stack[self]).hostMarker]
                            /\ daddr' = [daddr EXCEPT ![self] = Head(stack[self]).daddr]
                            /\ hostidx' = [hostidx EXCEPT ![self] = Head(stack[self]).hostidx]
                            /\ hidx' = [hidx EXCEPT ![self] = Head(stack[self]).hidx]
                            /\ otherEntry' = [otherEntry EXCEPT ![self] = Head(stack[self]).otherEntry]
                            /\ i_PrivT' = [i_PrivT EXCEPT ![self] = Head(stack[self]).i_PrivT]
                            /\ indicies' = [indicies EXCEPT ![self] = Head(stack[self]).indicies]
                            /\ portDomain' = [portDomain EXCEPT ![self] = Head(stack[self]).portDomain]
                            /\ sourcePort' = [sourcePort EXCEPT ![self] = Head(stack[self]).sourcePort]
                            /\ destPort' = [destPort EXCEPT ![self] = Head(stack[self]).destPort]
                            /\ new_sport' = [new_sport EXCEPT ![self] = Head(stack[self]).new_sport]
                            /\ good' = [good EXCEPT ![self] = Head(stack[self]).good]
                            /\ depth_PrivT' = [depth_PrivT EXCEPT ![self] = Head(stack[self]).depth_PrivT]
                            /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                            /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                            Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                            Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                            Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                            MaxPorts, EP1, PortMap1, EP2, 
                                            PortMap2, TableFull, 
                                            EvictionReroute, PortScanInv, 
                                            MaxTableSize, hosts, FreeHosts, 
                                            UsedHosts, Ports, ExtraPorts, 
                                            ExtraExtraPorts, T, FreeIPs, 
                                            UsedIPs, Connections, SendQueue, 
                                            RcvQueue, MAX, Marker1, Marker2, 
                                            CmdConnect, CmdDisconnect, 
                                            PortSpaceFull, depth_, host_, 
                                            hidx_, host_idx_, pidx_, port_idx_, 
                                            depth_D, ip_, host_D, connDomain_, 
                                            cidx_, conn_, host_Co, ip_C, 
                                            hidx_C, host_idx_C, pidx_C, 
                                            port_idx_C, host_Dis, ip_Di, 
                                            connDomain_D, cidx_D, conn_D, host, 
                                            ip, connDomain_Di, cidx_Di, 
                                            conn_Di, depth_P, pkt_, ipkt_, 
                                            entry_, conn_P, hostMarker_, 
                                            ip_idx_, ipidx_, ip_P, host_P, 
                                            pkt_P, ipkt_P, entry_P, conn_Pu, 
                                            hostMarker_P, ip_idx_P, ipidx_P, 
                                            ip_Pu, host_Pu, conn, sport, 
                                            dstAddr, dport, pkt_Pr, 
                                            hostMarker_Pr, daddr_, hostidx_, 
                                            hidx_P, otherEntry_, i_, indicies_, 
                                            portDomain_, sourcePort_, 
                                            destPort_, new_sport_, depth_Pr, 
                                            pkt_Pri, conn_Pr, hostMarker_Pri, 
                                            daddr_P, hostidx_P, hidx_Pr, 
                                            otherEntry_P, i_P, indicies_P, 
                                            portDomain_P, sourcePort_P, 
                                            destPort_P, new_sport_P, pkt_Priv, 
                                            conn_Pri, hostMarker_Priv, 
                                            daddr_Pr, hostidx_Pr, hidx_Pri, 
                                            otherEntry_Pr, i_Pr, indicies_Pr, 
                                            portDomain_Pr, sourcePort_Pr, 
                                            destPort_Pr, new_sport_Pr, depth_C, 
                                            host_C, hidx_Co, host_idx, pidx, 
                                            port_idx, depth_Di, ip_D, host_Di, 
                                            connDomain, cidx, conn_Dis, 
                                            depth_Pu, pkt_Pu, ipkt_Pu, 
                                            entry_Pu, conn_Pub, hostMarker_Pu, 
                                            ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                            host_Pub, depth_Pri, pkt_PrivT, 
                                            conn_Priv, hostMarker_PrivT, 
                                            daddr_Pri, hostidx_Pri, hidx_Priv, 
                                            otherEntry_Pri, i_Pri, 
                                            indicies_Pri, portDomain_Pri, 
                                            sourcePort_Pri, destPort_Pri, 
                                            new_sport_Pri, good_, depth_E, i_E, 
                                            j_, ip_E, host_E, indecies_, 
                                            depth_Ev, i_Ev, j_E, ip_Ev, 
                                            host_Ev, indecies_E, i_C, i_Ch, 
                                            depth_Pub, pkt_Pub, ipkt_Pub, 
                                            entry_Pub, conn_PubT, 
                                            hostMarker_Pub, ip_idx_Pub, 
                                            ipidx_Pub, ip_PubT, host_PubT, 
                                            depth_Priv, pkt_PrivTo, conn_PrivT, 
                                            hostMarker_PrivTo, daddr_Priv, 
                                            hostidx_Priv, hidx_PrivT, 
                                            otherEntry_Priv, i_Priv, 
                                            indicies_Priv, portDomain_Priv, 
                                            sourcePort_Priv, destPort_Priv, 
                                            new_sport_Priv, depth_Eve, i_Eve, 
                                            j_Ev, ip_Eve, host_Eve, 
                                            indecies_Ev, depth_PubT, pkt_PubT, 
                                            ipkt, entry, conn_PubTo, 
                                            hostMarker_PubT, ip_idx, ipidx, 
                                            ip_PubTo, host_PubTo, depth, 
                                            i_Even, j, ip_Even, host_Even, 
                                            indecies, i_Che, i, aa >>

privtopubGood(self) == /\ pc[self] = "privtopubGood"
                       /\ IF good[self]
                             THEN /\ pc' = [pc EXCEPT ![self] = "privToPubPkt1"]
                             ELSE /\ pc' = [pc EXCEPT ![self] = "privtopubRet"]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, stack, 
                                       depth_, host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

privToPubPkt1(self) == /\ pc[self] = "privToPubPkt1"
                       /\ IF sourcePort[self] = N
                             THEN /\ IF hostMarker[self]=H1
                                        THEN /\ sourcePort' = [sourcePort EXCEPT ![self] = EP1]
                                        ELSE /\ sourcePort' = [sourcePort EXCEPT ![self] = EP2]
                             ELSE /\ TRUE
                                  /\ UNCHANGED sourcePort
                       /\ pkt' = [pkt EXCEPT ![self] = [saddr |-> Head(conn_PrivTo[self]), sport |-> sourcePort'[self],
                                                        daddr |-> daddr[self], dport |-> destPort[self],
                                                        host_marker |-> hostMarker[self]
                                                       ]]
                       /\ PrintT(<<"PrivToPub - pkt: ", conn_PrivTo[self], pkt'[self]>>)
                       /\ entry' = [entry EXCEPT ![self] = [host_marker |-> hostMarker[self],
                                                            orig |-> [saddr |-> pkt'[self].saddr, sport |-> pkt'[self].sport,
                                                                      daddr |-> pkt'[self].daddr, dport |-> pkt'[self].dport],
                                                            reply |-> [saddr |-> pkt'[self].daddr, sport |-> pkt'[self].dport,
                                                                       daddr |-> E,  dport |-> pkt'[self].sport ]]]
                       /\ otherEntry' = [otherEntry EXCEPT ![self] = SelectSeq(T, LAMBDA k: k.reply.saddr=pkt'[self].daddr /\ k.reply.sport=pkt'[self].dport /\
                                                                                            k.reply.daddr=E /\ k.reply.dport=pkt'[self].sport /\
                                                                                            k.hostMarker /= hostMarker[self])]
                       /\ IF Len(otherEntry'[self]) > 0
                             THEN /\ PrintT("Evict")
                                  /\ IF Len(ExtraPorts) > 0
                                        THEN /\ new_sport' = [new_sport EXCEPT ![self] = Head(ExtraPorts)]
                                             /\ ExtraPorts' = Tail(ExtraPorts)
                                             /\ pc' = [pc EXCEPT ![self] = "privToPubNewPort"]
                                             /\ UNCHANGED PortSpaceFull
                                        ELSE /\ PortSpaceFull' = TRUE
                                             /\ pc' = [pc EXCEPT ![self] = "privToPubAppendT"]
                                             /\ UNCHANGED << ExtraPorts, 
                                                             new_sport >>
                             ELSE /\ pc' = [pc EXCEPT ![self] = "privToPubAppendT"]
                                  /\ UNCHANGED << ExtraPorts, PortSpaceFull, 
                                                  new_sport >>
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraExtraPorts, T, 
                                       FreeIPs, UsedIPs, Connections, 
                                       SendQueue, RcvQueue, MAX, Marker1, 
                                       Marker2, CmdConnect, CmdDisconnect, 
                                       stack, depth_, host_, hidx_, host_idx_, 
                                       pidx_, port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, i_PrivT, indicies, portDomain, 
                                       destPort, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i_Che, i, 
                                       aa >>

privToPubNewPort(self) == /\ pc[self] = "privToPubNewPort"
                          /\ entry' = [entry EXCEPT ![self] =                  [host_marker |-> hostMarker[self],
                                                              orig |-> [saddr |-> pkt[self].saddr, sport |-> pkt[self].sport,
                                                                        daddr |-> pkt[self].daddr, dport |-> pkt[self].dport],
                                                              reply |-> [saddr |-> pkt[self].daddr, sport |-> pkt[self].dport,
                                                                         daddr |-> E,  dport |-> new_sport[self] ]]]
                          /\ pkt' = [pkt EXCEPT ![self].sport = new_sport[self]]
                          /\ pc' = [pc EXCEPT ![self] = "privToPubAppendT"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          TableFull, EvictionReroute, 
                                          PortScanInv, MaxTableSize, hosts, 
                                          FreeHosts, UsedHosts, Ports, 
                                          ExtraPorts, ExtraExtraPorts, T, 
                                          FreeIPs, UsedIPs, Connections, 
                                          SendQueue, RcvQueue, MAX, Marker1, 
                                          Marker2, CmdConnect, CmdDisconnect, 
                                          PortSpaceFull, stack, depth_, host_, 
                                          hidx_, host_idx_, pidx_, port_idx_, 
                                          depth_D, ip_, host_D, connDomain_, 
                                          cidx_, conn_, host_Co, ip_C, hidx_C, 
                                          host_idx_C, pidx_C, port_idx_C, 
                                          host_Dis, ip_Di, connDomain_D, 
                                          cidx_D, conn_D, host, ip, 
                                          connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, conn_PrivTo, hostMarker, 
                                          daddr, hostidx, hidx, otherEntry, 
                                          i_PrivT, indicies, portDomain, 
                                          sourcePort, destPort, new_sport, 
                                          good, depth, i_Even, j, ip_Even, 
                                          host_Even, indecies, i_Che, i, aa >>

privToPubAppendT(self) == /\ pc[self] = "privToPubAppendT"
                          /\ T' = Append(T, entry[self])
                          /\ IF Len(T') >= MaxTableSize
                                THEN /\ TableFull' = TRUE
                                ELSE /\ TRUE
                                     /\ UNCHANGED TableFull
                          /\ pc' = [pc EXCEPT ![self] = "privtopubPkt"]
                          /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                          Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                          Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                          Ww, Xx, Yy, Zz, H1, H2, MaxPorts, 
                                          EP1, PortMap1, EP2, PortMap2, 
                                          EvictionReroute, PortScanInv, 
                                          MaxTableSize, hosts, FreeHosts, 
                                          UsedHosts, Ports, ExtraPorts, 
                                          ExtraExtraPorts, FreeIPs, UsedIPs, 
                                          Connections, SendQueue, RcvQueue, 
                                          MAX, Marker1, Marker2, CmdConnect, 
                                          CmdDisconnect, PortSpaceFull, stack, 
                                          depth_, host_, hidx_, host_idx_, 
                                          pidx_, port_idx_, depth_D, ip_, 
                                          host_D, connDomain_, cidx_, conn_, 
                                          host_Co, ip_C, hidx_C, host_idx_C, 
                                          pidx_C, port_idx_C, host_Dis, ip_Di, 
                                          connDomain_D, cidx_D, conn_D, host, 
                                          ip, connDomain_Di, cidx_Di, conn_Di, 
                                          depth_P, pkt_, ipkt_, entry_, conn_P, 
                                          hostMarker_, ip_idx_, ipidx_, ip_P, 
                                          host_P, pkt_P, ipkt_P, entry_P, 
                                          conn_Pu, hostMarker_P, ip_idx_P, 
                                          ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                          dstAddr, dport, pkt_Pr, 
                                          hostMarker_Pr, daddr_, hostidx_, 
                                          hidx_P, otherEntry_, i_, indicies_, 
                                          portDomain_, sourcePort_, destPort_, 
                                          new_sport_, depth_Pr, pkt_Pri, 
                                          conn_Pr, hostMarker_Pri, daddr_P, 
                                          hostidx_P, hidx_Pr, otherEntry_P, 
                                          i_P, indicies_P, portDomain_P, 
                                          sourcePort_P, destPort_P, 
                                          new_sport_P, pkt_Priv, conn_Pri, 
                                          hostMarker_Priv, daddr_Pr, 
                                          hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                          i_Pr, indicies_Pr, portDomain_Pr, 
                                          sourcePort_Pr, destPort_Pr, 
                                          new_sport_Pr, depth_C, host_C, 
                                          hidx_Co, host_idx, pidx, port_idx, 
                                          depth_Di, ip_D, host_Di, connDomain, 
                                          cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                          ipkt_Pu, entry_Pu, conn_Pub, 
                                          hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                          ip_Pub, host_Pub, depth_Pri, 
                                          pkt_PrivT, conn_Priv, 
                                          hostMarker_PrivT, daddr_Pri, 
                                          hostidx_Pri, hidx_Priv, 
                                          otherEntry_Pri, i_Pri, indicies_Pri, 
                                          portDomain_Pri, sourcePort_Pri, 
                                          destPort_Pri, new_sport_Pri, good_, 
                                          depth_E, i_E, j_, ip_E, host_E, 
                                          indecies_, depth_Ev, i_Ev, j_E, 
                                          ip_Ev, host_Ev, indecies_E, i_C, 
                                          i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                          entry_Pub, conn_PubT, hostMarker_Pub, 
                                          ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                          host_PubT, depth_Priv, pkt_PrivTo, 
                                          conn_PrivT, hostMarker_PrivTo, 
                                          daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                          otherEntry_Priv, i_Priv, 
                                          indicies_Priv, portDomain_Priv, 
                                          sourcePort_Priv, destPort_Priv, 
                                          new_sport_Priv, depth_Eve, i_Eve, 
                                          j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                          depth_PubT, pkt_PubT, ipkt, entry, 
                                          conn_PubTo, hostMarker_PubT, ip_idx, 
                                          ipidx, ip_PubTo, host_PubTo, 
                                          depth_PrivT, pkt, conn_PrivTo, 
                                          hostMarker, daddr, hostidx, hidx, 
                                          otherEntry, i_PrivT, indicies, 
                                          portDomain, sourcePort, destPort, 
                                          new_sport, good, depth, i_Even, j, 
                                          ip_Even, host_Even, indecies, i_Che, 
                                          i, aa >>

privtopubPkt(self) == /\ pc[self] = "privtopubPkt"
                      /\ pkt' = [pkt EXCEPT ![self] = [saddr |->pkt[self].daddr, sport |-> pkt[self].dport,
                                                       daddr |-> E, dport |-> pkt[self].sport,
                                                       host_marker |-> hostMarker[self]]]
                      /\ SendQueue' = Append(SendQueue, pkt'[self])
                      /\ pc' = [pc EXCEPT ![self] = "privtopubRet"]
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, RcvQueue, MAX, Marker1, 
                                      Marker2, CmdConnect, CmdDisconnect, 
                                      PortSpaceFull, stack, depth_, host_, 
                                      hidx_, host_idx_, pidx_, port_idx_, 
                                      depth_D, ip_, host_D, connDomain_, cidx_, 
                                      conn_, host_Co, ip_C, hidx_C, host_idx_C, 
                                      pidx_C, port_idx_C, host_Dis, ip_Di, 
                                      connDomain_D, cidx_D, conn_D, host, ip, 
                                      connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                      pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                      ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                      ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                      ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                      sport, dstAddr, dport, pkt_Pr, 
                                      hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                      otherEntry_, i_, indicies_, portDomain_, 
                                      sourcePort_, destPort_, new_sport_, 
                                      depth_Pr, pkt_Pri, conn_Pr, 
                                      hostMarker_Pri, daddr_P, hostidx_P, 
                                      hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                      portDomain_P, sourcePort_P, destPort_P, 
                                      new_sport_P, pkt_Priv, conn_Pri, 
                                      hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                      hidx_Pri, otherEntry_Pr, i_Pr, 
                                      indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                      entry_Pub, conn_PubT, hostMarker_Pub, 
                                      ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                      host_PubT, depth_Priv, pkt_PrivTo, 
                                      conn_PrivT, hostMarker_PrivTo, 
                                      daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth_PrivT, conn_PrivTo, hostMarker, 
                                      daddr, hostidx, hidx, otherEntry, 
                                      i_PrivT, indicies, portDomain, 
                                      sourcePort, destPort, new_sport, good, 
                                      depth, i_Even, j, ip_Even, host_Even, 
                                      indecies, i_Che, i, aa >>

privtopubRet(self) == /\ pc[self] = "privtopubRet"
                      /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                      /\ pkt' = [pkt EXCEPT ![self] = Head(stack[self]).pkt]
                      /\ conn_PrivTo' = [conn_PrivTo EXCEPT ![self] = Head(stack[self]).conn_PrivTo]
                      /\ hostMarker' = [hostMarker EXCEPT ![self] = Head(stack[self]).hostMarker]
                      /\ daddr' = [daddr EXCEPT ![self] = Head(stack[self]).daddr]
                      /\ hostidx' = [hostidx EXCEPT ![self] = Head(stack[self]).hostidx]
                      /\ hidx' = [hidx EXCEPT ![self] = Head(stack[self]).hidx]
                      /\ otherEntry' = [otherEntry EXCEPT ![self] = Head(stack[self]).otherEntry]
                      /\ i_PrivT' = [i_PrivT EXCEPT ![self] = Head(stack[self]).i_PrivT]
                      /\ indicies' = [indicies EXCEPT ![self] = Head(stack[self]).indicies]
                      /\ portDomain' = [portDomain EXCEPT ![self] = Head(stack[self]).portDomain]
                      /\ sourcePort' = [sourcePort EXCEPT ![self] = Head(stack[self]).sourcePort]
                      /\ destPort' = [destPort EXCEPT ![self] = Head(stack[self]).destPort]
                      /\ new_sport' = [new_sport EXCEPT ![self] = Head(stack[self]).new_sport]
                      /\ good' = [good EXCEPT ![self] = Head(stack[self]).good]
                      /\ depth_PrivT' = [depth_PrivT EXCEPT ![self] = Head(stack[self]).depth_PrivT]
                      /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                      /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                      Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                      Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                      Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                      PortMap2, TableFull, EvictionReroute, 
                                      PortScanInv, MaxTableSize, hosts, 
                                      FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                      ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                      Connections, SendQueue, RcvQueue, MAX, 
                                      Marker1, Marker2, CmdConnect, 
                                      CmdDisconnect, PortSpaceFull, depth_, 
                                      host_, hidx_, host_idx_, pidx_, 
                                      port_idx_, depth_D, ip_, host_D, 
                                      connDomain_, cidx_, conn_, host_Co, ip_C, 
                                      hidx_C, host_idx_C, pidx_C, port_idx_C, 
                                      host_Dis, ip_Di, connDomain_D, cidx_D, 
                                      conn_D, host, ip, connDomain_Di, cidx_Di, 
                                      conn_Di, depth_P, pkt_, ipkt_, entry_, 
                                      conn_P, hostMarker_, ip_idx_, ipidx_, 
                                      ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                      conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                      ip_Pu, host_Pu, conn, sport, dstAddr, 
                                      dport, pkt_Pr, hostMarker_Pr, daddr_, 
                                      hostidx_, hidx_P, otherEntry_, i_, 
                                      indicies_, portDomain_, sourcePort_, 
                                      destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                      conn_Pr, hostMarker_Pri, daddr_P, 
                                      hostidx_P, hidx_Pr, otherEntry_P, i_P, 
                                      indicies_P, portDomain_P, sourcePort_P, 
                                      destPort_P, new_sport_P, pkt_Priv, 
                                      conn_Pri, hostMarker_Priv, daddr_Pr, 
                                      hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                      i_Pr, indicies_Pr, portDomain_Pr, 
                                      sourcePort_Pr, destPort_Pr, new_sport_Pr, 
                                      depth_C, host_C, hidx_Co, host_idx, pidx, 
                                      port_idx, depth_Di, ip_D, host_Di, 
                                      connDomain, cidx, conn_Dis, depth_Pu, 
                                      pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                      hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                      ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                      conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                      hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                      i_Pri, indicies_Pri, portDomain_Pri, 
                                      sourcePort_Pri, destPort_Pri, 
                                      new_sport_Pri, good_, depth_E, i_E, j_, 
                                      ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                      j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                      i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                      entry_Pub, conn_PubT, hostMarker_Pub, 
                                      ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                      host_PubT, depth_Priv, pkt_PrivTo, 
                                      conn_PrivT, hostMarker_PrivTo, 
                                      daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                      otherEntry_Priv, i_Priv, indicies_Priv, 
                                      portDomain_Priv, sourcePort_Priv, 
                                      destPort_Priv, new_sport_Priv, depth_Eve, 
                                      i_Eve, j_Ev, ip_Eve, host_Eve, 
                                      indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                                      entry, conn_PubTo, hostMarker_PubT, 
                                      ip_idx, ipidx, ip_PubTo, host_PubTo, 
                                      depth, i_Even, j, ip_Even, host_Even, 
                                      indecies, i_Che, i, aa >>

PrivToPubExit(self) == privtopubStart(self) \/ privtopubIf(self)
                          \/ privtopubConn(self) \/ privtopubDport(self)
                          \/ privtopubMaxPorts1(self)
                          \/ privtopubMaxPorts2(self)
                          \/ privtopubGood(self) \/ privToPubPkt1(self)
                          \/ privToPubNewPort(self)
                          \/ privToPubAppendT(self) \/ privtopubPkt(self)
                          \/ privtopubRet(self)

evtSeqStart(self) == /\ pc[self] = "evtSeqStart"
                     /\ IF depth[self] <= 0
                           THEN /\ pc' = [pc EXCEPT ![self] = "evtSeqD0"]
                                /\ UNCHANGED << stack, depth_C, host_C, 
                                                hidx_Co, host_idx, pidx, 
                                                port_idx, depth_Di, ip_D, 
                                                host_Di, connDomain, cidx, 
                                                conn_Dis, depth_PubT, pkt_PubT, 
                                                ipkt, entry, conn_PubTo, 
                                                hostMarker_PubT, ip_idx, ipidx, 
                                                ip_PubTo, host_PubTo, 
                                                depth_PrivT, pkt, conn_PrivTo, 
                                                hostMarker, daddr, hostidx, 
                                                hidx, otherEntry, i_PrivT, 
                                                indicies, portDomain, 
                                                sourcePort, destPort, 
                                                new_sport, good >>
                           ELSE /\ \/ /\ IF Len(FreeIPs) > 0
                                            THEN /\ /\ depth_C' = [depth_C EXCEPT ![self] = depth[self] - 1]
                                                    /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Connect",
                                                                                             pc        |->  "evtSeqRet",
                                                                                             host_C    |->  host_C[self],
                                                                                             hidx_Co   |->  hidx_Co[self],
                                                                                             host_idx  |->  host_idx[self],
                                                                                             pidx      |->  pidx[self],
                                                                                             port_idx  |->  port_idx[self],
                                                                                             depth_C   |->  depth_C[self] ] >>
                                                                                         \o stack[self]]
                                                 /\ host_C' = [host_C EXCEPT ![self] = defaultInitValue]
                                                 /\ hidx_Co' = [hidx_Co EXCEPT ![self] = defaultInitValue]
                                                 /\ host_idx' = [host_idx EXCEPT ![self] = defaultInitValue]
                                                 /\ pidx' = [pidx EXCEPT ![self] = defaultInitValue]
                                                 /\ port_idx' = [port_idx EXCEPT ![self] = defaultInitValue]
                                                 /\ pc' = [pc EXCEPT ![self] = "connectStart"]
                                            ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet"]
                                                 /\ UNCHANGED << stack, 
                                                                 depth_C, 
                                                                 host_C, 
                                                                 hidx_Co, 
                                                                 host_idx, 
                                                                 pidx, 
                                                                 port_idx >>
                                      /\ UNCHANGED <<depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, depth_PubT, pkt_PubT, ipkt, entry, conn_PubTo, hostMarker_PubT, ip_idx, ipidx, ip_PubTo, host_PubTo, depth_PrivT, pkt, conn_PrivTo, hostMarker, daddr, hostidx, hidx, otherEntry, i_PrivT, indicies, portDomain, sourcePort, destPort, new_sport, good>>
                                   \/ /\ IF Len (Connections) > 0
                                            THEN /\ /\ depth_Di' = [depth_Di EXCEPT ![self] = depth[self] - 1]
                                                    /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "Disconnect",
                                                                                             pc        |->  "evtSeqRet",
                                                                                             ip_D      |->  ip_D[self],
                                                                                             host_Di   |->  host_Di[self],
                                                                                             connDomain |->  connDomain[self],
                                                                                             cidx      |->  cidx[self],
                                                                                             conn_Dis  |->  conn_Dis[self],
                                                                                             depth_Di  |->  depth_Di[self] ] >>
                                                                                         \o stack[self]]
                                                 /\ ip_D' = [ip_D EXCEPT ![self] = defaultInitValue]
                                                 /\ host_Di' = [host_Di EXCEPT ![self] = defaultInitValue]
                                                 /\ connDomain' = [connDomain EXCEPT ![self] = defaultInitValue]
                                                 /\ cidx' = [cidx EXCEPT ![self] = defaultInitValue]
                                                 /\ conn_Dis' = [conn_Dis EXCEPT ![self] = defaultInitValue]
                                                 /\ pc' = [pc EXCEPT ![self] = "disconnectStart"]
                                            ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet"]
                                                 /\ UNCHANGED << stack, 
                                                                 depth_Di, 
                                                                 ip_D, host_Di, 
                                                                 connDomain, 
                                                                 cidx, 
                                                                 conn_Dis >>
                                      /\ UNCHANGED <<depth_C, host_C, hidx_Co, host_idx, pidx, port_idx, depth_PubT, pkt_PubT, ipkt, entry, conn_PubTo, hostMarker_PubT, ip_idx, ipidx, ip_PubTo, host_PubTo, depth_PrivT, pkt, conn_PrivTo, hostMarker, daddr, hostidx, hidx, otherEntry, i_PrivT, indicies, portDomain, sourcePort, destPort, new_sport, good>>
                                   \/ /\ IF Len(Connections) > 0
                                            THEN /\ /\ depth_PrivT' = [depth_PrivT EXCEPT ![self] = depth[self] - 1]
                                                    /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PrivToPubExit",
                                                                                             pc        |->  "evtSeqRet",
                                                                                             pkt       |->  pkt[self],
                                                                                             conn_PrivTo |->  conn_PrivTo[self],
                                                                                             hostMarker |->  hostMarker[self],
                                                                                             daddr     |->  daddr[self],
                                                                                             hostidx   |->  hostidx[self],
                                                                                             hidx      |->  hidx[self],
                                                                                             otherEntry |->  otherEntry[self],
                                                                                             i_PrivT   |->  i_PrivT[self],
                                                                                             indicies  |->  indicies[self],
                                                                                             portDomain |->  portDomain[self],
                                                                                             sourcePort |->  sourcePort[self],
                                                                                             destPort  |->  destPort[self],
                                                                                             new_sport |->  new_sport[self],
                                                                                             good      |->  good[self],
                                                                                             depth_PrivT |->  depth_PrivT[self] ] >>
                                                                                         \o stack[self]]
                                                 /\ pkt' = [pkt EXCEPT ![self] = defaultInitValue]
                                                 /\ conn_PrivTo' = [conn_PrivTo EXCEPT ![self] = defaultInitValue]
                                                 /\ hostMarker' = [hostMarker EXCEPT ![self] = defaultInitValue]
                                                 /\ daddr' = [daddr EXCEPT ![self] = defaultInitValue]
                                                 /\ hostidx' = [hostidx EXCEPT ![self] = defaultInitValue]
                                                 /\ hidx' = [hidx EXCEPT ![self] = defaultInitValue]
                                                 /\ otherEntry' = [otherEntry EXCEPT ![self] = defaultInitValue]
                                                 /\ i_PrivT' = [i_PrivT EXCEPT ![self] = defaultInitValue]
                                                 /\ indicies' = [indicies EXCEPT ![self] = defaultInitValue]
                                                 /\ portDomain' = [portDomain EXCEPT ![self] = defaultInitValue]
                                                 /\ sourcePort' = [sourcePort EXCEPT ![self] = defaultInitValue]
                                                 /\ destPort' = [destPort EXCEPT ![self] = defaultInitValue]
                                                 /\ new_sport' = [new_sport EXCEPT ![self] = defaultInitValue]
                                                 /\ good' = [good EXCEPT ![self] = defaultInitValue]
                                                 /\ pc' = [pc EXCEPT ![self] = "privtopubStart"]
                                            ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet"]
                                                 /\ UNCHANGED << stack, 
                                                                 depth_PrivT, 
                                                                 pkt, 
                                                                 conn_PrivTo, 
                                                                 hostMarker, 
                                                                 daddr, 
                                                                 hostidx, hidx, 
                                                                 otherEntry, 
                                                                 i_PrivT, 
                                                                 indicies, 
                                                                 portDomain, 
                                                                 sourcePort, 
                                                                 destPort, 
                                                                 new_sport, 
                                                                 good >>
                                      /\ UNCHANGED <<depth_C, host_C, hidx_Co, host_idx, pidx, port_idx, depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, depth_PubT, pkt_PubT, ipkt, entry, conn_PubTo, hostMarker_PubT, ip_idx, ipidx, ip_PubTo, host_PubTo>>
                                   \/ /\ IF Len(SendQueue) > 0
                                            THEN /\ /\ depth_PubT' = [depth_PubT EXCEPT ![self] = depth[self] - 1]
                                                    /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "PubToPrivExit",
                                                                                             pc        |->  "evtSeqRet",
                                                                                             pkt_PubT  |->  pkt_PubT[self],
                                                                                             ipkt      |->  ipkt[self],
                                                                                             entry     |->  entry[self],
                                                                                             conn_PubTo |->  conn_PubTo[self],
                                                                                             hostMarker_PubT |->  hostMarker_PubT[self],
                                                                                             ip_idx    |->  ip_idx[self],
                                                                                             ipidx     |->  ipidx[self],
                                                                                             ip_PubTo  |->  ip_PubTo[self],
                                                                                             host_PubTo |->  host_PubTo[self],
                                                                                             depth_PubT |->  depth_PubT[self] ] >>
                                                                                         \o stack[self]]
                                                 /\ pkt_PubT' = [pkt_PubT EXCEPT ![self] = defaultInitValue]
                                                 /\ ipkt' = [ipkt EXCEPT ![self] = defaultInitValue]
                                                 /\ entry' = [entry EXCEPT ![self] = defaultInitValue]
                                                 /\ conn_PubTo' = [conn_PubTo EXCEPT ![self] = defaultInitValue]
                                                 /\ hostMarker_PubT' = [hostMarker_PubT EXCEPT ![self] = defaultInitValue]
                                                 /\ ip_idx' = [ip_idx EXCEPT ![self] = defaultInitValue]
                                                 /\ ipidx' = [ipidx EXCEPT ![self] = defaultInitValue]
                                                 /\ ip_PubTo' = [ip_PubTo EXCEPT ![self] = defaultInitValue]
                                                 /\ host_PubTo' = [host_PubTo EXCEPT ![self] = defaultInitValue]
                                                 /\ pc' = [pc EXCEPT ![self] = "pubtoprivStart"]
                                            ELSE /\ pc' = [pc EXCEPT ![self] = "evtSeqRet"]
                                                 /\ UNCHANGED << stack, 
                                                                 depth_PubT, 
                                                                 pkt_PubT, 
                                                                 ipkt, entry, 
                                                                 conn_PubTo, 
                                                                 hostMarker_PubT, 
                                                                 ip_idx, ipidx, 
                                                                 ip_PubTo, 
                                                                 host_PubTo >>
                                      /\ UNCHANGED <<depth_C, host_C, hidx_Co, host_idx, pidx, port_idx, depth_Di, ip_D, host_Di, connDomain, cidx, conn_Dis, depth_PrivT, pkt, conn_PrivTo, hostMarker, daddr, hostidx, hidx, otherEntry, i_PrivT, indicies, portDomain, sourcePort, destPort, new_sport, good>>
                     /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                     Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, 
                                     Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, 
                                     Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                                     PortMap2, TableFull, EvictionReroute, 
                                     PortScanInv, MaxTableSize, hosts, 
                                     FreeHosts, UsedHosts, Ports, ExtraPorts, 
                                     ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                     Connections, SendQueue, RcvQueue, MAX, 
                                     Marker1, Marker2, CmdConnect, 
                                     CmdDisconnect, PortSpaceFull, depth_, 
                                     host_, hidx_, host_idx_, pidx_, port_idx_, 
                                     depth_D, ip_, host_D, connDomain_, cidx_, 
                                     conn_, host_Co, ip_C, hidx_C, host_idx_C, 
                                     pidx_C, port_idx_C, host_Dis, ip_Di, 
                                     connDomain_D, cidx_D, conn_D, host, ip, 
                                     connDomain_Di, cidx_Di, conn_Di, depth_P, 
                                     pkt_, ipkt_, entry_, conn_P, hostMarker_, 
                                     ip_idx_, ipidx_, ip_P, host_P, pkt_P, 
                                     ipkt_P, entry_P, conn_Pu, hostMarker_P, 
                                     ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                                     sport, dstAddr, dport, pkt_Pr, 
                                     hostMarker_Pr, daddr_, hostidx_, hidx_P, 
                                     otherEntry_, i_, indicies_, portDomain_, 
                                     sourcePort_, destPort_, new_sport_, 
                                     depth_Pr, pkt_Pri, conn_Pr, 
                                     hostMarker_Pri, daddr_P, hostidx_P, 
                                     hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                     portDomain_P, sourcePort_P, destPort_P, 
                                     new_sport_P, pkt_Priv, conn_Pri, 
                                     hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                     hidx_Pri, otherEntry_Pr, i_Pr, 
                                     indicies_Pr, portDomain_Pr, sourcePort_Pr, 
                                     destPort_Pr, new_sport_Pr, depth_Pu, 
                                     pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                     hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                     ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                     conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                     hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                     i_Pri, indicies_Pri, portDomain_Pri, 
                                     sourcePort_Pri, destPort_Pri, 
                                     new_sport_Pri, good_, depth_E, i_E, j_, 
                                     ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                     j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                     i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                     entry_Pub, conn_PubT, hostMarker_Pub, 
                                     ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                     depth_Priv, pkt_PrivTo, conn_PrivT, 
                                     hostMarker_PrivTo, daddr_Priv, 
                                     hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                     i_Priv, indicies_Priv, portDomain_Priv, 
                                     sourcePort_Priv, destPort_Priv, 
                                     new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                     ip_Eve, host_Eve, indecies_Ev, depth, 
                                     i_Even, j, ip_Even, host_Even, indecies, 
                                     i_Che, i, aa >>

evtSeqD0(self) == /\ pc[self] = "evtSeqD0"
                  /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                  /\ i_Even' = [i_Even EXCEPT ![self] = Head(stack[self]).i_Even]
                  /\ j' = [j EXCEPT ![self] = Head(stack[self]).j]
                  /\ ip_Even' = [ip_Even EXCEPT ![self] = Head(stack[self]).ip_Even]
                  /\ host_Even' = [host_Even EXCEPT ![self] = Head(stack[self]).host_Even]
                  /\ indecies' = [indecies EXCEPT ![self] = Head(stack[self]).indecies]
                  /\ depth' = [depth EXCEPT ![self] = Head(stack[self]).depth]
                  /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                  /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, Ff, 
                                  Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, Qq, 
                                  Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                  MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                  TableFull, EvictionReroute, PortScanInv, 
                                  MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                  Ports, ExtraPorts, ExtraExtraPorts, T, 
                                  FreeIPs, UsedIPs, Connections, SendQueue, 
                                  RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                  CmdDisconnect, PortSpaceFull, depth_, host_, 
                                  hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                  ip_, host_D, connDomain_, cidx_, conn_, 
                                  host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                  port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                  cidx_D, conn_D, host, ip, connDomain_Di, 
                                  cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                  entry_, conn_P, hostMarker_, ip_idx_, ipidx_, 
                                  ip_P, host_P, pkt_P, ipkt_P, entry_P, 
                                  conn_Pu, hostMarker_P, ip_idx_P, ipidx_P, 
                                  ip_Pu, host_Pu, conn, sport, dstAddr, dport, 
                                  pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                  hidx_P, otherEntry_, i_, indicies_, 
                                  portDomain_, sourcePort_, destPort_, 
                                  new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                  hostMarker_Pri, daddr_P, hostidx_P, hidx_Pr, 
                                  otherEntry_P, i_P, indicies_P, portDomain_P, 
                                  sourcePort_P, destPort_P, new_sport_P, 
                                  pkt_Priv, conn_Pri, hostMarker_Priv, 
                                  daddr_Pr, hostidx_Pr, hidx_Pri, 
                                  otherEntry_Pr, i_Pr, indicies_Pr, 
                                  portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                  new_sport_Pr, depth_C, host_C, hidx_Co, 
                                  host_idx, pidx, port_idx, depth_Di, ip_D, 
                                  host_Di, connDomain, cidx, conn_Dis, 
                                  depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                  conn_Pub, hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                  ip_Pub, host_Pub, depth_Pri, pkt_PrivT, 
                                  conn_Priv, hostMarker_PrivT, daddr_Pri, 
                                  hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                  i_Pri, indicies_Pri, portDomain_Pri, 
                                  sourcePort_Pri, destPort_Pri, new_sport_Pri, 
                                  good_, depth_E, i_E, j_, ip_E, host_E, 
                                  indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                  host_Ev, indecies_E, i_C, i_Ch, depth_Pub, 
                                  pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                                  hostMarker_Pub, ip_idx_Pub, ipidx_Pub, 
                                  ip_PubT, host_PubT, depth_Priv, pkt_PrivTo, 
                                  conn_PrivT, hostMarker_PrivTo, daddr_Priv, 
                                  hostidx_Priv, hidx_PrivT, otherEntry_Priv, 
                                  i_Priv, indicies_Priv, portDomain_Priv, 
                                  sourcePort_Priv, destPort_Priv, 
                                  new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                  ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                  pkt_PubT, ipkt, entry, conn_PubTo, 
                                  hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                  host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                  hostMarker, daddr, hostidx, hidx, otherEntry, 
                                  i_PrivT, indicies, portDomain, sourcePort, 
                                  destPort, new_sport, good, i_Che, i, aa >>

evtSeqRet(self) == /\ pc[self] = "evtSeqRet"
                   /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                   /\ i_Even' = [i_Even EXCEPT ![self] = Head(stack[self]).i_Even]
                   /\ j' = [j EXCEPT ![self] = Head(stack[self]).j]
                   /\ ip_Even' = [ip_Even EXCEPT ![self] = Head(stack[self]).ip_Even]
                   /\ host_Even' = [host_Even EXCEPT ![self] = Head(stack[self]).host_Even]
                   /\ indecies' = [indecies EXCEPT ![self] = Head(stack[self]).indecies]
                   /\ depth' = [depth EXCEPT ![self] = Head(stack[self]).depth]
                   /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                   /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, 
                                   Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, 
                                   Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                   H2, MaxPorts, EP1, PortMap1, EP2, PortMap2, 
                                   TableFull, EvictionReroute, PortScanInv, 
                                   MaxTableSize, hosts, FreeHosts, UsedHosts, 
                                   Ports, ExtraPorts, ExtraExtraPorts, T, 
                                   FreeIPs, UsedIPs, Connections, SendQueue, 
                                   RcvQueue, MAX, Marker1, Marker2, CmdConnect, 
                                   CmdDisconnect, PortSpaceFull, depth_, host_, 
                                   hidx_, host_idx_, pidx_, port_idx_, depth_D, 
                                   ip_, host_D, connDomain_, cidx_, conn_, 
                                   host_Co, ip_C, hidx_C, host_idx_C, pidx_C, 
                                   port_idx_C, host_Dis, ip_Di, connDomain_D, 
                                   cidx_D, conn_D, host, ip, connDomain_Di, 
                                   cidx_Di, conn_Di, depth_P, pkt_, ipkt_, 
                                   entry_, conn_P, hostMarker_, ip_idx_, 
                                   ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                   entry_P, conn_Pu, hostMarker_P, ip_idx_P, 
                                   ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                   dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                   daddr_, hostidx_, hidx_P, otherEntry_, i_, 
                                   indicies_, portDomain_, sourcePort_, 
                                   destPort_, new_sport_, depth_Pr, pkt_Pri, 
                                   conn_Pr, hostMarker_Pri, daddr_P, hostidx_P, 
                                   hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                   portDomain_P, sourcePort_P, destPort_P, 
                                   new_sport_P, pkt_Priv, conn_Pri, 
                                   hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                   hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                                   portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                                   new_sport_Pr, depth_C, host_C, hidx_Co, 
                                   host_idx, pidx, port_idx, depth_Di, ip_D, 
                                   host_Di, connDomain, cidx, conn_Dis, 
                                   depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                                   conn_Pub, hostMarker_Pu, ip_idx_Pu, 
                                   ipidx_Pu, ip_Pub, host_Pub, depth_Pri, 
                                   pkt_PrivT, conn_Priv, hostMarker_PrivT, 
                                   daddr_Pri, hostidx_Pri, hidx_Priv, 
                                   otherEntry_Pri, i_Pri, indicies_Pri, 
                                   portDomain_Pri, sourcePort_Pri, 
                                   destPort_Pri, new_sport_Pri, good_, depth_E, 
                                   i_E, j_, ip_E, host_E, indecies_, depth_Ev, 
                                   i_Ev, j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                   i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                   entry_Pub, conn_PubT, hostMarker_Pub, 
                                   ip_idx_Pub, ipidx_Pub, ip_PubT, host_PubT, 
                                   depth_Priv, pkt_PrivTo, conn_PrivT, 
                                   hostMarker_PrivTo, daddr_Priv, hostidx_Priv, 
                                   hidx_PrivT, otherEntry_Priv, i_Priv, 
                                   indicies_Priv, portDomain_Priv, 
                                   sourcePort_Priv, destPort_Priv, 
                                   new_sport_Priv, depth_Eve, i_Eve, j_Ev, 
                                   ip_Eve, host_Eve, indecies_Ev, depth_PubT, 
                                   pkt_PubT, ipkt, entry, conn_PubTo, 
                                   hostMarker_PubT, ip_idx, ipidx, ip_PubTo, 
                                   host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                                   hostMarker, daddr, hostidx, hidx, 
                                   otherEntry, i_PrivT, indicies, portDomain, 
                                   sourcePort, destPort, new_sport, good, 
                                   i_Che, i, aa >>

EventSequenceExit(self) == evtSeqStart(self) \/ evtSeqD0(self)
                              \/ evtSeqRet(self)

checkModelStart(self) == /\ pc[self] = "checkModelStart"
                         /\ i_Che' = [i_Che EXCEPT ![self] = 0]
                         /\ pc' = [pc EXCEPT ![self] = "checkModelWhile"]
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, stack, 
                                         depth_, host_, hidx_, host_idx_, 
                                         pidx_, port_idx_, depth_D, ip_, 
                                         host_D, connDomain_, cidx_, conn_, 
                                         host_Co, ip_C, hidx_C, host_idx_C, 
                                         pidx_C, port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, depth, i_Even, j, 
                                         ip_Even, host_Even, indecies, i, aa >>

checkModelWhile(self) == /\ pc[self] = "checkModelWhile"
                         /\ IF i_Che[self] < MAX
                               THEN /\ PrintT(i_Che[self])
                                    /\ /\ depth' = [depth EXCEPT ![self] = MAX]
                                       /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceExit",
                                                                                pc        |->  "checkModelInc",
                                                                                i_Even    |->  i_Even[self],
                                                                                j         |->  j[self],
                                                                                ip_Even   |->  ip_Even[self],
                                                                                host_Even |->  host_Even[self],
                                                                                indecies  |->  indecies[self],
                                                                                depth     |->  depth[self] ] >>
                                                                            \o stack[self]]
                                    /\ i_Even' = [i_Even EXCEPT ![self] = defaultInitValue]
                                    /\ j' = [j EXCEPT ![self] = defaultInitValue]
                                    /\ ip_Even' = [ip_Even EXCEPT ![self] = defaultInitValue]
                                    /\ host_Even' = [host_Even EXCEPT ![self] = defaultInitValue]
                                    /\ indecies' = [indecies EXCEPT ![self] = defaultInitValue]
                                    /\ pc' = [pc EXCEPT ![self] = "evtSeqStart"]
                               ELSE /\ pc' = [pc EXCEPT ![self] = "checkModelRet"]
                                    /\ UNCHANGED << stack, depth, i_Even, j, 
                                                    ip_Even, host_Even, 
                                                    indecies >>
                         /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                         Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, 
                                         Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                                         Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, 
                                         PortMap1, EP2, PortMap2, TableFull, 
                                         EvictionReroute, PortScanInv, 
                                         MaxTableSize, hosts, FreeHosts, 
                                         UsedHosts, Ports, ExtraPorts, 
                                         ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                         Connections, SendQueue, RcvQueue, MAX, 
                                         Marker1, Marker2, CmdConnect, 
                                         CmdDisconnect, PortSpaceFull, depth_, 
                                         host_, hidx_, host_idx_, pidx_, 
                                         port_idx_, depth_D, ip_, host_D, 
                                         connDomain_, cidx_, conn_, host_Co, 
                                         ip_C, hidx_C, host_idx_C, pidx_C, 
                                         port_idx_C, host_Dis, ip_Di, 
                                         connDomain_D, cidx_D, conn_D, host, 
                                         ip, connDomain_Di, cidx_Di, conn_Di, 
                                         depth_P, pkt_, ipkt_, entry_, conn_P, 
                                         hostMarker_, ip_idx_, ipidx_, ip_P, 
                                         host_P, pkt_P, ipkt_P, entry_P, 
                                         conn_Pu, hostMarker_P, ip_idx_P, 
                                         ipidx_P, ip_Pu, host_Pu, conn, sport, 
                                         dstAddr, dport, pkt_Pr, hostMarker_Pr, 
                                         daddr_, hostidx_, hidx_P, otherEntry_, 
                                         i_, indicies_, portDomain_, 
                                         sourcePort_, destPort_, new_sport_, 
                                         depth_Pr, pkt_Pri, conn_Pr, 
                                         hostMarker_Pri, daddr_P, hostidx_P, 
                                         hidx_Pr, otherEntry_P, i_P, 
                                         indicies_P, portDomain_P, 
                                         sourcePort_P, destPort_P, new_sport_P, 
                                         pkt_Priv, conn_Pri, hostMarker_Priv, 
                                         daddr_Pr, hostidx_Pr, hidx_Pri, 
                                         otherEntry_Pr, i_Pr, indicies_Pr, 
                                         portDomain_Pr, sourcePort_Pr, 
                                         destPort_Pr, new_sport_Pr, depth_C, 
                                         host_C, hidx_Co, host_idx, pidx, 
                                         port_idx, depth_Di, ip_D, host_Di, 
                                         connDomain, cidx, conn_Dis, depth_Pu, 
                                         pkt_Pu, ipkt_Pu, entry_Pu, conn_Pub, 
                                         hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                         ip_Pub, host_Pub, depth_Pri, 
                                         pkt_PrivT, conn_Priv, 
                                         hostMarker_PrivT, daddr_Pri, 
                                         hostidx_Pri, hidx_Priv, 
                                         otherEntry_Pri, i_Pri, indicies_Pri, 
                                         portDomain_Pri, sourcePort_Pri, 
                                         destPort_Pri, new_sport_Pri, good_, 
                                         depth_E, i_E, j_, ip_E, host_E, 
                                         indecies_, depth_Ev, i_Ev, j_E, ip_Ev, 
                                         host_Ev, indecies_E, i_C, i_Ch, 
                                         depth_Pub, pkt_Pub, ipkt_Pub, 
                                         entry_Pub, conn_PubT, hostMarker_Pub, 
                                         ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                         host_PubT, depth_Priv, pkt_PrivTo, 
                                         conn_PrivT, hostMarker_PrivTo, 
                                         daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                         otherEntry_Priv, i_Priv, 
                                         indicies_Priv, portDomain_Priv, 
                                         sourcePort_Priv, destPort_Priv, 
                                         new_sport_Priv, depth_Eve, i_Eve, 
                                         j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                         depth_PubT, pkt_PubT, ipkt, entry, 
                                         conn_PubTo, hostMarker_PubT, ip_idx, 
                                         ipidx, ip_PubTo, host_PubTo, 
                                         depth_PrivT, pkt, conn_PrivTo, 
                                         hostMarker, daddr, hostidx, hidx, 
                                         otherEntry, i_PrivT, indicies, 
                                         portDomain, sourcePort, destPort, 
                                         new_sport, good, i_Che, i, aa >>

checkModelInc(self) == /\ pc[self] = "checkModelInc"
                       /\ i_Che' = [i_Che EXCEPT ![self] = i_Che[self] + 1]
                       /\ pc' = [pc EXCEPT ![self] = "checkModelWhile"]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, stack, 
                                       depth_, host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i, aa >>

checkModelRet(self) == /\ pc[self] = "checkModelRet"
                       /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                       /\ i_Che' = [i_Che EXCEPT ![self] = Head(stack[self]).i_Che]
                       /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                       /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, 
                                       Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, Mm, Nn, 
                                       Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, Ww, Xx, 
                                       Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, 
                                       EP2, PortMap2, TableFull, 
                                       EvictionReroute, PortScanInv, 
                                       MaxTableSize, hosts, FreeHosts, 
                                       UsedHosts, Ports, ExtraPorts, 
                                       ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                                       Connections, SendQueue, RcvQueue, MAX, 
                                       Marker1, Marker2, CmdConnect, 
                                       CmdDisconnect, PortSpaceFull, depth_, 
                                       host_, hidx_, host_idx_, pidx_, 
                                       port_idx_, depth_D, ip_, host_D, 
                                       connDomain_, cidx_, conn_, host_Co, 
                                       ip_C, hidx_C, host_idx_C, pidx_C, 
                                       port_idx_C, host_Dis, ip_Di, 
                                       connDomain_D, cidx_D, conn_D, host, ip, 
                                       connDomain_Di, cidx_Di, conn_Di, 
                                       depth_P, pkt_, ipkt_, entry_, conn_P, 
                                       hostMarker_, ip_idx_, ipidx_, ip_P, 
                                       host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                                       hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, 
                                       host_Pu, conn, sport, dstAddr, dport, 
                                       pkt_Pr, hostMarker_Pr, daddr_, hostidx_, 
                                       hidx_P, otherEntry_, i_, indicies_, 
                                       portDomain_, sourcePort_, destPort_, 
                                       new_sport_, depth_Pr, pkt_Pri, conn_Pr, 
                                       hostMarker_Pri, daddr_P, hostidx_P, 
                                       hidx_Pr, otherEntry_P, i_P, indicies_P, 
                                       portDomain_P, sourcePort_P, destPort_P, 
                                       new_sport_P, pkt_Priv, conn_Pri, 
                                       hostMarker_Priv, daddr_Pr, hostidx_Pr, 
                                       hidx_Pri, otherEntry_Pr, i_Pr, 
                                       indicies_Pr, portDomain_Pr, 
                                       sourcePort_Pr, destPort_Pr, 
                                       new_sport_Pr, depth_C, host_C, hidx_Co, 
                                       host_idx, pidx, port_idx, depth_Di, 
                                       ip_D, host_Di, connDomain, cidx, 
                                       conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, 
                                       entry_Pu, conn_Pub, hostMarker_Pu, 
                                       ip_idx_Pu, ipidx_Pu, ip_Pub, host_Pub, 
                                       depth_Pri, pkt_PrivT, conn_Priv, 
                                       hostMarker_PrivT, daddr_Pri, 
                                       hostidx_Pri, hidx_Priv, otherEntry_Pri, 
                                       i_Pri, indicies_Pri, portDomain_Pri, 
                                       sourcePort_Pri, destPort_Pri, 
                                       new_sport_Pri, good_, depth_E, i_E, j_, 
                                       ip_E, host_E, indecies_, depth_Ev, i_Ev, 
                                       j_E, ip_Ev, host_Ev, indecies_E, i_C, 
                                       i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                       entry_Pub, conn_PubT, hostMarker_Pub, 
                                       ip_idx_Pub, ipidx_Pub, ip_PubT, 
                                       host_PubT, depth_Priv, pkt_PrivTo, 
                                       conn_PrivT, hostMarker_PrivTo, 
                                       daddr_Priv, hostidx_Priv, hidx_PrivT, 
                                       otherEntry_Priv, i_Priv, indicies_Priv, 
                                       portDomain_Priv, sourcePort_Priv, 
                                       destPort_Priv, new_sport_Priv, 
                                       depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                       host_Eve, indecies_Ev, depth_PubT, 
                                       pkt_PubT, ipkt, entry, conn_PubTo, 
                                       hostMarker_PubT, ip_idx, ipidx, 
                                       ip_PubTo, host_PubTo, depth_PrivT, pkt, 
                                       conn_PrivTo, hostMarker, daddr, hostidx, 
                                       hidx, otherEntry, i_PrivT, indicies, 
                                       portDomain, sourcePort, destPort, 
                                       new_sport, good, depth, i_Even, j, 
                                       ip_Even, host_Even, indecies, i, aa >>

CheckModelExit(self) == checkModelStart(self) \/ checkModelWhile(self)
                           \/ checkModelInc(self) \/ checkModelRet(self)

checkModelVulnStart(self) == /\ pc[self] = "checkModelVulnStart"
                             /\ i' = [i EXCEPT ![self] = 0]
                             /\ pc' = [pc EXCEPT ![self] = "checkModelVulnWhile"]
                             /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                             Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                             Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                             Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                             H2, MaxPorts, EP1, PortMap1, EP2, 
                                             PortMap2, TableFull, 
                                             EvictionReroute, PortScanInv, 
                                             MaxTableSize, hosts, FreeHosts, 
                                             UsedHosts, Ports, ExtraPorts, 
                                             ExtraExtraPorts, T, FreeIPs, 
                                             UsedIPs, Connections, SendQueue, 
                                             RcvQueue, MAX, Marker1, Marker2, 
                                             CmdConnect, CmdDisconnect, 
                                             PortSpaceFull, stack, depth_, 
                                             host_, hidx_, host_idx_, pidx_, 
                                             port_idx_, depth_D, ip_, host_D, 
                                             connDomain_, cidx_, conn_, 
                                             host_Co, ip_C, hidx_C, host_idx_C, 
                                             pidx_C, port_idx_C, host_Dis, 
                                             ip_Di, connDomain_D, cidx_D, 
                                             conn_D, host, ip, connDomain_Di, 
                                             cidx_Di, conn_Di, depth_P, pkt_, 
                                             ipkt_, entry_, conn_P, 
                                             hostMarker_, ip_idx_, ipidx_, 
                                             ip_P, host_P, pkt_P, ipkt_P, 
                                             entry_P, conn_Pu, hostMarker_P, 
                                             ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                             conn, sport, dstAddr, dport, 
                                             pkt_Pr, hostMarker_Pr, daddr_, 
                                             hostidx_, hidx_P, otherEntry_, i_, 
                                             indicies_, portDomain_, 
                                             sourcePort_, destPort_, 
                                             new_sport_, depth_Pr, pkt_Pri, 
                                             conn_Pr, hostMarker_Pri, daddr_P, 
                                             hostidx_P, hidx_Pr, otherEntry_P, 
                                             i_P, indicies_P, portDomain_P, 
                                             sourcePort_P, destPort_P, 
                                             new_sport_P, pkt_Priv, conn_Pri, 
                                             hostMarker_Priv, daddr_Pr, 
                                             hostidx_Pr, hidx_Pri, 
                                             otherEntry_Pr, i_Pr, indicies_Pr, 
                                             portDomain_Pr, sourcePort_Pr, 
                                             destPort_Pr, new_sport_Pr, 
                                             depth_C, host_C, hidx_Co, 
                                             host_idx, pidx, port_idx, 
                                             depth_Di, ip_D, host_Di, 
                                             connDomain, cidx, conn_Dis, 
                                             depth_Pu, pkt_Pu, ipkt_Pu, 
                                             entry_Pu, conn_Pub, hostMarker_Pu, 
                                             ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                             host_Pub, depth_Pri, pkt_PrivT, 
                                             conn_Priv, hostMarker_PrivT, 
                                             daddr_Pri, hostidx_Pri, hidx_Priv, 
                                             otherEntry_Pri, i_Pri, 
                                             indicies_Pri, portDomain_Pri, 
                                             sourcePort_Pri, destPort_Pri, 
                                             new_sport_Pri, good_, depth_E, 
                                             i_E, j_, ip_E, host_E, indecies_, 
                                             depth_Ev, i_Ev, j_E, ip_Ev, 
                                             host_Ev, indecies_E, i_C, i_Ch, 
                                             depth_Pub, pkt_Pub, ipkt_Pub, 
                                             entry_Pub, conn_PubT, 
                                             hostMarker_Pub, ip_idx_Pub, 
                                             ipidx_Pub, ip_PubT, host_PubT, 
                                             depth_Priv, pkt_PrivTo, 
                                             conn_PrivT, hostMarker_PrivTo, 
                                             daddr_Priv, hostidx_Priv, 
                                             hidx_PrivT, otherEntry_Priv, 
                                             i_Priv, indicies_Priv, 
                                             portDomain_Priv, sourcePort_Priv, 
                                             destPort_Priv, new_sport_Priv, 
                                             depth_Eve, i_Eve, j_Ev, ip_Eve, 
                                             host_Eve, indecies_Ev, depth_PubT, 
                                             pkt_PubT, ipkt, entry, conn_PubTo, 
                                             hostMarker_PubT, ip_idx, ipidx, 
                                             ip_PubTo, host_PubTo, depth_PrivT, 
                                             pkt, conn_PrivTo, hostMarker, 
                                             daddr, hostidx, hidx, otherEntry, 
                                             i_PrivT, indicies, portDomain, 
                                             sourcePort, destPort, new_sport, 
                                             good, depth, i_Even, j, ip_Even, 
                                             host_Even, indecies, i_Che, aa >>

checkModelVulnWhile(self) == /\ pc[self] = "checkModelVulnWhile"
                             /\ IF i[self] < MAX
                                   THEN /\ /\ depth_Eve' = [depth_Eve EXCEPT ![self] = MAX]
                                           /\ stack' = [stack EXCEPT ![self] = << [ procedure |->  "EventSequenceExitVuln",
                                                                                    pc        |->  "checkModelVulnInc",
                                                                                    i_Eve     |->  i_Eve[self],
                                                                                    j_Ev      |->  j_Ev[self],
                                                                                    ip_Eve    |->  ip_Eve[self],
                                                                                    host_Eve  |->  host_Eve[self],
                                                                                    indecies_Ev |->  indecies_Ev[self],
                                                                                    depth_Eve |->  depth_Eve[self] ] >>
                                                                                \o stack[self]]
                                        /\ i_Eve' = [i_Eve EXCEPT ![self] = defaultInitValue]
                                        /\ j_Ev' = [j_Ev EXCEPT ![self] = defaultInitValue]
                                        /\ ip_Eve' = [ip_Eve EXCEPT ![self] = defaultInitValue]
                                        /\ host_Eve' = [host_Eve EXCEPT ![self] = defaultInitValue]
                                        /\ indecies_Ev' = [indecies_Ev EXCEPT ![self] = defaultInitValue]
                                        /\ pc' = [pc EXCEPT ![self] = "evtSeqVStart"]
                                   ELSE /\ pc' = [pc EXCEPT ![self] = "checkModelVulnRet"]
                                        /\ UNCHANGED << stack, depth_Eve, 
                                                        i_Eve, j_Ev, ip_Eve, 
                                                        host_Eve, indecies_Ev >>
                             /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                             Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, 
                                             Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, 
                                             Tt, Uu, Vv, Ww, Xx, Yy, Zz, H1, 
                                             H2, MaxPorts, EP1, PortMap1, EP2, 
                                             PortMap2, TableFull, 
                                             EvictionReroute, PortScanInv, 
                                             MaxTableSize, hosts, FreeHosts, 
                                             UsedHosts, Ports, ExtraPorts, 
                                             ExtraExtraPorts, T, FreeIPs, 
                                             UsedIPs, Connections, SendQueue, 
                                             RcvQueue, MAX, Marker1, Marker2, 
                                             CmdConnect, CmdDisconnect, 
                                             PortSpaceFull, depth_, host_, 
                                             hidx_, host_idx_, pidx_, 
                                             port_idx_, depth_D, ip_, host_D, 
                                             connDomain_, cidx_, conn_, 
                                             host_Co, ip_C, hidx_C, host_idx_C, 
                                             pidx_C, port_idx_C, host_Dis, 
                                             ip_Di, connDomain_D, cidx_D, 
                                             conn_D, host, ip, connDomain_Di, 
                                             cidx_Di, conn_Di, depth_P, pkt_, 
                                             ipkt_, entry_, conn_P, 
                                             hostMarker_, ip_idx_, ipidx_, 
                                             ip_P, host_P, pkt_P, ipkt_P, 
                                             entry_P, conn_Pu, hostMarker_P, 
                                             ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                             conn, sport, dstAddr, dport, 
                                             pkt_Pr, hostMarker_Pr, daddr_, 
                                             hostidx_, hidx_P, otherEntry_, i_, 
                                             indicies_, portDomain_, 
                                             sourcePort_, destPort_, 
                                             new_sport_, depth_Pr, pkt_Pri, 
                                             conn_Pr, hostMarker_Pri, daddr_P, 
                                             hostidx_P, hidx_Pr, otherEntry_P, 
                                             i_P, indicies_P, portDomain_P, 
                                             sourcePort_P, destPort_P, 
                                             new_sport_P, pkt_Priv, conn_Pri, 
                                             hostMarker_Priv, daddr_Pr, 
                                             hostidx_Pr, hidx_Pri, 
                                             otherEntry_Pr, i_Pr, indicies_Pr, 
                                             portDomain_Pr, sourcePort_Pr, 
                                             destPort_Pr, new_sport_Pr, 
                                             depth_C, host_C, hidx_Co, 
                                             host_idx, pidx, port_idx, 
                                             depth_Di, ip_D, host_Di, 
                                             connDomain, cidx, conn_Dis, 
                                             depth_Pu, pkt_Pu, ipkt_Pu, 
                                             entry_Pu, conn_Pub, hostMarker_Pu, 
                                             ip_idx_Pu, ipidx_Pu, ip_Pub, 
                                             host_Pub, depth_Pri, pkt_PrivT, 
                                             conn_Priv, hostMarker_PrivT, 
                                             daddr_Pri, hostidx_Pri, hidx_Priv, 
                                             otherEntry_Pri, i_Pri, 
                                             indicies_Pri, portDomain_Pri, 
                                             sourcePort_Pri, destPort_Pri, 
                                             new_sport_Pri, good_, depth_E, 
                                             i_E, j_, ip_E, host_E, indecies_, 
                                             depth_Ev, i_Ev, j_E, ip_Ev, 
                                             host_Ev, indecies_E, i_C, i_Ch, 
                                             depth_Pub, pkt_Pub, ipkt_Pub, 
                                             entry_Pub, conn_PubT, 
                                             hostMarker_Pub, ip_idx_Pub, 
                                             ipidx_Pub, ip_PubT, host_PubT, 
                                             depth_Priv, pkt_PrivTo, 
                                             conn_PrivT, hostMarker_PrivTo, 
                                             daddr_Priv, hostidx_Priv, 
                                             hidx_PrivT, otherEntry_Priv, 
                                             i_Priv, indicies_Priv, 
                                             portDomain_Priv, sourcePort_Priv, 
                                             destPort_Priv, new_sport_Priv, 
                                             depth_PubT, pkt_PubT, ipkt, entry, 
                                             conn_PubTo, hostMarker_PubT, 
                                             ip_idx, ipidx, ip_PubTo, 
                                             host_PubTo, depth_PrivT, pkt, 
                                             conn_PrivTo, hostMarker, daddr, 
                                             hostidx, hidx, otherEntry, 
                                             i_PrivT, indicies, portDomain, 
                                             sourcePort, destPort, new_sport, 
                                             good, depth, i_Even, j, ip_Even, 
                                             host_Even, indecies, i_Che, i, aa >>

checkModelVulnInc(self) == /\ pc[self] = "checkModelVulnInc"
                           /\ i' = [i EXCEPT ![self] = i[self] + 1]
                           /\ pc' = [pc EXCEPT ![self] = "checkModelVulnWhile"]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, Marker1, Marker2, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, stack, depth_, host_, 
                                           hidx_, host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           aa >>

checkModelVulnRet(self) == /\ pc[self] = "checkModelVulnRet"
                           /\ pc' = [pc EXCEPT ![self] = Head(stack[self]).pc]
                           /\ i' = [i EXCEPT ![self] = Head(stack[self]).i]
                           /\ stack' = [stack EXCEPT ![self] = Tail(stack[self])]
                           /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, 
                                           Dd, Ee, Ff, Gg, Hh, Ii, Jj, Kk, Ll, 
                                           Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, 
                                           Vv, Ww, Xx, Yy, Zz, H1, H2, 
                                           MaxPorts, EP1, PortMap1, EP2, 
                                           PortMap2, TableFull, 
                                           EvictionReroute, PortScanInv, 
                                           MaxTableSize, hosts, FreeHosts, 
                                           UsedHosts, Ports, ExtraPorts, 
                                           ExtraExtraPorts, T, FreeIPs, 
                                           UsedIPs, Connections, SendQueue, 
                                           RcvQueue, MAX, Marker1, Marker2, 
                                           CmdConnect, CmdDisconnect, 
                                           PortSpaceFull, depth_, host_, hidx_, 
                                           host_idx_, pidx_, port_idx_, 
                                           depth_D, ip_, host_D, connDomain_, 
                                           cidx_, conn_, host_Co, ip_C, hidx_C, 
                                           host_idx_C, pidx_C, port_idx_C, 
                                           host_Dis, ip_Di, connDomain_D, 
                                           cidx_D, conn_D, host, ip, 
                                           connDomain_Di, cidx_Di, conn_Di, 
                                           depth_P, pkt_, ipkt_, entry_, 
                                           conn_P, hostMarker_, ip_idx_, 
                                           ipidx_, ip_P, host_P, pkt_P, ipkt_P, 
                                           entry_P, conn_Pu, hostMarker_P, 
                                           ip_idx_P, ipidx_P, ip_Pu, host_Pu, 
                                           conn, sport, dstAddr, dport, pkt_Pr, 
                                           hostMarker_Pr, daddr_, hostidx_, 
                                           hidx_P, otherEntry_, i_, indicies_, 
                                           portDomain_, sourcePort_, destPort_, 
                                           new_sport_, depth_Pr, pkt_Pri, 
                                           conn_Pr, hostMarker_Pri, daddr_P, 
                                           hostidx_P, hidx_Pr, otherEntry_P, 
                                           i_P, indicies_P, portDomain_P, 
                                           sourcePort_P, destPort_P, 
                                           new_sport_P, pkt_Priv, conn_Pri, 
                                           hostMarker_Priv, daddr_Pr, 
                                           hostidx_Pr, hidx_Pri, otherEntry_Pr, 
                                           i_Pr, indicies_Pr, portDomain_Pr, 
                                           sourcePort_Pr, destPort_Pr, 
                                           new_sport_Pr, depth_C, host_C, 
                                           hidx_Co, host_idx, pidx, port_idx, 
                                           depth_Di, ip_D, host_Di, connDomain, 
                                           cidx, conn_Dis, depth_Pu, pkt_Pu, 
                                           ipkt_Pu, entry_Pu, conn_Pub, 
                                           hostMarker_Pu, ip_idx_Pu, ipidx_Pu, 
                                           ip_Pub, host_Pub, depth_Pri, 
                                           pkt_PrivT, conn_Priv, 
                                           hostMarker_PrivT, daddr_Pri, 
                                           hostidx_Pri, hidx_Priv, 
                                           otherEntry_Pri, i_Pri, indicies_Pri, 
                                           portDomain_Pri, sourcePort_Pri, 
                                           destPort_Pri, new_sport_Pri, good_, 
                                           depth_E, i_E, j_, ip_E, host_E, 
                                           indecies_, depth_Ev, i_Ev, j_E, 
                                           ip_Ev, host_Ev, indecies_E, i_C, 
                                           i_Ch, depth_Pub, pkt_Pub, ipkt_Pub, 
                                           entry_Pub, conn_PubT, 
                                           hostMarker_Pub, ip_idx_Pub, 
                                           ipidx_Pub, ip_PubT, host_PubT, 
                                           depth_Priv, pkt_PrivTo, conn_PrivT, 
                                           hostMarker_PrivTo, daddr_Priv, 
                                           hostidx_Priv, hidx_PrivT, 
                                           otherEntry_Priv, i_Priv, 
                                           indicies_Priv, portDomain_Priv, 
                                           sourcePort_Priv, destPort_Priv, 
                                           new_sport_Priv, depth_Eve, i_Eve, 
                                           j_Ev, ip_Eve, host_Eve, indecies_Ev, 
                                           depth_PubT, pkt_PubT, ipkt, entry, 
                                           conn_PubTo, hostMarker_PubT, ip_idx, 
                                           ipidx, ip_PubTo, host_PubTo, 
                                           depth_PrivT, pkt, conn_PrivTo, 
                                           hostMarker, daddr, hostidx, hidx, 
                                           otherEntry, i_PrivT, indicies, 
                                           portDomain, sourcePort, destPort, 
                                           new_sport, good, depth, i_Even, j, 
                                           ip_Even, host_Even, indecies, i_Che, 
                                           aa >>

CheckModelExitVuln(self) == checkModelVulnStart(self)
                               \/ checkModelVulnWhile(self)
                               \/ checkModelVulnInc(self)
                               \/ checkModelVulnRet(self)

foo1 == /\ pc["A"] = "foo1"
        /\ PrintT("Test")
        /\ stack' = [stack EXCEPT !["A"] = << [ procedure |->  "CheckModelExitVuln",
                                                pc        |->  "Done",
                                                i         |->  i["A"] ] >>
                                            \o stack["A"]]
        /\ i' = [i EXCEPT !["A"] = defaultInitValue]
        /\ pc' = [pc EXCEPT !["A"] = "checkModelVulnStart"]
        /\ UNCHANGED << A, B, C, D, N, E, NN, Aa, Bb, Cc, Dd, Ee, Ff, Gg, Hh, 
                        Ii, Jj, Kk, Ll, Mm, Nn, Oo, Pp, Qq, Rr, Ss, Tt, Uu, Vv, 
                        Ww, Xx, Yy, Zz, H1, H2, MaxPorts, EP1, PortMap1, EP2, 
                        PortMap2, TableFull, EvictionReroute, PortScanInv, 
                        MaxTableSize, hosts, FreeHosts, UsedHosts, Ports, 
                        ExtraPorts, ExtraExtraPorts, T, FreeIPs, UsedIPs, 
                        Connections, SendQueue, RcvQueue, MAX, Marker1, 
                        Marker2, CmdConnect, CmdDisconnect, PortSpaceFull, 
                        depth_, host_, hidx_, host_idx_, pidx_, port_idx_, 
                        depth_D, ip_, host_D, connDomain_, cidx_, conn_, 
                        host_Co, ip_C, hidx_C, host_idx_C, pidx_C, port_idx_C, 
                        host_Dis, ip_Di, connDomain_D, cidx_D, conn_D, host, 
                        ip, connDomain_Di, cidx_Di, conn_Di, depth_P, pkt_, 
                        ipkt_, entry_, conn_P, hostMarker_, ip_idx_, ipidx_, 
                        ip_P, host_P, pkt_P, ipkt_P, entry_P, conn_Pu, 
                        hostMarker_P, ip_idx_P, ipidx_P, ip_Pu, host_Pu, conn, 
                        sport, dstAddr, dport, pkt_Pr, hostMarker_Pr, daddr_, 
                        hostidx_, hidx_P, otherEntry_, i_, indicies_, 
                        portDomain_, sourcePort_, destPort_, new_sport_, 
                        depth_Pr, pkt_Pri, conn_Pr, hostMarker_Pri, daddr_P, 
                        hostidx_P, hidx_Pr, otherEntry_P, i_P, indicies_P, 
                        portDomain_P, sourcePort_P, destPort_P, new_sport_P, 
                        pkt_Priv, conn_Pri, hostMarker_Priv, daddr_Pr, 
                        hostidx_Pr, hidx_Pri, otherEntry_Pr, i_Pr, indicies_Pr, 
                        portDomain_Pr, sourcePort_Pr, destPort_Pr, 
                        new_sport_Pr, depth_C, host_C, hidx_Co, host_idx, pidx, 
                        port_idx, depth_Di, ip_D, host_Di, connDomain, cidx, 
                        conn_Dis, depth_Pu, pkt_Pu, ipkt_Pu, entry_Pu, 
                        conn_Pub, hostMarker_Pu, ip_idx_Pu, ipidx_Pu, ip_Pub, 
                        host_Pub, depth_Pri, pkt_PrivT, conn_Priv, 
                        hostMarker_PrivT, daddr_Pri, hostidx_Pri, hidx_Priv, 
                        otherEntry_Pri, i_Pri, indicies_Pri, portDomain_Pri, 
                        sourcePort_Pri, destPort_Pri, new_sport_Pri, good_, 
                        depth_E, i_E, j_, ip_E, host_E, indecies_, depth_Ev, 
                        i_Ev, j_E, ip_Ev, host_Ev, indecies_E, i_C, i_Ch, 
                        depth_Pub, pkt_Pub, ipkt_Pub, entry_Pub, conn_PubT, 
                        hostMarker_Pub, ip_idx_Pub, ipidx_Pub, ip_PubT, 
                        host_PubT, depth_Priv, pkt_PrivTo, conn_PrivT, 
                        hostMarker_PrivTo, daddr_Priv, hostidx_Priv, 
                        hidx_PrivT, otherEntry_Priv, i_Priv, indicies_Priv, 
                        portDomain_Priv, sourcePort_Priv, destPort_Priv, 
                        new_sport_Priv, depth_Eve, i_Eve, j_Ev, ip_Eve, 
                        host_Eve, indecies_Ev, depth_PubT, pkt_PubT, ipkt, 
                        entry, conn_PubTo, hostMarker_PubT, ip_idx, ipidx, 
                        ip_PubTo, host_PubTo, depth_PrivT, pkt, conn_PrivTo, 
                        hostMarker, daddr, hostidx, hidx, otherEntry, i_PrivT, 
                        indicies, portDomain, sourcePort, destPort, new_sport, 
                        good, depth, i_Even, j, ip_Even, host_Even, indecies, 
                        i_Che, aa >>

Foo == foo1

(* Allow infinite stuttering to prevent deadlock on termination. *)
Terminating == /\ \A self \in ProcSet: pc[self] = "Done"
               /\ UNCHANGED vars

Next == Foo
           \/ (\E self \in ProcSet:  \/ ConnectVuln(self) \/ DisconnectVuln(self)
                                     \/ ConnectMan(self) \/ DisconnectMan(self)
                                     \/ DisconnectVulnMan(self) \/ Evict(self)
                                     \/ PubToPrivVuln(self) \/ PubToPrivMan(self)
                                     \/ PrivToPubMan2(self) \/ PrivToPubVuln(self)
                                     \/ PrivToPubMan(self) \/ Connect(self)
                                     \/ Disconnect(self) \/ PubToPriv(self)
                                     \/ PrivToPub(self) \/ OldPortScan(self)
                                     \/ EventSequenceVuln(self)
                                     \/ EventSequence(self) \/ CheckModel(self)
                                     \/ CheckModelVuln(self) \/ PortScan(self)
                                     \/ PubToPrivExitVuln(self)
                                     \/ PrivToPubExitVuln(self)
                                     \/ EventSequenceExitVuln(self)
                                     \/ PubToPrivExit(self) \/ PrivToPubExit(self)
                                     \/ EventSequenceExit(self)
                                     \/ CheckModelExit(self)
                                     \/ CheckModelExitVuln(self))
           \/ Terminating

Spec == Init /\ [][Next]_vars

Termination == <>(\A self \in ProcSet: pc[self] = "Done")

\* END TRANSLATION 

=============================================================================
\* Modification History
\* Created Mon Feb 06 22:08:35 UTC 2023 by ben
